!function(){"use strict";!function(){function e(e,t,n,o,a,i,r){function c(){setTimeout(function(){var e=$(".event-detail-table tbody");e&&void 0!==e.html()&&e.find("tr").each(function(e,t){var n=$(t).find(".event-detail");n&&n.attr("data-title",n.html())})},300)}function u(e){angular.forEach(e,function(e){var t=kendo.parseDate(e.scheduledStartDateTime),n=kendo.parseDate(e.scheduledFinishDateTime);t&&n&&f.calendar.events.push({startTime:t,endTime:n,allDay:!1,title:e.barcodeName+" (Estimate)",originalObject:angular.copy(e),eventType:2})})}function l(e){angular.forEach(e,function(e,t){var n=kendo.parseDate(e.scheduledStartDateTime),o=kendo.parseDate(e.scheduledFinishDateTime);n&&o&&f.calendar.events.push({startTime:n,endTime:o,allDay:!1,title:e.barcodeName+" ("+e.technicianName+") "+e.technicianBio,originalObject:angular.copy(e),eventType:1})})}function s(e){angular.forEach(e,function(e){var t=kendo.parseDate(e.cacationDate),n=kendo.parseDate(e.vacationDate);e.endDateTime&&(n=kendo.parseDate(e.endDateTime)),t&&n&&f.calendar.events.push({startTime:t,endTime:n,allDay:e.isAllDay,title:e.vacationString,originalObject:angular.copy(e),eventType:3})})}function d(e){f.calendar.events=[],f.loadingCalender=!0,r.getDatewiseEvents(e).then(function(e){e&&(e.estimates&&e.estimates.length>0&&u(e.estimates),e.schedules&&e.schedules.length>0&&l(e.schedules),e.vacations&&e.vacations.length>0&&s(e.vacations)),f.loadingCalender=!1})}function m(){var e=o.get(p.settingsKeyName);e&&e.DefaultCalenderViewForMobile&&("workWeek"===e.DefaultCalenderViewForMobile?f.events.changeMode("week"):f.events.changeMode(e.DefaultCalenderViewForMobile)),d(!1)}var f=this,p=i.localStorageKeys;f.calendar={mode:"day",events:[],noEventLabel:"No Schedules Found",currentDate:new Date};var h=[{text:"Work Week View",mode:"week",otext:"Work Week View"},{text:"Day View",mode:"day",otext:"Day View"},{text:"Month View",mode:"month",otext:"Month View"},{text:"Refresh Calender",mode:"null",otext:"Refresh Calender"}];f.viewTitle="Calendar";a.alerts;f.events={refreshCalender:function(){d(!0)},onTimeSelected:function(e,t){c()},onEventSelected:function(e){if(1===e.eventType){var n=e.originalObject;a.alerts.confirm("Confirmation","Are you sure to edit this work order?",function(){t.go("app.editOrder",{barCode:n.barcode,technicianNum:n.num,src:"calender"})})}},today:function(){f.calendar.currentDate=new Date},changeMode:function(e){f.calendar.mode=e,angular.forEach(h,function(e){e.text=e.otext});var t=_.findWhere(h,{mode:e});t&&(t.text=t.otext+"<i class='icon ion-checkmark'></i>")},onViewTitleChanged:function(e){f.viewTitle=e},refreshOnPullDown:function(){d(!0)},showActionSheet:function(){n.show({buttons:h,titleText:"Calendar Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&f.events.changeMode("week"),1===e&&f.events.changeMode("day"),2===e&&f.events.changeMode("month"),3===e&&d(!0),!0}})}},f.loadingCalender=!1,e.$on("$ionicView.beforeEnter",function(t,n){e.$root.showNavButton=!0}),e.$on("$ionicView.afterEnter",function(e,t){m()})}e.$inject=["$scope","$state","$ionicActionSheet","localStorageService","fpm-utilities-factory","fieldPromaxConfig","work-orders-factory"],angular.module("fpm").controller("calendar-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a){function i(){n.getComponents().then(function(e){if(c.showEmptyMessage=null===e,angular.isArray(e)){var t=[];angular.forEach(e,function(n,o){n.isOpen=!1,t.push(n),o===e.length-1&&(c.components=t)})}})}function r(){i()}var c=this;c.showingLoading=!1,c.userInfo=o.getLoggedInUserInfo(),c.dateFormat=c.userInfo.dateFormat,c.reportModel={startDate:null,endDate:null};var u={BarcodeName:"Wo#",ActualStartDateTime:"Start Date"};c.events={onChildGroupClicked:function(e){e.isOpen=!e.isOpen},refreshOnPullDown:function(){i(),e.$broadcast("scroll.refreshComplete")},runReport:function(){c.columns=[];var e=[];a.showLoading("Generating report..."),c.showingLoading=!0,n.generateReport(c.reportModel).then(function(n){t(function(){var t=angular.element("#tableReport");if(t.find("tbody").html(""),n&&(c.result=JSON.parse(n),c.result&&c.result.length>0)){var o=c.result[0];for(var a in o)e.push(a),"BarcodeName"===a||"ActualStartDateTime"===a?c.columns.push({colName:u[a]}):c.columns.push({colName:a});angular.forEach(c.result,function(n,o){var a="<tr>";if(c.result.length-1===o)var a="<tr class='success'>";var i=c.dateFormat.toUpperCase();angular.forEach(e,function(o,r){var u="";"ActualStartDateTime"===o?n[o]&&c.dateFormat&&(u=moment(new Date(n[o])).format(i)):u=n[o]||"",a+="<td>"+u+"</td>",r===e.length-1&&(a+="</tr>",t.find("tbody").append(a))})})}},100)}).finally(function(){a.hideLoading(),c.showingLoading=!1})}},e.$on("$ionicView.afterEnter",function(e,t){r()})}e.$inject=["$scope","$timeout","custom-components-factory","authenticationFactory","fpm-utilities-factory"],angular.module("fpm").controller("custom-components-controller",e)}()}(),function(){"use strict";!function(){function e(e,t){function n(){return e.get(a+"GetCustomComponents")}function o(t){if(t){if(t.startDate)var n=kendo.toString(t.startDate,"g");if(t.endDate)var o=kendo.toString(t.endDate,"g")}return e.get(a+"GetTimeWorkedReport?startDate="+n+"&endDate="+o)}var a="api/CustomComponents/";return{generateReport:o,getComponents:n}}e.$inject=["api-base-factory","fieldPromaxConfig"],angular.module("fpm").factory("custom-components-factory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r,c,u,l,s,d,m,f){function p(){D=[],!b.isServiceProvider||b.havingGroupsAssigned?angular.forEach(b.result,function(e,t){e.dataForAdministrator&&e.dataForAdministrator.length>0&&_.forEach(e.dataForAdministrator,function(e){e.ordersJson&&_.forEach(JSON.parse(e.ordersJson),function(e){D.push(e)})})}):angular.forEach(b.result,function(e,t){e.dataForServiceProvider&&e.dataForServiceProvider.length>0&&_.forEach(e.dataForServiceProvider,function(e){D.push(e)})})}function h(e,t){b.showingLoading=!0,r.getMobileDashboard(e).then(function(e){b.result=e.result,b.havingGroupsAssinged=e.havingGroupsAssinged,b.isServiceProvider&&!b.havingGroupsAssigned&&(E="barcodeName",I="displayName"),p()}).finally(function(){b.showingLoading=!1,angular.isFunction(t)&&t()})}function g(e){S.confirmWithOkayCancel("Confirmation!","Your status has been updated to In Route",function(){s.showLoading().then(function(){r.updateJobStatus({scheduleButton:T.InRoute,scheduleNum:e.TechnicianScheduleNum,barcode:e.Barcode,ClientTime:kendo.toString(new Date,"g")}).then(function(){e.InRoute=!0}).finally(function(){s.hideLoading(),!0===w.enabled&&C()})})})}function y(e){_.where(w.currentDetails,{finishTime:null}).length>0?S.confirmWithOkayCancel("Confirmation","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(){g(e)}):g(e)}function C(){var e={CLOCK_IN:5001,CLOCK_OUT:5002},t=new Date,n=kendo.toString(new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),"g");l.getTimeCardByDate(n).then(function(t){t&&(w.todaysClockIns=_.where(t.timeCardDetails,{jobCode:e.CLOCK_IN}),w.currentDetails=_.reject(t.timeCardDetails,{jobCode:e.CLOCK_IN}))})}function v(){w.enabled=b.userInfo.timeCard||!1,b.havingGroupsAssigned=b.userInfo.havingGroupsAssigned,b.isServiceProvider=!b.userInfo.isAdminstrator,c.updateLocationServiceStatus(b.userInfo.userEmail),!0===w.enabled&&C(),c.getIniitialData().then(function(e){b.trackJobStatus=e.customerNumberEntity.trackJobStatus||!1,f.serviceProviders=e.serviceProviders,f.isServiceProvider=b.isServiceProvider;var t=e.customerNumberEntity.parsedCompanyConfiguration;e.customerNumberEntity&&t&&(f.showEditDeleteForServiceProvider=t.allowServiceProviderTeamLeadsToEditSchedules)}).finally(function(){h(!!angular.isDefined(n.refresh)&&n.refresh,null)})}var b=this;b.userInfo=u.getLoggedInUserInfo();var D=[],w={enabled:!1,clockedInInfo:null,currentDetails:[],todaysClockIns:[]},S=s.alerts;b.showingLoading=!0;var T={AcceptJob:0,InRoute:1,CheckIn:3,CheckOut:4};b.isSearchModalOpened=!1;var k=null;b.sortingType="WorkPerformedDate",b.sortingOrderDesc=!1,b.events={onDotsClicked:function(e,t){var n=t?"Sort "+e.technicianName+"'s work orders":"Sort "+e.heading;i.show({buttons:[{text:"Sort Ascending"},{text:"Sort Descending"}],titleText:n,cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return b.sortingOrderDesc=1===e,!0}})},inRouteClicked:function(e){if(!1===w.enabled)g(e);else{var n=_.findWhere(w.todaysClockIns,{finishTime:null});angular.isDefined(n)?y(e):S.confirm("Warning!","You have not Clocked-In yet. Would you like to Clock-In now?",function(){t.go("app.timecard",{proute:t.current.name})})}},onSearchItemClick:function(e){e&&(b.matchedOrders=[],b.isSearchModalOpened=!1,b.searchModal.hide(),b.searchValue="",k=b.isServiceProvider&&!b.havingGroupsAssigned?o(function(){t.go("app.editOrder",{barCode:e.barcode,technicianNum:e.technicianScheduleNum,src:"main"})},300):o(function(){t.go("app.editOrder",{barCode:e.Barcode,technicianNum:e.TechnicianScheduleNum,src:"main"})},300))},applySearch:function(){if(D&&D.length>0){var e=b.searchValue.toLowerCase(),t=_.filter(D,function(t){return t[E].indexOf(e)>-1||t[I].toLowerCase().indexOf(e)>-1});b.matchedOrders=_.uniq(t,function(e,t,n){return e[E]})}},closeSearchModal:function(){b.matchedOrders=[],b.isSearchModalOpened=!1,b.searchModal.hide(),b.searchValue=""},openSearchModal:function(){b.searchValue="",b.matchedOrders=[],b.isSearchModalOpened=!0,b.searchModal.show()},refreshOnPullDown:function(){h(!0,function(){e.$broadcast("scroll.refreshComplete")})},onChildGroupClicked:function(e,t,n){e.isOpen=!e.isOpen;var o=d.get("orderState");if(null===o&&(o={}),"DD"===t)return!0===e.isOpen?(o[n]=e,d.set("orderState",o)):d.set("orderState",null),!1;!0===e.isOpen&&0===e.clickCount?(o[n]=e,d.set("orderState",o),"SP"===t?e.dataForServiceProvider=JSON.parse(e.ordersJson):e.ordersN=JSON.parse(e.ordersJson),e.clickCount+=1):(o[n]=null,d.set("orderState",o))}},b.havingGroupsAssigned=!1;var E="BarcodeName",I="DisplayName";e.$on("network:connection:changed",function(e,t){}),e.$on("$ionicView.beforeEnter",function(e,t){v()}),e.$on("$fpm:scheduleChanged",function(e,t){h(!0,null)}),e.$on("$destroy",function(){b.searchModal.remove(),k&&o.cancel(k)}),b.showClockinButton=!0,a.fromTemplateUrl("dashboardSearchModal.html",{scope:e,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){b.searchModal=e})}e.$inject=["$scope","$state","$stateParams","$timeout","$ionicModal","$ionicActionSheet","work-orders-factory","shared-data-factory","authenticationFactory","timecard-factory","fpm-utilities-factory","localStorageService","sqlStorageFactory","dashboard-factory"],angular.module("fpm").controller("dashboard-controller",e)}()}(),function(){"use strict";!function(){function e(e){return{serviceProviders:[],showEditDeleteForServiceProvider:!1,isServiceProvider:!1}}e.$inject=["api-base-factory"],angular.module("fpm").factory("dashboard-factory",e)}()}(),function(){"use strict";!function(){function e(e,t){function n(){i&&(i=!1,o()),a.modal&&a.modal.show()}function o(){t.fromTemplateUrl("helpModalTemplate.html",{scope:e,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){a.modal=e})}var a=this,i=!1;a.events={onHelpButtonClicked:n},a.modal={},e.$on("$fp.onQuestionModalClosedClicked",function(){a.modal.hide()}),a.$onDestroy=function(){a.modal.remove(),i=!0},a.$onInit=function(){o()}}e.$inject=["$scope","$ionicModal"],angular.module("fpm").component("helpButtonComponent",{controller:e,controllerAs:"vm",templateUrl:"js/dashboard/help.button.component.html"})}()}(),function(){"use strict";!function(){function e(e,t,n,o){var a=this;a.data={posting:!1,showSuccessMessage:!1,entity:{question:"",description:"",fromMobile:!0}};var i=o.alerts;a.events={onSubmitClicked:function(e){a.data.posting=!0;var t=a.data.entity;t.fromMobile=!0,e&&n.submitQuestion(t).then(function(e){i.alert("Success!","Your question has been submitted successfully. We will get back to you shortly."),a.data.posting=!1,a.events.closePopoutModal()})},closePopoutModal:function(){a.modalwindow?a.modalwindow.hide():e.$emit("$fp.onQuestionModalClosedClicked",{_dt:new Date}),a.data.posting=!1,a.data.entity.question="",a.data.entity.description=""}},a.$onDestroy=function(){t.offHardwareBackButton(function(){})},a.$onInit=function(){t.registerBackButtonAction(function(e){a.event.closePopoutModal()})}}e.$inject=["$scope","$ionicPlatform","shared-data-factory","fpm-utilities-factory"],angular.module("fpm").component("helpQuestionModalComponent",{bindings:{modalwindow:"<"},controller:e,controllerAs:"vm",templateUrl:"js/dashboard/help.question.modal.component.html"})}()}(),function(){"use strict";!function(){angular.module("fpm").component("workorderViewComponent",{bindings:{odr:"<",trackJobStatus:"<",userInfo:"<",inRouteClicked:"&",index:"<"},controller:["$scope","$state","$rootScope","fpm-utilities-factory","authenticationFactory","sqlStorageFactory","work-orders-factory","dashboard-factory",function(e,t,n,o,a,i,r,c){var u={AcceptJob:0,InRoute:1,unAcceptJob:4},l=this;l.userInfo=a.getLoggedInUserInfo(),l.scheduleEditModal=null,l.allowedForSp=!1,l.events={onModalCancelClicked:function(){l.scheduleEditModal.hide()},onEditCompleted:function(t){o.alerts.alert("Success!","Schedule has been updated successfully.",function(){l.scheduleEditModal.hide(),e.$emit("$fpm:scheduleChanged",{scheduleId:l.odr.TechnicianScheduleNum})})},onEditButtonClicked:function(){o.showLoading().then(function(){r.getScheduleById(l.odr.TechnicianScheduleNum).then(function(t){t&&t.schedule&&(t.schedule.workComplete?o.alerts.alert("Warning!","Schedule has been marked as completed.",function(){l.odr.workComplete=t.schedule.workComplete}):(l.schedule=t.schedule,null===l.scheduleEditModal?o.getModal("editScheduleModal.html",e).then(function(e){l.scheduleEditModal=e,l.scheduleEditModal.show()}):l.scheduleEditModal.show()))}).finally(function(){o.hideLoading()})})},onDeleteButtonClicked:function(){o.alerts.confirm("Confirmation","Are you sure you want to delete the schedule?",function(){o.showLoading().then(function(){r.deleteSchedule(l.odr.TechnicianScheduleNum).then(function(t){t&&t.success&&o.alerts.alert("Success!","Schedule has been deleted.",function(){e.$emit("$fpm:scheduleChanged",{scheduleId:l.odr.TechnicianScheduleNum})})}).finally(function(){o.hideLoading()})})})},saveOrderRefOffline:function(){o.alerts.confirm("Confirmation!","Are you sure?",function(){var e=l.odr.Barcode,t=l.odr.TechnicianScheduleNum;i.insertWorkOrderRef({barcode:e,scheduleNum:t,userName:l.userInfo.userEmail,jsonPayload:JSON.stringify(l.odr)}).then(function(a){0!==a&-1!==a&&(n.$broadcast("$offline:newOrderSaved",{barcode:e}),o.alerts.alert("Success!","Work order saved.",function(){o.showLoading().then(function(){r.getBarcodeDetails(e).then(function(e){e&&i.insertWorkOrderInfo(e,t)}).finally(function(){o.hideLoading()})})})),-1===a&&o.alerts.alert("Warning","This work order already saved.",function(){o.hideLoading()})})})},unAcceptJob:function(){o.alerts.confirm("Confirmation!","Are you sure you want to un-accept this job?",function(){o.showLoading().then(function(){r.updateJobStatus({scheduleButton:u.unAcceptJob,scheduleNum:l.odr.TechnicianScheduleNum}).then(function(){l.odr.JobAcceptanceStatus=!1}).finally(o.hideLoading)})})},acceptJob:function(){o.alerts.confirm("Confirmation!","Are you sure you want to accept this job?",function(){o.showLoading().then(function(){r.updateJobStatus({scheduleButton:u.AcceptJob,scheduleNum:l.odr.TechnicianScheduleNum}).then(function(){l.odr.JobAcceptanceStatus=!0}).finally(o.hideLoading)})})},inRouteClicked:function(){angular.isFunction(l.inRouteClicked)&&o.alerts.confirm("Confirmation!","Are you sure?",function(){l.inRouteClicked({odr:l.odr})})},onOrderClicked:function(){l.odr&&t.go("app.editOrder",{barCode:l.odr.Barcode,technicianNum:l.odr.TechnicianScheduleNum,src:"main"})}};var s=["97713","97719","99009","97678","97636"];l.$onInit=function(){var e=s.indexOf(l.userInfo.customerNumber)>-1;l.isTrafficControllerCustomer=l.userInfo.isTrafficControllerCustomer||!1,l.forIntegrityCustomer=e,l.serviceProviders=c.serviceProviders,l.allowedForSp=c.isServiceProvider&&c.showEditDeleteForServiceProvider}}],controllerAs:"vm",templateUrl:"js/dashboard/workorder-view-component-template.html"})}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i){function r(){t.go("app.dashboard",{refresh:!1})}function c(e){e?i.alerts.confirm("Confirmation","Are you sure?",function(){r()}):r()}function u(e){s.errors=[],e?i.showLoading().then(function(){o.createCustomer(s.customerModel).then(function(e){angular.isArray(e.errors)&&e.errors.length>0?s.errors=e.errors:i.alerts.alert("Success","Customer created successfully",function(){r()})}).finally(i.hideLoading)}):s.errors.push("Please check all values before save")}function l(){s.customerModel=angular.copy(d)}var s=this,d={displayName:"",firstName:"",lastName:"",companyName:"",email:"",phone:"",mobile:"",fax:"",bStreet:"",bCity:"",bState:"",bZip:"",sStreet:"",sCity:"",sState:"",sZip:"",uinNum:""};s.errors=[],s.events={sameAsBilling:function(){s.customerModel&&(s.customerModel.sStreet=s.customerModel.bStreet,s.customerModel.sState=s.customerModel.bState,s.customerModel.sCity=s.customerModel.bCity,s.customerModel.sZip=s.customerModel.bZip)},clearAddress:function(){s.customerModel.sStreet="",s.customerModel.sState="",s.customerModel.sCity="",s.customerModel.sZip=""},onBackToDashboardClicked:c,onSubmitButtonClicked:u},e.$on("$ionicView.afterEnter",function(e,t){l()})}e.$inject=["$scope","$state","$ionicActionSheet","customers-file-factory","localStorageService","fpm-utilities-factory"],angular.module("fpm").controller("create-customer-controller",e)}()}(),function(){"use strict";!function(){function e(e,t){function n(t){return e.get(l+"SearchCustomers?searchPattern="+t)}function o(t){return e.post(l+"CreateCustomer?fromMobile=true",t)}function a(t){return e.get(l+"GetNotesByDisplayName?displayName="+encodeURIComponent(t))}function i(t){return e.deleteReq(l+"DeleteNote?num="+t)}function r(e){t.$broadcast("$fp:onAddEditNoteModalClosed",e)}function c(t){return e.post(l+"AddUpdateNote",t)}function u(t,n,o){return e.upload(l+"TryUploadNoteImage?customerFileNum="+o,t,n)}var l="api/CustomerFile/";return{tryUploadFile:u,onAddEditNoteModalClosed:r,addUpdateNote:c,selectedCustomer:null,selectedNote:null,addEditModal:null,attachmentsModal:null,deleteNote:i,getNotesByDisplayName:a,createCustomer:o,searchCustomers:n}}e.$inject=["api-base-factory","$rootScope"],angular.module("fpm").factory("customers-file-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{onCustomerSelected:"&",placeholder:"@",componentRef:"="},controller:["$scope","$ionicModal","customers-file-factory",function(e,t,n){function o(){c.searchValue="",c.customers=[],c.customerModal.show().then(function(){})}function a(){c.customers=[],c.searchApplied=!1,c.runningSearch=!0,n.searchCustomers(c.searchValue).then(function(e){c.searchApplied=!0,c.runningSearch=!1,angular.isArray(e)&&(c.customers=e)})}function i(){c.searchValue="",c.customers=[],c.customerModal.hide()}function r(e){c.customerModal.hide(),angular.isFunction(c.onCustomerSelected)&&c.onCustomerSelected({customer:e})}var c=this;c.componentRef=this,c.searchValue="",c.searchApplied=!1,c.runningSearch=!1,c.events={onSearchBoxTapped:o,applySearch:a,closeSearchModal:i,onCustomerSelected:r},t.fromTemplateUrl("customerSearchModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){c.customerModal=e})}],controllerAs:"vm",templateUrl:"js/customer/customer-search-header-component-template.html",replace:!0};angular.module("fpm").component("customerSearchHeaderComponent",e)}()}(),function(){"use strict";!function(){angular.module("fpm").component("equipmentCustomTypeListComponent",{bindings:{barcode:"<",entityId:"<"},controller:["equipment-factory","custom-types-factory","authenticationFactory",function(e,t,n){function o(){i.customTypes.data=[],i.factory.viewDataForEquipment=[],angular.isDefined(i.entityId)&&angular.isDefined(i.barcode)&&e.getEquipmentFields(i.entityId,i.barcode).then(function(e){if(e&&e.length>0){var t=_.where(e,{type:3});angular.forEach(t,function(e){e.value="true"===e.value||"True"===e.value||"1"===e.value}),i.customTypes.data=e,i.factory.viewDataForEquipment=i.customTypes.data}})}function a(t){3===t.type&&t.value,4===t.type&&(t.value=kendo.toString(kendo.parseDate(t.value),"g")),e.saveDataCustomTypes({num:i.entityId,barcode:i.barcode,customTypesJson:JSON.stringify(i.customTypes.data)})}var i=this;i.factory=t;var r=n.getLoggedInUserInfo();i.dateFormat=r.dateFormat,i.customTypes={data:[]};var c=0;i.events={onValueChanged:function(e){4===e.type?0===c?(a(e),c++):c=0:a(e)}},i.$onChanges=function(){i.entityId&&o()},i.$onInit=function(){i.entityId&&o()}}],controllerAs:"vm",templateUrl:"js/equipments/equipment-custom-type-list-component-template.html"})}()}(),function(){"use strict";!function(){function e(e){function t(t,n,o,a){return e.post(g+"CreateEquipment?uin="+t+"&barcode="+o+"&attach="+a,n)}function n(){return e.get(g+"GetEquipmentList")}function o(t){return e.post(g+"AddMaintenanceNote",t)}function a(t){return e.deleteApiCall(g+"DeleteEquipment?id="+t)}function i(t){return e.get(g+"GetEquipmentNotes?id="+t)}function r(t){return e.deleteApiCall(g+"DeleteNote?num="+t)}function c(t){return e.get(g+"GetEquipmentsByUin?uin="+t)}function u(t,n){return e.get(g+"AttachEquipToBarcode?barcode="+t+"&equipNum="+n)}function l(t,n){return e.get(g+"UnattachEquipToBarcode?barcode="+t+"&equipNum="+n)}function s(t){return e.get(g+"GetBarcodeEquipments?barcode="+t)}function d(t,n){return e.get(g+"GetEquipmentFields?barcode="+n+"&num="+t)}function m(t){return e.post(g+"SaveDataCustomTypes",t)}function f(t){return e.get(g+"GetEquipmentHistory?id="+t)}function p(){return e.get("/api/CustomTypes/GetCustomTypes?entityType=101&entityId=0")}var h={},g="api/equipment/";return h.getCustomDefaultTypes=p,h.createNewEquipment=t,h.getEquipments=n,h.addMaintenanceNote=o,h.deleteEquipment=a,h.getEquipmentNotes=i,h.deleteNote=r,h.getEquipmentsByUin=c,h.attachEquipToBarcode=u,h.unattachEquipToBarcode=l,h.getBarcodeEquipments=s,h.getEquipmentFields=d,h.saveDataCustomTypes=m,h.getEquipmentHistory=f,h}e.$inject=["api-base-factory"],angular.module("fpm").factory("equipment-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",uin:"<",displayName:"<"},controller:["$scope","$ionicActionSheet","equipment-factory","shared-data-factory","custom-types-factory","authenticationFactory","fpm-utilities-factory",function(e,t,n,o,a,i,r){function c(e,t){if(!0===t){var o=p.customTypesFactory.viewDataForEquipment;if(angular.isArray(o)&&o.length>0){r.showLoading();var a=_.where(o,{type:4});angular.isArray(a)&&angular.forEach(a,function(e){e.value&&(e.value=kendo.toString(kendo.parseDate(e.value),"d"))});var i=JSON.stringify(o);p.view.currentEquip?n.saveDataCustomTypes({num:p.view.currentEquip.num,barcode:p.barcode,customTypesJson:i}).then(function(){p.view.currentActiveIndex=e,p.view.currentEquip=p.view.barcodeEquipments[e]}).finally(r.hideLoading):(p.view.currentActiveIndex=e,p.view.currentEquip=p.view.barcodeEquipments[e])}else p.view.currentActiveIndex=e,p.view.currentEquip=p.view.barcodeEquipments[e]}else p.view.currentActiveIndex=e,p.view.currentEquip=p.view.barcodeEquipments[e]}function u(e,t){!0===e&&(p.view.currentActiveIndex=-1,p.view.currentEquip=null,p.view.notes=[]),p.view.gettingEquipements=!0,p.view.barcodeEquipments=[],r.showLoading().then(function(){n.getBarcodeEquipments(p.barcode).then(function(e){p.view.gettingEquipements=!1,angular.isArray(e)?(p.view.barcodeEquipments=e,1===p.view.barcodeEquipments.length?c(0,t):-1===p.view.currentActiveIndex?c(0,t):c(p.view.currentActiveIndex,t)):(p.view.currentActiveIndex=-1,p.view.currentEquip=null)}).finally(r.hideLoading)})}function l(){p.view.errors=[],r.showLoading().then(function(){n.getEquipmentsByUin(p.uin).then(function(t){if(t&&angular.isArray(t)&&0===t.length)return void r.hideLoading();p.view.allEquipments=t,p.view.equipments=_.where(t,{isRentable:!1}),p.view.rentableEquipments=_.where(t,{isRentable:!0}),r.getModal("attachEquipmentModal.html",e).then(function(e){p.view.attachEquipmentsModal=e,p.view.attachEquipmentsModal.show()})}).finally(r.hideLoading)})}function s(){if(p.view.currentEquip){var e=angular.copy(p.view.currentEquip);h.confirm("Confirmation!","Are you sure?",function(){r.showLoading().then(function(){n.unattachEquipToBarcode(p.barcode,e.num).then(function(e){!0===e&&h.alert("Success","Equipment unattached successfully",function(){u(!0,!1)})}).finally(r.hideLoading)})})}}function d(){p.uiResult=[],p.view.currentEquip?(null===p.view.equipmentHistoryModal&&r.getModal("equipmentHistoryModal.html",e).then(function(e){p.view.equipmentHistoryModal=e}),r.showLoading().then(function(){n.getEquipmentHistory(p.view.currentEquip.num).then(function(e){e&&(p.result=e,p.result.barcodes.length>0&&angular.forEach(p.result.barcodes,function(e){var t=_.filter(p.result.fields,function(t){return e.num===parseInt(t.entityKey,10)});t.length>0&&p.uiResult.push({barcodeView:e,fields:t})}))}).finally(function(){p.view.equipmentHistoryModal.show(),r.hideLoading()})})):h.alert("No Equipment Found","No Equipment Found")}function m(){p.view.errors=[],p.view.newEquipmentEntity=angular.copy(g),null===p.view.newEquipmentModal?r.getModal("newEquipmentModal.html",e).then(function(e){p.view.newEquipmentModal=e,p.view.newEquipmentModal.show()}):p.view.newEquipmentModal.show()}function f(){n.getCustomDefaultTypes().then(function(e){e&&angular.isArray(e)&&(y=e,angular.forEach(y,function(e){e.typeId=0}))})}var p=this;p.customTypesFactory=a,p.userInfo=null;var h=r.alerts;p.view={currentActiveIndex:-1,currentEquip:null,barcodeEquipments:[],notes:[],gettingEquipements:!0,attachEquipmentsModal:null,equipments:[],newEquipmentModal:null,newEquipmentEntity:null,equipmentHistoryModal:null,rentableEquipments:[],allEquipments:[]};var g={num:0,displayName:p.displayName,numFromCustomerFile:0,equipmentNumber:"",description:"",uin:p.uin,customTypesJson:""},y=[{EntityId:0,EntityType:101,UIOrder:1,Title:"Maintenance Note",Type:6},{EntityId:0,EntityType:101,UIOrder:2,Title:"Performed Date",Type:4}];p.searchValue="",p.events={onTabChanged:function(e,t){return!0},clearSearch:function(){p.searchValue="",p.view.equipments=_.where(p.view.allEquipments,{isRentable:!1}),p.view.rentableEquipments=_.where(p.view.allEquipments,{isRentable:!0})},applySearch:function(){if(p.searchValue&&""!==p.searchValue){var e=_.filter(p.view.allEquipments,function(e){return e.equipmentNumber.toLowerCase().indexOf(p.searchValue.toLowerCase())>-1});p.view.equipments=_.where(e,{isRentable:!1}),p.view.rentableEquipments=_.where(e,{isRentable:!0})}else p.view.equipments=_.where(p.view.allEquipments,{isRentable:!1}),p.view.rentableEquipments=_.where(p.view.allEquipments,{isRentable:!0})},tryAttachEquipment:function(){l()},closeHistoryModal:function(){p.view.equipmentHistoryModal&&p.view.equipmentHistoryModal.hide()},createEquipmentSubmit:function(e,t){p.view.errors=[];var o=0!==p.view.newEquipmentEntity.num;0===p.view.newEquipmentEntity.num&&(p.view.newEquipmentEntity.customTypesJson=JSON.stringify(y)),r.showLoading("creating equipment..").then(function(){n.createNewEquipment(p.uin,p.view.newEquipmentEntity,p.barcode,t).then(function(e){if(null!=e&&angular.isArray(e))p.data.errors=e;else{var n=t?"Equipment saved and attached successfully":"Equipment "+(o?"updated":"created")+" successfully";h.alert("Success!",n,function(){p.view.newEquipmentModal.hide(),u(!1)})}}).finally(r.hideLoading)})},closeNewEquipmentModal:function(){p.view.newEquipmentModal&&p.view.newEquipmentModal.hide()},closeEquipmentAttachModal:function(){p.view.attachEquipmentsModal.hide()},onAttachEquipmentItemClicked:function(e){p.view.errors=[],r.showLoading().then(function(){n.attachEquipToBarcode(p.barcode,e.num).then(function(e){null!==e&&angular.isArray(e)?(p.view.errors=e,h.alert("Warning",p.view.errors[0],function(){})):h.alert("Success","Equipment attached to work order successfully.",function(){u(!1,!0)})}).finally(r.hideLoading)})},onActionDotsClicked:function(){t.show({buttons:[{text:"Attach Equipment"},{text:"Unattach Equipment"},{text:"Show Maintenance History"},{text:"Create New Equipment"}],titleText:"Equipment Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&l(),1===e&&s(),2===e&&d(),3===e&&m(),!0}})},onEquimentNextPreButtonClicked:function(e){var t=p.view.currentActiveIndex;t=!0===e?t+1:t-1,t>p.view.barcodeEquipments.length-1&&(t=0),t<0&&(t=p.view.barcodeEquipments.length-1),c(t,!0)}},p.$onInit=function(){p.userInfo=i.getLoggedInUserInfo(),f(),u()},p.$onDestroy=function(){p.view.attachEquipmentsModal=null}}],controllerAs:"vm",templateUrl:"js/equipments/equipments-list-component-template.html"};angular.module("fpm").component("equipmentsListComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a){var i=this,r=o.alerts;i.errors=[],i.isCustomerSelected=!1,i.issameaddress,i.userInfo=a.getLoggedInUserInfo(),i.priorities=[{name:"Normal"},{name:"High"}],i.events={onBackToDashboardClicked:function(){e.go("app.estimates")},onSubmitButtonClicked:function(o){if(i.errors=[],!i.isCustomerSelected)return i.errors.push("Select a customer before save"),!1;if(o){var a=i.entity;n.getAddressCoorinates(a.wosState,a.wosZip,a.wosCity,a.wosStreet).then(function(n){i.entity.longitude=n.lat,i.entity.latitude=n.log,i.entity.estimateName="@",t.createWorkOrderEstimate(i.entity).then(function(t){t.errors?i.errors=t.errors:r.alert("Success","Estimate created successfully",function(){e.go("app.editEstimate",{id:t.entity.estimateId})})})})}else i.errors.push("Enter a valid email address.")},sameAsBilling:function(){i.issameaddress,i.entity.wosCity=i.entity.wobCity,i.entity.wosState=i.entity.wobState,i.entity.wosStreet=i.entity.wobStreet,i.entity.wosZip=i.entity.wobZip},clearServiceAddress:function(){i.entity.wosCity="",i.entity.wosState="",i.entity.wosStreet="",i.entity.wosZip="",i.issameaddress},onCustomerSelected:function(e){i.errors=[],i.entity.woDisplayName=e.name,i.entity.woFirstName=e.firstName,i.entity.woLastName=e.lastName,i.entity.woCompanyName=e.company,i.entity.wobCity=e.addressCity,i.entity.wobState=e.addressCountrySubDivCode,i.entity.wobZip=e.addressPostalCode,i.entity.uin=e.uin,i.entity.woEmail=e.email_Group,i.entity.woPhone=e.phone,i.entity.woFax=e.fax,i.entity.wobStreet=null==e.street?"":e.street.replace("::","\n"),!0===i.issameaddress?(i.entity.wosStreet=e.wobStreet,i.entity.wosState=i.entity.wobState,i.entity.wosCity=i.entity.wobCity,i.entity.wosZip=i.entity.wobZip):(i.entity.wosStreet=null==e.shipStreet?"":e.shipStreet.replace("::","\n"),i.entity.wosState=e.shipState,i.entity.wosCity=e.shipCity,i.entity.wosZip=e.shipZIP),i.isCustomerSelected=!0}},function(){n.getIniitialData().then(function(e){e&&(i.jobTypes=e.jobTypes,i.isServiceProvider=!i.userInfo.isAdminstrator)}),t.createEntity().then(function(e){i.entity=angular.copy(e),i.entity.estimateName="@"})}()}e.$inject=["$state","estimates-factory","shared-data-factory","fpm-utilities-factory","authenticationFactory"],angular.module("fpm").controller("create-estimate-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r,c){function u(){if(p.totals={subtotal:0,totalqty:0,totalcost:0,totaltax:0},p.est.invoice&&p.est.invoice.length>0){var e=p.est.estimate.woTaxRate||0;angular.forEach(p.est.invoice,function(t){if(t.price&&t.qty){var n=0;if(angular.isNumber(parseFloat(t.price))&&angular.isNumber(parseInt(t.qty,10))){if(t.markUpPercent>0){n=(parseFloat(t.price)+parseFloat((t.markUpPercent||0)/100*t.price))*t.qty}else n=t.price*t.qty;if(t.totalPrice=n,p.totals.subtotal+=parseFloat(n),p.totals.totalqty+=parseInt(t.qty,10),!0===(t.isTaxable||!1)){
var o=parseFloat(parseFloat(e)>0?parseFloat(e/100*n):0);p.totals.totaltax+=parseFloat(o)}}}})}}function l(){p.currentProduct&&(p.productModal?p.productModal.show():r.getModal("editProductModal.html",e).then(function(e){p.productModal=e,p.productModal.show()}))}function s(e){i.updateWorkOrderEstimate(p.est.estimate).then(function(t){t&&e&&h.alert("Success","Estimate has been updated successfully")})}function d(){p.productSearchModal?p.productSearchModal.show():r.getModal("productSearchModal.html",e).then(function(e){p.productSearchModal=e,p.productSearchModal.show()}),a(function(){e.$broadcast("$fpm:changeAddModalOpenPriority",!1)},1e3)}function m(e){i.getEstimateDetails(o.id).then(function(t){p.est=t,u(),e&&angular.isFunction(e)&&e()})}function f(e){var t=p.est.estimate;r.showLoading().then(function(){i.addProductToEstimate(e.productNumber,t.woBarCode,t.estimateId).then(function(e){e&&e.entity&&e.entity.products&&(p.est.products=e.entity.products,p.est.invoice=e.entity.invoice,u(),p.productSearchModal.hide())}).finally(r.hideLoading)})}var p=this;p.estimateId=o.id,p.enableMarkup=!0,p.user=c.getLoggedInUserInfo(),p.dateTimeFormat=t.dateFormat,a(function(){p.dateTimeFormat=p.user.dateFormat},100);var h=r.alerts,g=[];p.popModal={type:"DESCRIPTION",modal:null,placeholder:"enter here...",content:""},p.sendingEmail=!1,p.tabs={events:{updateClicked:function(){"DESCRIPTION"===p.popModal.type&&(p.est.estimate.woDescription=p.popModal.content),"NOTES"===p.popModal.type&&(p.est.estimate.woNotes=p.popModal.content),p.events.onDescriptionOrNotesChanged(),p.popModal.modal.hide()},closePopoutModal:function(){p.popModal.modal.hide()}}},p.events={popoutTextBox:function(t){switch(t){case"DESCRIPTION":p.popModal.content=angular.copy(p.est.estimate.woDescription);break;case"NOTES":p.popModal.content=angular.copy(p.est.estimate.woNotes)}p.popModal.type=t,p.popModal.modal?p.popModal.modal.show():r.getModal("fulltextModal.html",e).then(function(e){p.popModal.modal=e,p.popModal.modal.show()})},sendEstimateMail:function(e){if(e&&e.length>0){r.showLoading("Sending email..."),p.sendingEmail=!0;var t={estimateId:p.estimateId,selectedImages:g,emailAddresses:e};i.emailEstimateAsPdf(t).then(function(e){e&&h.alert("Success","Estimate mail has been sent.")},function(){}).finally(function(){p.sendingEmail=!1,r.hideLoading()})}},refreshOnPullDown:function(){m(function(){e.$broadcast("scroll.refreshComplete")})},onProdcutActionButtonClicked:function(){d()},onAddProductCompleted:function(e){},onEditProductClicked:function(e){p.currentProduct=e,l()},onDeleteProductClicked:function(e){h.confirmDelete(function(){r.showLoading(),i.deleteProduct(e.num,e.estimateId).then(function(e){e&&e.entity&&e.entity.products&&(p.est.products=e.entity.products,p.est.invoice=e.entity.invoice,u(),h.alert("Success","Product has been deleted successfully."))}).finally(r.hideLoading)})},onTaxCheckboaxChanged:function(e){u(),i.updateProductsForBarcodeEstimate(e)},onDescriptionOrNotesChanged:function(){s(!1)},onAddressTapped:function(){var e="http://maps.google.com/maps?saddr=Current+Location&daddr=",t=p.est.estimate;t.wosStreet&&(e+=t.wosStreet.replace("::"," ")),e+=" "+t.wosCity+", "+t.wosState+" "+t.wosZip,cordova.InAppBrowser.open(e,"_system","location=yes")}},e.$on("$fpm:onProductSelected",function(e,t){t&&f(t)}),e.$on("$fpm:operation:updateProduct",function(e,t){t&&(p.est.products=t.entity.products,p.est.invoice=t.entity.invoice,u(),p.productModal.hide())}),e.$on("fpm:imageSelectionChanged",function(e,t){g=t}),e.$on("$fpm:closeEditProductModal",function(){p.productModal.hide()}),e.$on("$fpm:closeProductSearchModal",function(){p.productSearchModal.hide()}),e.$on("$signature:completedEvent",function(){m()}),function(){m()}()}e.$inject=["$scope","$rootScope","$window","$stateParams","$timeout","estimates-factory","fpm-utilities-factory","authenticationFactory"],angular.module("fpm").controller("edit-estimate-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(){var o=n.get("estimateEntitySchema");return o?e.when(o):t.get(h+"CreateEntity").then(function(e){return n.set("estimateEntitySchema",e),e})}function a(e){return t.post(h+"CreateWorkOrderEstimate",e)}function i(){return t.get(h+"GetEstimates?status=0")}function r(e){return t.get(h+"GetEstimateDetails?estimateId="+e+"&fromMobile=true")}function c(e){return t.deleteReq(h+"DeleteEstimate?estimateId="+e)}function u(e,n,o){return t.get(h+"AddProductToEstimate?productNum="+e+"&barcode="+n+"&estimateId="+o)}function l(e,n){return t.deleteReq(h+"DeleteProductFromOrder?productNum="+e+"&estimateId="+n)}function s(e){return t.post(h+"UpdateProduct",e)}function d(e){return t.get(h+"GetEstimateImages?estimateId="+e)}function m(e){return t.post(h+"UpdateWorkOrderEstimate",e)}function f(e){return t.post(h+"UpdateProductsForBarcodeEstimate",e)}function p(e){return t.post(h+"EmailEstimateAsPdf",e)}var h="api/Estimates/";return{emailEstimateAsPdf:p,updateProductsForBarcodeEstimate:f,updateWorkOrderEstimate:m,getEstimateImages:d,updateProduct:s,deleteProduct:l,addProductToEstimate:u,deleteEstimate:c,getEstimateDetails:r,getAllEstimates:i,createWorkOrderEstimate:a,createEntity:o}}e.$inject=["$q","api-base-factory","localStorageService"],angular.module("fpm").factory("estimates-factory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function a(e){l.processing=!0,o.showLoading("Loading estimates..."),n.getAllEstimates().then(function(t){l.estimates=t.collection,l.processing=!1,angular.isFunction(e)&&e()}).finally(o.hideLoading)}function i(e,t){s.confirmDelete(function(){o.showLoading("Loading estimates..."),n.deleteEstimate(e.estimateId).then(function(e){e&&(l.estimates.splice(t,1),s.alert("Success","Estimate has been deleted successfully"))}).finally(o.hideLoading)})}function r(e){t.go("app.editEstimate",{id:e.estimateId})}function c(){t.go("app.createEstimate")}function u(){a(null)}var l=this;l.processing=!0;var s=o.alerts;l.events={refreshOnPullDown:function(){a(function(){e.$broadcast("scroll.refreshComplete")})},onCreateEstimateClicked:c,onDeleteClicked:i,onEditClicked:r},e.$on("$ionicView.afterEnter",function(e,t){u()})}e.$inject=["$scope","$state","estimates-factory","fpm-utilities-factory"],angular.module("fpm").controller("estimates-view-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r,c,u,l){var s=this,d=(r.secLevels,u.getLoggedInUserInfo()),m=c.get("configurations");s.sideMenuItems=[{title:"Home",state:"app.dashboard",icon:"home"},{title:"Calendar",state:"app.calendar",icon:"calendar"},{title:"Map",state:"app.map",icon:"location"},{title:"Create Work Order",state:"app.createWorkOrder",icon:"plus-round",isConfigurationBased:!0,configProperty:"allowCreateWorkOrders"},{title:"Create Customer",state:"app.createCustomer",icon:"plus-round",isConfigurationBased:!0,configProperty:"allowCreateWorkOrders"},{title:"Estimates",state:"app.estimates",icon:"ios-list-outline",isConfigurationBased:!0,configProperty:"allowCreateEstimates"},{title:"My Expense",state:"app.expense",icon:"cash",basedOn:"etOn",specialFeature:!0},{title:"Time Card",state:"app.timecard",icon:"clock",basedOn:"timeCard",specialFeature:!0},{title:"Custom Components",state:"app.customComponents",icon:"fork-repo",configProperty:"customComponentsAvail",isConfigurationBased:!0},{title:"Inventory",state:"app.inventory",icon:"fork-repo",basedOn:"inventoryOn"},{title:"Change Password",state:"app.changePassword",icon:"person"},{title:"Privacy",state:"app.privacy",icon:"person"},{title:"Timecard Kiosk",state:"app.timecardKiosk",icon:"clock"},{title:"Logout",state:"app.logout",icon:"power"}],e.$on("$ionicView.beforeEnter",function(e,t){n.showBackButton(!1)});a.$on("$stateChangeSuccess",function(e,t,n,o,i){"app.logout"!==t.name&&"login"!==t.name&&"app.editOrder"!==t&&"app.editEstimate"!==t&&c.set("appState",{stateName:t.name,params:n}),"login"===t.name&&"app.changePassword"===o.name&&a.$broadcast("$fpm:onLoginViewLoaded",{clearPassword:!0})});var f=["97713","97719","99009","97678","97636"];s.events={checkMenuItemVisibility:function(e){var t=d.isTrafficControllerCustomer||!1;if(e&&"app.timecard"===e.state&&(f.indexOf(d.customerNumber)>-1||t))return!1;if(t&&e&&"app.createCustomer"===e.state)return!1;if(angular.isDefined(e.basedOn)){return d[e.basedOn]}if(d.isAdministrator)return!0;if(angular.isDefined(e.isConfigurationBased)&&!0===e.isConfigurationBased&&m&&angular.isDefined(e.configProperty)){return m[e.configProperty]}return!0},onMenuItemClicked:function(e){o.go(e.state)},toggleLeft:function(){}}}e.$inject=["$scope","$ionicSideMenuDelegate","$ionicNavBarDelegate","$state","$rootScope","$stateParams","fieldPromaxConfig","localStorageService","authenticationFactory","fpm-utilities-factory"],angular.module("fpm").controller("app-main-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r,c,u,l,s){function d(){var e=a.getStoredCredentials();e&&angular.isDefined(e)&&(m.user=angular.copy(e),m.events.loginClick(!0))}var m=this;m.user={userName:"",password:""},m.showError=!1,m.data={model:""};var f=c.alerts;m.events={onForgotPasswordClicked:function(){m.forgotPasswordModalErrors=[],m.data.model="",n.show({templateUrl:"forgotPasswordModal.html",title:"Forgot Password",subTitle:"Please enter your registered email address",scope:e,buttons:[{text:"Cancel",onTap:function(){return m.data.model="",null}},{text:"Send password",type:"button-positive",onTap:function(e){if(m.showError=!1,m.data.model)return m.data.model;m.forgotPasswordModalErrors.push("please check the entered email"),e.preventDefault()}}]}).then(function(e){""!==$.trim(m.data.model)&&(m.forgotPasswordModalErrors=[],c.showLoading("sending password...").then(function(){a.sendPassword(e).then(function(e){angular.isArray(e)&&e.length>0?(f.alert("Oops",e[0]),m.forgotPasswordModalErrors=e):f.alert("Password Sent","Password has been sent successfully.")}).finally(c.hideLoading)}))})},loginTestClick:function(e){m.user.userName="ravimittal1604@gmail.com",m.user.password="test@12345",m.events.loginClick(!0)},loginClick:function(e){if(m.showError=!1,m.errors=[],!e)return f.alert("Oops","Please enter login information..."),!1;o.show({template:"authenticating you..."}).then(function(){a.login(m.user).then(function(e){o.hide().then(function(){if(e&&a.authentication.isAuth){c.isOnDevMode||(c.locationService.start(u.saveLocationCordinates),u.registerUserTemplateForPushNotifications());var t=l.get("authorizationData");null!=t&&(t.token=null,s.insertUserLoginInfo(m.user.userName,m.user.password,JSON.stringify(t)));var n=l.get("appState");n&&angular.isDefined(n)?"app.editOrder"===n.stateName?i.go("app.dashboard",{refresh:!0}):n.params&&angular.isDefined(n.params)?i.go(n.stateName,n.params):i.go(n.stateName):i.go("app.dashboard",{refresh:!0})}})},function(e){o.hide(),m.showError=!0,e.error?m.errors=[e.error]:m.errors=["Invalid Email or Password"]})})}},e.$on("$ionicView.loaded",function(){t(function(){r.clearHistory(),r.clearCache(),d()},200)}),e.$on("$fpm:onLoginViewLoaded",function(e,n){t(function(){n.clearPassword&&(m.user.password="")},200)})}e.$inject=["$scope","$timeout","$ionicPopup","$ionicLoading","authenticationFactory","$state","$ionicHistory","fpm-utilities-factory","shared-data-factory","localStorageService","sqlStorageFactory"],angular.module("fpm").controller("login-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i){function r(){a.logout(!0),n(function(){t.$broadcast("$fpm:onLoginViewLoaded",{fromLogout:!0}),o.go("login")},200)}e.$on("$ionicView.beforeEnter",function(e,t){r()})}e.$inject=["$scope","$rootScope","$timeout","$state","authenticationFactory","fpm-utilities-factory"],angular.module("fpm").controller("logout-controller",e)}()}(),function(){"use strict";!function(){function e(e){this.heading="HELLLO WORLD FROM IONIC"}e.$inject=["$scope"],angular.module("fpm").controller("main-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){var o=this,a=n.alerts;o.clearLocationDataClicked=function(){a.confirm("Clear Location Data","Are you sure?",function(){t.clearLocationData().then(function(e){a.alert("Success","Location information has been removed.")})},function(){})}}e.$inject=["$scope","shared-data-factory","fpm-utilities-factory"],angular.module("fpm").controller("privacy-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){return{link:function(o,a,i){var r=n.secLevels,c=e.getLoggedInUserInfo();if(angular.isDefined(o.basedOn)){a.hide();!0===c[o.basedOn]&&a.show()}else if(!1===o.isConfigurationBased&&o.hideFor===c.secLevel&&a.hide(),!0===o.isConfigurationBased&&c.secLevel===r.ServiceProvider){var u=t.get("configurations");if(u){var l=u[o.configProperty];!0===l?a.show():a.hide()}}},restrict:"A",scope:{isConfigurationBased:"=",configProperty:"=",hideFor:"=",basedOn:"="}}}e.$inject=["authenticationFactory","localStorageService","fieldPromaxConfig"],angular.module("fpm").directive("setElementVisibilityForRole",e)}()}(),function(){"use strict";!function(){angular.module("fpm").component("expanseExpanderComponent",{bindings:{barcode:"<"},controller:["$scope",function(e){}],controllerAs:"vm",templateUrl:"js/expanses/expanse-expander-component-template.html"})}()}(),function(){"use strict";!function(){angular.module("fpm").component("expanseItem",{bindings:{item:"<",itemIndex:"<",ondeleteClicked:"&",oneditClicked:"&",isPaidList:"<"},controller:["$scope","authenticationFactory",function(e,t){var n=this;n.user=t.getLoggedInUserInfo(),n.dateFormat=n.user.dateFormat,n.events={onEditClicked:function(){angular.isDefined(n.oneditClicked)&&n.oneditClicked({value:n.item})},onDeleteClicked:function(){angular.isDefined(n.ondeleteClicked)&&n.ondeleteClicked({value:n.item,index:n.itemIndex,isfrompaid:n.isPaidList})}}}],controllerAs:"vm",templateUrl:"js/expanses/expanse-item-template.html"})}()}(),function(){"use strict";!function(){angular.module("fpm").component("expanseListComponent",{bindings:{barcode:"<",refresher:"<"},controller:["$scope","$rootScope","$timeout","$ionicActionSheet","expense-data-factory","authenticationFactory","fpm-utilities-factory",function(e,t,n,o,a,i,r){function c(e){C.paid=[],C.unpaid=[],C.requestCompleted=!1,r.showLoading().then(function(){a.getExpense(C.barcode||"",!0).then(function(e){e&&(C.expanses=e,C.paid=_.filter(e,function(e){return 1==e.expenseStatus}),C.unpaid=_.filter(e,function(e){return 0==e.expenseStatus})),C.requestCompleted=!0}).finally(function(){angular.isFunction(e)&&e(),r.hideLoading()})})}function u(){c()}function l(e,t,o){v.confirmDelete(function(){r.showLoading().then(function(){a.deleteExpense(e.expenseId).then(function(e){!0===e&&(D=n(function(){v.alert("Deleted","Expense deleted successfully",function(){C.expanses.splice(t,1)})},200))}).finally(r.hideLoading)})})}function s(t){null===C.modal?r.getModal("expenseModal.html",e).then(function(e){C.modal=e,C.entity=angular.copy(t),0!==t.expenseId?(C.entity.isReimbursable=0===t.expenseType,C.entity.havingImage=null!==t.imageName):C.entity.havingImage=!1,C.modal.show()}):(C.entity=angular.copy(t),0!==t.expenseId?(C.entity.isReimbursable=0===t.expenseType,C.entity.havingImage=null!==t.imageName,C.entity.imageModel={name:t.imageName,image:null}):C.entity.havingImage=!1,C.modal.show())}function d(e){var t=angular.copy(e);t.isReimbursable=!1,s(t)}function m(){s(angular.copy(b))}function f(){m()}function p(e,t){C.entity.imageChanged=!0,C.entity.imageModel={image:e,name:t}}function h(){C.modal.hide(),C.entity.imageModel=null,C.entity=angular.copy(b),C.image={name:"",visible:!1}}function g(e){C.errors=[],!0===e?(C.entity.expenseType=!0===C.entity.isReimbursable?0:1,C.entity.expenseDate=kendo.toString(kendo.parseDate(C.entity.expenseDate),"g"),r.showLoading().then(function(){a.addExpense(C.entity).then(function(e){e&&(h(),c(r.hideLoading))})})):C.errors.push("Invalid Save: Please check all values before save")}function y(){c(function(){e.$broadcast("scroll.refreshComplete")})}var C=this;C.paid=[],C.unpaid=[],C.expanses=[],C.user=i.getLoggedInUserInfo(),C.modal=null;var v=r.alerts;C.dateFormat=C.user.dateFormat;var b={expenseId:0,title:"",description:"",expenseType:0,expenseStatus:0,totalCost:0,barcode:C.barcode,expenseDate:new Date,quantity:1,imageChanged:!1,havingImage:!1,isReimbursable:!1};C.image={name:"",visible:!1},C.requestCompleted=!1;var D=null;C.upload={control:null,config:{multiple:!1,showFileList:!1,localization:{select:"upload the receipt"},select:function(t){t.isDefaultPrevented=!0;var n=["tif","tiff","gif","jpeg","jpg","jif","jfif","jp2","jpx","j2k","j2c","pcd","png","bmp"],o=t.files[0].name.split("."),a=o.reverse();if(t.files[0].size>20971520)return void v.alert("Warning","This file is too big.Max size is 20 MB");if(e.$apply(function(){C.image.name=t.files[0].name,C.image.visible=!0}),$.inArray(a[0].toLowerCase(),n)<0)return void v.alert("Warning","Invalid image file extension ( ."+a[0]+" ). Please upload only image file.");var i=new FileReader;i.onload=function(e){p(e.target.result,t.files[0].name)},i.readAsDataURL(t.files[0].rawFile)}}},C.errors=[],C.$onDestroy=function(){n.cancel(D)},C.events={refreshOnPullDown:y,onSubmitClicked:g,closeModal:h,onActionDotsClicked:f,onDeleteClicked:l,onEditClicked:d},C.$onInit=function(){u()}}],controllerAs:"vm",templateUrl:"js/expanses/expanse-list-component-template.html"})}()}(),function(){"use strict";!function(){function e(e){}e.$inject=["$scope"],angular.module("fpm").controller("expanses-controller",e)}()}(),function(){"use strict";!function(){function e(e){function t(t,n){return e.get(r+"GetExpense?barcode="+t+"&isFromMain="+n)}function n(t){return e.post(r+"AddExpense",t)}function o(t){return e.deleteReq(r+"DeleteExpense?id="+t)}function a(t){return e.get(r+"MarkAsPaidUnPaid?id="+t)}function i(t){return e.deleteReq(r+"DeleteImage?expenseId="+t)}var r="api/expense/",c={};return c.markAsPaidUnPaid=a,c.deleteExpense=o,c.addExpense=n,c.getExpense=t,c.deleteImage=i,c}e.$inject=["api-base-factory"],angular.module("fpm").factory("expense-data-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{product:"="},templateUrl:"js/inventory/assign-container-component-template.html",controller:["$scope","$stateParams","$rootScope","$filter","authenticationFactory","fpm-utilities-factory","shared-data-factory","inventory-data-factory",function(e,t,n,o,a,i,r,c){function u(){l.loadingContainers=!0,c.getContainers().then(function(e){e&&(l.containers=e,l.loadingContainers=!1,l.isServiceProvider&&(l.containerList=o("filter")(l.containers,{userId:l.user.userEmail}),l.containerList.length>0&&(l.containers=l.containerList)))})}var l=this;l.loadingContainers=!1,l.containers=[],l.container=null,l.errors=[],l.quantity=0,l.containerList=[],l.user=a.getLoggedInUserInfo(),l.isServiceProvider=!l.user.isAdminstrator;var s=i.alerts;u(),l.events={closeContainerModal:function(){l.errors=[],l.quantity=0,u(),n.$broadcast("$fpm:closeAssignContainerModal")},assignContainer:function(){if(0==l.quantity)return l.errors.push("Please input quantity"),!1;l.errors=[],l.container.productId=l.product.num,l.container.qoh=l.quantity,c.assignContainerToProduct(l.container).then(function(t){null!=t.errors?l.errors.push(t.errors[0]):(l.errors=[],e.$emit("$fpm:operation:assignContainerToProduct",t),s.alert("Success"),l.errors=[],l.quantity=0,u())})}},l.$onInit=function(){}}],controllerAs:"vm"};angular.module("fpm").component("assignContainerComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{container:"="},templateUrl:"js/inventory/edit-container-component-template.html",controller:["$scope","$stateParams","$rootScope","authenticationFactory","fpm-utilities-factory","shared-data-factory","inventory-data-factory",function(e,t,n,o,a,i,r){var c=this;c.user=o.getLoggedInUserInfo();var u=a.alerts;c.events={closeContainerModal:function(){n.$broadcast("$fpm:closeEditContainerModal")},updateProductQuantity:function(t){r.updateProductQuantity(t).then(function(t){null==t.errors&&(e.$emit("$fpm:operation:updateProductContainerQuantity",t),u.alert("Success",""))})}},c.$onInit=function(){}}],controllerAs:"vm"};angular.module("fpm").component("editContainerComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{product:"="},templateUrl:"js/inventory/edit-container-product-component.html",controller:["$scope","$stateParams","$rootScope","authenticationFactory","fpm-utilities-factory","shared-data-factory","inventory-data-factory",function(e,t,n,o,a,i,r){var c=this;c.user=o.getLoggedInUserInfo();var u=a.alerts;c.productContainer={num:"",containerName:"",description:"",assignedTo:"",customerNumber:"",qoh:"",productId:"",lastUpdatedDate:"",userName:""},c.events={closeContainerModal:function(){n.$broadcast("$fpm:closeEditProductQuantityModal")},updateProductQuantity:function(t){c.productContainer={num:t.productContainerNum,customerNumber:t.customerNumber,qoh:t.quantity,productId:t.productNumber},r.updateProductQuantity(c.productContainer).then(function(t){null==t.errors&&(e.$emit("$fpm:operation:updateContainerProductQuantity",t),u.alert("Success",""))})}},c.$onInit=function(){}}],controllerAs:"vm"};angular.module("fpm").component("editContainerProductComponent",e)}()}(),function(){"use strict";!function(){var e={templateUrl:"js/inventory/inventory-container-view-component.html",controller:["$scope","$timeout","$ionicModal","fpm-utilities-factory","work-orders-factory","authenticationFactory","inventory-data-factory",function(e,t,n,o,a,i,r){function c(){u.productModal?u.productModal.show():o.getModal("editProductModal.html",e).then(function(e){u.productModal=e,u.productModal.show()})}var u=this;u.products=[],u.containers=[],u.container=null;u.disabled=!1,u.loadingContainers=!1,u.user=i.getLoggedInUserInfo(),u.isServiceProvider=!u.user.isAdminstrator,u.showButtons=!1,u.productContainer={num:"",containerName:"",description:"",assignedTo:"",customerNumber:"",qoh:"",productId:"",lastUpdatedDate:"",userName:""},function(){u.loadingContainers=!0,r.getContainers().then(function(e){e&&(u.containers=e,u.loadingContainers=!1)})}(),e.$on("$fpm:closeEditProductQuantityModal",function(){u.productModal&&u.productModal.hide()}),e.$on("$fpm:operation:updateContainerProductQuantity",function(e,t){r.getContainerProducts(u.container.containerName).then(function(e){null!=e.collection&&e.collection.length>0&&(u.products=e.collection),u.isServiceProvider&&angular.forEach(u.products,function(e,t){u.container.userId===u.user.userEmail?u.showButtons=!0:u.showButtons=!1})}),u.productModal.hide()}),u.events={onSelectedContainerChange:function(){u.loadingContainers=!0,u.products=[],r.getContainerProducts(u.container.containerName).then(function(e){null!=e&&null!=e.collection&&e.collection.length>0?(u.products=e.collection,u.loadingContainers=!1,u.isServiceProvider&&angular.forEach(u.products,function(e,t){u.container.userId===u.user.userEmail?u.showButtons=!0:u.showButtons=!1})):(u.products=[],u.loadingContainers=!1)})},editProductClick:function(e){u.currentProduct=angular.copy(e),c()},increaseQuantity:function(e){u.disabled=!0,e.quantity+=1,u.productContainer={num:e.productContainerNum,customerNumber:e.customerNumber,qoh:e.quantity,productId:e.productNumber},r.updateProductQuantity(u.productContainer).then(function(e){null==e.errors&&r.getContainerProducts(u.container.containerName).then(function(e){null!=e.collection&&e.collection.length>0&&(u.products=e.collection,u.disabled=!1,u.isServiceProvider&&angular.forEach(u.products,function(e,t){u.container.userId===u.user.userEmail?u.showButtons=!0:u.showButtons=!1}))})})},decreaseQuantity:function(e){u.disabled=!0,e.quantity>0&&(e.quantity-=1),u.productContainer={num:e.productContainerNum,customerNumber:e.customerNumber,qoh:e.quantity,productId:e.productNumber},r.updateProductQuantity(u.productContainer).then(function(e){null==e.errors&&r.getContainerProducts(u.container.containerName).then(function(e){null!=e.collection&&e.collection.length>0&&(u.products=e.collection,u.disabled=!1,u.isServiceProvider&&angular.forEach(u.products,function(e,t){u.container.userId===u.user.userEmail?u.showButtons=!0:u.showButtons=!1}))})})}}}],controllerAs:"vm"};angular.module("fpm").component("inventoryContainerViewComponent",e)}()}(),function(){"use strict";!function(){function e(e){var t=this;t.byProducts=!0,t.byContainers=!1,t.events={showContainersView:function(){t.byProducts=!1,t.byContainers=!0},showProductsView:function(){t.byProducts=!0,t.byContainers=!1}}}e.$inject=["$scope"],angular.module("fpm").controller("inventory-controller",e)}()}(),function(){"use strict";!function(){function e(e){function t(t){return e.get(r+"GetProductContainers?num="+t)}function n(t){return e.post(r+"UpdateQuantity",t)}function o(){return e.get(r+"GetInventoryContainers")}function a(t){return e.get(r+"GetContainerProducts?containerName="+t)}function i(t){return e.post(r+"AssignContainerToProduct",t)}var r="api/InventoryContainers/",c={};return c.getProductContainers=t,c.updateProductQuantity=n,c.getContainers=o,c.getContainerProducts=a,c.assignContainerToProduct=i,c}e.$inject=["api-base-factory"],angular.module("fpm").factory("inventory-data-factory",e)}()}(),function(){"use strict";!function(){var e={templateUrl:"js/inventory/inventory-search-component.html",controller:["$scope","$timeout","$ionicModal","fpm-utilities-factory","work-orders-factory","authenticationFactory","inventory-data-factory",function(e,t,n,o,a,i,r){function c(){s.runningSearch=!0,r.getContainers().then(function(e){if(e&&(s.allContainers=e,s.isServiceProvider)){var t=_.filter(s.allContainers,function(e){return e.userId===s.user.userEmail});s.showDispenseButton=t.length>0&&!s.productsAssigned,s.runningSearch=!1}})}function u(){s.assignContainerModal?s.assignContainerModal.show():o.getModal("assignContainerModal.html",e).then(function(e){s.assignContainerModal=e,s.assignContainerModal.show()})}function l(){s.containerModal?s.containerModal.show():o.getModal("editContainerModal.html",e).then(function(e){s.containerModal=e,s.containerModal.show()})}var s=this;s.disabled=!1,s.searchValue="",s.products=[],s.containers=[],s.productItemClicked=!1,s.runningSearch=!1;s.product=null,s.user=i.getLoggedInUserInfo(),s.isServiceProvider=!s.user.isAdminstrator,s.allContainers=[],s.showDispenseButton=!1,s.productsAssigned=!1,e.$on("$fpm:closeEditContainerModal",function(){s.containerModal&&s.containerModal.hide()}),e.$on("$fpm:closeAssignContainerModal",function(){s.assignContainerModal&&s.assignContainerModal.hide()}),e.$on("$fpm:operation:assignContainerToProduct",function(e,t){r.getProductContainers(t.entity.productId).then(function(e){s.productsAssigned=!0,c(),null!=e.collection&&e.collection.length>0&&(s.containers=e.collection),s.isServiceProvider&&angular.forEach(s.containers,function(e,t){e.userId===s.user.userEmail?e.showButtons=!0:e.showButtons=!1})}),s.assignContainerModal.hide()}),e.$on("$fpm:operation:updateProductContainerQuantity",function(e,t){r.getProductContainers(t.entity.productId).then(function(e){null!=e.collection&&e.collection.length>0&&(s.containers=e.collection),s.isServiceProvider&&angular.forEach(s.containers,function(e,t){e.userId===s.user.userEmail?e.showButtons=!0:e.showButtons=!1})}),s.containerModal.hide()}),s.events={applySearch:function(){s.products=[],s.searchApplied=!1,s.runningSearch=!0,s.productItemClicked=!1,s.containers=[],a.searchProduct(s.searchValue,"").then(function(e){s.searchApplied=!0,s.runningSearch=!1,angular.isArray(e)&&(s.products=e)})},onProductItemClicked:function(e){s.runningSearch=!0,s.productItemClicked=!0,s.searchApplied=!1,s.product=e,s.searchValue=e.productName,s.products=[],s.showDispenseButton=!1,r.getProductContainers(e.num).then(function(e){if(null!=e&&null!=e.collection&&e.collection.length>0){s.containers=e.collection;var t=_.filter(s.containers,function(e){return e.userId===s.user.userEmail});s.productsAssigned=t.length>0,s.isServiceProvider&&angular.forEach(s.containers,function(e,t){e.userId===s.user.userEmail?e.showButtons=!0:e.showButtons=!1}),s.runningSearch=!1}else s.productsAssigned=!1,s.runningSearch=!1,s.containers=[];c()})},cancelSearch:function(){s.searchValue="",s.products=[],s.containers=[],s.runningSearch=!1,s.productItemClicked=!1,s.searchApplied=!1},editContainerClick:function(e){s.currentContainer=angular.copy(e),l()},assignToContainer:function(){u()},increaseQuantity:function(e){s.disabled=!0,e.qoh+=1,r.updateProductQuantity(e).then(function(e){null==e.errors&&r.getProductContainers(s.product.num).then(function(e){null!=e.collection&&e.collection.length>0&&(s.containers=e.collection,s.disabled=!1,s.isServiceProvider&&angular.forEach(s.containers,function(e,t){e.userId===s.user.userEmail?e.showButtons=!0:e.showButtons=!1}))})})},decreaseQuantity:function(e){s.disabled=!0,e.qoh>0&&(e.qoh-=1),r.updateProductQuantity(e).then(function(e){null==e.errors&&r.getProductContainers(s.product.num).then(function(e){null!=e.collection&&e.collection.length>0&&(s.containers=e.collection,s.disabled=!1,s.isServiceProvider&&angular.forEach(s.containers,function(e,t){e.userId===s.user.userEmail?e.showButtons=!0:e.showButtons=!1}))})})}}}],controllerAs:"vm"};angular.module("fpm").component("inventorySearchComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",jobtype:"<"},controller:["$scope","$timeout","custom-types-factory","authenticationFactory","fpm-utilities-factory",function(e,t,n,o,a){function i(e,t){var o=angular.copy(e),a=!1;t&&o.value&&(o.value=kendo.toString(kendo.parseDate(e.value),"g")),3===e.type&&(a=e.value),o.dataEntityType=1,o.entityKey=f.barcode,n.updateData(o,a).then(function(t){t&&(e.id=t.id,f.clones.toolbar.currentIndex>-1&&r(t))})}function r(e){if(e){var t=_.findWhere(f.clones.clonesData,{id:e.id});if(t){var n=_.indexOf(f.clones.clonesData,t);n>-1&&(f.clones.clonesData[n].value=e.value)}else f.clones.clonesData.push(e)}}function c(){if(f.clones.currentDefination=null,-1===f.clones.toolbar.preIndex&&(f.clones.parentData=angular.copy(f.customTypes.data)),-1===f.clones.toolbar.currentIndex)f.customTypes.data=angular.copy(f.clones.parentData);else{var e=f.clones.clones[f.clones.toolbar.currentIndex];e&&(f.clones.currentDefination=e,t(function(){var t=_.where(f.clones.clonesData,{cloneRefId:e.num});angular.forEach(f.customTypes.data,function(n,o){var a=_.findWhere(t,{typeId:n.typeId});n.id=void 0!==a?a.id:0,3===n.type?n.value=void 0!==a&&"TRUE"===a.value.toString().toUpperCase():n.value=void 0!==a?a.value:null,n.cloneRefId=e.num,f.customTypes.data.length})},100))}}function u(){f.clones.toolbar.preIndex=f.clones.toolbar.currentIndex,f.clones.toolbar.currentIndex=f.clones.clones.length-1,c()}function l(){n.getWorkOrderClones(f.barcode,f.jobtype).then(function(e){e&&(f.clones.clones=e.clones,f.clones.clonesData=e.clonesData)}).finally(function(){})}function s(){f.clones.cloneModel={entityId:f.jobtype,entityType:4,refEntityId:f.barcode,refEntityType:1},l()}function d(){n.getJobTypeByName(f.jobtype).then(function(e){f.showCloneToolbar=e&&e.allowClone,e&&e.allowClone&&s(!1)})}function m(){if(null===f.jobtype)return void(f.factory.requestDataCompleted=!0);f.gettingCustomTypes=!0,n.getCustomTypesDataByBarcode(f.barcode,f.jobtype).then(function(e){if(f.gettingCustomTypes=!1,e&&e.length>0){var t=_.where(e,{type:h.CHECKBOX});angular.forEach(t,function(e){e.value="true"===e.value||"True"===e.value||"1"===e.value}),f.customTypes.data=e,f.factory.viewData=f.customTypes.data}}).finally(function(){f.factory.requestDataCompleted=!0})}var f=this;f.factory=n;var p=a.alerts;f.userInfo=o.getLoggedInUserInfo(),f.dateFormat=f.userInfo.dateFormat;var h=n.controlTypes;f.isExpanded=!1,f.customTypes={data:[]},f.gettingCustomTypes=!1,f.clones={toolbar:{message:"",preIndex:0,currentIndex:-1},currentDefination:null,cloneModel:null,clones:[],clonesData:[],parentData:null},f.events={assignValue:function(e){f.clones.toolbar.currentIndex>-1&&r(e)},toolbar:{deleteClicked:function(){
f.clones.toolbar.currentIndex>-1&&p.confirm("Confirmation!","Are you sure?",function(){var e=f.clones.currentDefination;e&&n.deleteClone(e.num).then(function(){}).finally(function(){var t=_.indexOf(f.clones.clones,e);f.clones.clones.splice(t,1),f.events.toolbar.previousClicked(),p.alert("Success","Information has been deleted.",function(){})})})},addAnotherList:function(){f.uiErrors=[],f.clones.cloneModel&&f.jobtype&&n.createClone(f.clones.cloneModel).then(function(e){e&&e.num>0?(f.clones.clones.push(e),u()):f.uiErrors.push("Error while creating clone.")},function(){}).finally()},previousClicked:function(){f.clones.clones.length>0?(f.clones.toolbar.preIndex=f.clones.toolbar.currentIndex,-1===f.clones.toolbar.currentIndex?f.clones.toolbar.currentIndex=f.clones.clones.length-1:f.clones.toolbar.currentIndex-=1,c()):(f.clones.toolbar.currentIndex=-1,f.clones.toolbar.preIndex=null,c())},nextClicked:function(){f.clones.clones.length>0&&(f.clones.toolbar.preIndex=f.clones.toolbar.currentIndex,f.clones.toolbar.currentIndex===f.clones.clones.length-1?f.clones.toolbar.currentIndex=-1:f.clones.toolbar.currentIndex+=1,c())}},makeValueAsNull:function(e){var t=_.findWhere(f.customTypes.data,{id:e});if(void 0!==t&&(t.value=null,t.id=0),f.clones.toolbar.currentIndex>-1){var n=_.findWhere(f.clones.clonesData,{id:e});void 0!==n&&(n.value=null)}},onExpandClicked:function(){f.isExpanded=!f.isExpanded},onValueChanged:function(e){i(e,4===e.type)}},f.showCloneToolbar=!1,f.$onInit=function(){f.customTypes.data=[],f.factory.viewData=[],f.factory.requestDataCompleted=!1,m(),d()}}],controllerAs:"vm",templateUrl:"js/jobtype-list/jobtype-list-component-template.html"};angular.module("fpm").component("jobtypeListComponent",e)}()}(),function(){"use strict";!function(){var e={require:{parentController:"?^^jobtypeListComponent"},bindings:{ctEntity:"<",fromEquipments:"=",useEntityId:"=",type:"<"},controller:["$scope","$ionicModal","$stateParams","$timeout","custom-types-factory","fpm-utilities-factory","fieldPromaxConfig","shared-data-factory",function(e,t,n,o,a,i,r,c){function u(e){var t=e[0].name;d.entity.imageModel={name:t},d.ctEntity.value=t,d.entity.view=d.ctEntity,d.entity.view.entityKey=n.barCode,d.fromEquipments?(d.entity.view.dataEntityType=102,d.entity.view.entityKey=d.useEntityId,d.entity.view.barcode=n.barCode):d.type&&(d.entity.view.dataEntityType=d.type),i.showLoading(),a.uploadFiles(e,d.entity).then(function(e){m=o(function(){e&&e.success&&(d.showImageUpload=!1,d.ctEntity.value=e.entity.value,d.ctEntity.id=e.entity.id,h.alert("Uploaded","File uploaded successfully"),d.parentController.events.assignValue(e.entity))},100)},function(){h.alert("Error","Not a valid image file.")}).finally(function(){i.hideLoading(),l()})}function l(){t.fromTemplateUrl("imageViewerModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){y=e})}function s(){d.showImageUpload=null===d.ctEntity.value,d.showImageUpload||l()}var d=this;d.entity={},d.show,d.showDeleteImageOnModal=!0;var m=null,f=null,p=r.fieldPromaxApi,h=i.alerts;d.events={takePictureClicked:function(){i.device.getPicture().then(function(e){i.showLoading(),f=o(function(){if(e){var t="Picture"+n.barCode+kendo.toString(new Date,"ddffMMss")+".jpeg";c.convertToBlob("data:image/jpeg;base64,"+e,t).then(function(e){e&&u([{rawFile:e}])},function(){})}},500)})},uploadImageClicked:function(){d.imageUploader.control.wrapper.find("#upload-image").trigger("click")},deleteImageClicked:function(){h.confirmDelete(function(){a.deleteCustomTypesData(d.ctEntity.id).then(function(){h.alert("Image delete successfully")}).finally(function(){y.hide(),d.showImageUpload=!0,d.ctEntity.value=null,d.parentController&&d.parentController.events.makeValueAsNull(d.ctEntity.id)})})},showImageClick:function(){null===y||d.showImageUpload||(d.imageUrl=p+"Handlers/GetImageFromBlob.ashx?imageId="+d.ctEntity.id+"&entity=custom&dateStamp="+new Date,y.show())},closeImageViewModal:function(){y&&y.hide()}};var g=["tif","tiff","gif","jpeg","jpg","png"];d.imageUploader={control:null,config:{select:function(e){e.isDefaultPrevented=!0,i.showLoading();var t=e.files[0].name.split("."),n=t.reverse();return e.files[0].size>10485760?(i.hideLoading(),void h.alert("Warning","This file is too big. Max size is 10 MB")):$.inArray(n[0].toLowerCase(),g)<0?(i.hideLoading(),void h.alert("Warning","Invalid image file extension ( ."+n[0]+" ). Please upload only image file.")):void u(e.files)},showFileList:!1,localization:{select:"upload image"},multiple:!1}};var y=null;d.$onDestroy=function(){d.showImageUpload=!1,d.ctEntity=null,m&&o.cancel(m),f&&o.cancel(f)},e.$watch("vm.ctEntity",s,!0),d.$onInit=function(){s()}}],controllerAs:"vm",templateUrl:"js/jobtype-list/jobtype-upload-component-template.html"};angular.module("fpm").component("jobtypeUploadComponent",e)}()}(),function(){"use strict";!function(){function e(e,i,r,c,u,l,s,d,m,f,p,h,g){function y(){v()}function C(){B.filtersModal&&(B.filterDate=null,B.filterEndDate=null,_.forEach(a,function(e){D(e,B.map,!1)}),B.filtersModal&&B.filtersModal.hide())}function v(){B.filtersModal?B.filtersModal.show():h.getModal("mapFilters.html",e).then(function(e){B.filtersModal=e,B.filtersModal.show()})}function b(){T(!1,!0),B.filtersModal&&B.filtersModal.hide()}function D(e,t){e.havingMap=null!==t,e.marker.setMap(t)}function w(){angular.forEach(a,function(e){D(e,null)})}function S(){if(a){q=!0;w();var e=_.filter(a,function(e){return null!==e.start});angular.forEach(e,function(e){D(e,null)});var t=null,n=null;B.filterEndDate&&(t=new Date(B.filterEndDate.getFullYear(),B.filterEndDate.getMonth(),B.filterEndDate.getDate(),0,0,0,0)),B.filterDate&&(n=new Date(B.filterDate.getFullYear(),B.filterDate.getMonth(),B.filterDate.getDate(),0,0,0,0));var o=_.filter(e,function(e){var o=kendo.parseDate(e.start),a=new Date(o.getFullYear(),o.getMonth(),o.getDate(),0,0,0,0);return null!==n&&null===t?moment(a).isSameOrAfter(n):null!==n&&null!==t?moment(a).isSameOrAfter(n)&&moment(a).isSameOrBefore(t):moment(a).isSameOrBefore(t)});o.length>0&&_.forEach(o,function(e){D(e,B.map)})}}function T(e,t){B.filterDate&&S(!0)}function k(){F(!0)}function E(){angular.forEach(B.mapData.users,function(e){e.isChecked=!e.isChecked})}function I(){angular.forEach(B.mapData.users,function(e){e.isChecked=!0})}function M(){u.show({buttons:[{text:"Select All"},{text:"Invert Selection"}],titleText:"Service Provider Filter Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&I(),1===e&&E(),!0}})}function P(){u.show({buttons:[{text:"Set As Today's Date"}],titleText:"Date Filter Options",destructiveText:"Clear Date Filter",cancelText:"Cancel",destructiveButtonClicked:function(){return B.filterDate=null,B.filterEndDate=null,T(!0,!1),!0},cancel:function(){},buttonClicked:function(e){return 0===e&&(B.filterDate=new Date),!0}})}function O(t,n){window.google.maps.event.addListener(t,"click",function(){if(B.currentMarker=n.o,!n.isHome){s.show({templateUrl:"mapInfoWindow.html",title:B.currentMarker.barcodeName,scope:e,buttons:[{text:"Close"},{text:"Edit Order",type:"button-positive",onTap:function(e){n.numFromTechnician&&i.go("app.editOrder",{barCode:n.barCode,technicianNum:n.numFromTechnician,src:"map"})}}]})}})}function N(){B.mapData;o&&o.length>0&&$.each(o,function(e,n){var i=null,r=new window.google.maps.LatLng(n.y,n.x);!0===n.isHome?(i=new window.google.maps.Marker({position:r,map:B.map,icon:{url:n.imageurl,size:new window.google.maps.Size(24,24),origin:new window.google.maps.Point(0,0),anchor:new window.google.maps.Point(0,24)},shape:{coord:[1,1,1,20,18,20,18,1],type:"poly"}}),O(i,n)):(!0===n.isAssigned?(i=new window.google.maps.Marker({position:r,map:B.map,labelContent:j,labelAnchor:new window.google.maps.Point(0,7),labelClass:"labels",labelStyle:{opacity:.75},icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:n.scale||6,fillColor:n.color||t,strokeColor:n.color||t}}),j+=1,a.push({detail:n,marker:i,technician:n.technician,havingMap:!0,isassigned:n.isAssigned,start:null!=n.start?new Date(n.start):null,isSpecialMarker:!0,numFromTechnician:n.numFromTechnician})):(i=new window.google.maps.Marker({position:r,map:B.map,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:n.scale||6,fillColor:n.color||t,strokeColor:n.color||t}}),a.push({detail:n,marker:i,technician:n.technician,havingMap:!0,isassigned:n.isAssigned,start:null!=n.start?new Date(n.start):null,isSpecialMarker:!1,numFromTechnician:n.numFromTechnician})),O(i,n)),o.length-1===e&&(B.filterDate=new Date,B.filterEndDate=new Date,b())})}function A(e){o=[],$.each(B.mapData.orders,function(e,n){var a=n.userColor||t,i=null!==n.scheduledStartDateTime&&null!==n.scheduledFinishDateTime;n.coordinateY&&n.coordinateX&&o.push({x:n.coordinateX,y:n.coordinateY,barCode:n.barcode,isHome:!1,color:a,scale:a===t?4:6,isAssigned:i,technician:n.technicianNum,start:n.scheduledStartDateTime,numFromTechnician:n.numFromTechnicianSchedule,o:n}),e===B.mapData.orders.length-1&&N()})}function F(e){h.showLoading().then(function(){f.getMapData(e).then(function(e){e&&(B.mapData.users=e.users,B.mapData.orders=e.orders,angular.isDefined(B.mapData)&&B.mapData.orders.length>0&&A(!0))}).finally(h.hideLoading)})}function L(){angular.isDefined(google)&&google.maps.event.addListenerOnce(B.map,"idle",function(){F(!1)})}function x(){a=[],R.center=new window.google.maps.LatLng(n.y,n.x),p.getIniitialData().then(function(e){if(B.iniitialData=e,e){var a=e.customerNumberEntity;R.center=new window.google.maps.LatLng(a.coordinateY||n.y,a.coordinateX||n.x),R.zoom=a.zoomDepth||8,B.map=new google.maps.Map(document.getElementById("map"),R),L(),o.push({x:a.coordinateX||n.x,y:a.coordinateY||n.y,imageurl:"../images/markers/home.png",barCode:"[HOME]",isHome:!0,color:t,technician:"",isAssigned:!0,start:null,numFromTechnician:0})}else R.center=new window.google.maps.LatLng(n.y,n.x),B.map=new google.maps.Map(document.getElementById("map"),R),L()})}function U(){x()}var B=this;B.user=g.getLoggedInUserInfo(),B.dateFormat=B.user.dateFormat;var R={center:null,panControl:!1,zoomControl:!0,scaleControl:!0,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP};B.filtersApplied=!1,B.filterDate=null;var q=!1;B.events={onFiltersClicked:y,clearFilters:C,applyFilters:b,refreshMapClicked:k,onServiceProviderDotsClicked:M,onDateFilterDotsClicked:P},B.mapData={users:[],orders:[]};var j=1;e.$on("$ionicView.afterEnter",function(e,t){U()}),e.$on("$destroy",function(e){B.map=null,o=[],a=[]})}var t="#000000",n={x:44.31127,y:-92.67851,xcom:-92.67851,ycom:44.3112679},o=[],a=[];e.$inject=["$scope","$state","$q","$cordovaGeolocation","$ionicActionSheet","$timeout","$ionicPopup","$cordovaNetwork","$rootScope","map-factory","shared-data-factory","fpm-utilities-factory","authenticationFactory"],angular.module("fpm").controller("map-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(n){!0===(n=null!==n&&n)&&i.remove(r);var o=i.get(r);return angular.isDefined(o)&&o?t.when(o):e.get(a+"GetMapData?fromMobile=true").then(function(e){return i.put(r,e),e})}var a="api/Dashboard/",i=n("mapCache"),r="workorder:mapdata";return{getMapData:o}}e.$inject=["api-base-factory","$q","$cacheFactory"],angular.module("fpm").factory("map-factory",e)}()}(),function(){"use strict"}(),function(){"use strict";!function(){function e(e,t,n,o,a,i){var r=this;r.isLoading=!1,r.messages=[],r.messageContent="";var c=n.sender;r.events={onSendMessageClicked:function(e){o.insertMessage({content:r.messageContent,sentToUser:c,fromMobile:!0}).then(function(e){e&&(r.messageContent="")})},onBackButtonClicked:function(){t.go("app.messageHub")}},function(){r.isLoading=!0,r.user=a.getLoggedInUserInfo(),o.getAllMessages(c,r.user.userNum).then(function(e){r.messages=e.collection}).finally(function(){r.isLoading=!1})}()}e.$inject=["$timeout","$state","$stateParams","message.hub.factory","authenticationFactory","shared-data-factory"],angular.module("fpm").controller("message-hub-chat-details-controller",e)}()}(),function(){"use strict";!function(){function e(e){var t=["@wo","@sch"];return{restrict:"A",bindToController:!0,link:function(n,o,a){var i="true"===a.messageContentFormatter;if(e(function(){var e=$(o).text(),n=e.match(/@\w+:\w+/g);n&&n.length>0&&_.forEach(n,function(a,i){var r=a.split(":")[0];t.indexOf(r.toLowerCase())>-1&&(e=e.replace(a,"<span class='tag'>"+a+"</span>")),i===n.length-1&&$(o).html(e)})},50),i){var r=$("#chat-content")[0];e(function(){$("#chat-content").animate({scrollTop:r.scrollHeight},500)},200)}}}}e.$inject=["$timeout"],angular.module("fpm").directive("messageContentFormatter",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function a(){return e.get(u+"GetAllMessagesToOrFromSender")}function i(){var t=l.get("users:list");return angular.isDefined(t)&&t?n.when(t):e.get("api/Users/GetUserGroupsForScheduler").then(function(e){return l.put("users:list",e),e})}function r(t){return e.post(u+"InsertMessage",t)}function c(t,n){return e.get(u+"GetAllMessages?senderId="+t+"&receiverId="+n)}var u="api/messagehub/",l=o("messageHub"),s={};return s.insertMessage=r,s.getAllMessages=c,s.getUserGroupsForScheduler=i,s.loadChatHistory=a,s}e.$inject=["api-base-factory","$rootScope","$q","$cacheFactory"],angular.module("fpm").factory("message.hub.factory",e)}()}(),function(){"use strict";!function(){function e(e,t,n){var o=this;o.uiData={newMessageCount:11},o.events={onHeaderButtonClicked:function(){t.go("app.messageHub")}},o.$onInit=function(){console.log("HELLO WORLD")}}e.$inject=["$timeout","$state","$scope"];var t={templateUrl:"js/message-hub/message.hub.header.component.html",controller:e,controllerAs:"vm"};angular.module("fpm").component("messageHubHeaderButton",t)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a){function i(e,t){var n=t.collection;if(e&&n&&n.length>0){var o=_.filter(e,function(e){return e.num!==u.user.userNum}),a="";angular.forEach(o,function(e){var t=+e.num,o=n.filter(function(e){return e.sentBy===t||e.sentTo===t});o.length>0&&(a=o[0].content,u.chatHistoryList.push({userName:e.text,lastMessageContent:a,userId:t}))})}}function r(){u.isLoading=!0,n.loadChatHistory().then(function(e){i(u.allUsersList,e)}).finally(function(){u.isLoading=!1})}function c(){n.getUserGroupsForScheduler().then(function(e){e&&(u.allUsersList=_.flatten(_.compact(_.map(e.userWorkGroups,function(e){return e.userList}))))}).finally(function(){e(function(){r()},10)})}var u=this;u.isLoading=!0,u.chatHistoryList=[],u.allUsersList=[],u.events={onHeaderButtonClicked:function(){console.log("GE")},onUserItemClicked:function(e){console.log(e),t.go("app.messageHubDetails",{sender:e.userId})}},function(){u.user=o.getLoggedInUserInfo(),c()}()}e.$inject=["$timeout","$state","message.hub.factory","authenticationFactory","shared-data-factory"],angular.module("fpm").controller("message-hub-page-controller",e)}()}(),function(){"use strict";!function(){var e={controllerAs:"vm",templateUrl:"js/offline/dashboard.item.component.html",controller:["$scope","$state","$timeout","fpm-utilities-factory","sqlStorageFactory","authenticationFactory","fieldPromaxConfig",function(e,t,n,o,a,i,r){function c(e){u.itemCount=0,u.savedItemsArray=[];try{a.getSavedOrdersByUser(s.userEmail).then(function(t){if(t&&(u.itemCount=t.length,e&&0===t.length&&(u.isOpened=!1),l=t,t.length>0))for(var o=[],a=0;a<t.length;a++)d?o.push(JSON.parse(t[a].jsonPayload)):o.push(JSON.parse(t.item(a).jsonPayload)),a===t.length-1&&n(function(){u.savedItemsArray=o},10)})}catch(e){m.alert(e)}}var u=this;u.itemCount=0,u.isOpened=!1;var l,s=null,d=r.devEnv;u.savedItemsArray=[];var m=o.alerts;u.events={syncChanges:function(e){},goToOfflineOrder:function(e){e&&t.go("app.editOrderOffline",{barCode:e.Barcode,technicianNum:e.TechnicianScheduleNum,src:"dashboard"})},deleteOrder:function(e){o.alerts.confirm("Confirmation!","Are you sure?",function(){a.deleteOrder(e.Barcode,e.TechnicianScheduleNum).then(function(e){c(!0)})})}},e.$on("$offline:newOrderSaved",function(e,t){u.isOpened=!1,c(!1)}),u.$onInit=function(){s=i.getLoggedInUserInfo(),c(!1)}}]};angular.module("fpm").component("offlineItem",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(e,t){n.updateScheduleInformation(e,t,r.schedule.scheduleNum)}function a(e,t){n.updateWorkOrder(e,t,r.barcode)}function i(){r.barCodeData.products&&r.barCodeData.products.length>0&&angular.forEach(r.barCodeData.products,function(e){e.isInEditMode=!1})}var r=this;r.barcode=t.barCode,r.scheduleNum=parseInt(t.technicianNum,10),r.barCodeData={},r.gettingBarcodeDetails=!0,r.events={onEditProductClicked:function(e){i(),e.isInEditMode=!e.isInEditMode,console.log(e)},onDeleteProductClicked:function(e){},onDescriptionOrResolutionChanged:function(e){var t="workDescription"===e?"comment_1":"comment_2";r.barCodeData.barcodeDetails&&(a(e,r.barCodeData.barcodeDetails[t]),a("jsonPayload",JSON.stringify(r.barCodeData.barcodeDetails)))},onStartDateTimeChaged:function(){o("actualStartDateTime",kendo.toString(r.schedule.actualStartDateTime,"g"))},onEndDateTimeChanged:function(){o("actualFinishDateTime",kendo.toString(r.schedule.actualFinishDateTime,"g"))},workCompleteChanged:function(){o("workComplete",r.schedule.workComplete)}},function(){r.gettingBarcodeDetails=!0,n.getOrderInfo(r.barcode,r.scheduleNum).then(function(e){r.barCodeData=e,r.barCodeData.info=JSON.parse(e.barcodeInfo.jsonPayload),e.workOrderDetails&&e.workOrderDetails.jsonPayload&&(r.schedule=angular.copy(e.schedule),r.schedule.workComplete="true"===e.schedule.workComplete,r.schedule.approve=!1,r.barCodeData.barcodeDetails=JSON.parse(e.workOrderDetails.jsonPayload))}).finally(function(){i(),r.gettingBarcodeDetails=!1})}()}e.$inject=["$scope","$stateParams","sqlStorageFactory"],angular.module("fpm").controller("edit-order-page-offline-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function a(){t(function(){r._onNetworkConnectionChange(!1)},500)}function i(){t(function(){r._onNetworkConnectionChange(!0)},500)}var r=this;r.isConnectedToNetwork=!0,r._onNetworkConnectionChange=function(n){o.setNetworkConnectivity(n),n!==r.isConnectedToNetwork&&(r.isConnectedToNetwork=n,t(function(){e.$broadcast("network:connection:changed",{isConnected:n})},300))},n.ready(function(){document.addEventListener("offline",a,!1),document.addEventListener("online",i,!1)}),r.$onInit=function(){},r.$onChanges=function(){}}var t=angular.module("fpm");e.$inject=["$scope","$timeout","$ionicPlatform","sqlStorageFactory"],t.directive("networkCheck",[function(){return{restrict:"A",controller:e,controllerAs:"vm"}}])}()}(),function(){"use strict";!function(){function e(e,t,n,o){function a(e,t){N=t,$=e}function i(e,t,n){var o="INSERT INTO UserLogins (userName, passwordPlain,jsonPayload) VALUES (?,?,?)";c("SELECT * FROM UserLogins WHERE userName = ?",[e],function(a){0!==a.rows.length?c("DELETE FROM UserLogins WHERE userName = ?",[e],function(a){c(o,[e,t,n],function(e){},l)},function(e){}):c(o,[e,t,n],function(e){},function(e){})},l)}function r(e){var t=n.defer();return c("SELECT * FROM UserWorkOrders WHERE barcode = ? AND scheduleNum = ?",[e.barcode,e.scheduleNum],function(n){if(0===n.rows.length){c("INSERT INTO UserWorkOrders (barcode, userName,scheduleNum,jsonPayload, isSynced) VALUES (?,?,?,?,?)",[e.barcode,e.userName,e.scheduleNum,e.jsonPayload,0],function(e){t.resolve(e.insertId)},function(e){t.resolve(0)})}else t.resolve(-1)}),t.promise}function c(e,n,o,a){$&&(n?t.execute($,e,n).then(o,a):u(e,o,a))}function u(e,n,o){try{$&&t.execute($,e).then(function(e){n(e)},o)}catch(e){}}function l(e){window.alert(e)}function s(){h("CREATE TABLE IF NOT EXISTS UserLogins (id INTEGER PRIMARY KEY AUTOINCREMENT, userName TEXT, passwordPlain TEXT, jsonPayload TEXT)").then(function(e){},l)}function d(){for(var e=["CREATE TABLE IF NOT EXISTS UserWorkOrders (id INTEGER PRIMARY KEY AUTOINCREMENT, barcode TEXT, userName TEXT,scheduleNum INTEGER,jsonPayload TEXT, isSynced NUMERIC)","CREATE TABLE IF NOT EXISTS WorkOrderPrimary (id INTEGER PRIMARY KEY AUTOINCREMENT, barcode TEXT, userName TEXT,scheduleNum INTEGER,workDescription TEXT,resolution TEXT,jsonPayload TEXT, isSynced NUMERIC)","CREATE TABLE IF NOT EXISTS WorkOrderSchedule (id INTEGER PRIMARY KEY AUTOINCREMENT, barcode TEXT,scheduleNum INTEGER,actualFinishDateTime TEXT,actualStartDateTime TEXT,scheduledFinishDateTime TEXT,scheduledStartDateTime TEXT,workComplete INTEGER,jsonPayload TEXT,updatedOn TEXT,isSynced NUMERIC)","CREATE TABLE IF NOT EXISTS WorkOrderProducts (id INTEGER PRIMARY KEY AUTOINCREMENT, barcode TEXT,productNum INTEGER,productName TEXT,productDescription TEXT,price REAL,qty REAL,jsonPayload TEXT, isSynced NUMERIC)"],t=0;t<e.length;t++)h(e[t])}function m(e){h("SELECT * FROM sqlite_master WHERE name = 'WorkOrderProducts' and type='table'",null).then(function(t){if(t.rows.length>0){var n=e.products;h("SELECT * FROM WorkOrderProducts WHERE barcode = ?",[n[0].barcode]).then(function(e){if(0===e.rows.length)for(var t=0;t<n.length;t++){var o=n[t];o&&h("INSERT INTO WorkOrderProducts (barcode,productNum,productName,productDescription,price,qty,jsonPayload,isSynced) VALUES (?,?,?,?,?,?,?,?)",[o.barcode,o.num,o.productName,o.productDescription,o.price,o.qty,JSON.stringify(o),0])}})}})}function f(e,t){h("SELECT * FROM sqlite_master WHERE name ='WorkOrderSchedule' and type='table'",null).then(function(n){if(n.rows.length>0){var o=_.findWhere(e.schedules,{num:t});o&&h("INSERT INTO WorkOrderSchedule (barcode,scheduleNum,actualFinishDateTime,actualStartDateTime,scheduledFinishDateTime,scheduledStartDateTime,workComplete,jsonPayload,isSynced) VALUES (?,?,?,?,?,?,?,?,?)",[o.barcode,t,o.actualFinishDateTime,o.actualStartDateTime,o.scheduledFinishDateTime,o.scheduledStartDateTime,o.workComplete?1:0,JSON.stringify(o),0]).then(function(t){t&&m(e)})}})}function p(e,t){h("SELECT * FROM sqlite_master WHERE name ='WorkOrderPrimary' and type='table'",null).then(function(n){if(n.rows.length>0){var o=e.barcodeDetails;h("INSERT INTO WorkOrderPrimary (barcode,scheduleNum,workDescription,resolution,jsonPayload,isSynced) VALUES (?,?,?,?,?,?)",[o.barcode,t,o.comment_1,o.comment_2,JSON.stringify(o),0]).then(function(n){n&&f(e,t)})}})}function h(e,n){return n?t.execute($,e,n):t.execute($,e)}function g(e){return h("SELECT * FROM UserWorkOrders WHERE userName = ?",[e]).then(function(e){return e.rows})}function y(e){h("SELECT * FROM WorkOrderPrimary WHERE barcode = ?",[e]).then(function(t){if(0===t.rows.length){h("DELETE FROM WorkOrderProducts WHERE barcode = ?",[e])}})}function C(e,t){for(var n=["UserWorkOrders","WorkOrderPrimary","WorkOrderSchedule"],o=0;o<n.length;o++){var a="DELETE FROM "+n[o]+" WHERE barcode = ? AND scheduleNum = ?";if(o===n.length-1)return h(a,[e,t]).then(function(){y(e)});h(a,[e,t])}}function v(e,t){return h(e,t).then(function(e){return N?e:e.rows},l)}function b(e,t){return v("SELECT * FROM UserWorkOrders WHERE barcode = ? AND scheduleNum = ?",[e,t])}function D(e,t){return v("SELECT * FROM WorkOrderPrimary WHERE barcode = ? AND scheduleNum = ?",[e,t])}function w(e,t){return v("SELECT * FROM WorkOrderSchedule WHERE barcode = ? AND scheduleNum = ?",[e,t])}function S(e){return v("SELECT * FROM WorkOrderProducts WHERE barcode = ?",[e])}function T(t,o){var a=n.defer(),i={};return n.all([b(t,o),D(t,o),w(t,o),S(t)]).then(function(t){var n=["barcodeInfo","workOrderDetails","schedule","products"];if(N){if(t&&t.length>0){for(var o=0;o<3;o++)t[o].rows.length>0&&(i[n[o]]=t[o].rows[0]);if(t.length===n.length){for(var r=[],c=3,o=0;o<t[c].rows.length;o++)r.push(t[c].rows[o]);i[n[c]]=r}}}else if(t&&t.length>0){for(var o=0;o<3;o++)t[o].length>0&&(i[n[o]]=t[o].item(0));if(t.length===n.length){for(var r=[],c=3,o=0;o<t[c].length;o++)r.push(t[c].item(o));i[n[c]]=r}}e(function(){a.resolve(i)},200)}),a.promise}function k(e,t,n){return h("UPDATE WorkOrderSchedule SET "+e+" = ? WHERE scheduleNum = ?",[t,n])}function E(e,t,n){return h("UPDATE WorkOrderPrimary SET "+e+" = ? WHERE barcode = ?",[t,n])}function I(e,t,n){}function M(e,t){}function P(e){O=e}var $=null,O=!0,N=!1;return{FP_DB_NAME:"fieldPromaxDb",isConnected:O,setNetworkConnectivity:P,tryLoginOffline:M,setDb:a,deleteOrder:C,getOrderInfo:T,insertWorkOrderInfo:p,getSavedOrdersByUser:g,createUserLoginTable:s,createWorkOrdersTable:d,insertWorkOrderRef:r,insertUserLoginInfo:i,updateScheduleInformation:k,updateWorkOrder:E,updateProduct:I}}e.$inject=["$timeout","$cordovaSQLite","$q","authenticationFactory"],angular.module("fpm").factory("sqlStorageFactory",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(o){a.errors=[],o?n.showLoading().then(function(){t.changePassword(a.model).then(function(o){o.success?n.alerts.alert("Success","Password has been changed successfully.",function(){t.logout(),e.go("login")}):o.errors&&o.errors.length>0&&a.errors.push(o.errors[0])}).finally(n.hideLoading)}):a.errors.push("Please enter all required information.")}var a=this;a.errors=[],a.model={oldPassword:"",newPassword:"",confirmPassword:""},a.events={onChangePasswordClicked:o}}e.$inject=["$state","authenticationFactory","fpm-utilities-factory"],angular.module("fpm").controller("change-password-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i){function r(){if(u.errors=[],u.amount>t.amount)return l.alert("Warning!","Payment amount can not be higher than the amount due.",function(){u.amount=t.amount}),!1;u.model.amount=100*u.amount,a.showLoading().then(function(){i.submitPayment(u.model).then(function(e){void 0!=e.Success&&e.Success?l.alert("Success!","Thank you!!!\nYour card has been successfully charged.",function(){c()}):l.alert("Failure!","Sorry!!! We are unable to charge your card, Please try again.",function(){})}).finally(a.hideLoading)})}function c(){e.go("app.editOrder",{barCode:t.barcode,technicianNum:t.technicianNum,src:t.src,_i:4})}var u=this;u.errors=[];var l=a.alerts;u.model={amount:100*t.amount,currency:"USD",description:"Payment",source:"",barcode:""};var s=Stripe("pk_live_3RsRk0wNiXaJxNow6hEzG7LR00fCpVR6n9"),d=s.elements(),m={base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}},f=d.create("card",{style:m});f.mount("#card-element"),f.addEventListener("change",function(e){var t=document.getElementById("card-errors");e.error?t.textContent=e.error.message:t.textContent=""}),document.getElementById("payment-form").addEventListener("submit",function(e){e.preventDefault(),s.createToken(f).then(function(e){e.error?document.getElementById("card-errors").textContent=e.error.message:(u.model.source=e.token.id,u.model.barcode=t.barcode,r())})}),u.events={submitPayment:r,backButtonClicked:function(){c()}}}e.$inject=["$state","$stateParams","$timeout","authenticationFactory","fpm-utilities-factory","work-orders-factory"],angular.module("fpm").controller("checkout-page-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i){function r(){var e=n.get(o.localStorageKeys.settingsKeyName);e&&(c.userSettings.defaultCalenderViewForMobile=e.DefaultCalenderViewForMobile||"workWeek",c.userSettings.startupPageForMobile=e.StartupPageForMobile,c.userSettings.pushNotifications=e.PushNotifications||!1,c.userSettings.locationServices=e.LocationServices||!1)}var c=this;c.userSettings={defaultCalenderViewForMobile:"workWeek",pushNotifications:!1,locationServices:!1},c.events={updateSettings:function(){i.showLoading().then(function(){a.updateSettings(c.userSettings).then(function(e){i.alerts.alert("Saved","Settings updated successfully",function(){n.set(o.localStorageKeys.settingsKeyName,JSON.parse(e))})}).finally(i.hideLoading)})}},e.$on("$ionicView.beforeEnter",function(e,t){r()})}e.$inject=["$scope","$state","localStorageService","fieldPromaxConfig","shared-data-factory","fpm-utilities-factory"],angular.module("fpm").controller("settings-controller",e)}()}(),function(){"use strict";!function(){angular.module("fpm.realtime",[]).run(["fieldPromaxConfig",function(e){}])}()}(),function(){"use strict";!function(){function e(e,t,n){function o(){c.qs={Bearer:n.getToken()},c.start().done(function(){})}function a(){r=c.createHubProxy("workOrderHubContext")}function i(e,t,n){null===r&&a(),r.invoke("onScheduleMarkCompleted",e,t,n)}var r=null,c=$.hubConnection(t.fieldPromaxApi+"signalr/hubs");return{getProxy:a,startConnection:o,onScheduleMarkCompleted:i}}angular.module("fpm.realtime").factory("fpm.realtime.workorders.factory",["$rootScope","fieldPromaxConfig","authenticationFactory",e])}()}(),function(){"use strict";!function(){function e(e,t,n,o){function a(o,a,i){function r(e,t,n,o){return u.resolve(e)}function c(e){u.reject(e)}var u=t.defer();return e({method:o,url:n.fieldPromaxApi+a,data:i}).success(r).error(c),u.promise}function i(e,t){return a("POST",e,JSON.stringify(t))}function r(e,t){return a("GET",e,t)}function c(e,t){return a("DELETE",e,t)}function u(o,a,i){function r(e){return u.resolve(e.data)}function c(e){u.reject(e)}var u=t.defer();return e({method:"POST",url:n.fieldPromaxApi+o,headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;t.append("model",JSON.stringify(i));for(var n=0;n<a.length;n++)t.append("file"+n,e.files[n].rawFile);return t},data:{files:a}}).then(r,c),u.promise}function l(o,a){function i(e,t,n,o){return c.resolve(e.data)}function r(e){c.reject(e)}var c=t.defer();return e({method:"GET",url:n.fieldPromaxApi+o,responseType:"arraybuffer"}).then(i,r),c.promise}return{downloadBlobFile:l,upload:u,get:r,post:i,deleteReq:c}}e.$inject=["$http","$q","fieldPromaxConfig","fpm-utilities-factory"],angular.module("fpm").factory("api-base-factory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r,c,u,l){function s(o){function r(e){if(e){b.isAuth=!0,b.userName=e.userName;var t={token:e.access_token,userName:e.userName,customerNumber:e.customerNumber,secLevel:e.secLevel,isAdminstrator:"True"===e.isAdminstrator,isIntuitUser:"True"===e.isIntuitUser,userEmail:e.userEmail,etOn:"True"===e.etOn,timeCard:"True"===e.timeCard,allowPushTime:"True"===e.allowPushTime,showPrice:"True"===e.showPrice,havingGroupsAssigned:"True"===e.havingGroups,inventoryOn:"True"===e.inventoryOn,allowUserToEditWoDescription:"True"===e.allowUserToEditWoDescription,currencySymbol:e.currencySymbol,dateFormat:e.dateFormat,timecardAccessLevel:+(e.timecardAccessLevel||1),allowUserToViewOtherSchedules:"True"===e.allowUserToViewOtherSchedules,userNum:+e.userNum,isTrafficControllerCustomer:"True"===e.isTrafficControllerCustomer};n.currencySymbol=e.currencySymbol,n.dateFormat=e.dateFormat,i.set(v.userCredentials,o),i.set(v.storageKeyName,t),e.hasOwnProperty(v.configKeyName)&&i.set(v.configKeyName,JSON.parse(e.configurations)),e.userSettings&&i.set(v.settingsKeyName,JSON.parse(e.userSettings)),l.resolve(e)}else e.data?l.reject(e.data.error):l.reject("Invalid Login Details")}function c(e){a.hideLoading(),l.reject(e)}var u="grant_type=password&username="+encodeURIComponent(o.userName)+"&password="+encodeURIComponent(o.password)+"&clientId=fieldPromaxMob",l=t.defer();return e.post(C+"token",u,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(r).error(c),l.promise}function d(){var e=t.defer();return i.get(v.storageKeyName)?e.resolve(!0):e.resolve(!1),e.promise}function m(){return i.get(v.storageKeyName)}function f(e){n.$evalAsync(function(){l.clearTimecardFactoryData(),o.clearHistory(),o.clearCache(),u.clearAllCache(),i.remove(v.initialData),i.remove(v.storageKeyName),i.remove(v.configKeyName),i.remove(v.settingsKeyName),i.clearAll(),e&&i.remove(v.userCredentials),i.remove("orderState"),a.clearHistory()})}function p(e){return c.get("api/public/SendPassword?email="+e)}function h(e){return c.post("api/user/changepassword",e)}function g(){return i.get(v.userCredentials)}function y(){return i.get(v.storageKeyName).token}var C=r.fieldPromaxApi,v=r.localStorageKeys,b={isAuth:!1,userName:""};return{getToken:y,
getStoredCredentials:g,login:s,isAuthenticated:d,getLoggedInUserInfo:m,logout:f,sendPassword:p,authentication:b,changePassword:h}}e.$inject=["$http","$q","$rootScope","$ionicHistory","fpm-utilities-factory","localStorageService","fieldPromaxConfig","api-base-factory","work-orders-factory","timecard-factory"],angular.module("fpm").factory("authenticationFactory",e)}()}(),function(){"use strict";!function(){function e(){return{link:function(e,t,n){setTimeout(function(){$(t).autogrow({vertical:!0,horizontal:!1})},1e3)},restrict:"A"}}function t(e){for(var t="",n=new Uint8Array(e),o=n.byteLength,a=0;a<o;a++)t+=String.fromCharCode(n[a]);return window.btoa(t)}function n(){return{restrict:"A",scope:{imageId:"<",imageElId:"@",downloadThumb:"<"},bindToController:!0,controllerAs:"vm",controller:["shared-data-factory",function(e){function n(n){e.downloadImageFromBlob(n,o.downloadThumb).then(function(e){if(e){var n=t(e);if(n&&""!==n){var a=document.getElementById(o.imageElId);a&&(a.src="data:image/png;base64,"+n)}}})}var o=this;o.$onInit=function(){o.imageId&&n(o.imageId)}}]}}var o=angular.module("fpm");o.directive("focusMe",["$timeout",function(e){return{link:function(t,n,o){t.$on("modal.shown",function(){e(function(){n[0].focus(),ionic.Platform.isAndroid()&&cordova.plugins.Keyboard.show()},750)})}}}]),o.directive("autoGrow",e),o.directive("fieldPromaxTitle",["$timeout",function(e){return{link:function(e,t,n){console.log(t)}}}]),o.directive("blobImage",n)}()}(),function(){"use strict";!function(){function e(){return function(e){if(e.lastIndexOf(".")<=0)return n;var t=e.substr(e.lastIndexOf("/")+1),n=t.substr(0,t.lastIndexOf("."))||"";return n}}var t=angular.module("fpm");t.provider("fpm-utilities-factory",function(){function e(e,n,o,a,i,r,c,u,l,s,d,m,f,p,h){var g={ANDROID:1,IOS:2,OTHER:3},y=!1,C=null,v=null,b={maximumAge:3e3,timeout:6e4,enableHighAccuracy:!1},D={maximumAge:3e3,timeout:6e4,enableHighAccuracy:!1},w=(p.localStorageKeys,{alert:function(t,n,o){var a=c.alert({title:t,template:n});angular.isFunction(o)&&a.then(function(t){e(function(){o()},100)})},confirmWithOkayCancel:function(e,t,n,o){c.confirm({title:e,template:t,cancelText:"Cancel",okText:"Okay"}).then(function(e){e?angular.isFunction(n)&&n():angular.isFunction(o)&&o()})},confirm:function(e,t,n,o){c.confirm({title:e,template:t,cancelText:"No",okText:"Yes"}).then(function(e){e?angular.isFunction(n)&&n():angular.isFunction(o)&&o()})},confirmDelete:function(e){c.confirm({title:"Confirmation",template:"Are you sure?",cancelText:"No",okText:"Yes"}).then(function(t){t&&angular.isFunction(e)&&e()})}}),S={isAndroid:function(){return!!t||ionic.Platform.isAndroid()},isIOS:function(){return!t&&ionic.Platform.isIOS()}},T={GCM_SENDER_ID:"504804224593",registrationId:null};return{push:{getRegistrationId:function(){return h.get("PUSH:registrationId")},register:function(){if(!t){PushNotification.init({android:{senderID:T.GCM_SENDER_ID,forceShow:"false"},ios:{alert:"true",badge:"true",sound:"true"}}).on("registration",function(e){e&&(T.registrationId=e.registrationId,h.set("PUSH:registrationId",e.registrationId))})}}},locationService:{start:function(e){function t(e){}function o(t){t&&t.coords&&(n.currentLocation=t,angular.isFunction(e)&&e(t.coords))}var a=h.get(p.localStorageKeys.settingsKeyName);a&&a.LocationServices&&(navigator.geolocation.getCurrentPosition(o,t,D),v=f.watchPosition(b),v.then(null,t,o))},stop:function(){v&&angular.isFunction(v.clearWatch)&&v.clearWatch(),f.clearWatch(v)}},isOnDevMode:t,showNetworkDialog:function(){y||(C=c.alert({title:"No Network",template:"You're not connected to internet"}),y=!0,C.then(function(){y=!1}))},hideNetworkDialog:function(){C&&y&&(C.close(),y=!1)},clearHistory:function(){m.clearHistory()},device:{isAndroid:S.isAndroid,isIOS:S.isIOS,isConnected:function(){return t||i.isOnline()},getPicture:function(){var e={quality:75,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,saveToPhotoAlbum:!1,correctOrientation:!0},t=r.defer();return d.getPicture(e).then(function(e){t.resolve(e)},function(){t.reject(null)}),t.promise},platforms:g,getPlatformInfo:function(){var e=t?"Android":s.getPlatform();return"Android"===e?g.ANDROID:"iOS"===e?g.IOS:g.OTHER}},toStringDate:function(e){return kendo.toString(kendo.parseDate(e),"g")},showLoading:function(e){var t=e||"please wait...";return l.show({template:t})},getModal:function(e,t){var n=r.defer();return u.fromTemplateUrl(e,{scope:t,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){n.resolve(e)}),n.promise},hideLoading:function(){return l.hide()},alerts:{alert:w.alert,confirm:w.confirm,confirmDelete:w.confirmDelete,confirmWithOkayCancel:w.confirmWithOkayCancel}}}var t=!1;this.setApplicationModel=function(e){t=e},this.$get=["$timeout","$rootScope","$cordovaDialogs","$window","$cordovaNetwork","$q","$ionicPopup","$ionicModal","$ionicLoading","$cordovaDevice","$cordovaCamera","$ionicHistory","$cordovaGeolocation","fieldPromaxConfig","localStorageService",e]}),t.filter("removeExt",[e])}()}(),function(){"use strict";!function(){function e(e,t,n){var o={BadRequest:400,PageNotFound:401},a={},i=function(e){e.headers=e.headers||{};var t=n.get("authorizationData");return t&&(e.headers.Authorization="Bearer "+t.token),e},r=function(n){if(n.status===o.PageNotFound&&t.path("/"),n.status===o.BadRequest&&n.data)throw n;return n&&n.data&&n.data.exceptionMessage&&n.data.exceptionMessage.indexOf("unauthorized")>0&&t.path("/"),console.log("rejection",n),e.reject(n)};return a.request=i,a.responseError=r,a}e.$inject=["$q","$location","localStorageService"],angular.module("fpm").factory("requestIntercepter",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i){function r(e){}function c(e){return n.post("api/User/UpdateUserSettings",e)}function u(e){var i=a.localStorageKeys.initialData;!0===(e||!1)&&o.remove(i);var r=o.get(i);return r?t.when(r):n.get(y+"GetIniitialData").then(function(e){return o.set(i,e),e})}function l(e){return n.get(y+"SaveLocationCoordinates?lat="+e.latitude+"&lng="+e.longitude)}function s(){var e=o.get("PUSH:registrationId");if(!i.isOnDevMode&&angular.isDefined(e)){var t=i.device.isAndroid(),a=t?"0":"1",r=C+"RegisterUserToHub?handle="+e+"&platform="+a;return n.get(r)}var r=C+"RegisterUserToHub?handle="+e+"&platform=0";return n.get(r)}function d(e){return n.post(v+"PostLocation",e)}function m(e,n,o,a){var i=t.defer();if(window.google){var r=new google.maps.Geocoder,c=a+" "+o+" "+e+" "+n;r.geocode({address:c},function(e,t){t===google.maps.GeocoderStatus.OK?i.resolve({log:e[0].geometry.location.lng(),lat:e[0].geometry.location.lat()}):i.resolve({log:0,lat:0})})}else i.resolve({log:0,lat:0});return i.promise}function f(e,n){var o=t.defer();e=e.replace(/data\:image\/(jpeg|jpg|png)\;base64\,/gi,"");for(var a=atob(e),i=[],r=Math.floor(a.length/512)+1,c=0,u=0;u<a.length;u+=512){c+=1;for(var l=a.slice(u,u+512),s=new Array(l.length),d=0;d<l.length;d++)s[d]=l.charCodeAt(d);var m=new Uint8Array(s);if(i.push(m),c===r){var f=new File(i,n,{type:"image/jpeg",lastModified:new Date});o.resolve(f)}}return o.promise}function p(e){return n.post(y+"SubmitQuestion",e)}function h(){return n.get(v+"ClearLocationData")}function g(e,t){return n.downloadBlobFile(y+"DownloadImageFromBlob?imageId="+e+"&thumb="+t)}var y="api/Shared/",C="api/NotificationsHub/",v="api/Location/";return{downloadImageFromBlob:g,submitQuestion:p,convertToBlob:f,updateLocationServiceStatus:r,getAddressCoorinates:m,postLocation:d,registerUserTemplateForPushNotifications:s,updateSettings:c,getIniitialData:u,saveLocationCordinates:l,clearLocationData:h}}e.$inject=["$rootScope","$q","api-base-factory","localStorageService","fieldPromaxConfig","fpm-utilities-factory"],angular.module("fpm").factory("shared-data-factory",e)}()}(),function(){"use strict";!function(){function e(){return{link:function(e,t,n){n.class?$(t[0].children[0]).css("text-align","center"):$(t[0].children[0]).css("text-align","right")}}}angular.module("fpm").directive("alignCalendar",e)}()}(),function(){"use strict";!function(){function e(e){function t(t,n){return e.get(s+"GetCustomTypesDataByBarcode?jobTypeName="+n+"&barcode="+t)}function n(t){return e.post(s+"UploadFile",t)}function o(t,n){return e.post(s+"UpdateData?checkBoxValue="+n,t)}function a(t){return e.deleteReq(s+"DeleteCustomTypeData?num="+t)}function i(t,n){return e.upload(s+"TryUploadFile",t,n)}function r(t){return e.post(s+"AddCustomeTypeClone",t)}function c(t,n){return e.get(s+"GetWorkOrderClones?barcode="+t+"&jobType="+n)}function u(t){return e.deleteReq(s+"DeleteCustomTypeClone?num="+t)}function l(t){return e.get("api/JobTypes/GetJobTypeByName?jobTypeName="+t)}var s="api/CustomTypes/";return{getJobTypeByName:l,deleteClone:u,getWorkOrderClones:c,createClone:r,uploadFiles:i,uploadFile:n,controlTypes:{TEXT_BOX:1,RADIO:2,CHECKBOX:3,DATE:4,UPLOAD:5},getCustomTypesDataByBarcode:t,entityTypes:{None:0,WorkOrder:1,Estimate:2,Expense:3,JobType:4,Equipment:101,EquipmentsToBarcode:102},typesData:{requestDataCompleted:!1,barcode:"",jobTypeName:"",entityId:0,isNewType:!1,fireGetTypesEvent:!1,fetchViewData:!1,data:[],viewData:[],viewDataForEquipment:[]},updateData:o,deleteCustomTypesData:a}}e.$inject=["api-base-factory"],angular.module("fpm").factory("custom-types-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{isEstimate:"<",onAddProductCompleted:"&",modalType:"<",product:"="},templateUrl:"js/shared-components/edit-product-component-template.html",controller:["$scope","$stateParams","$rootScope","work-orders-factory","authenticationFactory","fpm-utilities-factory","shared-data-factory","estimates-factory","inventory-data-factory",function(e,t,n,o,a,i,r,c,u){var l=this;l.containers=[],l.user=a.getLoggedInUserInfo(),l.errors=[];var s=i.alerts;l.events={closeProductEditModal:function(){n.$broadcast("$fpm:closeEditProductModal")},updateProductClick:function(){if(0===l.modalType){var a=l.isEstimate?c.updateProduct:o.updateProduct;!0===l.user.inventoryOn?u.getProductContainers(l.product.num).then(function(t){if(null!=t&&null!=t.collection&&t.collection.length>0){l.containers=t.collection;var n=_.filter(l.containers,function(e){return e.userId===l.user.userEmail});if(n){if(l.product.qty>n[0].qoh)return l.errors.push("Maximum quantity can be added is only "+n[0].qoh),!1;l.errors=[],i.showLoading("updating product...").then(function(){a(l.product).then(function(t){e.$emit("$fpm:operation:updateProduct",t),s.alert("Success","Product has been updated successfully.")}).finally(i.hideLoading)})}}}):i.showLoading("updating product...").then(function(){a(l.product).then(function(t){e.$emit("$fpm:operation:updateProduct",t),s.alert("Success","Product has been updated successfully.")}).finally(i.hideLoading)})}else l.product.barCode=t.barCode,l.product.quantity=l.product.qty,l.product.markup=l.product.markup,l.product.FromListWindow=!0,!0===l.user.inventoryOn?u.getProductContainers(l.product.num).then(function(e){if(null!=e&&null!=e.collection&&e.collection.length>0){l.containers=e.collection;var t=_.filter(l.containers,function(e){return e.userId===l.user.userEmail});if(t){if(l.product.qty>t[0].qoh)return l.errors.push("Maximum quantity can be added is only "+t[0].qoh),!1;l.errors=[],i.showLoading().then(function(){o.addProduct(l.product).then(function(e){angular.isFunction(l.onAddProductCompleted)?l.onAddProductCompleted({product:e}):n.$broadcast("$fpm:operation:addProduct",e)}).finally(i.hideLoading)})}}}):i.showLoading().then(function(){o.addProduct(l.product).then(function(e){angular.isFunction(l.onAddProductCompleted)?l.onAddProductCompleted({product:e}):n.$broadcast("$fpm:operation:addProduct",e)}).finally(i.hideLoading)})}},l.$onInit=function(){r.getIniitialData().then(function(e){l.enableMarkupOrders=e.customerNumberEntity.enableMarkupForWorkOrders||!1})}}],controllerAs:"vm"};angular.module("fpm").component("editProductComponent",e)}()}(),function(){"use strict";!function(){angular.module("fpm").component("errorsView",{bindings:{errors:"<"},templateUrl:"js/shared-components/errors-view-component-template.html",controllerAs:[function(){}],controllerAs:"vm"})}()}(),function(){"use strict"}(),function(){"use strict";!function(){angular.module("fpm").component("fpcurrencyRenderer",{controller:["$filter","$rootScope","authenticationFactory",function(e,t,n){function o(){i.modelVal?i.currencyValue=e("currency")(i.modelVal,t.currencySymbol,2):i.currencyValue=e("currency")(0,t.currencySymbol,2)}function a(){if(t.currencySymbol)o();else{var e=n.getLoggedInUserInfo();e.currencySymbol?(t.currencySymbol=e.currencySymbol,o()):(t.currencySymbol="$",o())}}var i=this;i.currencyValue="",i.$onChanges=function(){o()},i.$onInit=function(){a()},i.$onDestroy=function(){}}],template:'<span ng-bind="vm.currencyValue"></span>',controllerAs:"vm",bindings:{modelVal:"<"}})}()}(),function(){"use strict";!function(){angular.module("fpm").component("fpDateComponent",{controller:["$scope","$timeout","$rootScope",function(e,t,n){function o(){i.mobiscrollDateConfig={display:"bottom",dateFormat:void 0!==i.format&&""!==i.format?i.format.toLowerCase().replace("yy",""):"mm/dd/yy",onSelect:function(e){angular.isFunction(i.onDateChanged)&&t(i.onDateChanged,100)}}}function a(){i.modelVal&&!_.isDate(i.modelVal)&&(i.modelVal=new Date(i.modelVal))}var i=this;i.format=n.dateFormat,e.$watch("vm.modelVal",a),i.$onInit=function(){a(),o()},i.$onDestroy=function(){}}],template:'<input type="text" class="transparent-background" mobiscroll-date="vm.mobiscrollDateConfig" ng-model="vm.modelVal" placeholder="{{vm.defaultText}}" />',controllerAs:"vm",bindings:{modelVal:"=",type:"@",onDateChanged:"&",format:"<",defaultText:"@"}})}()}(),function(){"use strict";!function(){angular.module("fpm").component("fpDateTimeComponent",{controller:["$timeout","$rootScope",function(e,t){function n(){o.mobiscrollDateTimeConfig={instance:null,display:"bottom",dateFormat:void 0!==o.format&&""!==o.format?o.format.toLowerCase().replace("yy",""):"mm/dd/yy",timeFormat:"hh:ii A",onSelect:function(t){angular.isFunction(o.onDateChanged)&&e(function(){o.onDateChanged()},100)}}}var o=this;o.format=t.dateFormat,o.disableSelection=!1,o.onInputboxTapped=function(){},o.$onChanges=function(e,t){n()},o.$onInit=function(){o.modelVal&&!_.isDate(o.modelVal)&&(o.modelVal=new Date(o.modelVal)),n()},o.$onDestroy=function(){}}],template:'<input type="text" ng-if="!vm.isDisabled" on-tap="vm.onInputboxTapped()"  class="transparent-background" mobiscroll-datetime="vm.mobiscrollDateTimeConfig" ng-model="vm.modelVal" placeholder="{{vm.defaultText}}" /> <input type="text" ng-if="vm.isDisabled" readonly disabled on-tap="vm.onInputboxTapped()"  class="transparent-background" placeholder="{{vm.defaultText}}" />',controllerAs:"vm",bindings:{modelVal:"=",type:"@",onDateChanged:"&",format:"<",defaultText:"@",isDisabled:"<"}})}()}(),function(){"use strict";!function(){angular.module("fpm").component("fpDateTimeRenderer",{controller:["dateFilter",function(e){function t(){if(n.modelVal&&!_.isDate(n.modelVal)&&(n.modelVal=kendo.parseDate(n.modelVal)),n.modelVal&&""!==n.modelVal){var t="";n.format&&""!==n.format?(n.format="datetime"==n.type?n.format+" hh:mm a":n.format,t=e(n.modelVal,n.format)):(n.format="datetime"==n.type?"MM/dd/yyyy hh:mm a":n.format,t=e(n.modelVal,n.format)),n.formattedValue=t}}var n=this;n.formattedValue="",n.$onChanges=function(){t()},n.$onInit=function(){t()},n.$onDestroy=function(){}}],template:'<span ng-bind="vm.formattedValue"></span>',controllerAs:"vm",bindings:{modelVal:"<",format:"<",type:"@"}})}()}(),function(){"use strict";!function(){function e(e){return{link:function(t,n,o){t.$emit("fpm:showEmptyImageMessage",!1),$(n).on("error",function(){e(function(){$(n).hide(),$(n).parent().hide(),t.$emit("fpm:showEmptyImageMessage",!0)},20)})}}}e.$inject=["$timeout"],angular.module("fpm").directive("imageSrcCheck",e)}()}(),function(){"use strict";!function(){var e={templateUrl:"js/shared-components/product-search-component-template.html",controller:["$scope","$timeout","$ionicModal","fpm-utilities-factory","work-orders-factory","authenticationFactory",function(e,t,n,o,a,i){var r=this;r.searchValue="",r.products=[];var c=null;r.user=i.getLoggedInUserInfo(),r.events={closeProductEditModal:function(){r.productModal&&(r.searchValue="",r.vm.searchApplied=!1,r.productModal.hide())},applySearch:function(e){r.showingLessCount=!1,""!==r.searchValue&&(r.products=[],r.searchApplied=!1,r.runningSearch=!0,a.searchProduct(r.searchValue,"").then(function(e){if(r.searchApplied=!0,angular.isArray(e)&&(r.products=e,e.length>0)){var t=_.filter(e,function(e){return null!==e.totalCount});t.length>0&&(r.totalCount=t[0].totalCount,r.showingLessCount=r.totalCount>200)}}).finally(function(){r.runningSearch=!1}))},onProductItemClicked:function(t){r.currentProduct=angular.copy(t),r.currentProduct.qty=1,r.openEditProductModalOnProductSelectedFromSearch?(r.currentProduct.markup=0,r.productModal&&r.productModal.show().then(function(){})):e.$emit("$fpm:onProductSelected",t)},closeSearchModal:function(){r.searchValue="",r.products=[],r.searchApplied=!1,r.showingLessCount=!1,e.$emit("$fpm:closeProductSearchModal",{fromProductAdd:!1})},onAddProductCompleted:function(n){r.productModal.hide(),c=t(function(){e.$emit("$fpm:closeProductSearchModal",{fromProductAdd:!0})},100)}},e.$on("$fpm:closeEditProductModal",function(){r.productModal&&(r.productModal.hide(),r.searchValue=""),c&&t.cancel(c)}),o.getModal("addProductModal.html",e).then(function(e){r.productModal=e}),r.openEditProductModalOnProductSelectedFromSearch=!0,e.$on("$fpm:changeAddModalOpenPriority",function(e,t){r.openEditProductModalOnProductSelectedFromSearch=t}),r.$onInit=function(){},r.$onDestroy=function(){}}],controllerAs:"vm"};angular.module("fpm").component("productSearchComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",payment:"=",modalType:"<",amountReceived:"=",balanceDue:"="},controller:["$scope","fpm-utilities-factory","work-orders-factory","authenticationFactory","$rootScope",function(e,t,n,o,a){var i=this;i.errors=[],i.paymentModes=[{name:"Cash",value:"Cash"},{name:"Credit Card",value:"Credit Card"},{name:"Cheque",value:"Cheque"}],i.events={closePaymentModal:function(){a.$broadcast("$fpm:closeAddEditPaymentModal")},submit:function(){if(i.errors=[],i.showError=!1,i.payment.serviceProviderEmail=i.user.userEmail,void 0==i.payment.num&&i.payment.amountReceived>i.balanceDue.toFixed(2))return i.errors.push("Amount received can not be more than balance due"),i.showError=!0,!1;t.showLoading().then(function(){n.addUpdatePayment(i.payment).then(function(e){null==e?(i.errors=e.model.errors,i.showError=!0):a.$broadcast("$fpm:addUpdatePaymentCompleted",{o:{payment:i.payment,payments:e}})}).finally(t.hideLoading)})}},i.$onInit=function(){i.user=o.getLoggedInUserInfo()}}],controllerAs:"vm",templateUrl:"js/work-orders/add-edit-payment-modal-component.template.html"};angular.module("fpm").component("addEditPaymentComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",onCancelClicked:"&",onAddCompleted:"&",serviceProviders:"<",onEditOpCompleted:"&",isForEdit:"<",editedSchedule:"<"},controller:["$scope","$rootScope","$timeout","fpm-utilities-factory","work-orders-factory","authenticationFactory",function(e,t,n,o,a,i){var r=this;r.errors=[],r.dateTimeFormat=t.dateFormat;var c={serviceProvider:"",startDate:new Date,endTime:new Date,fromMobile:!0,barCode:r.barcode,intuitQboItemId:""};r.newSchedule=angular.copy(c),r.events={closeProductEditModal:function(){angular.isFunction(r.onCancelClicked)&&r.onCancelClicked()},addScheduleClicked:function(){r.errors=[],r.showError=!1;var e=angular.copy(r.newSchedule);e.startDate=o.toStringDate(r.newSchedule.startDate),e.endTime=o.toStringDate(r.newSchedule.endTime),r.isForEdit&&(e=angular.copy(r.editedSchedule),e.technicianNum=r.newSchedule.serviceProvider,e.scheduledStartDateTime=o.toStringDate(r.newSchedule.startDate),e.scheduledFinishDateTime=o.toStringDate(r.newSchedule.endTime)),o.showLoading().then(function(){(r.isForEdit?a.updateSchedule2:a.addWorkOrderSchedule)(e).then(function(e){angular.isDefined(e.model)&&angular.isArray(e.model.errors)&&e.model.errors.length>0?(r.errors=e.model.errors,r.showError=!0):(angular.isFunction(r.onAddCompleted)&&!r.isForEdit&&r.onAddCompleted({o:{invoice:e.invoice,schedules:e.schedule}}),angular.isFunction(r.onEditOpCompleted)&&r.isForEdit&&r.onEditOpCompleted({isDone:!0}))}).finally(o.hideLoading)})},onServiceProviderSelectionChanged:function(){}},r.$onInit=function(){r.user=i.getLoggedInUserInfo(),r.dateTimeFormat=r.user.dateFormat,r.isForEdit&&r.editedSchedule&&n(function(){r.newSchedule.serviceProvider=r.editedSchedule.technicianNum,r.newSchedule.startDate=kendo.parseDate(r.editedSchedule.scheduledStartDateTime),r.newSchedule.endTime=kendo.parseDate(r.editedSchedule.scheduledFinishDateTime),r.newSchedule.num=r.editedSchedule.num,r.newSchedule.barCode=r.editedSchedule.barcode},50)}}],controllerAs:"vm",templateUrl:"js/work-orders/add-schedule-modal-component.template.html"};angular.module("fpm").component("addScheduleModalComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i){var r=this;r.selectedOption=0,r.showOtherSchedules=!1;var c={AcceptJob:0,InRoute:1,CheckIn:2,CheckOut:3};r.checked=!0,r.events={onCheckboxClicked:function(e){var t=_.where(r.schedules,{isChecked:!0});r.checked=t.length>0},onSubmitButtonClicked:function(n){var i=_.pluck(_.where(r.schedules,{isChecked:!0}),"num");if(n&&0===i.length)return!1;if(3===r.actionType)e.$emit("$wo.multipleScheduleModalCancel.clockout",{multiple:n,checkedSchedules:i});else{var u=new Date,l=new Date,s={scheduleButton:1===r.actionType?c.CheckIn:2===r.actionType?c.CheckOut:-1,scheduleNums:n?i:null,scheduleNum:n?null:r.editedSchedule.num,actualEndTime:2===r.actionType?o.toStringDate(l):null,actualStartTime:o.toStringDate(u),barcode:r.barcode,timerStartAt:o.toStringDate(new Date),clientTime:kendo.toString(new Date,"g")};o.showLoading().then(function(){a.updateJobStatusMultiple(s).then(function(e){}).finally(function(){o.hideLoading(),t.$broadcast("$wo.multipleScheduleModalCancel.reloadAll",{closeModal:!0})})})}},onSelectedOptionChanged:function(){n(function(){r.showOtherSchedules=1===r.selectedOption},100)},closeProductEditModal:function(){e.$emit("$wo.multipleScheduleModalCancel")}},r.$onInit=function(){n(function(){a.getSchedulesWithSameDateTime(r.barcode,r.editedSchedule.num,r.actionType).then(function(e){r.schedules=e,angular.forEach(r.schedules,function(e){e.isChecked=!0})})},20)}}e.$inject=["$scope","$rootScope","$timeout","fpm-utilities-factory","work-orders-factory","timecard-factory"];var t={bindings:{barcode:"<",editedSchedule:"<",actionType:"<"},controller:e,controllerAs:"vm",templateUrl:"js/work-orders/checkin.multiple.schedule.modal.component.html"};angular.module("fpm").component("checkinMultipleScheduleModalComponent",t)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r){function c(){o.getBarCodeNumber().then(function(e){p.woEntity.barCode=e.barcode,p.woEntity.barCodeName=e.barcodeName}).finally(i.hideLoading)}function u(){p.dates&&p.dates.startDate&&g&&(p.dates.endDate=new Date(moment(p.dates.startDate).add("minutes",g.IntervalForDateTimePicker)))}function l(){i.showLoading().then(function(){o.createEntity().then(function(e){if(p.woEntity=angular.copy(e),p.woEntity.fromMobile=!0,!0===p.isServiceProvider)var n=t(function(){p.woEntity.serviceProvider=p.userInfo.userEmail,t.cancel(n)},100);m()}).finally(c)})}function s(){}function d(t){if(p.errors=[],!1===p.isCustomerSelected)return p.errors.push("Please select a customer first."),h.alert("Warning",p.errors[0],function(){p.customerSearchComponent&&void 0!==p.customerSearchComponent&&p.customerSearchComponent.events.onSearchBoxTapped()}),s(),!1;i.showLoading("creating work order...").then(function(){p.woEntity.scheduleStart=i.toStringDate(p.dates.startDate),p.woEntity.scheduleEnd=i.toStringDate(p.dates.endDate),a.getAddressCoorinates(p.woEntity.sState,p.woEntity.sZip,p.woEntity.sCity,p.woEntity.sStreet).then(function(t){p.woEntity.longitude=t.log,p.woEntity.latitude=t.lat,o.createWorkOrder(p.woEntity).then(function(t){t&&(t.errors.length>0?(p.errors=t.errors,h.alert("Warning",t.errors[0],null)):h.alert("Success","Work Order created successfully",function(){e.go("app.dashboard",{refresh:!0})}))},function(){p.errors=["Error while creating work order."]}).finally(i.hideLoading)})})}function m(){p.dates={startDate:new Date,endDate:new Date(moment().add(1,"hours"))},u()}function f(){e.go("app.dashboard",{refresh:!1})}var p=this,h=i.alerts;p.userInfo=r.getLoggedInUserInfo();var g=null;p.errors=[],p.dateTimeFormat=p.userInfo.dateFormat,m(),p.isCustomerSelected=!1,p.events={onStartDateChanged:function(){t(function(){u()},100)},sameAsBilling:function(){p.woEntity.sStreet=p.woEntity.bStreet,p.woEntity.sState=p.woEntity.bState,p.woEntity.sCity=p.woEntity.bCity,p.woEntity.sZip=p.woEntity.bZip},clearServiceAddress:function(){p.woEntity.sStreet="",p.woEntity.sState="",p.woEntity.sCity="",p.woEntity.sZip=""},onCustomerSelected:function(e){p.isCustomerSelected=!0,p.woEntity.firstName=e.firstName,p.woEntity.lastName=e.lastName,p.woEntity.companyName=e.company,p.woEntity.displayName=e.name,p.woEntity.bCity=e.addressCity,p.woEntity.isProject=e.isProject||!1,p.woEntity.bState=e.addressCountrySubDivCode,p.woEntity.bStreet=null==e.street?null:e.street.replace("::","\n"),p.woEntity.bZip=e.addressPostalCode,p.woEntity.phone=e.phone,p.woEntity.fax=e.fax,p.woEntity.uin=e.uin,p.woEntity.email=e.email_Group,p.woEntity.mobile=e.mobile,p.woEntity.sStreet=null==e.shipStreet?"":e.shipStreet.replace("::","\n"),p.woEntity.sState=e.shipState,p.woEntity.sCity=e.shipCity,p.woEntity.sZip=e.shipZIP},onSubmitButtonClicked:d,onBackToDashboardClicked:f},function(){a.getIniitialData().then(function(e){e&&(p.poHeading="PO Number",p.jobTypes=e.jobTypes,p.serviceProviders=e.serviceProviders,p.isServiceProvider=!p.userInfo.isAdminstrator,e.customerNumberEntity.configurationJson&&(g=JSON.parse(e.customerNumberEntity.configurationJson),g&&g.PoBoxLabel?p.poHeading=g.PoBoxLabel:"QBO"===e.customerNumberEntity.intuitServiceType?p.poHeading="Custom 1":p.poHeading="PO Number"))}).finally(l)}()}e.$inject=["$state","$timeout","$rootScope","work-orders-factory","shared-data-factory","fpm-utilities-factory","authenticationFactory"],angular.module("fpm").controller("create-order-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r,c,u,l,s,d,m,f,p){function h(){H.gettingBarcodeDetails=!0,u.show({template:"loading work order..."}).then(function(){s.getBarcodeDetails(H.barcode).then(function(e){if(H.gettingBarcodeDetails=!1,H.barCodeData=angular.copy(e),H.barCodeData.taxRate=H.barCodeData.taxRate.toFixed(2),H.uiSettings.woData=angular.copy(e),H.taxCheckboxVisibility=(H.barCodeData.taxRate||0)>0,angular.isArray(e.schedules)&&e.schedules.length>0){var t=angular.copy(_.findWhere(e.schedules,{num:parseInt(r.technicianNum,10)}));H.schedule=t,ne=angular.copy(t),angular.isDefined(H.schedule)?(H.schedule.actualStartDateTime&&(H.schedule.actualStartDateTime=kendo.parseDate(H.schedule.actualStartDateTime),H.schedule.actualStartDateTimeString=kendo.toString(kendo.parseDate(H.schedule.actualStartDateTime),"g")),H.schedule.actualFinishDateTime&&(H.schedule.actualFinishDateTime=kendo.parseDate(H.schedule.actualFinishDateTime),H.schedule.actualFinishDateTimeString=kendo.toString(kendo.parseDate(H.schedule.actualFinishDateTime),"g")),g(H.schedule.actualStartDateTime,H.schedule.actualFinishDateTime),0===H.uiSettings.billingOption&&(H.schedule.inRouteStartTime=kendo.parseDate(H.schedule.inRouteStartTime),H.schedule.inRouteEndTime=kendo.parseDate(H.schedule.inRouteEndTime)),0===H.uiSettings.billingOption&&H.uiSettings.isRouteTimeOptionChecked&&g(H.schedule.inRouteStartTime,H.schedule.inRouteEndTime,!0),H.uiSettings.orderBelongToCurrentUser=H.schedule.technicianNum===H.userId,E()):E()}else E();a(function(){var e=new Date,t=d.toStringDate(new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0));H.schedule&&p.checkPreviousDateClockIn({timecardDate:t,userEmail:H.schedule.technicianNum}).then(function(e){H.timecardClockinStat=e})},100)},function(){K.alert("Oops","ERROR WHILE GETTING WORK ORDER INFORMATION..",u.hide)}).finally(function(){u.hide(),e.$broadcast("scroll.refreshComplete"),a(function(){(z||H.isTrafficControllerCustomer)&&j(!1)},100)})})}function g(e,t,n){var i=o.defer();if(Date.parse(e)&&Date.parse(t)){var r=new Date(t),c=new Date(e),u=new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),0,0),l=new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes(),0,0),s=moment(u).diff(moment(l),"minutes"),d=s%60,m=Math.floor(s/60);oe=a(function(){n?H.scheduleTimeSpan.inRouteTimeSpan=0===m?d+" Minutes":m+" Hours "+d+" Minutes":H.scheduleTimeSpan.timeSpan=0===m?d+" Minutes":m+" Hours "+d+" Minutes"},50),i.resolve(s)}else i.resolve(0);return i.promise}function y(e,t){return new Date(e.getTime()+6e4*t)}function C(e,t){var n=t.getVal(),o=Math.floor(n/1e3),i=Math.floor(o/60);ae=a(function(){var e,t=angular.copy(H.schedule.inRouteStartTime);null==t?(e=new Date,H.schedule.inRouteStartTime=new Date):e=new Date(t);var n=y(e,i);H.schedule.inRouteEndTime=kendo.parseDate(n),M(!1,!1)},50)}function v(){g(H.schedule.inRouteStartTime,H.schedule.inRouteEndTime,!0),M(!1,!1)}function b(e){if(0===H.uiSettings.billingOption&&H.schedule){var t=!e&&!H.schedule.checkOutStatus;H.schedule.actualStartDateTime&&H.schedule.actualFinishDateTime?new Date(H.schedule.actualStartDateTime)>new Date(H.schedule.actualFinishDateTime)?K.alert("Warning",e?"Start time cannot be greater than finish time.":"Finish time cannot be less than start time"):t?a(function(){L(!1)},50):g(H.schedule.actualStartDateTime,H.schedule.actualFinishDateTime).then(function(e){H.schedule.approve||S()}):S()}else M(!1,!1)}function D(e,t,n){if(H.schedule){var o=H.user.havingGroupsAssigned;if(!1===H.isServiceProvider)return!0;var a=H.schedule.technicianNum===H.user.userEmail;if(o&&n&&!0===n){var i=_.findWhere(H.serviceProviders,{userId:H.schedule.technicianNum});if(angular.isDefined(i))return!0}return!(H.isServiceProvider&&!a&&3!==H.user.timecardAccessLevel)||(K.alert("Oops!","you are not authorized to perform this action",function(){angular.isFunction(t)&&e&&t(e)}),!1)}return!1}function w(e){D(null,null,!1)&&(!0===e&&(H.schedule.actualStartDateTime=null),H.schedule.actualFinishDateTime=null,H.scheduleTimeSpan.timeSpan="",H.schedule.approve||S())}function S(){var e=angular.copy(H.schedule);e.actualStartDateTime=kendo.toString(H.schedule.actualStartDateTime,"g"),e.actualFinishDateTime=kendo.toString(H.schedule.actualFinishDateTime,"g"),s.updateSchduleTotalTime(e).then(function(e){e&&(H.barCodeData.schedules=e.schedule,H.barCodeData.invoice=e.invoice,E())}).finally(function(){n.$broadcast("$workOrder.refreshTimecardUI")})}function T(){var t={num:0,numFromSummary:0,timeCardDate:d.toStringDate(H.schedule.actualStartDateTime),startTime:d.toStringDate(H.schedule.actualStartDateTime),finishTime:d.toStringDate(H.schedule.actualFinishDateTime),jobCode:0,notes:"",barcode:H.barcode,isUserDefined:!0,scheduleId:H.schedule.num};H.schedule.actualStartDateTime?p.pushCheckInOutTimes(t).then(function(t){angular.isArray(t)&&t.length>0?K.alert("Warning",t[0]):(K.alert("Success","Details successfully pushed to timecard"),3===H.user.timecardAccessLevel&&e.$broadcast("$timecard.refreshTimecard.pushToTimecard",{scheduleNum:H.schedule.num}))}):K.alert("Warning","Please select Check In date and time")}function k(){n.currentLocation?re=n.currentLocation:d.device.isIOS()&&n.locationTrackingOn&&window.BackgroundGeolocation&&window.BackgroundGeolocation.getCurrentPosition(function(e,t){window.BackgroundGeolocation.finish(t),re=e})}function E(){var e={subtotal:0,totalqty:0,
totalcost:0,totaltax:0};if(H.barCodeData.invoice&&H.barCodeData.invoice.length>0){var t=H.barCodeData.taxRate||0,n=0;angular.forEach(H.barCodeData.invoice,function(o,a){if(o.price&&o.qty){var i=0;if(angular.isDefined(o.newPriceCalculated)||(o.newPriceCalculated=!1),angular.isNumber(parseFloat(o.price))&&angular.isNumber(parseInt(o.qty,10))){if(o.markup>0){var r=o.newPriceCalculated?o.price:parseFloat(o.price)+parseFloat((o.markup||0)/100*o.price);o.price=r,o.newPriceCalculated=!0,i=r*o.qty}else i=o.price*o.qty;o.totalPrice=i;var c=parseFloat(parseFloat(t)>0?parseFloat(t/100*i):0);e.subtotal+=parseFloat(i),e.totalqty+=parseInt(o.qty,10),o.taxable&&(n+=parseFloat(c))}}a===H.barCodeData.invoice.length-1&&(e.totaltax=n,H.totals=e)})}else H.totals=e}function I(e){function t(){s.updateWorkOrderMobile({barcodeAssay:H.barCodeData.barcodeDetails,fromMobile:!0,secondaryStatusUpdatedDateTime:kendo.toString(new Date,"g")}).then(function(e){e&&angular.isArray(e)&&e.length>0&&(H.errors=e)})}e&&"desc"===e?t():D(null,null,!1)&&t()}function M(e,t,n){var o=angular.copy(H.schedule);H.schedule.actualStartDateTime&&(o.actualStartDateTime=kendo.toString(H.schedule.actualStartDateTime,"g")),H.schedule.actualFinishDateTime&&(o.actualFinishDateTime=kendo.toString(H.schedule.actualFinishDateTime,"g")),H.schedule.inRouteStartTime&&(o.inRouteStartTime=kendo.toString(H.schedule.inRouteStartTime,"g")),H.schedule.inRouteEndTime&&(o.inRouteEndTime=kendo.toString(H.schedule.inRouteEndTime,"g")),!0===t?d.showLoading().then(function(){s.updateSchedule(o).then(function(t){t&&""!==t?K.alert("Warning",t,function(){H.schedule.workComplete=!1}):e?K.alert("Success","Schedule information updated successfully",function(){angular.isFunction(n)&&n()}):angular.isFunction(n)&&n()}).then(d.hideLoading)}):s.updateSchedule(o).then(function(){e?K.alert("Success","Schedule information updated successfully",function(){angular.isFunction(n)&&n()}):angular.isFunction(n)&&n()})}function P(e){if(H.uiSettings.woData){var t=_.findWhere(H.uiSettings.woData.schedules,{num:e.num});if(angular.isDefined(t))for(var n in t)e.hasOwnProperty(n)&&(e[n]=t[n])}}function $(e){if(H.uiSettings.woData){var t=_.findWhere(H.uiSettings.woData.invoice,{num:e.num});if(angular.isDefined(t))for(var n in t)e.hasOwnProperty(n)&&(e[n]=t[n])}}function O(e){d.showLoading().then(function(){H.schedule.actualStartDateTime=new Date,H.schedule.actualFinishDateTime=null,H.scheduleTimeSpan.onStartDateTimeChaged(),s.updateJobStatus({scheduleButton:ee.CheckIn,scheduleNum:H.schedule.num,actualStartTime:d.toStringDate(H.schedule.actualStartDateTime),barcode:H.barcode,timerStartAt:d.toStringDate(new Date),clientTime:kendo.toString(new Date,"g")}).then(function(){H.schedule.checkInStatus=!0,n.$broadcast("$workOrder.refreshTimecardUI")}).finally(function(){d.hideLoading(),H.user.timeCard&&e&&j(!1)})})}function N(){H.productSearchModal?H.productSearchModal.show():d.getModal("productSearchModal.html",e).then(function(e){H.productSearchModal=e,H.productSearchModal.show()}),a(function(){e.$broadcast("$fpm:changeAddModalOpenPriority",!0)},1e3)}function A(){H.productModal?H.productModal.show():d.getModal("editProductModal.html",e).then(function(e){H.productModal=e,H.productModal.show()})}function F(){var e="",t=H.barCodeData.barcodeDetails;if(t.shipStreet&&(e+=t.shipStreet.replace("::"," "),e+="%20"+t.shipCity+",%20"+t.shipState+"%20"+t.shipZIP),re){var n="https://maps.google.com?saddr=";n+=re.coords.latitude+","+re.coords.longitude+"&daddr=",n+=e,cordova.InAppBrowser.open(n,"_system","location=yes").then(function(){},function(e){})}else n="https://maps.google.com?daddr="+e,cordova.InAppBrowser.open(n,"_system","location=yes")}function L(e){var t=new Date;e?(H.schedule.actualFinishDateTime=new Date,H.scheduleTimeSpan.onEndDateTimeChanged()):t=H.schedule.actualFinishDateTime,d.showLoading().then(function(){s.updateJobStatus({scheduleButton:ee.CheckOut,scheduleNum:H.schedule.num,actualEndTime:d.toStringDate(H.schedule.actualFinishDateTime),barcode:H.barcode,clientTime:d.toStringDate(t)}).then(function(){H.schedule.checkOutStatus=!0,n.$broadcast("$workOrder.refreshTimecardUI"),!z&&!H.isTrafficControllerCustomer||null!==H.schedule.workComplete&&H.schedule.workComplete||(H.schedule.workComplete=!0)}).finally(function(){d.hideLoading()})})}function x(e){d.showLoading().then(function(){p.checkoutPending(e).then(function(t){t&&t.success?e.scheduleId?s.updateJobStatus({scheduleButton:ee.CheckOut,scheduleNum:e.scheduleId,actualEndTime:d.toStringDate(new Date),barcode:H.barcode,clientTime:kendo.toString(new Date,"g")}).then(function(){K.alert("Success!","Pending task checked out successfully.",function(){O(!0)})}).finally(function(){d.hideLoading()}):K.alert("Success!","Pending task checked out successfully.",function(){O(!0),d.hideLoading()}):K.alert("Invalid Time","Go to Timecard and checkout manually.")},function(){d.hideLoading()}).finally(function(){})})}function U(){if(H.schedule.approve||H.schedule.checkOutStatus)K.alert("Alert","Not allowed to checkout");else if(D(null,null,!1)){if(null===H.schedule.actualStartDateTime||!H.schedule.checkInStatus)return K.alert("Warning","Please check in first"),!1;L(!0)}}function B(){if(!H.schedule.approve&&!H.schedule.checkInStatus){if(D(null,null,!0)){var e=(H.schedule.technicianNum,H.user.userEmail,!z&&!H.isTrafficControllerCustomer);if(H.user.timeCard&&(e||z||H.isTrafficControllerCustomer)){var n=_.where(se.currentDetails,{jobCode:te.CLOCK_IN,finishTime:null}),o=_.reject(se.currentDetails,{jobCode:te.CLOCK_IN}),a=new Date,i=d.toStringDate(new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0));if(0===n.length){var r=kendo.parseDate(H.schedule.scheduledStartDateTime);p.checkPreviousDateClockIn({timecardDate:z||H.isTrafficControllerCustomer?r:i,userEmail:H.schedule.technicianNum,previousDayCheck:!0}).then(function(e){e&&e.previousDayCheck&&null===e.lastClockOut&&e.hasPendingClockIn?K.confirm("Confirmation!","You have not clocked out for yesterday. \n\n Are you sure?",function(){O(!0)},function(){}):K.confirm("Confirmation!","You have not clocked in yet. You will be clocked in automattically \n\n Are you sure?",function(){O(!0)},function(){})})}else if(o.length>0){var u=_.where(o,{finishTime:null,jobCodeName:"On Job"});if(u.length>0){var l=[{text:"Check-out the pending task"},{text:"Open pending schedule"},{text:"Goto Timecard"}];c.show({buttons:l,titleText:"Pending Check-out Actions",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){var n=angular.copy(u[0]);return 0===e&&K.confirm("Confirmation!","Are you sure to check-out?",function(){x(n)}),1===e&&(n.scheduleId&&n.scheduleId>0?s.checkIfBarcodeClosed(n.barcode).then(function(e){null===e||e?K.alert("Alert","Work order has been closed. Please go to timecard and check-out manually."):t.go("app.editOrder",{barCode:n.barcode,technicianNum:n.scheduleId,src:"main",_i:1},{reload:!0})}):t.go("app.timecard",{refresh:!0})),2===e&&t.go("app.timecard",{refresh:!0}),!0}})}else O(!0)}else O(!0)}else O(!0)}return!1}K.alert("Alert","Not allowed to checkin")}function R(){d.showLoading().then(function(){s.updateScheduleBillableState(H.schedule.num,H.schedule.isBillable).then(function(e){if(H.schedule.isBillable&&e&&e.length>0){for(var t=angular.copy(H.barCodeData.invoice),n=0;n<e.length;n++)t.push(e[n]);H.barCodeData.invoice=t}else{var o=angular.copy(_.filter(H.barCodeData.invoice,function(e){return e.numFromSchedule!==H.schedule.num}));H.barCodeData.invoice=o}}).finally(function(){E(),d.hideLoading()})})}function q(e){e.num!==H.schedule.num&&K.confirm("Confirmation","Do you want to load this schedule?",function(){t.go("app.editOrder",{barCode:H.barcode,technicianNum:e.num,src:"main",_i:1})})}function j(e){if(H.user.timeCard){var t=z||H.isTrafficControllerCustomer?kendo.parseDate(H.schedule.scheduledStartDateTime):new Date,n="";(z||H.isTrafficControllerCustomer)&&H.schedule&&(n=H.schedule.technicianNum);var o=d.toStringDate(new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0));p.getTimeCardByDate(o,n).then(function(e){se.currentDetails=[],e&&(se.currentDetails=e.timeCardDetails)}).finally(function(){e&&O(!0)})}}function W(e){s.getBarcodeInvoiceAndProductDetails(H.barcode).then(function(e){H.barCodeData.products=e.products,H.barCodeData.invoice=e.invoice,E()}).finally(function(){e&&(d.hideLoading(),H.productModal.hide())})}function V(){H.multipleScheduleCheckInModal&&(H.multipleScheduleCheckInModal.hide(),H.multipleScheduleCheckInModal.remove(),H.multipleScheduleCheckInModal=null)}var H=this,G=void 0===r._i?0:r._i;H.barcode=r.barCode,H.taxCheckboxVisibility=!0,H.pendingPreviousDayClockout=!1;var K=d.alerts,J="",Y=[],X=!1,z=!1,Q=["97713","97719","99009","97678","97636"];H.onSummaryTabSelected=function(){return s.getBarcodeInvoiceAndScheduleDetails(H.barcode).then(function(e){e&&e.invoice&&(H.barCodeData.invoice=e.invoice,E())}),!0},H.isTrafficControllerCustomer=!1;var Z=["97713","97719","99009"];H.forIntegrityCustomer=!1;var ee={AcceptJob:0,InRoute:1,CheckIn:2,CheckOut:3},te=p.statics.jobCodes;H.invoiceOpen=!0,H.scheduleActionType=1,H.uiSettings={isTimeCardModuleEnabled:!1,milageTrackingEnabled:!1,orderBelongToCurrentUser:!1,timerEnabled:!1,woData:null,showEquipmentTabControl:!1,billingOption:0,isRouteTimeOptionChecked:!1,enableMarkup:!1,hideEmailButton:!1,customField2Label:"Custom 2",customField3Label:"Custom 3",expenseTrackingEnabled:!0,paymentOn:!1,allowServiceProviderMarkNonBillable:!1},H.multipleScheduleCheckInModal=null,H.numpad=null,H.numpadSettings={display:"bottom",min:0,scale:2,max:99999.99,preset:"decimal",onClose:function(e,t){H.barCodeData&&(H.barCodeData.taxRate&&H.barCodeData.taxRate.toString()!==e.toString()&&(H.barCodeData.taxRate=e,s.updateTaxRate(H.barcode,e).then(function(e){H.barCodeData.taxRate=H.barCodeData.taxRate.toFixed(2)})),E())}},H.errors=[],H.gettingBarcodeDetails=!0;var ne=null,oe=null,ae=null,ie=null;H.scheduleTimeSpan={timeSpan:"",inRouteTimeSpan:"",onInRouteTimespanChanged:C,onInRouteTImeChanged:v,onTimespanSeletionChanged:function(e,t){var n=t.getVal(),o=Math.floor(n/1e3),i=Math.floor(o/60);ie=a(function(){var e,t=angular.copy(H.schedule.actualStartDateTime);null==t?(e=new Date,H.schedule.actualStartDateTime=new Date):e=new Date(t);var n=y(e,i);H.schedule.actualFinishDateTime=kendo.parseDate(n),H.schedule.approve||S()},50)},onStartDateTimeChaged:function(){b(!0)},onEndDateTimeChanged:function(){b(!1)},clearAllDateTimeSelection:function(){}};var re=null;H.user=f.getLoggedInUserInfo(),H.dateTimeFormat=H.user.dateFormat,H.placeholder="tap here to select...";var ce=[{text:'<span class="text-assertive">Clear All</span>'},{text:'<span class="text-assertive">Clear Checkout Time</span>'},{text:"Update Schedule"}],ue=null;H.scheduleAddModal=null;H.map=null;var le=!1;H.popupDescriptionBoxType="",H.popModal={type:"DESCRIPTION",modal:null,placeholder:"enter here...",content:""},H.tabs={events:{updateClicked:function(){if("DESCRIPTION"===H.popModal.type){var e=H.uiSettings.woData.barcodeDetails.comment_1,t=H.popModal.content;if(!H.user.allowUserToEditWoDescription&&e!==t)return K.alert("Unauthorized","You are not authorized to change the description.",function(){a(function(){H.barCodeData.barcodeDetails.comment_1=e},400)}),!1;H.barCodeData.barcodeDetails.comment_1=angular.copy(H.popModal.content)}"RESOLUTION"===H.popModal.type&&(H.barCodeData.barcodeDetails.comment_2=angular.copy(H.popModal.content)),"COMMENTS"===H.popModal.type&&(H.barCodeData.barcodeDetails.comment_4=angular.copy(H.popModal.content)),"TRIP_NOTES"===H.popModal.type&&(H.schedule.tripNote=angular.copy(H.popModal.content),M(!1,!1)),I("DESCRIPTION"===H.popModal.type?"desc":null),H.popModal.modal.hide()},closePopoutModal:function(){H.popModal.modal.hide()},popoutTextBox:function(t){switch(H.popupDescriptionBoxType=t,t){case"DESCRIPTION":H.popModal.content=angular.copy(H.barCodeData.barcodeDetails.comment_1);break;case"RESOLUTION":H.popModal.content=angular.copy(H.barCodeData.barcodeDetails.comment_2);break;case"COMMENTS":H.popModal.content=angular.copy(H.barCodeData.barcodeDetails.comment_4);break;case"TRIP_NOTES":H.popModal.content=angular.copy(H.schedule.tripNote)}H.popModal.type=t,H.popModal.modal?H.popModal.modal.show():d.getModal("fulltextModal.html",e).then(function(e){H.popModal.modal=e,H.popModal.modal.show()})}},desc:{events:{reloadWorkResolution:function(){D()&&d.showLoading().then(function(){var e=H.barCodeData.barcodeDetails.id;s.getWorkOrderResolution(e).then(function(e){e&&(H.barCodeData.barcodeDetails.comment_2=e.comment_2,H.barCodeData.barcodeDetails.comment_4=e.comment_4)}).finally(d.hideLoading)})},refreshOnPullDown:function(){h(),j(!1)},closeWorkOrderMapModal:function(){le=!1,ue&&ue.hide()},onAddressTapped:function(){F()},onDescriptionOrResolutionChanged:function(e){if(e&&"desc"===e){var t=H.uiSettings.woData.barcodeDetails.comment_1,n=H.barCodeData.barcodeDetails.comment_1;if(!H.user.allowUserToEditWoDescription&&t!==n)return!1}I(e)}}},sch:{events:{onLabourCostChanged:function(){H.schedule.approve?(K.alert("Warning","This schedule has been approved and cannot be edited."),a(function(){H.schedule.laborCostPerHour=ne.laborCostPerHour},10)):a(function(){ne.laborCostPerHour=angular.copy(H.schedule.laborCostPerHour),M(!0,!0)},100)},onBillableChanged:function(){D(H.schedule,P,!1)&&a(function(){H.schedule&&!H.schedule.isBillable?K.confirm("Confirmation","Exclude this schedule from invoice?",function(){R()},function(){a(function(){H.schedule.isBillable=!0},100)}):R()},100)},workCompleteChanged:function(){D(H.schedule,P,!1)&&M(!0,!0,function(){a(function(){t.go("app.dashboard",{refresh:!0})},200)})},onCustomScheduleChanged:function(e){H.schedule.approve||s.updateCustomScheduleData(e)},pushToTimecard:function(){T()},onAddScheduleCompleted:function(e){e&&H.scheduleAddModal.hide().then(function(){K.alert("Success","Schedule added successfully",function(){H.barCodeData.schedules=e.schedules,H.barCodeData.invoice=e.invoice,E()})})},onModalCancelClicked:function(){H.scheduleAddModal.hide()},updateMilage:function(){H.schedule.startMiles&&H.schedule.endMiles&&(H.schedule.totalMiles=parseFloat(parseFloat(H.schedule.endMiles)-parseFloat(H.schedule.startMiles)).toFixed(2)),M(!1,!1)},onTripnoteChanged:function(){M(!1,!1)},updateSchedule:function(){M(!0,!0)},onListScheduleItemTap:function(e){!H.isServiceProvider||H.forIntegrityCustomer||H.isTrafficControllerCustomer?q(e):(H.user.havingGroupsAssigned||e.technicianNum===H.user.userEmail)&&q(e)},onSchedulesListButtonClicked:function(){null===H.scheduleAddModal?d.getModal("addScheduleModal.html",e).then(function(e){H.scheduleAddModal=e,H.scheduleAddModal.show()}):H.scheduleAddModal.show()},checkIn:function(){z||H.isTrafficControllerCustomer?s.getSchedulesWithSameDateTime(H.barcode,H.schedule.num,1).then(function(t){null===t||t.length<=1?B():(H.scheduleActionType=1,null===H.multipleScheduleCheckInModal?d.getModal("checkInMultipleSchedulesModal.html",e).then(function(e){H.multipleScheduleCheckInModal=e,H.multipleScheduleCheckInModal.show()}):H.multipleScheduleCheckInModal.show())}):B()},checkOut:function(){z||H.isTrafficControllerCustomer?(H.scheduleActionType=2,s.getSchedulesWithSameDateTime(H.barcode,H.schedule.num,H.scheduleActionType).then(function(t){null===t||t.length<=1?U():null===H.multipleScheduleCheckInModal?d.getModal("checkInMultipleSchedulesModal.html",e).then(function(e){H.multipleScheduleCheckInModal=e,H.multipleScheduleCheckInModal.show()}):H.multipleScheduleCheckInModal.show()})):U()},clearAllDateTimeSelection:function(e){w(e)},onScheduleActionButtonClicked:function(){var e=angular.copy(ce);c.show({buttons:e,titleText:"Current Schedule",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&w(!0),1===e&&w(!1),2===e&&M(!0,!0),3===e&&T(),!0}})}}},smry:{events:{onEditTaxRateClicked:function(){a(function(){H.numpad.show()},50)},onTaxCheckboaxChanged:function(e){D(e,$)&&a(function(){E(),s.updateOrderProduct(e)},200)}}},prod:{events:{onProdcutActionButtonClicked:function(){N()},closeProductEditModal:function(){H.productModal.hide()},openProductSearchModal:function(){},onEditProductClicked:function(e){H.currentProduct=angular.copy(e),A()},onDeleteProductClicked:function(e){K.confirmDelete(function(){s.deleteProduct(H.barcode,e.num,e.qty).then(function(e){e&&(H.barCodeData.products=e.products,H.barCodeData.invoice=e.invoice,E())})})}}}};var se={currentDetails:[]};H.onBarcodeScanned=function(e){s.addProductFromBarcodeScanner(e,H.barcode).then(function(e){e?W(!0):K.alert("Not Found","No product found with this code..",null)})},e.$on("$timecard.onclocked-out-fromComponent",function(e,t){j(!1)}),e.$on("$timecard.onClockedInCompleted",function(e,t){j(!1)}),e.$on("$timecard.onclocked-out-fromHeader",function(e,t){j(!1)}),e.$on("$fpm:closeEditProductModal",function(){H.productModal&&H.productModal.hide()}),e.$on("$fpm:closeProductSearchModal",function(e,t){H.productSearchModal&&(t&&!0===t.fromProductAdd&&W(!1),H.productSearchModal.hide())});var de=null;e.$on("$wo.multipleScheduleModalCancel",function(e,t){V()}),e.$on("$fpm:operation:updateProduct",function(e,t){de=a(function(){d.showLoading().then(function(){W(!0)})},300)}),e.$on("$wo.multipleScheduleModalCancel.reloadAll",function(e,t){t.closeModal&&V(),h()}),e.$on("$destroy",function(){de&&a.cancel(de),oe&&a.cancel(oe),ie&&a.cancel(ie),ae&&a.cancel(ae),le=!1}),H.selectedIndex=0,h(),function(){H.currencySymbol=n.currencySymbol,H.isTrafficControllerCustomer=H.user.isTrafficControllerCustomer||!1,J=H.user.customerNumber,X=Y.indexOf(J)>-1,z=Q.indexOf(J)>-1,H.forIntegrityCustomer=z,H.forIntegrityCustomerOld=Z.indexOf(J)>-1,n.isInDevMode||k(),le=!1,H.uiSettings.isTimeCardModuleEnabled=H.user.timeCard&&H.user.allowPushTime,H.isServiceProvider=!H.user.isAdminstrator,H.showPrice=H.user.showPrice,m.getIniitialData(!0).then(function(e){if(e){if(H.uiSettings.milageTrackingEnabled=e.customerNumberEntity.milageTrackingEnabled||!1,H.uiSettings.timerEnabled=e.customerNumberEntity.workOrderTimerEnabled||!1,H.uiSettings.showEquipmentTabControl=e.customerNumberEntity.equipmentTrackingOn||!1,H.uiSettings.enableMarkup=e.customerNumberEntity.enableMarkupForWorkOrders||!1,H.uiSettings.paymentOn=e.customerNumberEntity.paymentOn||!1,H.enableMarkup=H.uiSettings.enableMarkup,e.customerNumberEntity.billingOption&&(H.uiSettings.billingOption=e.customerNumberEntity.billingOption),H.poHeading="PO Number",0===H.uiSettings.billingOption&&(H.uiSettings.isRouteTimeOptionChecked=e.customerNumberEntity.isRouteTimeOptionChecked),H.uiSettings.expenseTrackingEnabled=e.customerNumberEntity.expenseTrackingEnabled,e.customerNumberEntity.configurationJson){var t=JSON.parse(e.customerNumberEntity.configurationJson);H.uiSettings.allowServiceProviderMarkNonBillable=!0,H.isServiceProvider&&(H.uiSettings.allowServiceProviderMarkNonBillable=t.AllowServiceProviderMarkNonBillable||!1,H.user.showPrice||(H.uiSettings.allowServiceProviderMarkNonBillable=!1)),H.uiSettings.hideEmailButton=t.HideEmailButtonOnMobile||!1,t&&t.PoBoxLabel?H.poHeading=t.PoBoxLabel:"QBO"===e.customerNumberEntity.intuitServiceType?H.poHeading="Custom 1":H.poHeading="PO Number",t.CustomField2Label&&""!==t.CustomField2Label&&(H.uiSettings.customField2Label=t.CustomField2Label),t.CustomField3Label&&""!==t.CustomField3Label&&(H.uiSettings.customField3Label=t.CustomField3Label)}H.scheduleStatus=e.secondaryOrderStatus,H.serviceProviders=e.serviceProviders,H.vehicles=e.vehicles}}).finally(function(){z||H.isTrafficControllerCustomer||j()})}();var me=a(function(){var e=l.$getByHandle("tabs");G>0&&e.select(Number(G)),a.cancel(me)},500)}e.$inject=["$scope","$state","$rootScope","$q","$timeout","$window","$stateParams","$ionicActionSheet","$ionicLoading","$ionicTabsDelegate","work-orders-factory","fpm-utilities-factory","shared-data-factory","authenticationFactory","timecard-factory"],angular.module("fpm").controller("edit-order-controller",e)}()}(),function(){"use strict";!function(){var e={templateUrl:"js/work-orders/order-documents-list-component.template.html",bindings:{barcode:"<"},controller:["$scope","work-orders-factory","fpm-utilities-factory","fieldPromaxConfig",function(e,t,n,o){function a(){i.gettinDocuments=!0,i.barcodeDocuments=[],t.getUploadedDocuments(i.barcode).then(function(e){if(angular.isArray(e)&&e.length>0){var t=_.where(e,{extension:".pdf"});i.barcodeDocuments=t}i.gettinDocuments=!1})}var i=this,r=o.fieldPromaxApi,c=n.alerts;i.docUrl="",i.gettinDocuments=!1;var u=[".pdf",".xls",".xlsx",".txt",".doc",".docx",".ppt",".pptx",".zip"],l=null;i.upload={control:null,options:{multiple:!0,showFileList:!1,localization:{select:"Upload documents"},select:function(e){if(e.isDefaultPrevented=!0,_.filter(e.files,function(e){return e.size>20971520}).length>0)return c.alert("Invalid Selection","Document size is too large to upload"),e.preventDefault(),!1;if(l=e.files,_.filter(e.files,function(e){return _.contains(u,e.extension.toLowerCase())}).length!==e.files.length)return c.alert("Invalid Selection","Invalid File Type(s) Found. Make sure only document files are selected."),e.preventDefault(),!1;n.showLoading("Uploading");var o={barcode:i.barcode,estimateId:0,rotate:!1,isFromDocumentUpload:!0};t.uploadFiles(e.files,o).then(function(e){e&&angular.isArray(e)&&e.length>0&&(a(),c.alert("Uploaded","Document(s) uploaded successfully."))}).finally(function(){n.hideLoading()}),e.preventDefault()}}},i.events={onDeleteDocumentClicked:function(e,o,i){e.stopPropagation(),c.confirmDelete(function(){n.showLoading().then(function(){t.deleteDocument(o.num).then(function(e){a(),c.alert("Deleted","Document deleted successfully.")}).finally(function(){n.hideLoading()})})})},onDocumentClicked:function(e){cordova.InAppBrowser.open(r+"Handlers/GetImageFromBlob.ashx?imageId="+e.num+"&dateStamp="+new Date+"&flag=viewTarget&cust="+e.customerNumber,"_system","location=yes")}},i.$onInit=function(){i.barcode?a():i.gettinDocuments=!1}}],controllerAs:"vm"};angular.module("fpm").component("orderDocumentsListComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",isEstimate:"<",showDeleteImageOnModal:"<",allowSelection:"<"},templateUrl:"js/work-orders/order-images-list-component.template.html",controller:["$scope","$stateParams","$q","$timeout","$ionicModal","work-orders-factory","fpm-utilities-factory","estimates-factory","fieldPromaxConfig","shared-data-factory",function(e,t,n,o,a,i,r,c,u,l){function s(){var t=_.where(m.barcodeImages,{isChecked:!0});m.selectedImagesCount=t.length;var n=_.pluck(t,"num");e.$emit("fpm:imageSelectionChanged",n)}function d(){m.barcode&&!m.isEstimate?i.getImagesList(m.barcode).then(function(e){m.barcodeImages=e}):c.getEstimateImages(C).then(function(e){m.barcodeImages=e})}var m=this;m.isExpanded=!1;var f=u.fieldPromaxApi,p=r.alerts;m.showDeleteImageOnModal=!1;var h=(r.device.isIOS(),null);m.upload={control:null,uploadImages:function(e,t){var n={barcode:m.barcode,estimateId:C,rotate:!1};e&&e.length>0&&(r.showLoading("Uploading"),i.uploadFiles(e,n).then(function(e){e&&(d(),p.alert("Uploaded","File(s) Uploaded successfully"))},function(){p.alert("Error","Not a valid image file.")}).finally(function(){r.hideLoading()}))},uploadImage:function(e,t,a,c){var u=n.defer();return model={barcode:m.barcode,image:e,name:t,estimateId:C,rotate:!1},r.showLoading("Uploading 1 of "+(a?1:h.length)).then(function(){i.uploadFile(model).then(function(e){e&&e.entity&&(t=e.entity.name,o(function(){m.barcodeImages.push({barcode:m.barcode,fileName:t,estimateId:C,isChecked:!1,imageURL:"/"+t+(a?".jpg":""),num:e.entity.newIdentity}),m.selectedImagesCount=0},20)),u.resolve(),c&&p.alert("Uploaded","File(s) Uploaded successfully")},function(e){p.alert("ERROR WHILE UPLOADING","Please try again"),u.reject()}).finally(r.hideLoading)}),u.promise},options:{multiple:!0,showFileList:!1,localization:{select:"Upload images"},select:function(e){if(e.isDefaultPrevented=!0,_.filter(e.files,function(e){return e.size>g}).length>0)return p.alert("Invalid Selection","Image size is too large to upload"),e.preventDefault(),!1;h=e.files,m.upload.uploadImages(e.files,!1),e.preventDefault()}}},m.selectedImagesCount=0,m.currentImage=null,m.events={onImageTapped:function(e,t){e.target&&e.target.toString().toLowerCase().indexOf("button")<=-1&&m.allowSelection&&(void 0===t.isChecked?t.isChecked=!0:t.isChecked=!t.isChecked,s()),e.stopPropagation()},takePictureClicked:function(){r.device.getPicture().then(function(e){o(function(){if(e){var t="Picture"+m.barcode+kendo.toString(new Date,"ddffMMss")+".jpeg";l.convertToBlob("data:image/jpeg;base64,"+e,t).then(function(e){e&&m.upload.uploadImages([{rawFile:e}],!0)},function(){})}},500)})},onDeleteImageClicked:function(e,t,n){e.stopPropagation(),p.confirmDelete(function(){r.showLoading().then(function(){i.deleteImageFromBlob(t.num,m.barcode).then(function(){p.alert("Success","Image has been removed",function(){m.barcodeImages.splice(n,1)})}).finally(r.hideLoading)})})},zoomImage:function(e,t){e.stopPropagation(),m.currentImage=t,m.imageUrl=f+"Handlers/GetImageFromBlob.ashx?imageId="+t.num+"&dateStamp="+new Date,m.imageViewerModel.show()},closeImageViewModal:function(){m.imageViewerModel.hide()}};var g=8388608,y=!1,C=0;m.$onInit=function(){y=r.device.isAndroid(),y&&(g=5242880),m.isEstimate&&(C=t.id),d()},a.fromTemplateUrl("imageViewerModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){m.imageViewerModel=e})}],controllerAs:"vm"};angular.module("fpm").component("orderImagesListComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",totalAmountDue:"="},templateUrl:"js/work-orders/order-payment-component.template.html",controller:["$scope","$state","$stateParams","authenticationFactory","work-orders-factory","fieldPromaxConfig","fpm-utilities-factory","$timeout",function(e,t,n,o,a,i,r,c){function u(){var e=0,t=d.totalAmountDue.toFixed(2);angular.forEach(d.payments,function(t,n){e+=parseFloat(t.amountReceived)}),d.amountReceived=e,d.balanceDue=t-e}function l(){a.getBarcodePayments(d.barcode).then(function(e){null!=e?(d.showList=!0,d.payments=angular.copy(e)):d.showList=!1,u()})}function s(){d.modalType=1,d.currentPayment=angular.copy(f),d.paymentModal?d.paymentModal.show():d.balanceDue>0?r.getModal("addEditPaymentModal.html",e).then(function(e){d.addEditPaymentModal=e,d.addEditPaymentModal.show()}):m.alert("Alert","There is no amount to charge against this work order.",function(){return!1})}var d=this;i.fieldPromaxApi,o.getLoggedInUserInfo();d.showList=!1,d.paymentModal=null;var m=r.alerts,f={paymentMode:"",receivedDate:new Date,barCode:d.barcode,paymentMemo:"",amountReceived:0,serviceProviderEmail:""};e.$on("$fpm:closeAddEditPaymentModal",function(){d.addEditPaymentModal&&d.addEditPaymentModal.hide()}),e.$watch("vm.totalAmountDue",function(e,t){u()}),e.$on("$fpm:addUpdatePaymentCompleted",function(e,t){d.payments=angular.copy(t.o.payments),void 0==t.o.payment.num?m.alert("Success","Payment added successfully",function(){c(function(){d.showList=!0,u()},50)}):m.alert("Success","Payment updated successfully",function(){c(function(){d.showList=!0,u()},50)}),d.addEditPaymentModal.hide()}),d.events={collectPaymentClicked:function(){d.balanceDue>0?t.go("app.checkout",{amount:d.balanceDue,barcode:d.barcode,technicianNum:n.technicianNum}):m.alert("Alert","There is no amount to charge against this work order.",function(){return!1})},addEditPayment:function(){s()},onEditPaymentClicked:function(t){d.modalType=0,d.currentPayment=angular.copy(t),d.currentPayment.receivedDate=kendo.parseDate(t.receivedDate),d.paymentModal?d.paymentModal.show():r.getModal("addEditPaymentModal.html",e).then(function(e){d.addEditPaymentModal=e,d.addEditPaymentModal.show()})},onDeletePaymentClicked:function(e){m.confirmDelete(function(){a.deletePayment(e.num).then(function(e){e&&(d.payments=e),u()})})}},d.$onInit=function(){l()}}],controllerAs:"vm"};angular.module("fpm").component("orderPaymentComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",isEstimate:"<"},templateUrl:"js/work-orders/order-signature-card-component.template.html",controller:["$scope","$stateParams","$timeout","authenticationFactory","fieldPromaxConfig",function(e,t,n,o,a){function i(){r.imageUrl=u+"Handlers/GetBarcodeSignature.ashx?barcode="+r.barcode+"&dateStamp="+new Date+"&customernumber="+l.customerNumber+"&estimate="+r.isEstimate+"&estimateId="+c}var r=this,c=0;r.showingSignaturePad=!1,r.nextWorkdayAppointmentConfirmed=!1;var u=a.fieldPromaxApi,l=o.getLoggedInUserInfo();r.signPadEvents=null,r.showEmptySignatureMessage=!1,r.events={closeSignaturePad:function(){r.showingSignaturePad=!1,n(function(){i()},100)},saveSignature:function(){r.signPadEvents&&r.signPadEvents.trySaveSignature().then(function(e){!0===e&&(r.showingSignaturePad=!1,i())})},onSignatureActionButtonClicked:function(){r.showingSignaturePad=!0,i()}},e.$on("fpm:showEmptyImageMessage",function(e,t){r.showEmptySignatureMessage=t}),e.$on("$signature:completedEvent",function(){r.showingSignaturePad=!1}),r.imageUrl=u+"Handlers/GetBarcodeSignature.ashx?barcode",r.$onInit=function(){r.showNextWorkdayApppointmentCheckbox=l&&"193514633790019"===l.customerNumber,console.log(r.showNextWorkdayApppointmentCheckbox),r.isEstimate&&(c=t.id),r.imageUrl=u+"Handlers/GetBarcodeSignature.ashx?barcode="+r.barcode+"&dateStamp="+new Date+"&customernumber="+l.customerNumber+"&estimate="+r.isEstimate+"&estimateId="+c}}],controllerAs:"vm"};angular.module("fpm").component("orderSignatureComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{padEventsRef:"=",isEstimate:"<",nextWorkdayAppointment:"<"},templateUrl:"js/work-orders/order-signature-pad-template.html",controller:["$scope","$stateParams","$q","work-orders-factory","fpm-utilities-factory",function(e,t,n,o,a){var i=this;i.customerName="";var r=t.barCode;i.errors=["Please add customer name before save"],i.showError=!1;var c=0;i.events={onCustomerNameKeyup:function(e){13===e&&(i.showError=!1,i.events.trySaveSignature())},trySaveSignature:function(){var t=n.defer();i.showError=!1;var u=i.isEstimate;if(""===$.trim(i.customerName))i.showError=!0,t.resolve(!1);else{var l=$(angular.element("#signature")).jSignature("getData","image");""!==$.trim(i.customerName)&&angular.isArray(l)&&a.showLoading().then(function(){o.saveJsonSignForBarcode({nextWorkdayAppointmentConfirmed:i.nextWorkdayAppointment,BaseString:l[1],Barcode:u?"":r,CustomerName:i.customerName,EstimateId:c}).then(function(){e.$emit("$signature:completedEvent"),t.resolve(!0)}).finally(a.hideLoading)})}return t.promise}},i.$onInit=function(){var e=angular.element("#signature");$(e).jSignature({lineWidth:1,width:$(document).width()-80,height:200,"decor-color":"transparent"}).bind("change",function(t){var n=$(e).jSignature("getData","image");angular.isArray(n)}),i.isEstimate&&(c=t.id),i.padEventsRef=i.events}}],controllerAs:"vm"};angular.module("fpm").component("orderSignaturePad",e)}()}(),function(){"use strict";!function(){var e={bindings:{isEstimate:"<",onSendEmailClicked:"&",showPrice:"<",hideEmailButton:"<",barcode:"<",taxrate:"<",defaultEmails:"<",isBusy:"<"},templateUrl:"js/work-orders/work-order-email-card-template.html",controller:["$q","work-orders-factory","fpm-utilities-factory",function(e,t,n){function o(e){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(e)}function a(){var t=e.defer(),n=!1,a=r.mailConfig.mailAddresses;if(a.length>0)for(var i=0;i<=a.length-1;i++){n=!1;var c=$.trim(a[i]);o(c)||(n=!0),i===a.length-1&&t.resolve(n)}else t.resolve(!0);return t.promise}function i(e){r.emailErrors=[],r.sendingEmails=!1,r.mailConfig.mailAddresses&&r.mailConfig.mailAddresses.length>0&&a().then(function(o){o?r.emailErrors=["Please enter valid emails"]:(r.sendingEmails=!0,r.isEstimate?angular.isFunction(r.onSendEmailClicked)&&r.onSendEmailClicked({mails:r.mailConfig.mailAddresses}):t.sendInvoiceMail({BarCode:r.barcode,SendAsInvoice:e,
emailAddresses:r.mailConfig.mailAddresses,TaxRate:r.taxrate}).then(function(){n.alerts.alert("Email Sent","Email has been sent successfully",function(){r.sendingEmails=!1})}))})}var r=this;r.emailErrors=[],r.sendingEmails=!1,r.mailConfig={mailAddresses:[]},r.events={sendEmail:i},r.$onInit=function(){if(null!=r.defaultEmails&&r.defaultEmails.includes(",")){var e=[],t=r.defaultEmails.split(",");angular.forEach(t,function(t){e.push(t)}),r.mailConfig.mailAddresses=e}null==r.defaultEmails||r.defaultEmails.includes(",")||(r.mailConfig.mailAddresses=[r.defaultEmails])}}],controllerAs:"vm"};angular.module("fpm").component("orderEmailCardComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{isCheckedIn:"<",isCheckedOut:"<",isApproved:"<",schedule:"<"},controller:["$interval","$state","$element","$timeout","shared-data-factory",function(e,t,n,o,a){function i(){var e=Math.floor(l.currentTime.totalMinutes/60),t=Math.floor(l.currentTime.totalMinutes%60);l.currentTime.mins=t<=9?"0"+t:t,l.currentTime.hrs=e<=9?"0"+e:e,l.currentTime.isOnInterval=0===e&&t>=55||e>0&&(t>55||t<=5)}function r(){!1===l.currentTime.showControl&&(l.currentTime.showControl=!0),l.currentTime.isRunning=!0,s=e(function(){l.currentTime.totalMinutes+=1,i()},6e4)}function c(){null!==s&&(l.currentTime.isRunning=!1,e.cancel(s));var t=o(function(){l.currentTime.showControl=!1,o.cancel(t)},100)}function u(){i()}var l=this;l.currentTime={hrs:"00",mins:"00",totalMinutes:0,showControl:!1,isRunning:!1,isOnInterval:!1,intervalMinutes:0,intervalCounter:0};var s=null;this.$onDestroy=function(){c()};var d=!1;this.$onChanges=function(){!0===d&&(!0===l.isCheckedIn&&!1===l.currentTime.isRunning&&r(),!0===l.isCheckedOut&&c())},l.events={refreshTimer:u},this.$onInit=function(){l.currentTime.showControl=!1,a.getIniitialData().then(function(e){!0===(d=e.customerNumberEntity.workOrderTimerEnabled||!1)&&o(function(){if(l.schedule&&(l.currentTime.showControl=!0===l.schedule.checkInStatus&&!1===l.schedule.checkOutStatus,!0===l.schedule.checkInStatus&&l.schedule.timerStartAt&&!1===(l.schedule.checkOutStatus||!1))){var e=moment(new Date).diff(moment(l.schedule.timerStartAt),"minutes");e>0&&(l.currentTime.totalMinutes=e,i())}},1e3)})}}],templateUrl:"js/work-orders/work-order-timer-component.template.html",controllerAs:"model"};angular.module("fpm").component("workOrderTimerComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function a(e){var n=t.currentLocation,o=void 0!==n?n.coords:{};return o&&void 0!==o.latitude&&(e.longitude=o.longitude,e.latitude=o.latitude),e}function i(){Y.remove(X),Y.removeAll()}function r(t,n){angular.isDefined(t)&&t&&Y.remove(X);var a=Y.get(X);return angular.isDefined(a)&&a?e.when(a):o.get(J+"GetMobileDashboard").then(function(e){return Y.put(X,e),e})}function c(e){return o.get(J+"GetBarcodeDetails?barcode="+e)}function u(e,t){return o.get(J+"DeleteProduct?barcode="+e+"&productNum="+t)}function l(e){return o.post(J+"UpdateProduct?fromMobile=true",e)}function s(e,t){return o.get(J+"GetProductsLists?searchPattern="+e+"&alphabet="+t+"&fromMobile=true")}function d(e){return o.post(J+"AddProductsToOrder?fromMobile=true",e)}function m(e){return o.get(J+"GetBarcodeInvoiceAndProductDetails?barcode="+e)}function f(e){return e=a(e),o.post(J+"SaveJsonSignForBarcode",e)}function p(e){return o.post(J+"SendInvoiceMail",e)}function h(e){return o.get(J+"GetImagesList?barcode="+e)}function g(e){return o.get(J+"GetUploadedDocuments?barcode="+e)}function y(e){return o.post(J+"UploadFile",e)}function C(){var t=Y.get("workOrderEntity");return angular.isDefined(t)&&t?e.when(t):o.get(J+"CreateEntity").then(function(e){return Y.put("workOrderEntity",e),e})}function v(e){return o.post(J+"CreateWorkOrder",e)}function b(){return o.get(J+"GetBarCodeNumber")}function D(e){return e=a(e),o.post(J+"UpdateWorkOrderMobile",e)}function w(e){return void 0!==e.clientTime&&null!==e.clientTime||(e.clientTime=kendo.toString(new Date,"g")),e=a(e),o.post(J+"UpdateJobStatus",e)}function S(e){return e=a(e),e.customSchedules&&(e.customSchedules=JSON.stringify(e.customSchedules)),o.post(J+"UpdateSchedule?fromMobile=true",e)}function T(e){return o.post(J+"UpdateSchedule?fromMobile=true",e)}function k(e){return o.post(J+"AddWorkOrderSchedule",e)}function E(e){return o.post(J+"UpdateOrderProduct",e)}function I(t){!0===(t=null!==t&&t)&&Y.remove(z);var n=Y.get(z);return angular.isDefined(n)&&n?e.when(n):o.get("api/Scheduler/GetMyCalender?fromMobile=true").then(function(e){return Y.put(z,e),e})}function M(e){return o.post(J+"UpdateCustomScheduleData",e)}function P(e){return o.get(J+"GetWorkOrderResolution?id="+e)}function $(e){return e=a(e),o.post(J+"UpdateSchduleTotalTime",e)}function O(e,t){return o.deleteReq(J+"DeleteImage?imageId="+e+"&barcode="+t)}function N(e){return o.post(J+"UploadFilesN",e)}function A(e,t){return o.get(J+"AddProductFromBarcodeScanner?skuCode="+e+"&barcode="+t)}function F(e,t){return o.upload(J+"TryUpload",e,t)}function L(e){return o.get(J+"CheckIfBarcodeClosed?barcode="+e)}function x(e){return o.get(J+"GetWorkOrderPayments?barcode="+e)}function U(e){return o.post(J+"AddUpdatePayment",e)}function B(e){return o.get(J+"DeletePayment?num="+e)}function R(e,t){return o.get(J+"UpdateTaxRate?barcode="+e+"&taxRate="+t)}function q(e){return o.post("api/Checkout/SubmitPayment",e)}function j(e){return o.deleteReq(J+"DeleteSchedule?num="+e+"&fromMobile=true")}function _(e){return o.get(J+"GetScheduleById?scheduleId="+e+"&fromMobile=true")}function W(e,t,n){return o.get(J+"GetSchedulesWithSameDateTime?barcode="+encodeURIComponent(e)+"&currentSchedule="+encodeURIComponent(t)+"&checkForStatus="+encodeURIComponent(n))}function V(e){return void 0!==e.clientTime&&null!==e.clientTime||(e.clientTime=kendo.toString(new Date,"g")),e=a(e),o.post(J+"UpdateJobStatusMultipleSchedulesAsync",e)}function H(e,t){return o.get(J+"UpdateScheduleBillableState?scheduleNum="+e+"&isBillable="+t)}function G(e){return o.deleteReq(J+"DeleteDocument?num="+e+"&fromMobile=true")}function K(e){return o.get(J+"GetBarcodeInvoiceAndScheduleDetails?barcode="+e+"&loadSchedules=false")}var J="api/workorders/",Y=n("orderCache"),X="dashboardData",z="workorder:calendar";return{deleteDocument:G,updateScheduleBillableState:H,updateJobStatusMultiple:V,getSchedulesWithSameDateTime:W,getScheduleById:_,submitPayment:q,checkIfBarcodeClosed:L,uploadFiles:F,addProductFromBarcodeScanner:A,uploadFilesN:N,deleteImageFromBlob:O,updateSchduleTotalTime:$,getWorkOrderResolution:P,updateCustomScheduleData:M,getMobileDashboard:r,getBarcodeDetails:c,deleteProduct:u,updateProduct:l,searchProduct:s,addProduct:d,getBarcodeInvoiceAndProductDetails:m,saveJsonSignForBarcode:f,sendInvoiceMail:p,getImagesList:h,getUploadedDocuments:g,uploadFile:y,createEntity:C,createWorkOrder:v,getBarCodeNumber:b,updateWorkOrderMobile:D,updateJobStatus:w,updateSchedule:S,updateSchedule2:T,addWorkOrderSchedule:k,updateOrderProduct:E,getDatewiseEvents:I,clearAllCache:i,getBarcodePayments:x,addUpdatePayment:U,deletePayment:B,updateTaxRate:R,deleteSchedule:j,getBarcodeInvoiceAndScheduleDetails:K}}e.$inject=["$q","$rootScope","$cacheFactory","api-base-factory"],angular.module("fpm").factory("work-orders-factory",e)}()}(),function(){"use strict";!function(){angular.module("fpm").filter("timeSpan",function(){return function(e,t){if(Date.parse(e)&&Date.parse(t)){var n=moment(t).diff(kendo.parseDate(e),"minutes"),o=Math.floor(n/60),a=n%60;return o>0?o+" hrs "+a+" min":a+" min"}return""}})}()}(),function(){"use strict";!function(){var e={bindings:{onCancelClicked:"&",onAddCompleted:"&",basedOn:"@",schedule:"<"},controller:["$scope","$timeout","$q","timecard-factory","fpm-utilities-factory","authenticationFactory",function(e,t,n,o,a,i){function r(){if(p.ui.errors=[],p.isFromPto){if(null===p.entity.finishTime)return p.ui.errors.push("Please select finish time."),!1;var e=kendo.parseDate(p.entity.startTime),t=kendo.parseDate(p.entity.timeCardDate),n=moment(new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0)),i=moment(new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0)),i=moment(kendo.parseDate(p.entity.timeCardDate)),r=moment(n).diff(i,"day");if(r<0||r>1)return p.ui.errors.push("Invalid Date"),!1}if(null!==p.entity.finishTime){var c=kendo.parseDate(p.entity.finishTime),u=kendo.parseDate(p.entity.timeCardDate),i=new Date(u.getFullYear(),u.getMonth(),u.getDate(),(new Date).getHours(),(new Date).getMinutes(),0,0),l=moment(new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes(),0,0));if(moment(l).diff(kendo.parseDate(p.entity.startTime),"minutes")<0)return p.ui.errors.push("Invalid Time"),!1}var s=angular.copy(p.entity);if(s.startTime=kendo.toString(kendo.parseDate(p.entity.startTime),"g"),s.finishTime=kendo.toString(kendo.parseDate(p.entity.finishTime),"g"),p.entity.timeCardDate&&(s.timeCardDate=kendo.toString(p.entity.timeCardDate,"g")),null===s.jobCode||0===s.jobCode)return p.ui.errors.push("Please select Job code before save"),!1;p.showServiceProviderLabel&&p.schedule&&"workOrder"===p.basedOn&&(s.timecardUserEmailDefined=!0,s.timecardUserEmail=p.schedule.technicianNum),a.showLoading().then(function(){(p.isFromPto?o.addPtoDetails:o.addNewDetails)(s).then(function(e){y=!1,angular.isArray(e.errors)&&e.errors.length>0?p.ui.errors=e.errors:h.alert("Time Added","Time has been "+(p.editMode?"updated":"added"),function(){angular.isFunction(p.onAddCompleted)&&p.onAddCompleted({o:e})})}).finally(a.hideLoading)})}function c(){t(function(){p.entity.startTime=p.dateTimeMode.startTime,d()},100)}function u(){t(function(){p.entity&&null===p.entity.startTime&&c(),p.entity.finishTime=p.dateTimeMode.finishTime,d()},100)}function l(){if(o.summary&&o.summary.timeCardDate){var e=o.summary,t=kendo.parseDate(e.timeCardDate),n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),(new Date).getHours(),(new Date).getMinutes(),0);p.entity.startTime=n,p.dateTimeMode.startTime=n}}function s(e){p.showServiceProviderLabel="workOrder"===p.basedOn&&null!==p.schedule,p.ui.errors=[],v=e.currentDate||new Date,p.details=e.details,p.editMode=e.editMode,p.isInEditMode=p.editMode;var t=e.isFromPto;p.isFromPto=t,p.editMode&&p.details?(p.entity=angular.copy(p.details),p.entity.startTime=kendo.parseDate(p.details.startTime),p.entity.finishTime=kendo.parseDate(p.details.finishTime),p.entity.timeCardDate=kendo.parseDate(p.details.timeCardDate),p.isFromPto=p.details.isPtoType,p.dateTimeMode.startTime=null,p.entity.startTime&&(p.dateTimeMode.startTime=p.entity.startTime,p.dateTimeMode.isCheckedIn=!0),p.dateTimeMode.finishTime=null,p.entity.finishTime&&(p.dateTimeMode.finishTime=p.entity.finishTime,p.dateTimeMode.isCheckedOut=!0),p.dateTimeMode.isCheckedOut=null!==p.entity.finishTime,d()):(p.entity=angular.copy(C),p.entity.startTime=new Date,p.entity.finishTime=null,p.dateTimeMode.startTime=new Date,p.dateTimeMode.finishTime=null,p.dateTimeMode.isCheckedIn=!1,p.dateTimeMode.isCheckedOut=!1,p.dateTimeMode.timeSpan="",e&&e.currentDate&&(p.entity.timeCardDate=e.currentDate,v=e.currentDate),!0===t&&l()),o.summary&&o.summary.timeCardDate&&(p.entity.numFromSummary=o.summary.num,p.entity.timeCardDate=kendo.parseDate(o.summary.timeCardDate)),p.timecardPermissions.isFromAddingPto=t,t&&(p.timecardPermissions.timePickerVisibility=!0)}function d(){var e=n.defer();if(p.ui.errors=[],p.ui.isInvalidSave=!1,Date.parse(p.entity.startTime)&&Date.parse(p.entity.finishTime))var o=new Date(p.entity.finishTime),a=new Date(p.entity.startTime),i=new Date(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),0,0),r=new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),0,0),c=moment(i).diff(moment(r),"minutes"),u=Math.floor(c/60),l=c%60,s=t(function(){c>0?(p.dateTimeMode.timeSpan=u>0?u+(u>1?" Hours ":" Hour ")+l+(l>1?" Minutes":" Minute"):l+" Minutes",e.resolve(!0)):c<0?(p.dateTimeMode.timeSpan="",p.ui.isInvalidSave=!0,e.resolve(!1)):p.isInEditMode||(p.ui.isInvalidSave=!0,e.resolve(!1)),t.cancel(s)},10);return e.promise}function m(){a.showLoading().then(function(){o.getWorkOrdersList().then(function(e){p.ui.workOrders=e}).finally(function(){if(p.showServiceProviderLabel&&p.schedule&&"workOrder"===p.basedOn){_.contains(p.ui.workOrders,{barcode:p.schedule.barcode})&&(p.entity.barcode=p.schedule.barcode)}f()})})}function f(){a.showLoading().then(function(){o.getJobCodes().then(function(e){p.ui.jobCodes=_.where(e,{isPtoType:!1}),p.ui.ptoJobCodes=_.where(e,{isPtoType:!0})}).finally(a.hideLoading)})}var p=this,h=a.alerts,g=o.statics.jobCodes,y=!1;p.ui={summary:angular.copy(o.summary),jobCodes:[],workOrders:[],errors:[],isInvalidSave:!1,ptoJobCodes:[]},p.dateTimeMode={timeSpan:"",startTime:new Date,finishTime:null,isCheckedIn:!1,isCheckedOut:!1};var C={num:0,numFromSummary:0,timeCardDate:new Date,startTime:null,finishTime:null,jobCode:0,notes:"",barcode:0,isUserDefined:!0};p.timecardPermissions={allowPushTime:!1,timePickerVisibility:!0,isFromAddingPto:!1},p.entity=null,p.events={checkInClick:function(){null===p.entity.startTime&&(p.dateTimeMode.startTime=new Date,p.entity.startTime=new Date,p.entity.finishTime=null,p.dateTimeMode.finishTime=null,d().then(function(e){e?p.dateTimeMode.isCheckedIn=!0:p.ui.errors.push("Invalid Time")}))},checkOutClick:function(){null===p.entity.finishTime&&(p.dateTimeMode.finishTime=new Date,p.entity.finishTime=new Date),d().then(function(e){e?p.dateTimeMode.isCheckedOut=!0:p.ui.errors.push("Invalid Time")})},updateButtonClicked:function(){if(p.ui.errors=[],p.ui.isInvalidSave=!1,null===p.entity.startTime&&(p.entity.startTime=new Date),p.entity.startTime=kendo.toString(p.entity.startTime,"g"),p.entity.finishTime=kendo.toString(p.entity.finishTime,"g"),!p.editMode){var e=angular.copy(o.details);return _.filter(e,function(e){return null===e.finishTime&&e.jobCode!==g.CLOCK_IN}).length>0&&!y?h.confirm("Confirmation!","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(e){y=!0,r()}):r(),!1}return r(),!1},closeProductEditModal:function(){angular.isFunction(p.onCancelClicked)&&p.onCancelClicked()},onDateTimeChaged:c,onFinishDateTimeChaged:u};var v=new Date,b=!1;p.$onInit=function(){p.userInfo=i.getLoggedInUserInfo(),p.userInfo&&(p.timecardPermissions.allowPushTime=p.userInfo.allowPushTime,p.timecardPermissions.timePickerVisibility=!0)},e.$on("timecard:addEditDetailsModal:open",function(e,n){b=!0,s(n),t(function(){m()},100)})}],controllerAs:"vm",templateUrl:"js/timecard/timecard-add-edit-detail-component.template.html"};angular.module("fpm").component("addEditDetailsComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r,c,u,l){function s(e,t){var n="SELECT TIME";if(n=5001===e.jobCode?t?"CLOCK IN":"CLOCK OUT":t?"CHECK IN":"CHECK OUT",E.timePicker.prop=t?"startTime":"finishTime",e[E.timePicker.prop]){n=n+" - "+kendo.toString(kendo.parseDate(e[E.timePicker.prop]),"g")}var o=kendo.parseDate(e[E.timePicker.prop]);E.timePicker.instance&&(E.timePicker.timecardObject=e,E.timePicker.originalTime=o,E.timePicker.instance.settings.headerText=n,E.timePicker.instance.setVal(o),E.timePicker.instance.show())}function d(e){return _.where(e.timeCardDetails,{finishTime:null}).length>0?(E.ui.data.allowSendForApproval=!1,!1):E.ui.data.approvalStatus!==P.NONE?(E.ui.data.allowSendForApproval=!1,!1):(E.ui.data.allowSendForApproval=!0,!0)}function m(){t(function(){var e=new Date(E.currentDate.getFullYear(),E.currentDate.getMonth(),E.currentDate.getDate(),0,0,0,0),t=new Date,n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),o=moment().add(1,"days").toDate(),a=(moment(e).isBefore(n),moment(e).isAfter(o));E.ui.data.addTimeVisibility=E.ui.data.isClockedIn,E.ui.data.ptoButtonVisibility=!E.ui.data.isClockedIn,a&&(E.ui.data.disableClockInButton=!0,E.ui.data.addTimeVisibility=!1,E.ui.data.ptoButtonVisibility=!0)},100)}function f(e){E.ui.data.timeCards=e}function p(e){if(E.ui.data.timeCards=[],E.ui.data.checkInOuts=_.filter(e.timeCardDetails,function(e){return 5001!=e.jobCode&&5002!=e.jobCode}),E.timecardAccessLevel=e.timecardAccessLevel,E.ui.data.summary=e.timeCardSummary,E.factory.summary=e.timeCardSummary,E.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0,$=e.pendingClockIns,E.ui.data.currentClockedIn=_.findWhere(e.timeCardDetails,{jobCode:I.CLOCK_IN,finishTime:null}),d(e),angular.isDefined(E.ui.data.currentClockedIn)){var t=E.ui.data.currentClockedIn;E.ui.data.clockInDateTime=kendo.parseDate(t.startTime),E.ui.data.isClockedIn=!0,E.ui.data.isClockedOut=null!==t.finishTime,E.ui.data.addTimeVisibility=!E.ui.data.isClockedOut,E.ui.data.clockOutDateTime=kendo.parseDate(t.finishTime),E.ui.data.clockedInDate=angular.copy(t)}m(),f(e.timeCardDetails)}function h(){E.hideTotalRow=!1,E.ui.data.totalTime="0",E.ui.data.totalCheckinTime=[];var e=_.filter(E.ui.data.timeCards,function(e){return e.jobCode===I.CLOCK_IN&&null!==e.finishTime}),t=_.filter(E.ui.data.timeCards,function(e){return e.jobCode!==I.CLOCK_IN&&!1===e.isPayable&&null!==e.finishTime}),n=_.filter(E.ui.data.timeCards,function(e){return e.jobCode!==I.CLOCK_IN&&null!==e.finishTime});if(!(n.length>0))return void(E.ui.data.totalcheckinTime="0 hrs 0 min");var o=_.pluck(n,"clockInNum"),a=_.uniq(o);1==a.length&&null==a[0]&&(E.hideTotalRow=!0),angular.forEach(a,function(e,t){var o=0;angular.forEach(n,function(t,n){t.clockInNum==e&&(o+=moment(kendo.parseDate(t.finishTime)).diff(kendo.parseDate(t.startTime),"minutes"))});var a=Math.floor(o/60),i=o%60;E.ui.data.totalCheckinTime[e]=a+" hrs "+i+" min"});var i=0;if(!(e.length>0))return void(E.ui.data.totalTime="0 hrs 0 min");if(angular.forEach(e,function(e,t){i+=moment(kendo.parseDate(e.finishTime)).diff(kendo.parseDate(e.startTime),"minutes")}),t.length>0){var r=0;angular.forEach(t,function(e,n){if(r+=moment(kendo.parseDate(e.finishTime)).diff(kendo.parseDate(e.startTime),"minutes"),n===t.length-1)if((i-=r)>0){var o=Math.floor(i/60),a=i%60;E.ui.data.totalTime=o+" hrs "+a+" min"}else E.ui.data.totalTime="0 hrs 0 min"})}else{var c=Math.floor(i/60),u=i%60;E.ui.data.totalTime=c+" hrs "+u+" min"}}function g(){E.ui.data.allowSendForApproval=!1,E.ui.data.summary=null,E.ui.data.approvalStatus=0,E.ui.data.isClockedOut=!1,E.ui.data.summary=null,E.ui.data.clockInDateTime=new Date,E.ui.data.isClockedIn=!1,E.ui.data.addTimeVisibility=!1,E.ui.data.clockedInDate=null,E.ui.data.timeCards=[],E.ui.data.disableClockInButton=!1,E.ui.data.disableClockOutButton=!1}function y(){t(function(){g(),E.showingLoading=!0,u.showLoading().then(function(){c.getTimeCardByDate(M(E.currentDate)).then(function(e){e?p(e):m()}).finally(function(){E.showingLoading=!1,u.hideLoading()})})},50)}function C(e){E.popover.show(e)}function v(e,t){var n=null;n=E.ui.data.summary&&E.ui.data.summary.timeCardDate?moment(E.ui.data.summary.timeCardDate).toDate():E.currentDate;var o=e||new Date,a=new Date(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),0,0),i=t?t.num:0,r={num:i,startTime:kendo.toString(a,"g"),jobCode:I.CLOCK_OUT,numFromSummary:E.ui.data.summary.num,timeCardDate:kendo.toString(kendo.parseDate(n),"g")};E.ui.data.currentClockedIn?r.uniqueIdentifier=E.ui.data.currentClockedIn.uniqueIdentifier:r.uniqueIdentifier=t.uniqueIdentifier,u.showLoading().then(function(){c.clockInOutUser(r).then(function(e){if(e&&null===e.errors){E.ui.data.clockOutDateTime=a,E.ui.data.isClockedOut=!0,E.ui.data.isClockedIn=!1,E.ui.data.disableClockOutButton=!0,E.ui.data.addTimeVisibility=!1,E.ui.data.ptoButtonVisibility=!0,E.ui.data.summary=e.timeCardSummary,E.factory.summary=e.timeCardSummary;var t=E.currentDate?E.currentDate:new Date,o=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),i=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0);moment(i).isSameOrAfter(o)&&(E.ui.data.disableClockInButton=!1),E.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0,f(e.timeCardDetails),d(e)}else O.alert("Error","Not able to perform clock out")}).finally(function(){u.hideLoading()})})}function b(){!0===E.ui.data.isFromPto&&null===E.ui.data.summary&&(E.ui.data.summary={num:0,timeCardDate:E.currentDate},E.factory.summary=E.ui.data.summary),null===E.ui.data.addEditDetailsModal?i.fromTemplateUrl("timecardDetailsModal.html",{scope:e,animation:"slide-in-up"}).then(function(n){E.ui.data.addEditDetailsModal=n,t(function(){e.$broadcast("timecard:addEditDetailsModal:open",{isFromPto:E.ui.data.isFromPto,details:E.ui.data.currentDetails,editMode:E.ui.data.isInEditMode,currentDate:E.currentDate}),n.show()},300)}):(e.$broadcast("timecard:addEditDetailsModal:open",{isFromPto:E.ui.data.isFromPto,details:E.ui.data.currentDetails,editMode:E.ui.data.isInEditMode,currentDate:E.currentDate}),E.ui.data.addEditDetailsModal.show())}function D(){null===E.ui.data.timeCardSummaryModal?i.fromTemplateUrl("timecardSummaryModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){E.ui.data.timeCardSummaryModal=t,e.$broadcast("timecard:timeCardSummaryModal:open"),E.ui.data.timeCardSummaryModal.show()}):(e.$broadcast("timecard:timeCardSummaryModal:open"),E.ui.data.timeCardSummaryModal.show())}function w(){null===E.ui.data.timecardTutorialModal?i.fromTemplateUrl("timecardTutorialModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){E.ui.data.timecardTutorialModal=e,E.ui.data.timecardTutorialModal.show()}):E.ui.data.timecardTutorialModal.show()}function S(e){y()}function T(){angular.isDefined(E.ui.calendar.control)&&E.ui.calendar.control.show()}function k(e,n,o){O.confirm("Confirmation!","Are you sure?",function(){angular.isFunction(o)&&o(),u.showLoading().then(function(){c.clearClockOutTime(e,n).then(function(e){e&&t(function(){y()})}).finally(function(){u.hideLoading()})})},function(){angular.isFunction(o)&&o()})}var E=this,I=c.statics.jobCodes,M=u.toStringDate;E.dateFormat=n.dateFormat;var P=c.statics.statusTypes,$=[];E.errors=[],E.factory=c;var O=u.alerts;E.currentDate=new Date,E.showingLoading=!1,E.timePicker={settings:{timeFormat:"hh:ii A",headerText:"{label} Time",theme:"mobiscroll",display:"bottom",swipeDirection:"vertical"},prop:null,instance:null,originalTime:null,currentTime:null,timecardObject:null,onTimeNewPicked:function(){var e=E.timePicker.timecardObject,n=e.jobCode===I.CLOCK_IN&&"finishTime"===E.timePicker.prop,o=angular.copy(e);n?v(E.timePicker.currentTime,e):(e[E.timePicker.prop]=E.timePicker.currentTime,o.startTime=kendo.toString(kendo.parseDate(e.startTime),"g"),o.finishTime=kendo.toString(kendo.parseDate(e.finishTime),"g"),u.showLoading().then(function(){c.addNewDetails(o).then(function(e){null===e.errors&&(O.alert("Time Added","Time has been updated."),E.ui.data.timeCards.length!==e.timeCardDetails.length&&(E.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0),t(function(){f(e.timeCardDetails)},100))}).finally(u.hideLoading)}))},onTimeClicked:function(e,n){var o=E.ui.data.approvalStatus;if(o===P.SEND_FOR_APPROVAL||o===P.APPROVED||o===P.RESENT_FOR_APPROVAL)return!1;e.jobCode!==I.CLOCK_IN||n||null!==e.finishTime?s(e,n):_.filter(E.ui.data.timeCards,function(e){return null===e.finishTime&&e.jobCode!==I.CLOCK_IN}).length>0?O.confirm("Confirmation!","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(){t(function(){s(e,n)},20)}):O.confirm("Confirmation!","Are you sure?",function(){t(function(){s(e,n)},20)})}},a.fromTemplateUrl("my-popover.html",{scope:e}).then(function(e){E.popover=e});E.currentDate;E.events={showPopoverClicked:C},E.isPtoClockIn=function(e){return 5001!==e.jobCode||0===_.filter(E.ui.data.timeCards,function(t){return t.ptoClockInLinkedWith&&t.ptoClockInLinkedWith===e.num}).length};E.ui={errors:[],calendar:{settings:{theme:"mobiscroll",display:"bottom",swipeDirection:"vertical"}},data:{componentEvents:null,summary:null,currentDate:new Date,isClockedIn:!1,isClockedOut:!1,clockInDateTime:new Date,clockOutDateTime:new Date,addTimeVisibility:!1,clockedInDate:null,timeCards:[],approvalStatus:0,disableClockInButton:!1,disableClockOutButton:!1,currentClockedIn:null,allowSendForApproval:!1,totalTime:"",enableForCustomer:!1,ptoButtonVisibility:!1,isFromPto:!1,isInEditMode:!1,addEditDetailsModal:null,timeCardSummaryModal:null,currentDetails:null,timecardTutorialModal:null},events:{refreshOnPullDown:function(){y()},onClockInOutActionClicked:function(e){var t=r.show({buttons:[{text:"Delete Clock In/Out",className:"destructive "}],destructiveText:"Clear Clock-Out Time",titleText:"Time Card Options",cancel:function(){},buttonClicked:function(n){0===n&&k(e.num,!0,t)},destructiveButtonClicked:function(){if(E.ui.data.timeCards.filter(function(e){return e.jobCode===I.CLOCK_IN&&null===e.finishTime}).length>0)return t(),O.alert("Warning","You cannot have multiple Clock Out."),!1;k(e.num,!1,t)}})},checkOutPending:function(e){O.confirm("Confirmation!","Are you sure?",function(){var n=kendo.parseDate(e.timeCardDate),o=angular.copy(e),a=moment(new Date(n.getFullYear(),n.getMonth(),n.getDate(),(new Date).getHours(),(new Date).getMinutes(),0,0)),i=kendo.parseDate(o.startTime);a.isBefore(i)?O.alert("Invalid Time","Please enter finish time manually.",function(){t(function(){E.ui.data.currentDetails=o,E.ui.data.isInEditMode=!0,E.ui.data.isFromPto=o.isPtoType,b()},100)}):(o.finishTime=kendo.toString(new Date(n.getFullYear(),n.getMonth(),n.getDate(),(new Date).getHours(),(new Date).getMinutes(),0,0),"g"),u.showLoading().then(function(){c.addNewDetails(o).then(function(e){e&&t(function(){y()})}).finally(function(){u.hideLoading()})}))})},onShowCalenderClick:T,onCurrentDateChanged:S,onTutorialModalCancel:function(){E.ui.data.timecardTutorialModal&&E.ui.data.timecardTutorialModal.hide()},onSummaryModalCancel:function(){E.ui.data.timeCardSummaryModal.hide()},checkSummaryClick:function(){return D(),E.popover.hide(),!0},showTimeCardTutorialWindow:function(){return E.popover.hide(),w(),!0},onAddScheduleCompleted:function(e){E.ui.data.timeCards.length!==e.timeCardDetails.length&&(E.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0),f(e.timeCardDetails),E.ui.data.addEditDetailsModal.hide()},onModalCancelClicked:function(){E.ui.data.isInEditMode=!1,E.ui.data.isFromPto=!1,E.ui.data.currentDetails=null,E.ui.data.addEditDetailsModal.hide()},addTimeClick:function(e){return t(function(){E.ui.data.isFromPto=e,E.ui.data.isInEditMode=!1,E.ui.data.currentDate=E.currentDate,b()},100),E.popover.hide(),!0},onCardActionClicked:function(e){r.show({buttons:[{text:"Edit"}],destructiveText:"Delete",titleText:"Time Card Options",cancelText:"Cancel",cancel:function(){},destructiveButtonClicked:function(){return e.isUserDefined&&1!=E.timecardAccessLevel?O.confirmDelete(function(){u.showLoading().then(function(){c.deleteTimeCardDetails(e.num,e.numFromSummary).then(function(e){e&&O.alert("Success","Time Details cleared successfully",function(){f(e.timeCardDetails)})}).finally(u.hideLoading)})}):O.alert("Invalid Action","You are not allowed to perform delete"),!0},buttonClicked:function(n){return 0===n&&(E.ui.data.currentDetails=e,t(function(){E.ui.data.isInEditMode=!0,E.ui.data.isFromPto=e.isPtoType,b()},200)),!0}})},sendForApproval:function(e){if(angular.isArray(E.ui.data.timeCards)&&0===E.ui.data.timeCards.length)return O.alert("No Timecard!","No Timecard information found to process this request."),!1;O.confirm("Confirmation!","Are you sure?",function(){u.showLoading().then(function(){c.sendForApproval(E.ui.data.summary.num,e).then(function(e){e&&(E.ui.data.summary=e.timeCardSummary,O.alert("Success","Time card sent for approval successfully"),E.ui.data.addTimeVisibility=!1,E.ui.data.ptoButtonVisibility=!1,E.ui.data.approvalStatus=E.ui.data.summary.approveStatus)}).finally(u.hideLoading)})})},clockOutClick:function(e,n){_.filter(E.ui.data.timeCards,function(e){return null===e.finishTime&&e.jobCode!==I.CLOCK_IN}).length>0?O.confirm("Confirmation!","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(){t(function(){v(e,n)},10)}):O.confirm("Confirmation!","Are you sure?",function(){t(function(){v(e,n)},10)})},clockInClick:function(){var e=E.currentDate,t=new Date,n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),(new Date).getHours(),(new Date).getMinutes(),0,0),o=new Date(e.getFullYear(),e.getMonth(),e.getDate(),(new Date).getHours(),(new Date).getMinutes(),0,0),a={startTime:u.toStringDate(n),jobCode:I.CLOCK_IN,numFromSummary:null===E.ui.data.summary?0:E.ui.data.summary.Num,timeCardDate:u.toStringDate(o)};E.errors=[],u.showLoading().then(function(){c.clockInOutUser(a).then(function(e){null===e.errors?(E.ui.data.clockInDateTime=n,E.ui.data.isClockedIn=!0,E.ui.data.disableClockOutButton=!1,E.ui.data.addTimeVisibility=!0,E.ui.data.ptoButtonVisibility=!1,O.alert("Clocked In","Clocked in successfully",function(){p(e)})):E.errors=e.errors}).then(function(){u.hideLoading()})})}}};var N=[{c:"407805491"},{c:"1238967820"}];e.$watch("vm.ui.data.timeCards",function(e){E.factory.details=e,angular.isDefined(e)&&h()},!0),e.$on("modal.removed",function(){}),e.$on("$destroy",function(){E.ui.data.addEditDetailsModal&&E.ui.data.addEditDetailsModal.remove()}),function(){i.fromTemplateUrl("timecardDetailsModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){E.ui.data.addEditDetailsModal=e}),y();var t=l.getLoggedInUserInfo(),n=_.findWhere(N,{c:t.customerNumber});E.ui.data.enableForCustomer=angular.isDefined(n),E.dateFormat=t.dateFormat,t&&(E.userName=t.userName)}(),m()}e.$inject=["$scope","$timeout","$rootScope","$state","$ionicPopover","$ionicModal","$ionicActionSheet","timecard-factory","fpm-utilities-factory","authenticationFactory"],angular.module("fpm").controller("timecard-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function a(t,n){var o=n||"";return e.get(I+"GetTimeCardByDate?date="+encodeURIComponent(t)+"&userEmail="+encodeURIComponent(o))}function i(e){var n=t.currentLocation,o=void 0!==n?n.coords:{};return o&&void 0!==o.latitude&&(e.coordinateX=o.longitude,e.coordinateY=o.latitude),e}function r(t){return e.get(I+"GetClockInByDate?date="+t)}function c(t){var n=i(t);return e.post(I+"ClockInOutUser",n)}function u(t){!0===(t=t||!1)&&M.remove("jobCodes");var o=M.get("jobCodes");return angular.isDefined(o)&&o?n.when(o):e.get(I+"GetJobCodes").then(function(e){return M.put("jobCodes",e),e})}function l(t){!0===(t=t||!1)&&M.remove("workorders");var o=M.get("workorders");return angular.isDefined(o)&&o?n.when(o):e.get(I+"GetWorkOrdersList").then(function(e){return M.put("workorders",e),e})}function s(t){var n=i(t);return e.post(I+"AddNewDetails",n)}function d(t,n){return e.get(I+"ClearCheckedOutTime?detailId="+t+"&summaryId="+n)}function m(t,n){return e.get(I+"SendForApproval?summaryId="+t+"&status="+n)}function f(t,n){return e.get(I+"DeleteTimeCardDetails?detailId="+t+"&summaryId="+n)}function p(t){return e.get(I+"ClearTimeCard?summaryId="+t)}function h(){return e.get(I+"GetPendingClockIns")}function g(t){var n=i(t);return e.post(I+"PushCheckInOutTimes",n)}function y(){return e.get(I+"CertifieldUser")}function C(){return e.get(I+"GetCertifieldUser")}function v(t){var n=i(t);return e.post(I+"AddPtoDetails",n)}function b(t){return e.post(I+"GetPayableHoursSummaryView",t)}function D(t,n){return e.get(I+"ClearClockOutTime?detailNum="+t+"&fromDeleteClockIn="+n)}function w(){A.data={details:[],jobCodes:{CLOCK_IN:5001,CLOCK_OUT:5002},summary:null}}function S(e){var t=n.defer(),o=e,a=kendo.parseDate(e.timeCardDate),i=moment(new Date(a.getFullYear(),a.getMonth(),a.getDate(),(new Date).getHours(),(new Date).getMinutes(),0,0)),r=kendo.parseDate(o.startTime);return i.isBefore(r)?t.resolve({success:!1,reason:-1}):(o.finishTime=kendo.toString(new Date(a.getFullYear(),a.getMonth(),a.getDate(),(new Date).getHours(),(new Date).getMinutes(),0,0),"g"),s(o).then(function(e){e&&t.resolve({success:!0,reason:0})})),t.promise}function T(t){return e.post(I+"CheckPreviousDateClockIn",t)}function k(e,t,n){$.clockInDateTime=e,$.details=t,
$.data=n}function E(){return $}var I="api/timecard/",M=o("timeCardCache"),P={CLOCK_IN:5001,CLOCK_OUT:5002},$={clockInDateTime:null,details:null,data:null},O={details:[],jobCodes:{CLOCK_IN:5001,CLOCK_OUT:5002},summary:null},N={NONE:0,SEND_FOR_APPROVAL:1,CANCELLED:2,APPROVED:3,UNAPPROVED:4,RESENT_FOR_APPROVAL:5},A={};return A.statics={jobCodes:P,statusTypes:N},A.setClockinData=k,A.getClockinData=E,A.checkPreviousDateClockIn=T,A.clearClockOutTime=D,A.checkoutPending=S,A.clearTimecardFactoryData=w,A.addPtoDetails=v,A.getSummaryPayableHours=b,A.certifyUser=y,A.getCertifieldUser=C,A.pushCheckInOutTimes=g,A.data=O,A.getPendingClockIns=h,A.getJobCodes=u,A.clockInOutUser=c,A.getClockInByDate=r,A.getTimeCardByDate=a,A.getWorkOrdersList=l,A.addNewDetails=s,A.clearCheckedOutTime=d,A.sendForApproval=m,A.deleteTimeCardDetails=f,A.clearTimeCard=p,A}e.$inject=["api-base-factory","$rootScope","$q","$cacheFactory"],angular.module("fpm").factory("timecard-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{onCancelClicked:"&"},controller:["$scope","$ionicActionSheet","timecard-factory","fpm-utilities-factory","authenticationFactory",function(e,t,n,o,a){function i(){angular.isFunction(l.onCancelClicked)&&l.onCancelClicked()}function r(){l.payableReport=[];var e=[];l.totalPayables={p:0,np:0,t:0},o.showLoading().then(function(){n.getSummaryPayableHours({startDate:l.modal.startDate,finishDate:l.modal.endDate}).then(function(t){t&&t.length>0&&angular.forEach(t,function(n,o){var a=_.findWhere(e,{timeCardDate:n.timeCardDate});angular.isDefined(a)?(n.isPayable?a.payableHours+=parseFloat(n.totalMinutes):a.nonPayable+=parseFloat(n.totalMinutes),a.total+=parseFloat(a.payableHours)+parseFloat(a.nonPayable)):e.push({timeCardDate:n.timeCardDate,payableHours:n.isPayable?parseFloat(n.totalMinutes):0,nonPayable:n.isPayable?0:parseFloat(n.totalMinutes),total:parseFloat(n.totalMinutes).toFixed(2)}),o===t.length-1&&(l.payableReport=e,_.forEach(e,function(e){l.totalPayables.p+=parseFloat(e.payableHours),l.totalPayables.np+=parseFloat(e.nonPayable),l.totalPayables.t+=parseFloat(e.total)}))})}).finally(o.hideLoading)})}function c(){t.show({buttons:[{text:"Show Current"},{text:"As Selected Dates"}],titleText:"Time card Report",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&u(),1===e&&(l.showCurrentSummary=!1),!0}})}function u(){l.lists={clockInOuts:[],payables:[],nonPayables:[]},o.showLoading().then(function(){if(angular.isArray(n.details)&&n.details.length>0){l.lists.clockInOuts=_.where(n.details,{jobCode:s.CLOCK_IN});var e=_.reject(n.details,{jobCode:s.CLOCK_IN});l.lists.payables=_.where(e,{isPayable:!0}),l.lists.nonPayables=_.where(e,{isPayable:!1})}o.hideLoading()}),l.showCurrentSummary=!0}var l=this;l.user=a.getLoggedInUserInfo(),l.dateFormat=l.user.dateFormat;var s=n.data.jobCodes;l.lists={clockInOuts:[],payables:[],nonPayables:[]},l.modal={startDate:new Date,endDate:null},l.payableReport=[],l.totalPayables={p:0,np:0,t:0},l.events={closeProductEditModal:i,showReport:r,onCardActionClicked:c},l.$onInit=function(){u()},e.$on("timecard:timeCardSummaryModal:open",function(){u()})}],controllerAs:"vm",templateUrl:"js/timecard/timecard-summary-component.template.html"};angular.module("fpm").component("timecardSummaryComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{onCancelClicked:"&"},controller:["$scope","timecard-factory",function(e,t){function n(){angular.isFunction(a.onCancelClicked)&&a.onCancelClicked()}function o(){t.certifyUser().then(function(e){e&&(a.isCertifield=!0,a.info=e)})}var a=this;a.isCertifield=!1,a.info=null,a.events={closeProductEditModal:n,onCertifyClicked:o},a.$onInit=function(){t.getCertifieldUser().then(function(e){e&&(a.isCertifield=e.isCertified||!1,a.info=e)})}}],controllerAs:"vm",templateUrl:"js/timecard/timecard-tutorial-component.template.html"};angular.module("fpm").component("timecardTutorialViewComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r,c,u,l,s){function d(e){return kendo.parseDate(e)}function m(e,t){var n=t||new Date;return new Date(e.getFullYear(),e.getMonth(),e.getDate(),n.getHours(),n.getMinutes(),0,0)}function f(t,n,o){var i=null;i=D.data.summary&&D.data.summary.timeCardDate?moment(D.data.summary.timeCardDate).toDate():D.currentDate;var r=t||new Date,u=m(r,r),l=n?n.num:0,s={num:l,scheduleNums:o,startTime:h(u),jobCode:S.CLOCK_OUT,numFromSummary:D.data.summary.num,timeCardDate:h(i)};D.assgiendToSameUser||(s.timecardUserEmailDefined=!0,s.timecardUserEmail=E),D.data.currentClockedIn?s.uniqueIdentifier=D.data.currentClockedIn.uniqueIdentifier:s.uniqueIdentifier=n.uniqueIdentifier,a.showLoading().then(function(){c.clockInOutUser(s).then(function(t){g(),t&&null===t.errors?(y(t),e.$broadcast("$timecard.onclocked-out-fromHeader",t)):I.alert("Error","Not able to perform clock out")}).finally(function(){a.hideLoading()})})}function p(e,t,o){_.filter(D.data.timeCards,function(e){return null===e.finishTime&&e.jobCode!==S.CLOCK_IN}).length>0?I.confirm("Confirmation!","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(){n(function(){f(e,t,o)},10)}):I.confirm("Confirmation!","Are you sure?",function(){n(function(){f(e,t,o)},10)})}function h(e){return a.toStringDate(e)}function g(){D.data.currentClockedIn=null,D.data.isClockedOut=!1,D.data.isClockedIn=!1,D.data.timeCards=[],D.data.disableClockInButton=!1,D.data.disableClockOutButton=!1}function y(e){if(D.data.timeCards=e.timeCardDetails,D.data.summary=e.timeCardSummary,D.data.currentClockedIn=_.findWhere(e.timeCardDetails,{jobCode:S.CLOCK_IN,finishTime:null}),angular.isDefined(D.data.currentClockedIn)){var t=D.data.currentClockedIn;D.data.clockInDateTime=d(t.startTime),D.data.isClockedIn=!0,D.data.isClockedOut=null!==t.finishTime}else D.data.isClockedOut=D.data.timeCards&&D.data.timeCards.length>0}function C(){var e=h(D.currentDate);D.data.loading=!0,g(),c.getTimeCardByDate(e,E).then(function(e){e&&y(e)}).finally(function(){D.data.loading=!1})}function v(e){D.schedule&&(D.barcode=D.schedule.barcode,D.assgiendToSameUser=D.schedule&&D.schedule.technicianNum===D.user.userEmail,D.currentDate=d(D.schedule.scheduledStartDateTime),D.userName=w?D.schedule.technicianName:D.user.userName,E=D.assgiendToSameUser?D.user.userEmail:D.schedule.technicianNum,n(function(){C()},50))}function b(){D.multipleScheduleCheckInModal&&(D.multipleScheduleCheckInModal.hide(),D.multipleScheduleCheckInModal.remove(),D.multipleScheduleCheckInModal=null)}var D=this;D.pleaseWait=!1;var w=!1,S=c.statics.jobCodes,T=(c.statics.statusTypes,["97713","97719","99009","97678","97636"]),k=!1,E="",I=a.alerts;D.assgiendToSameUser=!1,D.currentDate=new Date,D.dateFormat=e.dateFormat,D.multipleScheduleCheckInModal=null,D.data={events:{clockOutClick:function(e,n){c.setClockinData(e,n,{data:D.data}),k||D.isTrafficControllerCustomer?(D.scheduleActionType=3,D.pleaseWait=!0,o.getSchedulesWithSameDateTime(D.barcode,D.schedule.num,D.scheduleActionType).then(function(o){null===o||o.length<=1?p(e,n):a.getModal("checkInMultipleSchedulesModal.html",t).then(function(e){D.multipleScheduleCheckInModal=e,D.multipleScheduleCheckInModal.show()})}).finally(function(){D.pleaseWait=!1})):p(e,n)}},currentClockedIn:null,clockInDateTime:null,isClockedOut:!1,isClockedIn:!1,timeCards:[],clockedInDate:null,loading:!1},D.$onChanges=function(){n(function(){v(!1)},100)},D.isTrafficControllerCustomer=!1,D.$onInit=function(){D.user=r.getLoggedInUserInfo(),D.isTrafficControllerCustomer=D.user.isTrafficControllerCustomer||!1;var e=D.user.customerNumber;k=T.indexOf(e)>-1,w="workorder"===D.basedOn,D.canChangeTimecardDate="timecard"===D.basedOn,n(function(){v(!0)},100)},t.$on("$timecard.onclocked-out-fromComponent",function(e,t){n(function(){D.data.isClockedOut=!0,D.data.isClockedIn=!1,D.data.disableClockOutButton=!0,D.data.addTimeVisibility=!1,D.data.ptoButtonVisibility=!0,D.data.summary=t.timeCardSummary,y(t)},100)}),t.$on("$wo.multipleScheduleModalCancel",function(e,t){b()}),t.$on("$wo.multipleScheduleModalCancel.clockout",function(e,t){b();var n=c.getClockinData();t.multiple?p(n.clockInDate,n.detail,t.checkedSchedules):p(n.clockInDate,n.detail,null)}),t.$on("$timecard.onClockedInCompleted",function(e,t){n(function(){y(t)},100)}),t.$on("$workOrder.refreshTimecardUI",function(e,t){n(function(){C()},100)})}var t={bindings:{basedOn:"@",schedule:"<"},controller:e,controllerAs:"vm",templateUrl:"js/timecard/timecard.clockin.out.header.component.html"};e.$inject=["$rootScope","$scope","$timeout","work-orders-factory","fpm-utilities-factory","shared-data-factory","authenticationFactory","timecard-factory","$ionicPopover","$ionicModal","$ionicActionSheet"],angular.module("fpm").component("timecardClockInHeader",t)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r,c,u,l,s,d){function m(e){return kendo.parseDate(e)}function f(e){return i.toStringDate(e)}function p(e,t){var n="SELECT TIME";if(n=5001===e.jobCode?t?"CLOCK IN":"CLOCK OUT":t?"CHECK IN":"CHECK OUT",E.timePicker.prop=t?"startTime":"finishTime",e[E.timePicker.prop]){n=n+" - "+f(e[E.timePicker.prop])}var o=m(e[E.timePicker.prop]);E.timePicker.instance&&(E.timePicker.timecardObject=e,E.timePicker.originalTime=o,E.timePicker.instance.settings.headerText=n,E.timePicker.instance.setVal(o),E.timePicker.instance.show())}function h(e,t){var n=t||new Date;return new Date(e.getFullYear(),e.getMonth(),e.getDate(),n.getHours(),n.getMinutes(),0,0)}function g(e){E.data.timeCards=e}function y(){E.data.totalTime="0",E.data.totalCheckinTime=[];var e=_.filter(E.data.timeCards,function(e){return e.jobCode===I.CLOCK_IN&&null!==e.finishTime}),t=_.filter(E.data.timeCards,function(e){return e.jobCode!==I.CLOCK_IN&&!1===e.isPayable&&null!==e.finishTime}),n=_.filter(E.data.timeCards,function(e){return e.jobCode!==I.CLOCK_IN&&null!==e.finishTime});if(!(n.length>0))return void(E.data.totalcheckinTime="0 hrs 0 min");var o=_.pluck(n,"clockInNum"),a=_.uniq(o);angular.forEach(a,function(e,t){var o=0;angular.forEach(n,function(t,n){t.clockInNum==e&&(o+=moment(kendo.parseDate(t.finishTime)).diff(kendo.parseDate(t.startTime),"minutes"))});var a=Math.floor(o/60),i=o%60;E.data.totalCheckinTime[e]=a+" hrs "+i+" min"});var i=0;if(!(e.length>0))return void(E.data.totalTime="0 hrs 0 min");if(angular.forEach(e,function(e,t){i+=moment(kendo.parseDate(e.finishTime)).diff(kendo.parseDate(e.startTime),"minutes")}),t.length>0){var r=0;angular.forEach(t,function(e,n){if(r+=moment(kendo.parseDate(e.finishTime)).diff(kendo.parseDate(e.startTime),"minutes"),n===t.length-1)if((i-=r)>0){var o=Math.floor(i/60),a=i%60;E.data.totalTime=o+" hrs "+a+" min"}else E.data.totalTime="0 hrs 0 min"})}else{var c=Math.floor(i/60),u=i%60;E.data.totalTime=c+" hrs "+u+" min"}}function C(t,n){var o=null;o=E.data.summary&&E.data.summary.timeCardDate?moment(E.data.summary.timeCardDate).toDate():E.currentDate;var a=t||new Date,r=h(a,a),c=n?n.num:0,l={num:c,startTime:f(r),jobCode:I.CLOCK_OUT,numFromSummary:E.data.summary.num,timeCardDate:f(o)};E.assgiendToSameUser||(l.timecardUserEmailDefined=!0,l.timecardUserEmail=$),E.data.currentClockedIn?l.uniqueIdentifier=E.data.currentClockedIn.uniqueIdentifier:l.uniqueIdentifier=n.uniqueIdentifier,i.showLoading().then(function(){u.clockInOutUser(l).then(function(t){t&&null===t.errors?(E.data.clockOutDateTime=r,E.data.isClockedOut=!0,E.data.isClockedIn=!1,E.data.disableClockOutButton=!0,E.data.addTimeVisibility=!1,E.data.ptoButtonVisibility=!0,E.data.summary=t.timeCardSummary,e.$broadcast("$timecard.onclocked-out-fromComponent",t),E.data.approvalStatus=t.timeCardSummary.approveStatus||0,S(t)):O.alert("Error","Not able to perform clock out")}).finally(function(){i.hideLoading()})})}function v(){E.data.isFromPto&&null===E.data.summary&&(E.data.summary={num:0,timeCardDate:E.currentDate},u.summary=E.data.summary),null===E.data.addEditDetailsModal?s.fromTemplateUrl("timecardDetailsModal.html",{scope:t,animation:"slide-in-up"}).then(function(e){E.data.addEditDetailsModal=e,o(function(){t.$broadcast("timecard:addEditDetailsModal:open",{isFromPto:E.data.isFromPto,details:E.data.currentDetails,editMode:E.data.isInEditMode,currentDate:E.currentDate}),e.show()},300)}):(t.$broadcast("timecard:addEditDetailsModal:open",{isFromPto:E.data.isFromPto,details:E.data.currentDetails,editMode:E.data.isInEditMode,currentDate:E.currentDate}),E.data.addEditDetailsModal.show())}function b(e,t,n){O.confirm("Confirmation!","Are you sure?",function(){angular.isFunction(n)&&n(),i.showLoading().then(function(){u.clearClockOutTime(e,t).then(function(e){e&&o(function(){T()},100)}).finally(function(){i.hideLoading()})})},function(){angular.isFunction(n)&&n()})}function D(e){return _.where(e.timeCardDetails,{finishTime:null}).length>0||E.data.approvalStatus!==M.NONE?(E.data.allowSendForApproval=!1,!1):(E.data.allowSendForApproval=!0,!0)}function w(){E.data.allowSendForApproval=!1,E.data.summary=null,E.data.approvalStatus=0,E.data.isClockedOut=!1,E.data.summary=null,E.data.clockInDateTime=new Date,E.data.isClockedIn=!1,E.data.addTimeVisibility=!1,E.data.clockedInDate=null,E.data.timeCards=[],E.data.disableClockInButton=!1,E.data.disableClockOutButton=!1}function S(e){if(E.data.timecard=e,E.data.timeCards=e.timeCardDetails,E.data.checkInOuts=_.filter(e.timeCardDetails,function(e){return e.jobCode!==I.CLOCK_IN&&e.jobCode!==I.CLOCK_OUT}),E.timecardAccessLevel=e.timecardAccessLevel,E.data.summary=e.timeCardSummary,E.data.currentClockedIn=_.findWhere(e.timeCardDetails,{jobCode:I.CLOCK_IN,finishTime:null}),e.timeCardSummary&&(E.data.approvalStatus=e.timeCardSummary.approveStatus||0),D(e),angular.isDefined(E.data.currentClockedIn)){var t=E.data.currentClockedIn;E.data.clockInDateTime=m(t.startTime),E.data.isClockedIn=!0,E.data.isClockedOut=null!==t.finishTime,E.data.addTimeVisibility=!E.data.isClockedOut,E.data.clockOutDateTime=m(t.finishTime),E.data.clockedInDate=angular.copy(t)}}function T(){var e=f(E.currentDate);w(),E.showingLoading=!0,E.data.loading=!0,u.getTimeCardByDate(e,$).then(function(e){e&&S(e)}).finally(function(){E.data.loading=!1,E.showingLoading=!1,i.hideLoading()})}function k(e){E.schedule&&(E.assgiendToSameUser=E.schedule&&E.schedule.technicianNum===E.user.userEmail,E.currentDate=m(E.schedule.scheduledStartDateTime),E.userName=P?E.schedule.technicianName:E.user.userName,$=E.assgiendToSameUser?E.user.userEmail:E.schedule.technicianNum,o(function(){T()},50))}var E=this,I=u.statics.jobCodes,M=u.statics.statusTypes,f=i.toStringDate,P=!1,$="",O=i.alerts;E.assgiendToSameUser=!1,E.currentDate=new Date,E.dateFormat=e.dateFormat,E.isExpanded=!1,E.timePicker={settings:{timeFormat:"hh:ii A",headerText:"{label} Time",theme:"mobiscroll",display:"bottom",swipeDirection:"vertical"},prop:null,instance:null,originalTime:null,currentTime:null,timecardObject:null,onTimeNewPicked:function(){var e=E.timePicker.timecardObject,t=e.jobCode===I.CLOCK_IN&&"finishTime"===E.timePicker.prop,n=angular.copy(e);t?C(E.timePicker.currentTime,e):(e[E.timePicker.prop]=E.timePicker.currentTime,n.startTime=f(e.startTime),n.finishTime=f(e.finishTime),E.assgiendToSameUser||(n.timecardUserEmailDefined=!0,n.timecardUserEmail=$),i.showLoading().then(function(){u.addNewDetails(n).then(function(e){null===e.errors&&(O.alert("Time Added","Time has been updated."),E.data.timeCards.length!==e.timeCardDetails.length&&(E.data.approvalStatus=e.timeCardSummary.approveStatus||0),o(function(){g(e.timeCardDetails)},100))}).finally(i.hideLoading)}))},onTimeClicked:function(e,t){var n=E.data.approvalStatus,a=e.jobCode===I.CLOCK_IN&&!t&&null===e.finishTime;if(n===M.SEND_FOR_APPROVAL||n===M.APPROVED||n===M.RESENT_FOR_APPROVAL||!e.isUserDefined&&e.jobCode!==I.CLOCK_IN)return!1;if(a){_.filter(E.data.timeCards,function(e){return null===e.finishTime&&e.jobCode!==I.CLOCK_IN}).length>0?O.confirm("Confirmation!","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(){o(function(){p(e,t)},20)}):O.confirm("Confirmation!","Are you sure?",function(){o(function(){p(e,t)},20)})}else p(e,t)}},E.data={errors:[],calendar:{settings:{theme:"mobiscroll",display:"bottom",swipeDirection:"vertical"}},events:{sendForApproval:function(e){if(angular.isArray(E.data.timeCards)&&0===E.data.timeCards.length)return O.alert("No Timecard!","No Timecard information found to process this request."),!1;O.confirm("Confirmation!","Are you sure?",function(){i.showLoading().then(function(){u.sendForApproval(E.data.summary.num,e).then(function(e){e&&(E.data.summary=e.timeCardSummary,O.alert("Success","Time card sent for approval successfully"),E.data.addTimeVisibility=!1,E.data.ptoButtonVisibility=!1,E.data.approvalStatus=E.data.summary.approveStatus)}).finally(i.hideLoading)})})},onClockInOutActionClicked:function(e){var t=d.show({buttons:[{text:"Delete Clock In/Out",className:"destructive "}],destructiveText:"Clear Clock-Out Time",titleText:"Time Card Options",cancel:function(){},buttonClicked:function(n){0===n&&b(e.num,!0,t)},destructiveButtonClicked:function(){if(E.ui.data.timeCards.filter(function(e){return e.jobCode===I.CLOCK_IN&&null===e.finishTime}).length>0)return t(),O.alert("Warning","You cannot have multiple Clock Out."),!1;b(e.num,!1,t)}})},onCardActionClicked:function(e){d.show({buttons:[{text:"Edit"}],destructiveText:"Delete",titleText:"Time Card Options",cancelText:"Cancel",cancel:function(){},destructiveButtonClicked:function(){return e.isUserDefined&&1!==E.timecardAccessLevel?O.confirmDelete(function(){i.showLoading().then(function(){u.deleteTimeCardDetails(e.num,e.numFromSummary).then(function(e){e&&O.alert("Success","Time Details cleared successfully",function(){S(e)})}).finally(i.hideLoading)})}):O.alert("Invalid Action","You are not allowed to perform delete"),!0},buttonClicked:function(t){return 0===t&&(E.data.currentDetails=e,o(function(){E.data.isInEditMode=!0,E.data.isFromPto=e.isPtoType,v()},200)),!0}})},onModalCancelClicked:function(){E.data.isInEditMode=!1,E.data.isFromPto=!1,E.data.currentDetails=null,E.data.addEditDetailsModal.hide()},onAddScheduleCompleted:function(e){E.data.timeCards.length!==e.timeCardDetails.length&&(E.data.approvalStatus=e.timeCardSummary.approveStatus||0),S(e),E.data.addEditDetailsModal.hide()},addTimeClick:function(e){return o(function(){E.data.isFromPto=e,E.data.isInEditMode=!1,E.data.currentDate=E.currentDate,v()},100),E.popover.hide(),!0},showPopoverClicked:function(e){E.popover.show(e)},clockOutClick:function(e,t){_.filter(E.data.timeCards,function(e){return null===e.finishTime&&e.jobCode!==I.CLOCK_IN}).length>0?O.confirm("Confirmation!","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(){o(function(){C(e,t)},10)}):O.confirm("Confirmation!","Are you sure?",function(){o(function(){C(e,t)},10)})},clockInClick:function(){var t=E.currentDate,n=new Date,o=h(new Date),a=h(t,n);E.data.errors=[];var r={startTime:f(o),jobCode:I.CLOCK_IN,numFromSummary:E.data.summary?E.data.summary.num:0,timeCardDate:f(a)};E.assgiendToSameUser||(r.timecardUserEmailDefined=!0,r.timecardUserEmail=$),i.showLoading().then(function(){u.clockInOutUser(r).then(function(t){null===t.errors?(E.data.clockInDateTime=o,E.data.isClockedIn=!0,E.data.disableClockOutButton=!1,E.data.addTimeVisibility=!0,E.data.ptoButtonVisibility=!1,e.$broadcast("$timecard.onClockedInCompleted",t),O.alert("Clocked In","Clocked in successfully",function(){S(t)})):E.errors=t.errors}).finally(function(){i.hideLoading()})})},onShowCalenderClick:function(e){angular.isDefined(E.data.calendar.control)&&E.data.calendar.control.show()},onCurrentDateChanged:function(){o(function(){T()},100)}},loading:!1,summary:null,isClockedIn:!1,isClockedOut:!1,clockInDateTime:new Date,clockOutDateTime:new Date,timecard:null,timeCards:[],approvalStatus:0,disableClockInButton:!1,disableClockOutButton:!1,currentClockedIn:null,allowSendForApproval:!1,totalTime:"",enableForCustomer:!1,ptoButtonVisibility:!1,isFromPto:!1,isInEditMode:!1,addEditDetailsModal:null,timeCardSummaryModal:null,currentDetails:null},t.$watch("vm.data.timeCards",function(e){angular.isDefined(e)&&y()},!0),E.$onChanges=function(){o(function(){k(!1)},100)},E.$onInit=function(){E.user=c.getLoggedInUserInfo(),P="workorder"===E.basedOn,E.canChangeTimecardDate="timecard"===E.basedOn,o(function(){k(!0)},100)},t.$on("$timecard.onclocked-out-fromHeader",function(e,t){o(function(){E.data.isClockedOut=!0,E.data.isClockedIn=!1,E.data.disableClockOutButton=!0,E.data.addTimeVisibility=!1,E.data.ptoButtonVisibility=!0,E.data.summary=t.timeCardSummary,S(t)},100)}),t.$on("$timecard.refreshTimecard.pushToTimecard",function(e,t){o(function(){k(!1)},100)}),t.$on("$workOrder.refreshTimecardUI",function(e,t){o(function(){T()},100)}),l.fromTemplateUrl("timecard-popover.html",{scope:t}).then(function(e){E.popover=e}),s.fromTemplateUrl("timecardDetailsModal.html",{scope:t,animation:"slide-in-up"}).then(function(e){E.data.addEditDetailsModal=e})}var t={bindings:{basedOn:"@",schedule:"<"},controller:e,controllerAs:"vm",templateUrl:"js/timecard/timecard.detail.component.html"};e.$inject=["$rootScope","$scope","$state","$timeout","work-orders-factory","fpm-utilities-factory","shared-data-factory","authenticationFactory","timecard-factory","$ionicPopover","$ionicModal","$ionicActionSheet"],angular.module("fpm").component("timecardDetails",t)}()}(),function(){"use strict";!function(){var e=angular.module("fpm");e.filter("totalTimeDiff",function(){return function(e){var t="0";if(e.length>0){var n=0;angular.forEach(e,function(o,a){if(o.finishTime&&(n+=moment(kendo.parseDate(o.finishTime)).diff(kendo.parseDate(o.startTime),"minutes")),a===e.length-1&&n>0){var i=Math.floor(n/60);return t=i+" hrs "+n%60+" min"}})}return t}}),e.filter("toTimeFormat",function(){return function(e){if(e){var t=e/60,n=Math.floor(t),o=60*(t-n);return n+":"+("0"+Math.round(o)).slice(-2)}return"0:00"}})}()}(),function(){"use strict";!function(){var e={bindings:{},controller:["$scope","$timeout","fpm-utilities-factory","customers-file-factory",function(e,t,n,o){function a(){o.addEditModal&&(o.addEditModal.hide(),o.addEditModal.remove(),o.addEditModal=null,o.selectedNote=null)}var i=this;i.notes=[],i.errors=[],i.noteModel={num:0,note:"",numFromCustomerFile:0},i.events={closeNotesModal:function(){a()},saveNote:function(e){e&&n.showLoading("Saving...").then(function(){o.addUpdateNote(i.noteModel).then(function(e){o.onAddEditNoteModalClosed(e),a()}).then(function(){n.hideLoading()})})}},i.$onInit=function(){i.modalTitle=null===o.selectedNote?"Add Note":"Edit Note",o.selectedNote?i.noteModel=angular.copy(o.selectedNote):i.noteModel.numFromCustomerFile=o.selectedCustomer.num}}],controllerAs:"vm",templateUrl:"js/customer/customer-note-add-modal/customer-note-add-modal.html"};angular.module("fpm").component("customerNoteAddModal",e)}()}(),function(){"use strict";!function(){var e={bindings:{displayName:"<",notesModal:"<"},controller:["$scope","$timeout","fpm-utilities-factory","customers-file-factory","authenticationFactory",function(e,t,n,o,a){function i(){o.addEditModal?o.addEditModal.show():n.getModal("customerAddNoteModal.html",e).then(function(e){o.addEditModal=e,o.addEditModal.show()})}function r(e){var t=_.filter(u.notes,function(t){return t.num===e.num});t.length>0?t[0].note=e.note:u.notes.push(e)}function c(){u.isRunning=!0,n.showLoading("Getting notes...").then(function(){o.getNotesByDisplayName(u.displayName).then(function(e){e&&(u.notes=e.notes,o.selectedCustomer=e.customer)}).finally(function(){u.isRunning=!1,n.hideLoading()})})}var u=this;u.notes=[],u.errors=[];var l=!1;u.isRunning=!1,u.upload={control:null,uploadImages:function(e,t){var a={extension:t};if(e&&e.length>0){var i=o.selectedCustomer.num,r=o.selectedNote,c=e[0];a.entityId=r.num,a.isWebRequest=!0,n.showLoading().then(function(){o.tryUploadFile([c],a,i).then(function(e){e&&(null!==r.notesImagesIds&&void 0!==r.notesImagesIds||(r.notesImagesIds=[]),r.notesImagesIds.push(e))}).finally(function(){n.hideLoading()})})}},options:{validation:{allowedExtensions:[".jpeg",".jpg",".png"]},multiple:!1,showFileList:!1,localization:{select:"Upload images"},select:function(e){if(e.isDefaultPrevented=!0,_.filter(e.files,function(e){return e.size>10485760}).length>0)return alerts.alert("Invalid Selection","Image size is too large to upload"),e.preventDefault(),!1;var t=e.files[0],n=t.extension;u.upload.uploadImages(e.files,n),e.preventDefault()}}},u.events={openAddNoteModal:function(){l=!1,o.selectedNote=null,i()},deleteNote:function(e,a){n.alerts.confirm("Confirmation","Are you sure you want to delete the note?",function(){n.showLoading("Deleting note...").then(function(){o.deleteNote(e.num).then(function(e){e&&t(function(){1===u.notes.length?u.notes=[]:u.notes.splice(a,1)},10)}).finally(function(){n.hideLoading()})})})},editNote:function(e){l=!0,o.selectedNote=e,i()},uploadImage:function(e){u.upload.control&&(o.selectedNote=e,u.upload.control.wrapper.find("#upload-notes-image").trigger("click"))},showAllAttachements:function(t){o.selectedNote=t,n.getModal("customerNotesAttachmentsModal.html",e).then(function(e){o.attachmentsModal=e,o.attachmentsModal.show()})},closeNotesModal:function(){u.notesModal&&u.notesModal.hide()}},u.$onInit=function(){c()},e.$on("$fp:onAddEditNoteModalClosed",function(e,n){n&&n.entity&&t(function(){r(n.entity)},10)})}],controllerAs:"vm",templateUrl:"js/customer/customer-notes-modal/customer-notes-modal.html"};angular.module("fpm").component("customerNotesModal",e)}()}(),function(){"use strict";!function(){var e={bindings:{displayName:"<"},templateUrl:"js/customer/display-name-component/display.name.component.html",controller:["$timeout","$scope","fpm-utilities-factory",function(e,t,n){var o=this;o.customerNotesModal=null,o.events={onDisplayNameLinkClicked:function(){o.customerNotesModal?o.customerNotesModal.show():n.getModal("customerNotesModal.html",t).then(function(e){o.customerNotesModal=e,o.customerNotesModal.show()})}},o.$onInit=function(){},t.$on("$destroy",function(){o.customerNotesModal&&o.customerNotesModal.remove()})}],controllerAs:"vm"};angular.module("fpm").component("displayName",e)}()}(),function(){"use strict";!function(){var e={controller:["customers-file-factory",function(e){var t=this;t.note=null,t.errors=[],t.events={onImageClicked:function(e){},closeNotesModal:function(){e.attachmentsModal&&(e.attachmentsModal.hide(),e.attachmentsModal.remove())}},t.$onInit=function(){t.note=e.selectedNote}}],controllerAs:"vm",templateUrl:"js/customer/note-images-modal/note.images.modal.html"};angular.module("fpm").component("customerNotesImagesModal",e)}()}(),function(){"use strict";!function(){var e={bindings:{onScanned:"&",buttonLabel:"@"},template:'<button class="button button-default button-small" ng-click="vm.doScan()">{{vm.buttonLabel}}</button>',controller:["$cordovaBarcodeScanner",function(e){var t=this;t.doScan=function(){e.scan({disableAnimations:!0}).then(function(e){e&&e.text&&angular.isFunction(t.onScanned)&&t.onScanned({skuCode:e.text})})}}],controllerAs:"vm"};angular.module("fpm").component("scanner",e)}()}();