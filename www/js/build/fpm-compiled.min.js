!function(){"use strict";!function(){function e(e,t,n,o,a,i,r,u){function c(e){angular.forEach(e,function(e){var t=kendo.parseDate(e.scheduledStartDateTime),n=kendo.parseDate(e.scheduledFinishDateTime);t&&n&&f.calendar.events.push({startTime:t,endTime:n,allDay:!1,title:e.barcodeName+" (Estimate)",originalObject:angular.copy(e),eventType:2})})}function s(e){angular.forEach(e,function(e){var t=kendo.parseDate(e.scheduledStartDateTime),n=kendo.parseDate(e.scheduledFinishDateTime);t&&n&&f.calendar.events.push({startTime:t,endTime:n,allDay:!1,title:e.barcodeName+" (Schedule)",originalObject:angular.copy(e),eventType:1})})}function l(e){angular.forEach(e,function(e){var t=kendo.parseDate(e.cacationDate),n=kendo.parseDate(e.vacationDate);e.endDateTime&&(n=kendo.parseDate(e.endDateTime)),t&&n&&f.calendar.events.push({startTime:t,endTime:n,allDay:e.isAllDay,title:e.vacationString,originalObject:angular.copy(e),eventType:3})})}function d(e){f.calendar.events=[],i.showLoading().then(function(){u.getDatewiseEvents(e).then(function(e){e&&(e.estimates.length>0&&c(e.estimates),e.schedules.length>0&&s(e.schedules),e.vacations.length>0&&l(e.vacations))}).finally(i.hideLoading)})}function m(){var e=a.get(p.settingsKeyName);e&&e.DefaultCalenderViewForMobile&&("workWeek"===e.DefaultCalenderViewForMobile?f.events.changeMode("week"):f.events.changeMode(e.DefaultCalenderViewForMobile)),d(!1)}var f=this,p=r.localStorageKeys;f.calendar={mode:"day",events:[],noEventLabel:"No Schedules Found",currentDate:new Date},f.viewTitle="Calendar";i.alerts;f.events={onTimeSelected:function(e,t){},onEventSelected:function(e){if(1===e.eventType){var n=e.originalObject;i.alerts.confirm("Confirmation","Are you sure to edit this work order?",function(){t.go("app.editOrder",{barCode:n.barcode,technicianNum:n.num,src:"calender"})})}},today:function(){f.calendar.currentDate=new Date},changeMode:function(e){f.calendar.mode=e},onViewTitleChanged:function(e){f.viewTitle=e},refreshOnPullDown:function(){d(!0)},showActionSheet:function(){o.show({buttons:[{text:"Work Week View"},{text:"Day View"},{text:"Month View"},{text:"Refresh Calender"}],titleText:"Calendar Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&f.events.changeMode("week"),1===e&&f.events.changeMode("day"),2===e&&f.events.changeMode("month"),3===e&&d(!0),!0}})}},e.$on("$ionicView.afterEnter",function(e,t){m()})}e.$inject=["$scope","$state","$timeout","$ionicActionSheet","localStorageService","fpm-utilities-factory","fieldPromaxConfig","work-orders-factory"],angular.module("fpm").controller("calendar-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i){function r(){t.go("app.dashboard")}function u(e){e?i.alerts.confirm("Confirmation","Are you sure?",function(){r()}):r()}function c(e){d.errors=[],e?i.showLoading().then(function(){o.createCustomer(d.customerModel).then(function(e){angular.isArray(e.errors)&&e.errors.length>0?d.errors=e.errors:i.alerts.alert("Success","Customer create successfully",function(){r()})}).finally(i.hideLoading)}):d.errors.push("Please check all values before save")}function s(){n.show({buttons:[{text:"Same as Business Address"},{text:"Clear Address"}],titleText:"Service Address Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&(d.customerModel.sStreet=d.customerModel.bStreet,d.customerModel.sState=d.customerModel.bState,d.customerModel.sCity=d.customerModel.bCity,d.customerModel.sZip=d.customerModel.bZip),1===e&&(d.customerModel.sStreet="",d.customerModel.sState="",d.customerModel.sCity="",d.customerModel.sZip=""),!0}})}function l(){d.customerModel=angular.copy(m)}var d=this,m={displayName:"",firstName:"",lastName:"",companyName:"",email:"",phone:"",mobile:"",fax:"",bStreet:"",bCity:"",bState:"",bZip:"",sStreet:"",sCity:"",sState:"",sZip:"",uinNum:""};d.errors=[],d.events={onBackToDashboardClicked:u,onSubmitButtonClicked:c,onServiceAddressActionClicked:s},e.$on("$ionicView.afterEnter",function(e,t){l()})}e.$inject=["$scope","$state","$ionicActionSheet","customers-file-factory","localStorageService","fpm-utilities-factory"],angular.module("fpm").controller("create-customer-controller",e)}()}(),function(){"use strict";!function(){function e(e,t){function n(t){return e.get(a+"SearchCustomers?searchPattern="+t)}function o(t){return e.post(a+"CreateCustomer?fromMobile=true",t)}var a="api/CustomerFile/";return{createCustomer:o,searchCustomers:n}}e.$inject=["api-base-factory","fieldPromaxConfig"],angular.module("fpm").factory("customers-file-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{onCustomerSelected:"&"},controller:["$scope","$ionicModal","customers-file-factory",function(e,t,n){function o(){u.searchValue="",u.customers=[],u.customerModal.show()}function a(){n.searchCustomers(u.searchValue).then(function(e){u.customers=e})}function i(){u.searchValue="",u.customers=[],u.customerModal.hide()}function r(e){u.customerModal.hide(),angular.isFunction(u.onCustomerSelected)&&u.onCustomerSelected({customer:e}),console.log(e)}var u=this;u.searchValue="",u.events={onSearchBoxTapped:o,applySearch:a,closeSearchModal:i,onCustomerSelected:r},t.fromTemplateUrl("customerSearchModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){u.customerModal=e})}],controllerAs:"vm",templateUrl:"js/customer/customer-search-header-component-template.html",replace:!0};angular.module("fpm").component("customerSearchHeaderComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r,u,c,s){function l(){y=[],g.isServiceProvider===!1?angular.forEach(g.result,function(e,t){e.dataForAdministrator&&e.dataForAdministrator.length>0&&_.forEach(e.dataForAdministrator,function(e){e.ordersJson&&_.forEach(JSON.parse(e.ordersJson),function(e){y.push(e)})})}):angular.forEach(g.result,function(e,t){e.dataForServiceProvider&&e.dataForServiceProvider.length>0&&_.forEach(e.dataForServiceProvider,function(e){y.push(e)})})}function d(e,t){a.getMobileDashboard(e).then(function(e){g.result=e.result,l()}).finally(function(){angular.isFunction(t)&&t()})}function m(e){C.confirm("Confirmation!","Your status has been updated to In Route",function(){c.showLoading().then(function(){a.updateJobStatus({scheduleButton:w.InRoute,scheduleNum:e.TechnicianScheduleNum,barcode:e.Barcode}).then(function(){e.InRoute=!0}).finally(function(){c.hideLoading(),v.enabled===!0&&p()})})})}function f(e){var t=_.where(v.currentDetails,{finishTime:null});t.length>0?C.confirm("Confirmation","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(){m(e)}):m(e)}function p(){var e={CLOCK_IN:5001,CLOCK_OUT:5002},t=new Date,n=kendo.toString(new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),"g");u.getTimeCardByDate(n).then(function(t){t&&(v.todaysClockIns=_.where(t.timeCardDetails,{jobCode:e.CLOCK_IN}),v.currentDetails=_.reject(t.timeCardDetails,{jobCode:e.CLOCK_IN}))})}function h(){v.enabled=g.userInfo.timeCard||!1,g.havingGroupsAssigned=g.userInfo.havingGroupsAssigned,g.isServiceProvider=!g.userInfo.isAdminstrator,v.enabled===!0&&p(),g.isServiceProvider&&(b="barcodeName"),i.getIniitialData().then(function(e){g.trackJobStatus=e.customerNumberEntity.trackJobStatus||!1}).finally(function(){d(!1)})}var g=this;g.userInfo=r.getLoggedInUserInfo();var y=[],v={enabled:!1,clockedInInfo:null,currentDetails:[],todaysClockIns:[]},C=c.alerts,w={AcceptJob:0,InRoute:1,CheckIn:3,CheckOut:4};g.isSearchModalOpened=!1;var D=null;g.events={inRouteClicked:function(e){if(v.enabled===!1)m(e);else{var n=_.findWhere(v.todaysClockIns,{finishTime:null});angular.isDefined(n)?f(e):C.confirm("Warning!","You have not Clocked-In yet. Would you like to Clock-In now?",function(){t.go("app.timecard",{proute:t.current.name})})}},onSearchItemClick:function(e){e&&(g.matchedOrders=[],g.isSearchModalOpened=!1,g.searchModal.hide(),g.searchValue="",D=g.isServiceProvider?n(function(){t.go("app.editOrder",{barCode:e.barcode,technicianNum:e.technicianScheduleNum,src:"main"})},300):n(function(){t.go("app.editOrder",{barCode:e.Barcode,technicianNum:e.TechnicianScheduleNum,src:"main"})},300))},applySearch:function(){var e=g.searchValue.toLowerCase(),t=_.filter(y,function(t){return t[b].indexOf(e)>-1});g.matchedOrders=_.uniq(t,function(e,t,n){return e[b]})},closeSearchModal:function(){g.matchedOrders=[],g.isSearchModalOpened=!1,g.searchModal.hide(),g.searchValue=""},openSearchModal:function(){g.searchValue="",g.matchedOrders=[],g.isSearchModalOpened=!0,g.searchModal.show()},refreshOnPullDown:function(){d(!0,function(){e.$broadcast("scroll.refreshComplete")})},onChildGroupClicked:function(e,t,n){e.isOpen=!e.isOpen;var o=s.get("orderState");return null===o&&(o={}),"DD"===t?(e.isOpen===!0?(o[n]=e,s.set("orderState",o)):s.set("orderState",null),!1):void(e.isOpen===!0&&0===e.clickCount?(o[n]=e,s.set("orderState",o),"SP"===t?e.dataForServiceProvider=JSON.parse(e.ordersJson):e.ordersN=JSON.parse(e.ordersJson),e.clickCount+=1):(o[n]=null,s.set("orderState",o)))}},e.$on("$ionicView.loaded",function(e,t){h()}),g.havingGroupsAssigned=!1;var b="BarcodeName";e.$on("$destroy",function(){g.searchModal.remove(),D&&n.cancel(D)}),o.fromTemplateUrl("dashboardSearchModal.html",{scope:e,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){g.searchModal=e})}e.$inject=["$scope","$state","$timeout","$ionicModal","work-orders-factory","shared-data-factory","authenticationFactory","timecard-factory","fpm-utilities-factory","localStorageService"],angular.module("fpm").controller("dashboard-controller",e)}()}(),function(){"use strict";!function(){function e(e){function t(){return e.get(n+"GetValues")}var n="api/workorders/",o={testCall:t};return o}e.$inject=["api-base-factory"],angular.module("fpm").factory("dashboard-factory",e)}()}(),function(){"use strict";!function(){angular.module("fpm").component("workorderViewComponent",{bindings:{odr:"<",trackJobStatus:"<",userInfo:"<",inRouteClicked:"&"},controller:["$state","fpm-utilities-factory","work-orders-factory",function(e,t,n){var o={AcceptJob:0,InRoute:1,CheckIn:3,CheckOut:4},a=this;a.events={acceptJob:function(){t.alerts.confirm("Confirmation!","Are you sure you want to accept this job?",function(){t.showLoading().then(function(){n.updateJobStatus({scheduleButton:o.AcceptJob,scheduleNum:a.odr.TechnicianScheduleNum}).then(function(){a.odr.JobAcceptanceStatus=!0}).finally(t.hideLoading)})})},inRouteClicked:function(){angular.isFunction(a.inRouteClicked)&&a.inRouteClicked({odr:a.odr})},onOrderClicked:function(){a.odr&&e.go("app.editOrder",{barCode:a.odr.Barcode,technicianNum:a.odr.TechnicianScheduleNum,src:"main"})}},a.$onInit=function(){}}],controllerAs:"vm",templateUrl:"js/dashboard/workorder-view-component-template.html"})}()}(),function(){"use strict";!function(){angular.module("fpm").component("equipmentCustomTypeListComponent",{bindings:{barcode:"<",entityId:"<"},controller:["equipment-factory","custom-types-factory",function(e,t){function n(){a.customTypes.data=[],a.factory.viewDataForEquipment=[],angular.isDefined(a.entityId)&&angular.isDefined(a.barcode)&&e.getEquipmentFields(a.entityId,a.barcode).then(function(e){if(e&&e.length>0){var t=_.where(e,{type:3});angular.forEach(t,function(e){e.value="true"===e.value||"True"===e.value||"1"===e.value}),a.customTypes.data=e,a.factory.viewDataForEquipment=a.customTypes.data}})}function o(t){var n=!1;3===t.type&&(n=t.value===!0),4===t.type&&(t.value=kendo.toString(kendo.parseDate(t.value),"g")),e.saveDataCustomTypes({num:a.entityId,barcode:a.barcode,customTypesJson:JSON.stringify(a.customTypes.data)})}var a=this;a.factory=t,a.customTypes={data:[]};var i=0;a.events={onValueChanged:function(e){4===e.type?0===i?(o(e),i++):i=0:o(e)}},a.$onChanges=function(){a.entityId&&n()},a.$onInit=function(){a.entityId&&n()}}],controllerAs:"vm",templateUrl:"js/equipments/equipment-custom-type-list-component-template.html"})}()}(),function(){"use strict";!function(){function e(e){function t(t,n,o,a){return e.post(h+"CreateEquipment?uin="+t+"&barcode="+o+"&attach="+a,n)}function n(){return e.get(h+"GetEquipmentList")}function o(t){return e.post(h+"AddMaintenanceNote",t)}function a(t){return e.deleteApiCall(h+"DeleteEquipment?id="+t)}function i(t){return e.get(h+"GetEquipmentNotes?id="+t)}function r(t){return e.deleteApiCall(h+"DeleteNote?num="+t)}function u(t){return e.get(h+"GetEquipmentsByUin?uin="+t)}function c(t,n){return e.get(h+"AttachEquipToBarcode?barcode="+t+"&equipNum="+n)}function s(t,n){return e.get(h+"UnattachEquipToBarcode?barcode="+t+"&equipNum="+n)}function l(t){return e.get(h+"GetBarcodeEquipments?barcode="+t)}function d(t,n){return e.get(h+"GetEquipmentFields?barcode="+n+"&num="+t)}function m(t){return e.post(h+"SaveDataCustomTypes",t)}function f(t){return e.get(h+"GetEquipmentHistory?id="+t)}var p={},h="api/equipment/";return p.createNewEquipment=t,p.getEquipments=n,p.addMaintenanceNote=o,p.deleteEquipment=a,p.getEquipmentNotes=i,p.deleteNote=r,p.getEquipmentsByUin=u,p.attachEquipToBarcode=c,p.unattachEquipToBarcode=s,p.getBarcodeEquipments=l,p.getEquipmentFields=d,p.saveDataCustomTypes=m,p.getEquipmentHistory=f,p}e.$inject=["api-base-factory"],angular.module("fpm").factory("equipment-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",uin:"<",displayName:"<"},controller:["$scope","$ionicActionSheet","equipment-factory","shared-data-factory","custom-types-factory","authenticationFactory","fpm-utilities-factory",function(e,t,n,o,a,i,r){function u(e,t){if(t===!0){var o=f.customTypesFactory.viewDataForEquipment;if(angular.isArray(o)&&o.length>0){r.showLoading();var a=_.where(o,{type:4});angular.isArray(a)&&angular.forEach(a,function(e){e.value&&(e.value=kendo.toString(kendo.parseDate(e.value),"d"))});var i=JSON.stringify(o);f.view.currentEquip?n.saveDataCustomTypes({num:f.view.currentEquip.num,barcode:f.barcode,customTypesJson:i}).then(function(){f.view.currentActiveIndex=e,f.view.currentEquip=f.view.barcodeEquipments[e]}).finally(r.hideLoading):(f.view.currentActiveIndex=e,f.view.currentEquip=f.view.barcodeEquipments[e])}else f.view.currentActiveIndex=e,f.view.currentEquip=f.view.barcodeEquipments[e]}else f.view.currentActiveIndex=e,f.view.currentEquip=f.view.barcodeEquipments[e]}function c(e,t){e===!0&&(f.view.currentActiveIndex=-1,f.view.currentEquip=null,f.view.notes=[]),f.view.gettingEquipements=!0,f.view.barcodeEquipments=[],r.showLoading().then(function(){n.getBarcodeEquipments(f.barcode).then(function(e){f.view.gettingEquipements=!1,angular.isArray(e)?(f.view.barcodeEquipments=e,1===f.view.barcodeEquipments.length?u(0,t):f.view.currentActiveIndex===-1?u(0,t):u(f.view.currentActiveIndex,t)):(f.view.currentActiveIndex=-1,f.view.currentEquip=null)}).finally(r.hideLoading)})}function s(){0===f.view.equipments.length?r.showLoading().then(function(){n.getEquipmentsByUin(f.uin).then(function(t){return t&&angular.isArray(t)&&0===t.length?void r.hideLoading():(f.view.equipments=t,void r.getModal("attachEquipmentModal.html",e).then(function(e){f.view.attachEquipmentsModal=e,f.view.attachEquipmentsModal.show()}))}).finally(r.hideLoading)}):null===f.view.attachEquipmentsModal?r.getModal("attachEquipmentModal.html",e).then(function(e){f.view.attachEquipmentsModal=e,f.view.attachEquipmentsModal.show()}):f.view.attachEquipmentsModal.show()}function l(){if(f.view.currentEquip){var e=angular.copy(f.view.currentEquip);p.confirm("Confirmation!","Are you sure?",function(){r.showLoading().then(function(){n.unattachEquipToBarcode(f.barcode,e.num).then(function(e){e===!0&&p.alert("Success","Equipment unattached successfully",function(){c(!0,!1)})}).finally(r.hideLoading)})})}}function d(){f.uiResult=[],f.view.currentEquip&&(null===f.view.equipmentHistoryModal&&r.getModal("equipmentHistoryModal.html",e).then(function(e){f.view.equipmentHistoryModal=e}),r.showLoading().then(function(){n.getEquipmentHistory(f.view.currentEquip.num).then(function(e){e&&(f.result=e,f.result.barcodes.length>0&&angular.forEach(f.result.barcodes,function(e){var t=_.filter(f.result.fields,function(t){return e.num===parseInt(t.entityKey,10)});t.length>0&&f.uiResult.push({barcodeView:e,fields:t})}))}).finally(function(){f.view.equipmentHistoryModal.show(),r.hideLoading()})}))}function m(){f.view.errors=[],f.view.newEquipmentEntity=angular.copy(h),null===f.view.newEquipmentModal?r.getModal("newEquipmentModal.html",e).then(function(e){f.view.newEquipmentModal=e,f.view.newEquipmentModal.show()}):f.view.newEquipmentModal.show()}var f=this;f.customTypesFactory=a,f.userInfo=null;var p=r.alerts;f.view={currentActiveIndex:-1,currentEquip:null,barcodeEquipments:[],notes:[],gettingEquipements:!0,attachEquipmentsModal:null,equipments:[],newEquipmentModal:null,newEquipmentEntity:null,equipmentHistoryModal:null};var h={num:0,displayName:f.displayName,numFromCustomerFile:0,equipmentNumber:"",description:"",uin:f.uin,customTypesJson:""},g=[{EntityId:0,EntityType:101,UIOrder:1,Title:"Maintenance Note",Type:6},{EntityId:0,EntityType:101,UIOrder:2,Title:"Performed Date",Type:4}];f.events={closeHistoryModal:function(){f.view.equipmentHistoryModal&&f.view.equipmentHistoryModal.hide()},createEquipmentSubmit:function(e,t){f.view.errors=[];var o=0!==f.view.newEquipmentEntity.num;0===f.view.newEquipmentEntity.num&&(f.view.newEquipmentEntity.customTypesJson=JSON.stringify(g)),r.showLoading("creating equipment..").then(function(){n.createNewEquipment(f.uin,f.view.newEquipmentEntity,f.barcode,t).then(function(e){null!=e&&angular.isArray(e)?f.data.errors=e:p.alert("Success!","Equipment "+(o?"updated":"created")+" successfully",function(){f.view.newEquipmentModal.hide(),c(!1)})}).finally(r.hideLoading)})},closeNewEquipmentModal:function(){f.view.newEquipmentModal&&f.view.newEquipmentModal.hide()},closeEquipmentAttachModal:function(){f.view.attachEquipmentsModal.hide()},onAttachEquipmentItemClicked:function(e){f.view.errors=[],r.showLoading().then(function(){n.attachEquipToBarcode(f.barcode,e.num).then(function(e){null!==e&&angular.isArray(e)?f.view.errors=e:p.alert("Success","Equipment attached to work order successfully.",function(){c(!1,!0)})}).finally(r.hideLoading)})},onActionDotsClicked:function(){t.show({buttons:[{text:"Attach Equipment"},{text:"Unattach Equipment"},{text:"Show Maintenance History"},{text:"Create New Equipment"}],titleText:"Equipment Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&s(),1===e&&l(),2===e&&d(),3===e&&m(),!0}})},onEquimentNextPreButtonClicked:function(e){var t=f.view.currentActiveIndex;t=e===!0?t+1:t-1,t>f.view.barcodeEquipments.length-1&&(t=0),t<0&&(t=f.view.barcodeEquipments.length-1),u(t,!0)}},f.$onInit=function(){f.userInfo=i.getLoggedInUserInfo(),c()},f.$onDestroy=function(){f.view.attachEquipmentsModal=null}}],controllerAs:"vm",templateUrl:"js/equipments/equipments-list-component-template.html"};angular.module("fpm").component("equipmentsListComponent",e)}()}(),function(){"use strict";!function(){function e(e){}e.$inject=["$scope"],angular.module("fpm").controller("create-estimate-controller",e)}()}(),function(){"use strict";!function(){angular.module("fpm").component("expanseExpanderComponent",{bindings:{barcode:"<"},controller:["$scope",function(e){}],controllerAs:"vm",templateUrl:"js/expanses/expanse-expander-component-template.html"})}()}(),function(){"use strict";!function(){angular.module("fpm").component("expanseItem",{bindings:{item:"<"},controller:["$scope",function(){}],controllerAs:"vm",templateUrl:"js/expanses/expanse-item-template.html"})}()}(),function(){"use strict";!function(){angular.module("fpm").component("expanseListComponent",{bindings:{barcode:"<",refresher:"<"},controller:["$scope","$ionicActionSheet","expense-data-factory","fpm-utilities-factory",function(e,t,n,o){function a(e){h.requestCompleted=!1,o.showLoading().then(function(){n.getExpense(h.barcode||"",!0).then(function(e){h.expanses=e,h.paid=_.filter(e,function(e){return 1==e.expenseStatus}),h.unpaid=_.filter(e,function(e){return 0==e.expenseStatus}),h.requestCompleted=!0}).finally(function(){angular.isFunction(e)&&e(),o.hideLoading()})})}function i(){a()}function r(e,t,a){g.confirmDelete(function(){o.showLoading().then(function(){n.deleteExpense(e.expenseId).then(function(e){e===!0&&g.alert("Deleted","Expense deleted successfully",function(){h.expanses.splice(t,1)})}).finally(o.hideLoading)})})}function u(t){null===h.modal?o.getModal("expenseModal.html",e).then(function(e){h.modal=e,h.entity=angular.copy(t),0!==t.expenseId?(h.entity.isReimbursable=0===t.expenseType,h.entity.havingImage=null!==t.imageName):h.entity.havingImage=!1,h.modal.show()}):(h.entity=angular.copy(t),0!==t.expenseId?(h.entity.isReimbursable=0===t.expenseType,h.entity.havingImage=null!==t.imageName):h.entity.havingImage=!1,h.modal.show())}function c(e){var t=angular.copy(e);t.isReimbursable=!1,u(t)}function s(){u(angular.copy(y))}function l(){t.show({buttons:[{text:"Add New Expanse"}],titleText:"Expanse",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&s(),!0}})}function d(e,t){h.entity.imageChanged=!0,h.entity.imageModel={image:e,name:t}}function m(){h.modal.hide()}function f(e){h.errors=[],e===!0?(h.entity.expenseType=h.entity.isReimbursable===!0?0:1,h.entity.expenseDate=kendo.toString(kendo.parseDate(h.entity.expenseDate),"g"),o.showLoading().then(function(){n.addExpense(h.entity).then(function(e){e&&(h.modal.hide(),a(o.hideLoading))})})):h.errors.push("Invalid Save: Please check all values before save")}function p(){a(function(){e.$broadcast("scroll.refreshComplete")})}var h=this;h.paid=[],h.unpaid=[],h.expanses=[],h.modal=null;var g=o.alerts,y={expenseId:0,title:"",description:"",expenseType:0,expenseStatus:0,totalCost:0,barcode:h.barcode,expenseDate:new Date,quantity:1,imageChanged:!1,havingImage:!1,isReimbursable:!1};h.image={name:"",visible:!1},h.requestCompleted=!1,h.upload={control:null,config:{multiple:!1,showFileList:!1,localization:{select:"upload the receipt"},select:function(t){t.isDefaultPrevented=!0;var n=["tif","tiff","gif","jpeg","jpg","jif","jfif","jp2","jpx","j2k","j2c","pcd","png","bmp"],o=t.files[0].name.split("."),a=o.reverse();if(t.files[0].size>20971520)return void g.alert("Warning","This file is too big.Max size is 20 MB");if(e.$apply(function(){h.image.name=t.files[0].name,h.image.visible=!0}),$.inArray(a[0].toLowerCase(),n)<0)return void g.alert("Warning","Invalid image file extension ( ."+a[0]+" ). Please upload only image file.");console.log("e",t);var i=new FileReader;i.onload=function(e){var n=e.target.result;d(n,t.files[0].name)},i.readAsDataURL(t.files[0].rawFile)}}},h.errors=[],h.events={refreshOnPullDown:p,onSubmitClicked:f,closeModal:m,onActionDotsClicked:l,onDeleteClicked:r,onEditClicked:c},h.$onInit=function(){i()}}],controllerAs:"vm",templateUrl:"js/expanses/expanse-list-component-template.html"})}()}(),function(){"use strict";!function(){function e(e){}e.$inject=["$scope"],angular.module("fpm").controller("expanses-controller",e)}()}(),function(){"use strict";!function(){function e(e){function t(t,n){return e.get(r+"GetExpense?barcode="+t+"&isFromMain="+n)}function n(t){return e.post(r+"AddExpense",t)}function o(t){return e.deleteReq(r+"DeleteExpense?id="+t)}function a(t){return e.get(r+"MarkAsPaidUnPaid?id="+t)}function i(t){return e.deleteReq(r+"DeleteImage?expenseId="+t)}var r="api/expense/",u={};return u.markAsPaidUnPaid=a,u.deleteExpense=o,u.addExpense=n,u.getExpense=t,u.deleteImage=i,u}e.$inject=["api-base-factory"],angular.module("fpm").factory("expense-data-factory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r){var u=this,c=(a.secLevels,r.getLoggedInUserInfo()),s=i.get("configurations");u.sideMenuItems=[{title:"Home",state:"app.dashboard",icon:"home"},{title:"Calendar",state:"app.calendar",icon:"calendar"},{title:"Map",state:"app.map",icon:"location"},{title:"Create Work Order",state:"app.createWorkOrder",icon:"plus-round",isConfigurationBased:!0,configProperty:"allowCreateWorkOrders"},{title:"Create Customer",state:"app.createCustomer",icon:"plus-round"},{title:"My Expense",state:"app.expense",icon:"cash",basedOn:"etOn",specialFeature:!0},{title:"Time Card",state:"app.timecard",icon:"clock",basedOn:"timeCard",specialFeature:!0},{title:"Settings",state:"app.settings",icon:"settings"},{title:"Change Password",state:"app.changePassword",icon:""},{title:"Logout",state:"app.logout",icon:"power"}],e.$on("$ionicView.beforeEnter",function(e,t){n.showBackButton(!1)}),u.events={checkMenuItemVisibility:function(e){if(angular.isDefined(e.basedOn)){var t=c[e.basedOn];return t}if(c.isAdministrator)return!0;if(angular.isDefined(e.isConfigurationBased)&&e.isConfigurationBased===!0&&s&&angular.isDefined(e.configProperty)){var n=s[e.configProperty];return n}return!0},onMenuItemClicked:function(e){o.go(e.state)},toggleLeft:function(){}}}e.$inject=["$scope","$ionicSideMenuDelegate","$ionicNavBarDelegate","$state","fieldPromaxConfig","localStorageService","authenticationFactory"],angular.module("fpm").controller("app-main-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r,u){var c=this;c.user={userName:"",password:""},c.showError=!1,c.data={model:""};var s=u.alerts;c.events={onForgotPasswordClicked:function(){c.forgotPasswordModalErrors=[];var t=n.show({templateUrl:"forgotPasswordModal.html",title:"Forgot Password",subTitle:"Please enter your registered email address",scope:e,buttons:[{text:"Cancel"},{text:"Send password",type:"button-positive",onTap:function(e){return c.data.model?c.data.model:(c.forgotPasswordModalErrors.push("please check the entered email"),void e.preventDefault())}}]});t.then(function(e){c.forgotPasswordModalErrors=[],c.showError=!1,a.sendPassword(e).then(function(e){angular.isArray(e)&&e.length>0&&(c.forgotPasswordModalErrors=e,c.showError=!0)})})},loginClick:function(e){return c.showError=!1,c.errors=[],e?void o.show({template:"authenticating you..."}).then(function(){a.login(c.user).then(function(e){o.hide().then(function(){e&&a.authentication.isAuth&&i.go("app.dashboard")})},function(e){o.hide(),c.showError=!0,e.error?c.errors=[e.error]:c.errors=["Invalid Email or Password"]})}):(s.alert("Oops","Please enter login information..."),!1)}}}e.$inject=["$scope","$ionicScrollDelegate","$ionicPopup","$ionicLoading","authenticationFactory","$state","dashboard-factory","fpm-utilities-factory"],angular.module("fpm").controller("login-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(){n.logout(),t.go("login")}o(),console.log("HELLO WORLD")}e.$inject=["$scope","$state","authenticationFactory"],angular.module("fpm").controller("logout-controller",e)}()}(),function(){"use strict";!function(){function e(e){var t=this;t.heading="HELLLO WORLD FROM IONIC"}e.$inject=["$scope"],angular.module("fpm").controller("main-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){return{link:function(o,a,i){var r=n.secLevels,u=e.getLoggedInUserInfo();if(angular.isDefined(o.basedOn)){a.hide();var c=u[o.basedOn];c===!0&&a.show()}else if(o.isConfigurationBased===!1&&o.hideFor===u.secLevel&&a.hide(),o.isConfigurationBased===!0&&u.secLevel===r.ServiceProvider){var s=t.get("configurations");if(s){var l=s[o.configProperty];l===!0?a.show():a.hide()}}},restrict:"A",scope:{isConfigurationBased:"=",configProperty:"=",hideFor:"=",basedOn:"="}}}e.$inject=["authenticationFactory","localStorageService","fieldPromaxConfig"],angular.module("fpm").directive("setElementVisibilityForRole",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",jobtype:"<"},controller:["$scope","$timeout","custom-types-factory",function(e,t,n){function o(e,t){var o=angular.copy(e),i=!1;t&&o.value&&(o.value=kendo.toString(kendo.parseDate(e.value),"g")),3===e.type&&(i=e.value),o.dataEntityType=1,o.entityKey=a.barcode,n.updateData(o,i).then(function(t){t&&(e.id=t.id)})}var a=this;a.factory=n;var i=n.controlTypes;a.isExpanded=!1;var r=0;a.customTypes={data:[]},a.events={onValueChanged:function(e){4===e.type?0===r?(o(e,!0),r++):r=0:o(e)}},a.$onInit=function(){return a.customTypes.data=[],a.factory.viewData=[],a.factory.requestDataCompleted=!1,null===a.jobtype?void(a.factory.requestDataCompleted=!0):void n.getCustomTypesDataByBarcode(a.barcode,a.jobtype).then(function(e){if(e&&e.length>0){var t=_.where(e,{type:i.CHECKBOX});angular.forEach(t,function(e){e.value="true"===e.value||"True"===e.value||"1"===e.value}),a.customTypes.data=e,a.factory.viewData=a.customTypes.data}a.factory.requestDataCompleted=!0})}}],controllerAs:"vm",templateUrl:"js/jobtype-list/jobtype-list-component-template.html"};angular.module("fpm").component("jobtypeListComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{ctEntity:"="},controller:["$scope","$stateParams","$timeout","custom-types-factory","fpm-utilities-factory",function(e,t,n,o,a){function i(e,i){r.entity.imageModel={Image:e,Name:i},r.entity.view=r.ctEntity,r.entity.view.entityKey=t.barCode,r.ctEntity.value=i,o.uploadFile(r.entity).then(function(e){n(function(){r.ctEntity=e,r.showImageUpload=!1},100),u.alert("Uploaded","File uploaded successfully")}).finally(a.hideLoading)}var r=this;r.entity={},console.log("vm.ctEntity.value",r.ctEntity.value),r.showImageUpload=null===r.ctEntity.value;var u=a.alerts;r.events={showImageClick:function(){}},r.imageUploader={control:null,config:{select:function(e){e.isDefaultPrevented=!0,a.showLoading();var t=["tif","tiff","gif","jpeg","jpg","jif","jfif","jp2","jpx","j2k","j2c","pcd","png","bmp"],n=e.files[0].name.split("."),o=n.reverse();if(e.files[0].size>10485760)return a.hideLoading(),void u.alert("Warning","This file is too big. Max size is 10 MB");if($.inArray(o[0].toLowerCase(),t)<0)return a.hideLoading(),void u.alert("Warning","Invalid image file extension ( ."+o[0]+" ). Please upload only image file.");var r=new FileReader;r.onload=function(t){var n=t.target.result;i(n,e.files[0].name)},r.readAsDataURL(e.files[0].rawFile)},showFileList:!1,localization:{select:"upload image"},multiple:!1}}}],controllerAs:"vm",templateUrl:"js/jobtype-list/jobtype-upload-component-template.html"};angular.module("fpm").component("jobtypeUploadComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function a(e){i.errors=[],o.showLoading().then(function(){n.changePassword(i.model).then(function(e){e.ok===!0?o.alerts.alert("Success",e.msg,function(){n.logout(),t.go("login")}):i.errors.push(e.msg)}).finally(o.hideLoading)})}var i=this;i.errors=[],i.model={oldPassword:"",newPassword:"",confirmPassword:""},i.events={onChangePasswordClicked:a}}e.$inject=["$scope","$state","authenticationFactory","fpm-utilities-factory"],angular.module("fpm").controller("change-password-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i){function r(){var e=n.get(o.localStorageKeys.settingsKeyName);e&&(u.userSettings.defaultCalenderViewForMobile=e.DefaultCalenderViewForMobile||"workWeek",u.userSettings.startupPageForMobile=e.StartupPageForMobile||states.todaysWorkOrders,u.userSettings.pushNotifications=e.PushNotifications||!1,u.userSettings.locationServices=e.LocationServices||!1)}var u=this;u.userSettings={defaultCalenderViewForMobile:"workWeek",pushNotifications:!1,locationServices:!1},u.events={updateSettings:function(){i.showLoading().then(function(){a.updateSettings(u.userSettings).then(function(e){i.alerts.alert("Saved","Settings updated successfully",function(){n.set(o.localStorageKeys.settingsKeyName,JSON.parse(e))})}).finally(i.hideLoading)})}},r()}e.$inject=["$scope","$state","localStorageService","fieldPromaxConfig","shared-data-factory","fpm-utilities-factory"],angular.module("fpm").controller("settings-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(o,a,i){function r(e,t,n,o){return c.resolve(e)}function u(e){c.reject(e)}var c=t.defer();return e({method:o,url:n.fieldPromaxApi+a,data:i}).success(r).error(u),
c.promise}function a(e,t){return o("POST",e,JSON.stringify(t))}function i(e,t){return o("GET",e,t)}function r(e,t){return o("DELETE",e,t)}var u={get:i,post:a,deleteReq:r};return u}e.$inject=["$http","$q","fieldPromaxConfig"],angular.module("fpm").factory("api-base-factory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r,u,c,s){function l(n){function o(e){if(e){v.isAuth=!0,v.userName=e.userName;var t={token:e.access_token,userName:e.userName,customerNumber:e.customerNumber,secLevel:e.secLevel,isAdminstrator:"True"===e.isAdminstrator,isIntuitUser:"True"===e.isIntuitUser,userEmail:e.userEmail,etOn:"True"===e.etOn,timeCard:"True"===e.timeCard,allowPushTime:"True"===e.allowPushTime,showPrice:"True"===e.showPrice,havingGroupsAssigned:"True"===e.havingGroups};u.set(y.storageKeyName,t),e.hasOwnProperty(y.configKeyName)&&u.set(y.configKeyName,JSON.parse(e.configurations)),e.userSettings&&u.set(y.settingsKeyName,JSON.parse(e.userSettings)),c.resolve(e)}else e.data?c.reject(e.data.error):c.reject("Invalid Login Details")}function a(e){r.hide(),c.reject(e)}var i="grant_type=password&username="+n.userName+"&password="+n.password+"&client_id=fieldPromaxMob",c=t.defer();return e.post(g+"token",i,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(o).error(a),c.promise}function d(){var e=t.defer(),n=u.get(y.storageKeyName);return n?e.resolve(!0):e.resolve(!1),e.promise}function m(){return u.get(y.storageKeyName)}function f(){u.remove(y.initialData),u.remove(y.storageKeyName),u.remove(y.configKeyName),u.remove(y.settingsKeyName),u.remove("orderState")}function p(e){return s.get("api/public/SendPassword?email="+e)}function h(e){return s.post("api/user/changepassword",e)}var g=c.fieldPromaxApi,y=c.localStorageKeys,v={isAuth:!1,userName:""},C={login:l,isAuthenticated:d,getLoggedInUserInfo:m,logout:f,sendPassword:p,authentication:v,changePassword:h};return C}e.$inject=["$http","$q","$rootScope","$state","$window","$timeout","$ionicLoading","localStorageService","fieldPromaxConfig","api-base-factory"],angular.module("fpm").factory("authenticationFactory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a){return{toStringDate:function(e){return moment(e).format("lll")},showLoading:function(e){var t=e||"please wait...";return a.show({template:t})},getModal:function(e,n){var a=t.defer();return o.fromTemplateUrl(e,{scope:n,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){a.resolve(e)}),a.promise},hideLoading:function(){return a.hide()},alerts:{alert:function(e,t,o){var a=n.alert({title:e,template:t});angular.isFunction(o)&&a.then(function(e){o()})},confirm:function(e,t,o,a){var i=n.confirm({title:e,template:t});i.then(function(e){e?angular.isFunction(o)&&o():angular.isFunction(a)&&a()})},confirmDelete:function(e){var t=n.confirm({title:"Confirmation",template:"Are you sure?"});t.then(function(t){t&&angular.isFunction(e)&&e()})}}}}function t(){return function(e){var t=e.substr(e.lastIndexOf("/")+1),n=t.substr(0,t.lastIndexOf("."))||"";return n}}e.$inject=["$cordovaDialogs","$q","$ionicPopup","$ionicModal","$ionicLoading"],angular.module("fpm").factory("fpm-utilities-factory",e),angular.module("fpm").filter("removeExt",[t])}()}(),function(){"use strict";!function(){function e(e,t,n){var o={BadRequest:400,PageNotFound:401},a={},i=function(e){e.headers=e.headers||{};var t=n.get("authorizationData");return t&&(e.headers.Authorization="Bearer "+t.token),e},r=function(n){if(n.status===o.PageNotFound&&t.path("/"),n.status===o.BadRequest&&n.data)throw n;return e.reject(n)};return a.request=i,a.responseError=r,a}e.$inject=["$q","$location","localStorageService"],angular.module("fpm").factory("requestIntercepter",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function a(e){return t.post("api/User/UpdateUserSettings",e)}function i(a){var i=o.localStorageKeys.initialData,u=a||!1;u===!0&&n.remove(i);var c=n.get(i);return c?e.when(c):t.get(r+"GetIniitialData").then(function(e){return n.set(i,e),e})}var r="api/Shared/";return{updateSettings:a,getIniitialData:i}}e.$inject=["$q","api-base-factory","localStorageService","fieldPromaxConfig"],angular.module("fpm").factory("shared-data-factory",e)}()}(),function(){"use strict";!function(){function e(e,i,r,u,c,s,l,d,m,f,p,h){function g(){v()}function y(){if(q.filtersModal){q.filterDate=null;var e=_.where(q.mapData.users,{isChecked:!1});_.forEach(e,function(e){e.isChecked=!0}),T(),q.filtersModal.hide()}}function v(){q.filtersModal?q.filtersModal.show():p.getModal("mapFilters.html",e).then(function(e){q.filtersModal=e,q.filtersModal.show()})}function C(){T(),q.filtersModal.hide()}function w(e,t){e.havingMap=null!==t,e.marker.setMap(t)}function D(){if(a){B=!0;var e=_.filter(a,function(e){return null!=e.start&&e.havingMap===!0});if(angular.forEach(e,function(e){w(e,null)}),q.filterDate){var t=kendo.parseDate(q.filterDate),n=_.filter(e,function(e){return e.start.getDate()===parseInt(t.getDate())&&e.start.getMonth()===parseInt(t.getMonth())&&e.start.getFullYear()===parseInt(t.getFullYear())});n.length>0&&_.forEach(n,function(e){w(e,q.map)})}}}function b(e,t,n){if(n=n||!1,angular.forEach(e,function(e){var n=_.where(a,{technician:e.userId});angular.forEach(n,function(e){w(e,t)})}),n===!0){var o=_.where(a,{isassigned:!1});_.forEach(o,function(e){w(e,null)})}}function T(){b(_.where(q.mapData.users,{isChecked:!0}),q.map),b(_.where(q.mapData.users,{isChecked:!1}),null),q.filterDate&&(U=c(D,1e3))}function S(){O(!0)}function k(){angular.forEach(q.mapData.users,function(e){e.isChecked=!e.isChecked})}function M(){angular.forEach(q.mapData.users,function(e){e.isChecked=!0})}function E(){u.show({buttons:[{text:"Select All"},{text:"Invert Selection"}],titleText:"Service Provider Filter Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&M(),1===e&&k(),!0}})}function I(){u.show({buttons:[{text:"Set As Today's Date"}],titleText:"Date Filter Options",destructiveText:"Clear Date Filter",cancelText:"Cancel",destructiveButtonClicked:function(){return q.filterDate=null,T(),!0},cancel:function(){},buttonClicked:function(e){return 0===e&&(q.filterDate=new Date),!0}})}function P(t,n){q.currentMarker=n.o,window.google.maps.event.addListener(t,"click",function(){if(!n.isHome){s.show({templateUrl:"mapInfoWindow.html",title:q.currentMarker.barcodeName,scope:e,buttons:[{text:"Close"},{text:"Edit Order",type:"button-positive",onTap:function(e){n.numFromTechnician&&i.go("app.editOrder",{barCode:n.barCode,technicianNum:n.numFromTechnician,src:"map"})}}]})}})}function A(){q.mapData;o&&o.length>0&&$.each(o,function(e,n){var i=null,r=new window.google.maps.LatLng(n.y,n.x);n.isHome===!0?(i=new window.google.maps.Marker({position:r,map:q.map,icon:{url:n.imageurl,size:new window.google.maps.Size(24,24),origin:new window.google.maps.Point(0,0),anchor:new window.google.maps.Point(0,24)},shape:{coord:[1,1,1,20,18,20,18,1],type:"poly"}}),P(i,n)):(n.isAssigned===!0?(i=new window.google.maps.Marker({position:r,map:q.map,labelContent:R,labelAnchor:new window.google.maps.Point(0,7),labelClass:"labels",labelStyle:{opacity:.75},icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:n.scale||6,fillColor:n.color||t,strokeColor:n.color||t}}),R+=1,a.push({detail:n,marker:i,technician:n.technician,havingMap:!0,isassigned:n.isAssigned,start:null!=n.start?new Date(n.start):null,isSpecialMarker:!0,numFromTechnician:n.numFromTechnician})):(i=new window.google.maps.Marker({position:r,map:q.map,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:n.scale||6,fillColor:n.color||t,strokeColor:n.color||t}}),a.push({detail:n,marker:i,technician:n.technician,havingMap:!0,isassigned:n.isAssigned,start:null!=n.start?new Date(n.start):null,isSpecialMarker:!1,numFromTechnician:n.numFromTechnician})),P(i,n)),o.length-1===e})}function F(){o=[],$.each(q.mapData.orders,function(e,n){var a=t;if(q.mapData.users&&null!=n.technicianNum){var i=_.findWhere(q.mapData.users,{userId:n.technicianNum});i&&(a=i.userColor||t)}var r=null!==n.scheduledStartDateTime&&null!==n.scheduledFinishDateTime;Math.abs(n.coordinateX+98.908)>.1&&Math.abs(n.coordinateY-39.45)>.1&&o.push({x:n.coordinateX,y:n.coordinateY,barCode:n.barcode,isHome:!1,color:a,scale:a===t?4:6,isAssigned:r,technician:n.technicianNum,start:n.scheduledStartDateTime,numFromTechnician:n.numFromTechnicianSchedule,o:n}),e===q.mapData.orders.length-1&&A()})}function O(e){p.showLoading().then(function(){m.getMapData(e).then(function(e){e&&(q.mapData.users=e.users,q.mapData.orders=e.orders,angular.isDefined(q.mapData)&&q.mapData.orders.length>0&&F())}).finally(p.hideLoading)})}function x(){angular.isDefined(google)&&google.maps.event.addListenerOnce(q.map,"idle",function(){O(!1)})}function L(){a=[],j.center=new window.google.maps.LatLng(n.y,n.x),f.getIniitialData().then(function(e){if(q.iniitialData=e,e){var a=e.customerNumberEntity;j.center=new window.google.maps.LatLng(a.coordinateY||n.y,a.coordinateX||n.x),j.zoom=a.zoomDepth||8,q.map=new google.maps.Map(document.getElementById("map"),j),x(),o.push({x:a.coordinateX||n.x,y:a.coordinateY||n.y,imageurl:"../images/markers/home.png",barCode:"[HOME]",isHome:!0,color:t,technician:"",isAssigned:!0,start:null,numFromTechnician:0})}else j.center=new window.google.maps.LatLng(n.y,n.x),q.map=new google.maps.Map(document.getElementById("map"),j),x()})}function N(){L()}var q=this;q.user=h.getLoggedInUserInfo();var j={center:null,panControl:!1,zoomControl:!0,scaleControl:!0,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP};q.filtersApplied=!1,q.filterDate=null;var B=!1,U=null;q.events={onFiltersClicked:g,clearFilters:y,applyFilters:C,refreshMapClicked:S,onServiceProviderDotsClicked:E,onDateFilterDotsClicked:I},q.mapData={users:[],orders:[]};var R=1;e.$on("$ionicView.afterEnter",function(e,t){N()}),e.$on("$destroy",function(e){q.map=null,o=[],a=[],U&&c.cancel(U)}),d.$on("$cordovaNetwork:online",function(e,t){p.hideLoading()}),d.$on("$cordovaNetwork:offline",function(e,t){p.showLoading("You must connected to the internet to view this map")})}var t="#000000",n={x:44.31127,y:-92.67851,xcom:-92.67851,ycom:44.3112679},o=[],a=[];e.$inject=["$scope","$state","$cordovaGeolocation","$ionicActionSheet","$timeout","$ionicPopup","$cordovaNetwork","$rootScope","map-factory","shared-data-factory","fpm-utilities-factory","authenticationFactory"],angular.module("fpm").controller("map-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(n){n=null!==n&&n,n===!0&&i.remove(r);var o=i.get(r);return angular.isDefined(o)&&o?t.when(o):e.get(a+"GetMapData?fromMobile=true").then(function(e){return i.put(r,e),e})}var a="api/Dashboard/",i=n("mapCache"),r="workorder:mapdata";return{getMapData:o}}e.$inject=["api-base-factory","$q","$cacheFactory"],angular.module("fpm").factory("map-factory",e)}()}(),function(){"use strict";!function(){function e(e){function t(t,n){return e.get(a+"GetCustomTypesDataByBarcode?jobTypeName="+n+"&barcode="+t)}function n(t){return e.post(a+"UploadFile",t)}function o(t,n){return e.post(a+"UpdateData?checkBoxValue="+n,t)}var a="api/CustomTypes/",i={None:0,WorkOrder:1,Estimate:2,Expense:3,JobType:4,Equipment:101,EquipmentsToBarcode:102},r={TEXT_BOX:1,RADIO:2,CHECKBOX:3,DATE:4,UPLOAD:5},u={requestDataCompleted:!1,barcode:"",jobTypeName:"",entityId:0,isNewType:!1,fireGetTypesEvent:!1,fetchViewData:!1,data:[],viewData:[],viewDataForEquipment:[]},c={};return c.uploadFile=n,c.controlTypes=r,c.getCustomTypesDataByBarcode=t,c.entityTypes=i,c.typesData=u,c.updateData=o,c}e.$inject=["api-base-factory"],angular.module("fpm").factory("custom-types-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{isEstimate:"<",onAddProductCompleted:"&",modalType:"<",product:"="},templateUrl:"js/shared-components/edit-product-component-template.html",controller:["$scope","$stateParams","$rootScope","work-orders-factory","authenticationFactory","fpm-utilities-factory",function(e,t,n,o,a,i){var r=this;r.user=a.getLoggedInUserInfo(),r.events={closeProductEditModal:function(){n.$broadcast("$fpm:closeEditProductModal")},updateProductClick:function(){if(0===r.modalType){var a=r.isEstimate?null:o.updateProduct;i.showLoading("updating product...").then(function(){a(r.product).then(function(t){e.$emit("$fpm:operation:updateProduct",t)}).finally(i.hideLoading)})}else r.product.BarCode=t.barCode,r.product.Quantity=r.product.qty,r.product.FromListWindow=!0,i.showLoading().then(function(){o.addProduct(r.product).then(function(e){angular.isFunction(r.onAddProductCompleted)?r.onAddProductCompleted({product:e}):n.$broadcast("$fpm:operation:addProduct",e)}).finally(i.hideLoading)})}}}],controllerAs:"vm"};angular.module("fpm").component("editProductComponent",e)}()}(),function(){"use strict";!function(){var e={templateUrl:"js/shared-components/product-search-component-template.html",controller:["$scope","$timeout","$ionicModal","work-orders-factory","authenticationFactory",function(e,t,n,o,a){var i=this;i.searchValue="",i.products=[],i.user=a.getLoggedInUserInfo(),i.events={closeProductEditModal:function(){i.productModal.hide()},applySearch:function(){o.searchProduct(i.searchValue,"").then(function(e){i.products=e})},onProductItemClicked:function(e){i.currentProduct=angular.copy(e),i.currentProduct.qty=1,i.productModal&&i.productModal.show()},closeSearchModal:function(){e.$emit("$fpm:closeProductSearchModal",{fromProductAdd:!1})},onAddProductCompleted:function(n){i.productModal.hide(),t(function(){e.$emit("$fpm:closeProductSearchModal",{fromProductAdd:!0})},100)}},e.$on("$fpm:closeEditProductModal",function(){i.productModal.hide()}),n.fromTemplateUrl("addProductModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){i.productModal=e})}],controllerAs:"vm"};angular.module("fpm").component("productSearchComponent",e)}()}(),function(){"use strict";!function(){angular.module("fpm").filter("timeSpan",function(){return function(e,t){if(Date.parse(e)&&Date.parse(t)){var n=moment(t).diff(kendo.parseDate(e),"minutes"),o=Math.floor(n/60),a=n%60;return o>0?o+" hrs "+a+" min":a+" min"}return""}})}()}(),function(){"use strict";!function(){var e={bindings:{onCancelClicked:"&",onAddCompleted:"&",details:"<",isFromPto:"<",editMode:"<"},controller:["$scope","$timeout","$ionicActionSheet","timecard-factory","fpm-utilities-factory","authenticationFactory",function(e,t,n,o,a,i){function r(){if(p.ui.errors=[],null!==p.entity.finishTime){var e=kendo.parseDate(p.entity.finishTime),t=kendo.parseDate(p.entity.timeCardDate),n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),(new Date).getHours(),(new Date).getMinutes(),0,0),i=moment(new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),0,0)),r=moment(i).diff(kendo.parseDate(p.entity.startTime),"minutes");if(r<0)return p.ui.errors.push("Invalid Time"),!1;if(!p.isFromPto&&!p.editMode&&i.isAfter(n))return p.ui.errors.push("Cannot be a future time"),!1}return null===p.entity.jobCode||0===p.entity.jobCode?(p.ui.errors.push("Please select Job code before save"),!1):void a.showLoading().then(function(){var e=p.isFromPto?o.addPtoDetails:o.addNewDetails;e(p.entity).then(function(e){g=!1,angular.isArray(e.errors)&&e.errors.length>0?p.ui.errors=e.errors:h.alert("Time Added","Time has been "+(p.editMode?"updated":"added"),function(){angular.isFunction(p.onAddCompleted)&&p.onAddCompleted({o:e})})}).finally(a.hideLoading)})}function u(){var e=o.summary,t=p.dateTimeMode.startTime,n=kendo.parseDate(e.timeCardDate);p.entity.startTime=new Date(n.getFullYear(),n.getMonth(),n.getDate(),t.getHours(),t.getMinutes(),0,0),d()}function c(){var e=o.summary;null===p.entity.startTime&&u();var t=p.dateTimeMode.finishTime,n=kendo.parseDate(e.timeCardDate);p.entity.finishTime=new Date(n.getFullYear(),n.getMonth(),n.getDate(),t.getHours(),t.getMinutes(),0,0),d()}function s(){var e=o.summary;if(e&&e.timeCardDate){var t=kendo.parseDate(e.timeCardDate),n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),(new Date).getHours(),(new Date).getMinutes(),0);p.entity.startTime=n,p.dateTimeMode.startTime=n}}function l(){p.editMode&&p.details?(p.entity=angular.copy(p.details),p.entity.startTime=kendo.parseDate(p.details.startTime),p.entity.finishTime=kendo.parseDate(p.details.finishTime),p.isFromPto=p.details.isPtoType,p.entity.startTime&&(p.dateTimeMode.startTime=p.entity.startTime,p.dateTimeMode.isCheckedIn=!0),p.entity.finishTime&&(p.dateTimeMode.finishTime=p.entity.finishTime,p.dateTimeMode.isCheckedOut=!0),p.dateTimeMode.isCheckedOut=null!==p.entity.finishTime,d()):(p.entity=angular.copy(y),p.entity.startTime=new Date,p.entity.finishTime=new Date,p.isFromPto===!0&&s()),o.summary&&(p.entity.numFromSummary=o.summary.num,p.entity.timeCardDate=new Date(moment(o.summary.timeCardDate))),p.timecardPermissions.isFromAddingPto=p.isFromPto}function d(){if(p.ui.errors=[],p.ui.isInvalidSave=!1,console.log("Date.parse(vm.entity.finishTime)",Date.parse(p.entity.finishTime)),Date.parse(p.entity.startTime)&&Date.parse(p.entity.finishTime)){var e=new Date(p.entity.finishTime),n=new Date(p.entity.startTime);console.log("new Date(vm.entity.finishTime",new Date(p.entity.finishTime));var o=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),0,0),a=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),0,0),i=moment(o).diff(moment(a),"minutes"),r=Math.floor(i/60),u=i%60,c=t(function(){i>0?r>0?p.dateTimeMode.timeSpan=r+(r>1?" Hours ":" Hour ")+u+(u>1?" Minutes":" Minute"):p.dateTimeMode.timeSpan=u+" Minutes":p.isInEditMode||(p.entity.finishTime=new Date,p.ui.isInvalidSave=!0,p.ui.errors.push("Invalid Time")),t.cancel(c)},10)}return""}function m(){a.showLoading().then(function(){o.getWorkOrdersList().then(function(e){p.ui.workOrders=e}).finally(f)})}function f(){a.showLoading().then(function(){o.getJobCodes().then(function(e){p.ui.jobCodes=_.where(e,{isPtoType:!1}),p.ui.ptoJobCodes=_.where(e,{isPtoType:!0})}).finally(a.hideLoading)}).finally(a.hideLoading)}var p=this,h=a.alerts,g=!1;p.ui={summary:angular.copy(o.summary),jobCodes:[],workOrders:[],errors:[],isInvalidSave:!1,ptoJobCodes:[]},p.dateTimeMode={timeSpan:"",startTime:new Date,finishTime:null,isCheckedIn:!1,isCheckedOut:!1};var y={num:0,numFromSummary:0,timeCardDate:new Date,startTime:null,finishTime:null,jobCode:0,notes:"",barcode:0,isUserDefined:!0};p.timecardPermissions={allowPushTime:!1,timePickerVisibility:!0,isFromAddingPto:!1},p.entity=null,p.events={onCardActionClicked:function(){n.show({buttons:[{text:"Check In"},{text:"Check Out"}],titleText:"Time card",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&(p.dateTimeMode.startTime=new Date,p.entity.startTime=new Date,p.entity.finishTime=null,p.dateTimeMode.finishTime=null,p.dateTimeMode.isCheckedIn=!0,d()),1===e&&(p.dateTimeMode.finishTime=new Date,p.entity.finishTime=new Date,p.dateTimeMode.isCheckedOut=!0,d()),!0}})},updateButtonClicked:function(){if(p.ui.errors=[],p.ui.isInvalidSave=!1,null===p.entity.startTime&&(p.entity.startTime=new Date),p.entity.startTime=kendo.toString(p.entity.startTime,"g"),p.entity.finishTime=kendo.toString(p.entity.finishTime,"g"),!p.editMode){var e=angular.copy(o.details),t=_.where(e,{finishTime:null});return t.length>0&&!g?h.confirm("Confirmation!","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(e){g=!0,r()}):r(),!1}return r(),!1},closeProductEditModal:function(){angular.isFunction(p.onCancelClicked)&&p.onCancelClicked()},onDateTimeChaged:u,onFinishDateTimeChaged:c},p.$onChanges=function(){l()},l(),p.$onInit=function(){p.userInfo=i.getLoggedInUserInfo(),p.userInfo&&(p.timecardPermissions.allowPushTime=p.userInfo.allowPushTime,p.timecardPermissions.timePickerVisibility=!1),p.timecardPermissions.isFromAddingPto=p.isFromPto,p.timecardPermissions.isFromAddingPto===!0&&(p.timecardPermissions.timePickerVisibility=!0),m()},e.$on("timecard:addEditDetailsModal:open",function(){p.entity=angular.copy(y),p.dateTimeMode.startTime=null,p.dateTimeMode.finishTime=null,p.dateTimeMode.timeSpan=""})}],controllerAs:"vm",templateUrl:"js/timecard/timecard-add-edit-detail-component.template.html"};angular.module("fpm").component("addEditDetailsComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r,u,c,s,l){function d(e){var t=_.where(e.timeCardDetails,{finishTime:null});return t.length>0?(S.ui.data.allowSendForApproval=!1,!1):S.ui.data.approvalStatus!==E.NONE?(S.ui.data.allowSendForApproval=!1,!1):(S.ui.data.allowSendForApproval=!0,!0)}function m(){var e=new Date(S.ui.data.currentDate.getFullYear(),S.ui.data.currentDate.getMonth(),S.ui.data.currentDate.getDate(),0,0,0,0),t=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),0,0,0,0),n=moment(e).isBefore(t),o=moment(e).isAfter(t);moment(e).isSame(t)&&(S.ui.data.addTimeVisibility=S.ui.data.isClockedIn,S.ui.data.ptoButtonVisibility=!S.ui.data.isClockedIn),S.ui.data.disableClockInButton=n,S.ui.data.isClockedOut===!0&&(S.ui.data.disableClockOutButton=n),o===!0&&(S.ui.data.disableClockInButton=!0,S.ui.data.addTimeVisibility=!1,S.ui.data.ptoButtonVisibility=!0),n===!0&&(S.ui.data.addTimeVisibility=!1,S.ui.data.ptoButtonVisibility=!0)}function f(e){var t=1,n=1;S.ui.data.timeCards=[],e.length>0&&angular.forEach(e,function(o,a){o.jobCode!==k.CLOCK_IN?o.isPtoType?(o.pto=n,n++):(o.section=t,t++):o.section=0,a===e.length-1&&(S.ui.data.timeCards=_.reject(e,{jobCode:k.CLOCK_IN,finishTime:null}))})}function p(e){if(S.ui.data.timeCards=[],S.ui.data.summary=e.timeCardSummary,S.factory.summary=e.timeCardSummary,S.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0,I=e.pendingClockIns,S.ui.data.currentClockedIn=_.findWhere(e.timeCardDetails,{jobCode:k.CLOCK_IN,finishTime:null}),d(e),angular.isDefined(S.ui.data.currentClockedIn)){var t=S.ui.data.currentClockedIn;S.ui.data.clockInDateTime=moment(t.startTime),S.ui.data.isClockedIn=!0,S.ui.data.isClockedOut=null!==t.finishTime,S.ui.data.addTimeVisibility=!S.ui.data.isClockedOut,S.ui.data.clockOutDateTime=moment(t.finishTime),S.ui.data.clockedInDate=angular.copy(t)}m(),f(e.timeCardDetails)}function h(){S.ui.data.totalTime="0";var e=_.filter(S.ui.data.timeCards,function(e){return e.jobCode===k.CLOCK_IN&&null!==e.finishTime}),t=_.filter(S.ui.data.timeCards,function(e){return e.jobCode!==k.CLOCK_IN&&e.isPayable===!1&&null!==e.finishTime}),n=0;if(e.length>0&&angular.forEach(e,function(e,t){n+=moment(e.FinishTime).diff(kendo.parseDate(e.startTime),"minutes")}),t.length>0){var o=0;angular.forEach(t,function(e,a){if(o+=moment(e.finishTime).diff(moment(e.startTime),"minutes"),a===t.length-1){n-=o;var i=Math.floor(n/60),r=n%60;S.ui.data.totalTime=i+" hrs "+r+" min"}})}else{var a=Math.floor(n/60),i=n%60;S.ui.data.totalTime=a+" hrs "+i+" min"}}function g(){s.showLoading().then(function(){c.getTimeCardByDate(M(S.currentDate)).then(function(e){e?p(e):m()}).finally(s.hideLoading)})}function y(){a.openDatePicker(A)}function v(e){S.popover.show(e)}function C(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),0,0),n={startTime:kendo.toString(t,"g"),jobCode:k.CLOCK_OUT,numFromSummary:S.ui.data.summary.Num,timeCardDate:kendo.parseDate(S.ui.data.summary.timeCardDate),uniqueIdentifier:S.ui.data.currentClockedIn.uniqueIdentifier};c.clockInOutUser(n).then(function(e){if(null===e.errors){S.ui.data.clockOutDateTime=t,S.ui.data.isClockedOut=!0,S.ui.data.isClockedIn=!1,S.ui.data.disableClockOutButton=!0,S.ui.data.addTimeVisibility=!1,S.ui.data.ptoButtonVisibility=!0,S.ui.data.summary=e.timeCardSummary,S.factory.summary=e.timeCardSummary;var n=new Date,o=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),a=new Date(moment(S.ui.data.summary.timeCardDate)),i=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0);moment(i).isSameOrAfter(o)&&(S.ui.data.disableClockInButton=!1),S.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0,f(e.timeCardDetails),d(e)}})}function w(){null===S.ui.data.addEditDetailsModal?r.fromTemplateUrl("timecardDetailsModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){S.ui.data.addEditDetailsModal=t,e.$broadcast("timecard:addEditDetailsModal:open"),S.ui.data.addEditDetailsModal.show()}):(e.$broadcast("timecard:addEditDetailsModal:open"),S.ui.data.addEditDetailsModal.show())}function D(){null===S.ui.data.timeCardSummaryModal?r.fromTemplateUrl("timecardSummaryModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){S.ui.data.timeCardSummaryModal=t,e.$broadcast("timecard:timeCardSummaryModal:open"),S.ui.data.timeCardSummaryModal.show()}):(e.$broadcast("timecard:timeCardSummaryModal:open"),S.ui.data.timeCardSummaryModal.show())}function b(){null===S.ui.data.timecardTutorialModal?r.fromTemplateUrl("timecardTutorialModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){S.ui.data.timecardTutorialModal=e,S.ui.data.timecardTutorialModal.show()}):S.ui.data.timecardTutorialModal.show()}function T(){g();var e=l.getLoggedInUserInfo(),t=_.findWhere(O,{c:e.customerNumber});S.ui.data.enableForCustomer=angular.isDefined(t)}var S=this,k={CLOCK_IN:5001,CLOCK_OUT:5002},M=s.toStringDate,E={NONE:0,SEND_FOR_APPROVAL:1,CANCELLED:2,APPROVED:3},I=[],P=!1;S.errors=[],S.factory=c;var $=s.alerts;S.currentDate=new Date,i.fromTemplateUrl("my-popover.html",{scope:e}).then(function(e){S.popover=e});var A={callback:function(e){S.currentDate=new Date(e),g()},inputDate:S.currentDate};S.events={onDatePickerClicked:y,showPopoverClicked:v};var F=null;S.ui={errors:[],calendar:{settings:{theme:"mobiscroll",display:"bottom",swipeDirection:"vertical"}},data:{componentEvents:null,summary:null,currentDate:new Date,isClockedIn:!1,isClockedOut:!1,clockInDateTime:new Date,clockOutDateTime:new Date,addTimeVisibility:!1,clockedInDate:null,timeCards:[],approvalStatus:0,disableClockInButton:!1,disableClockOutButton:!1,currentClockedIn:null,allowSendForApproval:!1,totalTime:"",enableForCustomer:!1,ptoButtonVisibility:!1,isFromPto:!1,isInEditMode:!1,addEditDetailsModal:null,timeCardSummaryModal:null,currentDetails:null,timecardTutorialModal:null},events:{onTutorialModalCancel:function(){S.ui.data.timecardTutorialModal&&S.ui.data.timecardTutorialModal.hide()},onSummaryModalCancel:function(){S.ui.data.timeCardSummaryModal.hide()},checkSummaryClick:function(){return D(),S.popover.hide(),!0},showTimeCardTutorialWindow:function(){return S.popover.hide(),b(),!0},onAddScheduleCompleted:function(e){S.ui.data.timeCards.length!==e.timeCardDetails.length&&(S.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0),f(e.timeCardDetails),S.ui.data.addEditDetailsModal.hide()},onModalCancelClicked:function(){S.ui.data.isInEditMode=!1,S.ui.data.isFromPto=!1,S.ui.data.currentDetails=null,S.ui.data.addEditDetailsModal.hide()},addTimeClick:function(e){return S.ui.data.isFromPto=e,S.ui.data.isInEditMode=!1,w(),S.popover.hide(),!0},onCardActionClicked:function(e){u.show({buttons:[{text:"Edit"}],destructiveText:"Delete",titleText:"Time Card Options",cancelText:"Cancel",cancel:function(){},destructiveButtonClicked:function(){return e.isUserDefined?$.confirmDelete(function(){s.showLoading().then(function(){c.deleteTimeCardDetails(e.num,e.numFromSummary).then(function(e){e&&$.alert("Success","Time Details cleared successfully",function(){f(e.timeCardDetails)})}).finally(s.hideLoading)})}):$.alert("Invalid Action","You are not allowed to perform delete"),!0},buttonClicked:function(t){return 0===t&&(S.ui.data.currentDetails=e,S.ui.data.isInEditMode=!0,S.ui.data.isFromPto=!1,w()),!0}})},sendForApproval:function(e){return angular.isArray(S.ui.data.timeCards)&&0===S.ui.data.timeCards.length?($.alert("No Timecard!","No Timecard information found to process this request."),!1):void $.confirm("Confirmation!","Are you sure?",function(){s.showLoading().then(function(){c.sendForApproval(S.ui.data.summary.num,e).then(function(e){e&&(S.ui.data.summary=e.timeCardSummary,F=t(function(){$.alert("Success","Time card sent for approval successfully",function(){S.ui.data.addTimeVisibility=!1,S.ui.data.ptoButtonVisibility=!1,S.ui.data.approvalStatus=S.ui.data.summary.approveStatus||0})},100))}).finally(s.hideLoading)})})},clockOutClick:function(){var e=_.where(S.ui.data.timeCards,{finishTime:null});e.length>0?$.confirm("Confirmation!","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(){C()}):$.confirm("Confirmation!","Are you sure?",function(){C()})},clockInClick:function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),(new Date).getHours(),(new Date).getMinutes(),0,0),n={startTime:s.toStringDate(t),jobCode:k.CLOCK_IN,numFromSummary:null===S.ui.data.summary?0:S.ui.data.summary.Num,timeCardDate:t};S.errors=[],c.clockInOutUser(n).then(function(e){null===e.errors?(S.ui.data.clockInDateTime=t,S.ui.data.isClockedIn=!0,S.ui.data.addTimeVisibility=!0,S.ui.data.ptoButtonVisibility=!1,$.alert("Clocked In","Clocked in successfully",function(){P===!0?o.go($stateParams.proute):p(e)})):S.errors=e.errors})}}};var O=[{c:"407805491"},{c:"1238967820"}];e.$watch("vm.ui.data.timeCards",function(e){S.factory.details=e,angular.isDefined(e)&&h()},!0),e.$on("$destroy",function(){F&&t.cancel(F)}),T()}e.$inject=["$scope","$timeout","$rootScope","$state","ionicDatePicker","$ionicPopover","$ionicModal","$ionicActionSheet","timecard-factory","fpm-utilities-factory","authenticationFactory"],angular.module("fpm").controller("timecard-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(t){return e.get(C+"GetTimeCardByDate?date="+t)}function a(t){return e.get(C+"GetClockInByDate?date="+t)}function i(t){return e.post(C+"ClockInOutUser",t)}function r(n){n=n||!1,n===!0&&w.remove("jobCodes");var o=w.get("jobCodes");return angular.isDefined(o)&&o?t.when(o):e.get(C+"GetJobCodes").then(function(e){return w.put("jobCodes",e),e})}function u(n){n=n||!1,n===!0&&w.remove("workorders");var o=w.get("workorders");return angular.isDefined(o)&&o?t.when(o):e.get(C+"GetWorkOrdersList").then(function(e){return w.put("workorders",e),e})}function c(t){return e.post(C+"AddNewDetails",t)}function s(t,n){return e.get(C+"ClearCheckedOutTime?detailId="+t+"&summaryId="+n)}function l(t,n){return e.get(C+"SendForApproval?summaryId="+t+"&status="+n)}function d(t,n){return e.get(C+"DeleteTimeCardDetails?detailId="+t+"&summaryId="+n)}function m(t){return e.get(C+"ClearTimeCard?summaryId="+t)}function f(){return e.get(C+"GetPendingClockIns")}function p(t){return e.post(C+"PushCheckInOutTimes",t)}function h(){return e.get(C+"CertifieldUser")}function g(){return e.get(C+"GetCertifieldUser")}function y(t){return e.post(C+"AddPtoDetails",t)}function v(t){return e.post(C+"GetPayableHoursSummaryView",t)}var C="api/timecard/",w=n("timeCardCache"),D={details:[],jobCodes:{CLOCK_IN:5001,CLOCK_OUT:5002},summary:null},b={};return b.addPtoDetails=y,b.getSummaryPayableHours=v,b.certifyUser=h,b.getCertifieldUser=g,b.pushCheckInOutTimes=p,b.data=D,b.getPendingClockIns=f,b.getJobCodes=r,b.clockInOutUser=i,b.getClockInByDate=a,b.getTimeCardByDate=o,b.getWorkOrdersList=u,b.addNewDetails=c,b.clearCheckedOutTime=s,b.sendForApproval=l,b.deleteTimeCardDetails=d,b.clearTimeCard=m,b}e.$inject=["api-base-factory","$q","$cacheFactory"],angular.module("fpm").factory("timecard-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{onCancelClicked:"&"},controller:["$scope","$ionicActionSheet","timecard-factory","fpm-utilities-factory",function(e,t,n,o){function a(){angular.isFunction(c.onCancelClicked)&&c.onCancelClicked()}function i(){c.payableReport=[];var e=[];o.showLoading().then(function(){n.getSummaryPayableHours({startDate:c.modal.startDate,finishDate:c.modal.endDate}).then(function(t){t&&t.length>0&&angular.forEach(t,function(n,o){var a=_.findWhere(e,{timeCardDate:n.timeCardDate}),i=parseFloat(parseInt(n.totalMinutes,10)/60).toFixed(2);angular.isDefined(a)?(n.IsPayable?a.payableHours=parseFloat(i):a.nonPayable=parseFloat(i),
a.total=parseFloat(a.payableHours)+parseFloat(a.nonPayable)):e.push({timeCardDate:n.timeCardDate,payableHours:n.isPayable===!0?parseFloat(i):0,nonPayable:n.isPayable===!1?parseFloat(i):0,total:parseFloat(i).toFixed(2)}),o===t.length-1&&(c.payableReport=e,_.forEach(e,function(e){c.totalPayables.p+=parseFloat(e.payableHours),c.totalPayables.np+=parseFloat(e.nonPayable),c.totalPayables.t+=parseFloat(e.total)}))})}).finally(o.hideLoading)})}function r(){t.show({buttons:[{text:"Show Current"},{text:"As Selected Dates"}],titleText:"Time card Report",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&u(),1===e&&(c.showCurrentSummary=!1),!0}})}function u(){c.lists={clockInOuts:[],payables:[],nonPayables:[]},o.showLoading().then(function(){if(angular.isArray(n.details)&&n.details.length>0){c.lists.clockInOuts=_.where(n.details,{jobCode:s.CLOCK_IN});var e=_.reject(n.details,{jobCode:s.CLOCK_IN});c.lists.payables=_.where(e,{isPayable:!0}),c.lists.nonPayables=_.where(e,{isPayable:!1})}o.hideLoading()}),c.showCurrentSummary=!0}var c=this,s=n.data.jobCodes;c.lists={clockInOuts:[],payables:[],nonPayables:[]},c.modal={startDate:new Date,endDate:null},c.payableReport=[],c.totalPayables={p:0,np:0,t:0},c.events={closeProductEditModal:a,showReport:i,onCardActionClicked:r},c.$onInit=function(){u()},e.$on("timecard:timeCardSummaryModal:open",function(){u()})}],controllerAs:"vm",templateUrl:"js/timecard/timecard-summary-component.template.html"};angular.module("fpm").component("timecardSummaryComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{onCancelClicked:"&"},controller:["$scope","timecard-factory",function(e,t){function n(){angular.isFunction(a.onCancelClicked)&&a.onCancelClicked()}function o(){t.certifyUser().then(function(e){e&&(a.isCertifield=!0,a.info=e)})}var a=this;a.isCertifield=!1,a.info=null,a.events={closeProductEditModal:n,onCertifyClicked:o},a.$onInit=function(){t.getCertifieldUser().then(function(e){e&&(a.isCertifield=e.isCertified||!1,a.info=e)})}}],controllerAs:"vm",templateUrl:"js/timecard/timecard-tutorial-component.template.html"};angular.module("fpm").component("timecardTutorialViewComponent",e)}()}(),function(){"use strict";!function(){angular.module("fpm").filter("totalTimeDiff",function(){return function(e){var t="0";if(e.length>0){var n=0;angular.forEach(e,function(o,a){if(o.finishTime&&(n+=moment(kendo.parseDate(o.finishTime)).diff(kendo.parseDate(o.startTime),"minutes")),a===e.length-1&&n>0){var i=Math.floor(n/60),r=n%60;return t=i+" hrs "+r+" min"}})}return t}})}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",onCancelClicked:"&",onAddCompleted:"&",serviceProviders:"<"},controller:["$scope","fpm-utilities-factory","work-orders-factory",function(e,t,n){var o=this;o.errors=[];var a={serviceProvider:"",startDate:new Date,endTime:new Date,fromMobile:!0,barCode:o.barcode,intuitQboItemId:""};o.newSchedule=angular.copy(a),o.events={closeProductEditModal:function(){angular.isFunction(o.onCancelClicked)&&o.onCancelClicked()},addScheduleClicked:function(){o.errors=[],o.showError=!1;var e=angular.copy(o.newSchedule);e.startDate=t.toStringDate(o.newSchedule.startDate),e.endTime=t.toStringDate(o.newSchedule.endTime),t.showLoading().then(function(){n.addWorkOrderSchedule(e).then(function(e){angular.isDefined(e.model)&&angular.isArray(e.model.errors)&&e.model.errors.length>0?(o.errors=e.model.errors,o.showError=!0):o.onAddCompleted({o:{invoice:e.invoice,schedules:e.schedule}})}).finally(t.hideLoading)})},onServiceProviderSelectionChanged:function(){}},o.$onInit=function(){}}],controllerAs:"vm",templateUrl:"js/work-orders/add-schedule-modal-component.template.html"};angular.module("fpm").component("addScheduleModalComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r){function u(){a.getBarCodeNumber().then(function(e){p.woEntity.barCode=e.barcode,p.woEntity.barCodeName=e.barcodeName})}function c(){a.createEntity().then(function(e){p.woEntity=angular.copy(e),p.woEntity.fromMobile=!0,d()}).finally(u)}function s(e){return p.errors=[],p.showError=!1,p.isCustomerSelected===!1?(p.errors.push("Please select a customer first"),p.showError=!0,!1):void o.show({template:"creating work order..."}).then(function(){p.woEntity.scheduleStart=r.toStringDate(p.dates.startDate),p.woEntity.scheduleEnd=r.toStringDate(p.dates.endDate),a.createWorkOrder(p.woEntity).then(function(e){e&&(e.errors.length>0?(p.errors=e.errors,p.showError=!0):h.alert("Success","Work Order created successfully",function(){t.go("app.dashboard")}))}).finally(o.hide)})}function l(){n.show({buttons:[{text:"Same as Business Address"},{text:"Clear Address"}],titleText:"Service Address Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&(p.woEntity.sStreet=p.woEntity.bStreet,p.woEntity.sState=p.woEntity.bState,p.woEntity.sCity=p.woEntity.bCity,p.woEntity.sZip=p.woEntity.bZip),1===e&&(p.woEntity.sStreet="",p.woEntity.sState="",p.woEntity.sCity="",p.woEntity.sZip=""),!0}})}function d(){p.dates={startDate:new Date,endDate:new Date(moment().add(1,"hours"))}}function m(){t.go("app.dashboard")}function f(){i.getIniitialData().then(function(e){e&&(p.jobTypes=e.jobTypes,p.serviceProviders=e.serviceProviders)}).finally(c)}var p=this,h=r.alerts;p.errors=[],d(),p.isCustomerSelected=!1,p.events={onCustomerSelected:function(e){p.isCustomerSelected=!0,p.woEntity.firstName=e.firstName,p.woEntity.lastName=e.lastName,p.woEntity.companyName=e.company,p.woEntity.displayName=e.name,p.woEntity.bCity=e.addressCity,p.woEntity.bState=e.addressCountrySubDivCode,p.woEntity.bStreet=null==e.street?null:e.street.replace("::","\n"),p.woEntity.bZip=e.addressPostalCode,p.woEntity.phone=e.phone,p.woEntity.fax=e.fax,p.woEntity.uin=e.uin,p.woEntity.email=e.email_Group,p.woEntity.mobile=e.mobile,p.woEntity.sStreet=null==e.shipStreet?"":e.shipStreet.replace("::","\n"),p.woEntity.sState=e.shipState,p.woEntity.sCity=e.shipCity,p.woEntity.sZip=e.shipZIP},onSubmitButtonClicked:s,onServiceAddressActionClicked:l,onBackToDashboardClicked:m},f()}e.$inject=["$scope","$state","$ionicActionSheet","$ionicLoading","work-orders-factory","shared-data-factory","fpm-utilities-factory"],angular.module("fpm").controller("create-order-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,i,r,u,c,s,l,d,m){function f(){i.show({template:"loading work order..."}).then(function(){c.getBarcodeDetails(P.barcode).then(function(e){P.barCodeData=e,P.uiSettings.woData=angular.copy(e),P.taxCheckboxVisibility=(P.barCodeData.taxRate||0)>0,angular.isArray(e.schedules)&&(P.schedule=angular.copy(angular.copy(_.findWhere(e.schedules,{num:parseInt(o.technicianNum,10)}))),P.schedule.actualStartDateTime&&(P.schedule.actualStartDateTime=new Date(moment(P.schedule.actualStartDateTime))),P.schedule.actualFinishDateTime&&(P.schedule.actualFinishDateTime=new Date(moment(P.schedule.actualFinishDateTime))),p(P.schedule.actualStartDateTime,P.schedule.actualFinishDateTime),P.uiSettings.orderBelongToCurrentUser=P.schedule.technicianNum===P.userId,i.hide(),w())},function(e){$.alert("Oops","ERROR WHILE GETTING WORK ORDER INFORMATION..",i.hide)})})}function p(e,t){if(!Date.parse(e)||!Date.parse(t))return 0;var o=Math.abs(new Date(e)-new Date(t)),a=Math.floor(o/1e3),i=Math.floor(a/60),r=Math.floor(i/60);return i%=60,O=n(function(){0===r?P.scheduleTimeSpan.timeSpan=i+" Minutes":P.scheduleTimeSpan.timeSpan=r+" Hours "+i+" Minutes"},50),0}function h(e,t){return new Date(e.getTime()+6e4*t)}function g(e,t,n){P.user.havingGroupsAssigned;if(P.isServiceProvider===!1)return!0;var o=P.schedule.technicianNum===P.user.userEmail;if(havingGroupsAssinged===!0&&n&&n===!0){var a=_.findWhere(P.serviceProviders,{UserId:P.schedule.TechnicianNum});if(angular.isDefined(a))return!0}return P.isServiceProvider!==!0||o!==!1||($.alert("Oops!","you are not authorized to perform this action",function(){angular.isFunction(t)&&t(e)}),!1)}function y(e){g(null,null,!1)&&(e===!0&&(P.schedule.actualStartDateTime=null),P.schedule.actualFinishDateTime=null,P.scheduleTimeSpan.timeSpan="")}function v(){var e={num:0,numFromSummary:0,timeCardDate:s.toStringDate(P.schedule.actualStartDateTime),startTime:s.toStringDate(P.schedule.actualStartDateTime),finishTime:s.toStringDate(P.schedule.actualFinishDateTime),jobCode:0,notes:"",barcode:P.barcode,isUserDefined:!0,scheduleId:P.schedule.num};P.schedule.actualStartDateTime?m.pushCheckInOutTimes(e).then(function(e){angular.isArray(e)&&e.length>0?$.alert("Warning",e[0]):$.alert("Success","Details successfully pushed to timecard")}):$.alert("Warning","Please select Check In date and time")}function C(){P.uiSettings.isTimeCardModuleEnabled=P.user.timeCard&&P.user.allowPushTime,P.isServiceProvider=!P.user.isAdminstrator,l.getIniitialData(!0).then(function(e){e&&(P.uiSettings.milageTrackingEnabled=e.customerNumberEntity.milageTrackingEnabled||!1,P.uiSettings.timerEnabled=e.customerNumberEntity.workOrderTimerEnabled||!1,P.uiSettings.showEquipmentTabControl=e.customerNumberEntity.equipmentTrackingOn||!1,P.scheduleStatus=e.secondaryOrderStatus,P.serviceProviders=e.serviceProviders,P.vehicles=e.vehicles)}).finally(I)}function w(){if(P.totals={subtotal:0,totalqty:0,totalcost:0,totaltax:0},P.barCodeData.invoice&&P.barCodeData.invoice.length>0){var e=P.barCodeData.taxRate||0;angular.forEach(P.barCodeData.invoice,function(t){if(t.price&&t.qty&&angular.isNumber(parseFloat(t.price))&&angular.isNumber(parseInt(t.qty,10))){var n=t.price*t.qty,o=parseFloat(parseFloat(e)>0?parseFloat(e/100*n):0);P.totals.subtotal+=parseFloat(n),P.totals.totalqty+=parseInt(t.qty,10),(t.taxable||!1)===!0&&(P.totals.totaltax+=parseFloat(o))}})}}function D(){g(null,null,!1)&&c.updateWorkOrderMobile({barcodeAssay:P.barCodeData.barcodeDetails,fromMobile:!0}).then(function(e){e&&angular.isArray(e)&&e.length>0&&(P.errors=e)})}function b(e,t){t===!0?s.showLoading().then(function(){c.updateSchedule(P.schedule).then(function(){e&&$.alert("Success","Schedule information updated successfully")}).then(s.hideLoading)}):c.updateSchedule(P.schedule).then(function(){e&&$.alert("Success","Schedule information updated successfully")})}function T(e){if(P.uiSettings.woData){var t=_.findWhere(P.uiSettings.woData.invoice,{num:e.num});if(angular.isDefined(t))for(var n in t)e.hasOwnProperty(n)&&(e[n]=t[n])}}function S(){s.showLoading().then(function(){P.schedule.actualStartDateTime=new Date,P.schedule.actualFinishDateTime=null,P.scheduleTimeSpan.onStartDateTimeChaged(),c.updateJobStatus({scheduleButton:A.CheckIn,scheduleNum:P.schedule.num,actualStartTime:s.toStringDate(P.schedule.actualStartDateTime),barcode:P.barcode,timerStartAt:s.toStringDate(new Date)}).then(function(){P.schedule.checkInStatus=!0}).finally(s.hideLoading)})}function k(){P.productSearchModal?P.productSearchModal.show():s.getModal("productSearchModal.html",e).then(function(e){P.productSearchModal=e,P.productSearchModal.show()})}function M(){P.productModal?P.productModal.show():s.getModal("editProductModal.html",e).then(function(e){P.productModal=e,P.productModal.show()})}function E(){var e=P.barCodeData.barcodeDetails,t=e.shipStreet+" "+e.shipCity+" "+e.shipState+" "+e.shipZIP;(new google.maps.Geocoder).geocode({address:t},function(e,t){if(e.length>0){var n=new window.google.maps.LatLng(e[0].geometry.location.lat(),e[0].geometry.location.lng());null===P.map&&(P.map=new google.maps.Map(document.getElementById("map"),{zoom:15,panControl:!1,zoomControl:!0,scaleControl:!0,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP})),new window.google.maps.Marker({position:n,map:P.map,animation:google.maps.Animation.DROP}),j=!0}else s.alerts.alert("Not Found","Failed to locate the address",function(){N.hide()})})}function I(){if(P.user.timeCard===!0){var e=new Date,t=s.toStringDate(new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0));timeCardFactory.getTimeCardByDate(t).then(function(e){e&&(B.currentDetails=e.timeCardDetails)})}}var P=this;P.barcode=o.barCode,P.taxCheckboxVisibility=!0;var $=s.alerts,A={AcceptJob:0,InRoute:1,CheckIn:2,CheckOut:3},F={CLOCK_IN:5001,CLOCK_OUT:5002};P.invoiceOpen=!1,P.uiSettings={isTimeCardModuleEnabled:!1,milageTrackingEnabled:!1,orderBelongToCurrentUser:!1,timerEnabled:!1,woData:null,showEquipmentTabControl:!1},P.errors=[],f();var O=null,x=null;P.scheduleTimeSpan={timeSpan:"",onTimespanSeletionChanged:function(e,t){var o=t.getVal(),a=Math.floor(o/1e3),i=Math.floor(a/60);x=n(function(){var e,t=angular.copy(P.schedule.actualStartDateTime);null==t?(e=new Date,P.schedule.actualStartDateTime=new Date):e=new Date(t);var n=h(e,i);P.schedule.actualFinishDateTime=kendo.parseDate(n)},50)},onStartDateTimeChaged:function(){P.schedule.actualStartDateTime&&P.schedule.actualFinishDateTime&&(new Date(P.schedule.actualStartDateTime)>new Date(P.schedule.actualFinishDateTime)?$.alert("Warning","Start time cannot be greater than finish time."):p(P.schedule.actualStartDateTime,P.schedule.actualFinishDateTime))},onEndDateTimeChanged:function(){P.schedule.actualStartDateTime&&P.schedule.actualFinishDateTime&&(new Date(P.schedule.actualStartDateTime)>new Date(P.schedule.actualFinishDateTime)?$.alert("Warning","Start time cannot be greater than finish time."):p(P.schedule.actualStartDateTime,P.schedule.actualFinishDateTime))},clearAllDateTimeSelection:function(){}},P.user=d.getLoggedInUserInfo(),C();var L=[{text:"Check In"},{text:"Check Out"},{text:'<span class="text-assertive">Clear All</span>'},{text:'<span class="text-assertive">Clear Checkout Time</span>'},{text:"Update Schedule"}],N=null;P.scheduleAddModal=null;var q=null;P.map=null;var j=!1;P.tabs={desc:{events:{closeWorkOrderMapModal:function(){N&&N.hide()},onAddressTapped:function(){s.alerts.confirm("Show Map","Would you like to open map?",function(){N?(N.show(),q=n(E,2e3)):s.getModal("workOrderMap.html",e).then(function(e){N=e,N.show(),j||(q=n(E,2e3))})})},onDescriptionOrResolutionChanged:function(){D()}}},sch:{events:{onAddScheduleCompleted:function(e){e&&(P.barCodeData.schedules=e.schedules,P.barCodeData.invoice=e.invoice,P.scheduleAddModal.hide(),$.alert("Success","Schedule added successfully"))},onModalCancelClicked:function(){P.scheduleAddModal.hide()},onMilageInformationActionButtonClicked:function(){a.show({buttons:[{text:"Save Milage Information"}],titleText:"Milage Information",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&b(!0,!0),!0}})},onTripnoteChanged:function(){b(!1,!1)},updateSchedule:function(){b(!0,!0)},onListScheduleItemTap:function(e){e.num!==P.schedule.num&&$.confirm("Confirmation","Are you sure to load this schedule",function(){t.go("app.editOrder",{barCode:P.barcode,technicianNum:e.num,src:"main"})})},onSchedulesListButtonClicked:function(){a.show({buttons:[{text:"Add New Schedule"}],titleText:"New Schedule",cancelText:"Cancel",cancel:function(){},buttonClicked:function(t){return 0===t&&(null===P.scheduleAddModal?u.fromTemplateUrl("addScheduleModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){P.scheduleAddModal=e,P.scheduleAddModal.show()}):P.scheduleAddModal.show()),!0}})},checkIn:function(){if(P.schedule.approve!==!0&&P.schedule.checkInStatus!==!0){if(g(null,null,!0))if(P.user.timeCard===!0){var e=_.where(B.currentDetails,{jobCode:F.CLOCK_IN,finishTime:null}),t=_.reject(B.currentDetails,{jobCode:F.CLOCK_IN});if(0===e.length)$.confirm("Confirmation!","You have not clocked in yet. You will be clocked in automattically \n\n Are you sure?",function(){S()},function(){});else if(t.length>0){var n=_.where(t,{finishTime:null,jobCodeName:"On Job"});n.length>0?$.alert("Warning!","You have not checked out for previous task.",function(){}):S()}else S()}else S();return!1}$.alert("Alert","Not allowed to checkin")},checkOut:function(){if(P.schedule.approve===!0||P.schedule.checkOutStatus===!0)$.alert("Alert","Not allowed to checkout");else if(g(null,null,!1)){if(null===P.schedule.actualStartDateTime)return $.alert("Warning","Please check in first"),!1;P.schedule.actualFinishDateTime=new Date,P.scheduleTimeSpan.onEndDateTimeChanged(),c.updateJobStatus({scheduleButton:A.CheckOut,scheduleNum:P.schedule.num,actualEndTime:s.toStringDate(P.schedule.actualFinishDateTime),Barcode:P.barcode}).then(function(){P.schedule.checkOutStatus=!0})}},onScheduleActionButtonClicked:function(){var e=angular.copy(L);P.user.allowPushTime&&e.push({text:"<b>Push to Timecard</b>"}),a.show({buttons:e,titleText:"Current Schedule",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&P.tabs.sch.events.checkIn(),1===e&&P.tabs.sch.events.checkOut(),2===e&&y(!0),3===e&&y(!1),4===e&&b(!0,!0),5===e&&v(),!0}})}}},smry:{events:{onTaxCheckboaxChanged:function(e){g(e,T)&&(w(),c.updateOrderProduct(e))}}},prod:{events:{onProdcutActionButtonClicked:function(){a.show({buttons:[{text:"Add New Product"}],titleText:"New Product",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&k(),!0}})},closeProductEditModal:function(){P.productModal.hide()},openProductSearchModal:function(){},onEditProductClicked:function(e){P.currentProduct=angular.copy(e),M()},onDeleteProductClicked:function(e){$.confirmDelete(function(){c.deleteProduct(P.barcode,e.num).then(function(e){e&&(P.barCodeData.products=e.products,P.barCodeData.invoice=e.invoice,w())})})}}}};var B={currentDetails:[]};e.$on("$fpm:closeEditProductModal",function(){P.productModal.hide()}),e.$on("$fpm:closeProductSearchModal",function(e,t){P.productSearchModal&&(t&&t.fromProductAdd===!0&&c.getBarcodeInvoiceAndProductDetails(P.barcode).then(function(e){P.barCodeData.products=e.products,P.barCodeData.invoice=e.invoice,w()}),P.productSearchModal.hide())});var U=null;e.$on("$fpm:operation:updateProduct",function(e,t){if(t&&P.currentProduct){var o=_.filter(P.barCodeData.products,function(e){return e.num===t.num}),a=_.filter(P.barCodeData.invoice,function(e){return"Labor"!==e.productName&&e.numFromSchedule===t.num});U=n(function(){o.length>0&&(o[0].qty=t.qty,o[0].productDescription=t.productDescription,o[0].price=t.price),a.length>0&&(a[0].qty=t.qty,a[0].productDescription=t.productDescription,a[0].price=t.price,a[0].totalPrice=parseFloat(t.qty)*parseFloat(t.price)),w(),P.productModal.hide()},100)}}),e.$on("$destroy",function(){U&&n.cancel(U),O&&n.cancel(O),x&&n.cancel(x),q&&n.cancel(q),P.map=null})}e.$inject=["$scope","$state","$timeout","$stateParams","$ionicActionSheet","$ionicLoading","$ionicPopup","$ionicModal","work-orders-factory","fpm-utilities-factory","shared-data-factory","authenticationFactory","timecard-factory"],angular.module("fpm").controller("edit-order-controller",e)}()}(),function(){"use strict";!function(){var e={templateUrl:"js/work-orders/order-documents-list-component.template.html",bindings:{barcode:"<"},controller:["$scope","work-orders-factory","fpm-utilities-factory","fieldPromaxConfig",function(e,t,n,o){var a=this,i=o.fieldPromaxApi;n.alerts;a.docUrl="",a.events={onDocumentClicked:function(e){window.open(i+"Handlers/GetImageFromBlob.ashx?imageId="+e.num+"&dateStamp="+new Date+"&flag=viewTarget&cust="+e.customerNumber,"_system","location=yes")}},a.$onInit=function(){a.barcode&&t.getUploadedDocuments(a.barcode).then(function(e){a.barcodeDocuments=e})}}],controllerAs:"vm"};angular.module("fpm").component("orderDocumentsListComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<"},templateUrl:"js/work-orders/order-images-list-component.template.html",controller:["$scope","$ionicModal","$ionicLoading","work-orders-factory","fpm-utilities-factory","fieldPromaxConfig",function(e,t,n,o,a,i){var r=this;r.isExpanded=!1;var u=i.fieldPromaxApi,c=a.alerts;r.upload={control:null,uploadImage:function(e,t){n.show({template:"Please wait..."}).then(function(){o.uploadFile({Barcode:r.barcode,Image:e,Name:t}).then(function(e){r.barcodeImages.push({barcode:r.barcode,fileName:t,imageURL:"/"+t,num:e}),c.alert("Uploaded","File Uploaded successfully")}).finally(n.hide)})},options:{multiple:!0,showFileList:!1,localization:{select:"Upload files"},select:function(e){e.isDefaultPrevented=!0;var t=["tif","tiff","gif","jpeg","jpg","jif","jfif","jp2","jpx","j2k","j2c","pcd","png","bmp"];angular.forEach(e.files,function(e){var n=e.name.split("."),o=n.reverse();if(e.size<20971520){var a=_.filter(t,function(e){return o[0].toLowerCase()===e});if(a.length>0){var i=new FileReader;i.onload=function(t){r.upload.uploadImage(t.target.result,e.name)},i.readAsDataURL(e.rawFile)}}})}}},r.currentImage=null,r.events={onDeleteImageClicked:function(e){c.confirmDelete(function(){console.log("HELLO WORLDF")})},onImageTap:function(e){r.currentImage=e,r.imageUrl=u+"Handlers/GetImageFromBlob.ashx?imageId="+e.num+"&dateStamp="+new Date,r.imageViewerModel.show()},closeImageViewModal:function(){r.imageViewerModel.hide()}},r.$onInit=function(){r.barcode&&o.getImagesList(r.barcode).then(function(e){r.barcodeImages=e})},t.fromTemplateUrl("imageViewerModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){r.imageViewerModel=e})}],controllerAs:"vm"};angular.module("fpm").component("orderImagesListComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<"},templateUrl:"js/work-orders/order-signature-card-component.template.html",controller:["$scope","$ionicActionSheet","authenticationFactory","fieldPromaxConfig",function(e,t,n,o){var a=this;a.showingSignaturePad=!1;var i=o.fieldPromaxApi,r=n.getLoggedInUserInfo();a.signPadEvents=null,a.events={onSignaturePadActionButtonClicked:function(){t.show({buttons:[{text:"Hide Signature Pad"},{text:"Save New Signature"}],titleText:"Work Order Signature",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&(a.showingSignaturePad=!1),1===e&&(console.log("EVNT",a.signPadEvents),a.signPadEvents&&a.signPadEvents.trySaveSignature().then(function(e){e===!0&&(a.showingSignaturePad=!1,a.imageUrl=i+"Handlers/GetBarcodeSignature.ashx?barcode="+a.barcode+"&dateStamp="+new Date+"&customernumber="+r.customerNumber)})),!0}})},onSignatureActionButtonClicked:function(){t.show({buttons:[{text:"Show Signature Pad"}],titleText:"Work Order Signature",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&(a.showingSignaturePad=!0),!0}})}},a.imageUrl=i+"Handlers/GetBarcodeSignature.ashx?barcode",a.$onInit=function(){a.imageUrl=i+"Handlers/GetBarcodeSignature.ashx?barcode="+a.barcode+"&dateStamp="+new Date+"&customernumber="+r.customerNumber},a.$onChanges=function(){}}],controllerAs:"vm"};angular.module("fpm").component("orderSignatureComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{padEventsRef:"="},templateUrl:"js/work-orders/order-signature-pad-template.html",controller:["$scope","$stateParams","$q","work-orders-factory",function(e,t,n,o){var a=this;a.customerName="";var i=t.barCode;a.events={trySaveSignature:function(){var e=n.defer(),t=!1,r=$(angular.element("#signature")).jSignature("getData","image");return""!==$.trim(a.customerName)&&angular.isArray(r)&&o.saveJsonSignForBarcode({BaseString:r[1],Barcode:t?"":i,CustomerName:a.customerName,EstimateId:0}).then(function(){e.resolve(!0)}),e.promise}},a.$onInit=function(){var e=angular.element("#signature");$(e).jSignature({lineWidth:1,width:$(document).width()-80,height:200,"decor-color":"transparent"}).bind("change",function(t){var n=$(e).jSignature("getData","image");angular.isArray(n)}),a.padEventsRef=a.events}}],controllerAs:"vm"};angular.module("fpm").component("orderSignaturePad",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",taxrate:"<",defaultEmails:"<"},templateUrl:"js/work-orders/work-order-email-card-template.html",controller:["$scope","$ionicActionSheet","$q","work-orders-factory","fpm-utilities-factory",function(e,t,n,o,a){function i(e){u.mailConfig.mailAddresses&&u.mailConfig.mailAddresses.length>0&&o.sendInvoiceMail({BarCode:u.barcode,SendAsInvoice:e,emailAddresses:u.mailConfig.mailAddresses,TaxRate:u.taxrate}).then(function(){a.alerts.alert("Email Sent","Email Sent Successfully")})}function r(){t.show({buttons:[{text:"Send As Invoice"},{text:"Send As Work Order"}],titleText:"Work Order Email Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0!==e&&1!==e||i(0===e),!0}})}var u=this;u.mailConfig={mailAddresses:[]},u.events={onOrderEmailActionClicked:r},u.$onInit=function(){console.log("DF",u.defaultEmails)}}],controllerAs:"vm"};angular.module("fpm").component("orderEmailCardComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{isCheckedIn:"<",isCheckedOut:"<",isApproved:"<",schedule:"<"},controller:["$interval","$state","$element","$timeout","shared-data-factory",function(e,t,n,o,a){function i(){var e=Math.floor(s.currentTime.totalMinutes/60),t=Math.floor(s.currentTime.totalMinutes%60);s.currentTime.mins=t<=9?"0"+t:t,s.currentTime.hrs=e<=9?"0"+e:e,0===e&&t>=55?s.currentTime.isOnInterval=!0:e>0&&(t>55||t<=5)?s.currentTime.isOnInterval=!0:s.currentTime.isOnInterval=!1}function r(){s.currentTime.showControl===!1&&(s.currentTime.showControl=!0),s.currentTime.isRunning=!0,l=e(function(){s.currentTime.totalMinutes+=1,console.log(s.currentTime.totalMinutes),i()},6e4)}function u(){null!==l&&(s.currentTime.isRunning=!1,e.cancel(l));var t=o(function(){s.currentTime.showControl=!1,o.cancel(t)},100)}function c(){i()}var s=this;s.currentTime={hrs:"00",mins:"00",totalMinutes:0,showControl:!1,isRunning:!1,isOnInterval:!1,intervalMinutes:0,intervalCounter:0};var l=null;this.$onDestroy=function(){u()};var d=!1;this.$onChanges=function(){d===!0&&(s.isCheckedIn===!0&&s.currentTime.isRunning===!1&&r(),s.isCheckedOut===!0&&u())},s.events={refreshTimer:c},this.$onInit=function(){s.currentTime.showControl=!1,a.getIniitialData().then(function(e){d=e.customerNumberEntity.workOrderTimerEnabled||!1,d===!0&&o(function(){if(s.schedule&&(s.currentTime.showControl=s.schedule.checkInStatus===!0&&s.schedule.checkOutStatus===!1,s.schedule.checkInStatus===!0&&s.schedule.timerStartAt&&(s.schedule.checkOutStatus||!1)===!1)){var e=moment(new Date).diff(moment(s.schedule.timerStartAt),"minutes");e>0&&(s.currentTime.totalMinutes=e,i())}},1e3)})}}],templateUrl:"js/work-orders/work-order-timer-component.template.html",controllerAs:"model"};angular.module("fpm").component("workOrderTimerComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function a(t,o){t=null!==t&&t,t===!0&&M.remove(E);var a=M.get(E);return angular.isDefined(a)&&a?e.when(a):n.get(k+"GetMobileDashboard").then(function(e){return M.put(E,e),e})}function i(e){return n.get(k+"GetBarcodeDetails?barcode="+e)}function r(e,t){return n.get(k+"DeleteProduct?barcode="+e+"&productNum="+t)}function u(e){return n.post(k+"UpdateProduct?fromMobile=true",e)}function c(e,t){return n.get(k+"GetProductsLists?searchPattern="+e+"&alphabet="+t)}function s(e){return n.post(k+"AddProductsToOrder?fromMobile=true",e)}function l(e){return n.get(k+"GetBarcodeInvoiceAndProductDetails?barcode="+e)}function d(e){return n.post(k+"SaveJsonSignForBarcode",e)}function m(e){return n.post(k+"SendInvoiceMail",e)}function f(e){return n.get(k+"GetImagesList?barcode="+e)}function p(e){return n.get(k+"GetUploadedDocuments?barcode="+e)}function h(e){return n.post(k+"UploadFile",e)}function g(){var t=M.get("workOrderEntity");return angular.isDefined(t)&&t?e.when(t):n.get(k+"CreateEntity").then(function(e){return M.put("workOrderEntity",e),e})}function y(e){return n.post(k+"CreateWorkOrder",e)}function v(){return n.get(k+"GetBarCodeNumber")}function C(e){return n.post(k+"UpdateWorkOrderMobile",e)}function w(e){return e.clientTime=new Date,n.post(k+"UpdateJobStatus",e)}function D(e){return n.post(k+"UpdateSchedule?fromMobile=true",e)}function b(e){return n.post(k+"AddWorkOrderSchedule",e)}function T(e){return n.post(k+"UpdateOrderProduct",e)}function S(t){t=null!==t&&t,t===!0&&M.remove(I);var o=M.get(I);return angular.isDefined(o)&&o?e.when(o):n.get("api/Scheduler/GetMyCalender?fromMobile=true").then(function(e){return M.put(I,e),e})}var k="api/workorders/",M=t("orderCache"),E="dashboardData",I="workorder:calendar";return{getMobileDashboard:a,getBarcodeDetails:i,deleteProduct:r,updateProduct:u,searchProduct:c,addProduct:s,getBarcodeInvoiceAndProductDetails:l,saveJsonSignForBarcode:d,sendInvoiceMail:m,getImagesList:f,getUploadedDocuments:p,uploadFile:h,createEntity:g,createWorkOrder:y,getBarCodeNumber:v,updateWorkOrderMobile:C,updateJobStatus:w,updateSchedule:D,addWorkOrderSchedule:b,updateOrderProduct:T,getDatewiseEvents:S}}e.$inject=["$q","$cacheFactory","api-base-factory","shared-data-factory"],angular.module("fpm").factory("work-orders-factory",e)}()}();