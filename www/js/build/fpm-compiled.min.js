!function(){"use strict";!function(){function e(e,t,n,a,o,i,r,c){function u(e){angular.forEach(e,function(e){var t=kendo.parseDate(e.scheduledStartDateTime),n=kendo.parseDate(e.scheduledFinishDateTime);t&&n&&f.calendar.events.push({startTime:t,endTime:n,allDay:!1,title:e.barcodeName+" (Estimate)",originalObject:angular.copy(e),eventType:2})})}function l(e){angular.forEach(e,function(e){var t=kendo.parseDate(e.scheduledStartDateTime),n=kendo.parseDate(e.scheduledFinishDateTime);t&&n&&f.calendar.events.push({startTime:t,endTime:n,allDay:!1,title:e.barcodeName+" (Schedule)",originalObject:angular.copy(e),eventType:1})})}function s(e){angular.forEach(e,function(e){var t=kendo.parseDate(e.cacationDate),n=kendo.parseDate(e.vacationDate);e.endDateTime&&(n=kendo.parseDate(e.endDateTime)),t&&n&&f.calendar.events.push({startTime:t,endTime:n,allDay:e.isAllDay,title:e.vacationString,originalObject:angular.copy(e),eventType:3})})}function d(e){f.calendar.events=[],i.showLoading().then(function(){c.getDatewiseEvents(e).then(function(e){e&&(e.estimates.length>0&&u(e.estimates),e.schedules.length>0&&l(e.schedules),e.vacations.length>0&&s(e.vacations))}).finally(i.hideLoading)})}function m(){var e=o.get(h.settingsKeyName);e&&e.DefaultCalenderViewForMobile&&("workWeek"===e.DefaultCalenderViewForMobile?f.events.changeMode("week"):f.events.changeMode(e.DefaultCalenderViewForMobile)),d(!1)}var f=this,h=r.localStorageKeys;f.calendar={mode:"day",events:[],noEventLabel:"No Schedules Found",currentDate:new Date},f.viewTitle="Calendar";i.alerts;f.events={onTimeSelected:function(e,t){},onEventSelected:function(e){if(1===e.eventType){var n=e.originalObject;i.alerts.confirm("Confirmation","Are you sure to edit this work order",function(){t.go("app.editOrder",{barCode:n.barcode,technicianNum:n.num,src:"calender"})})}},today:function(){f.calendar.currentDate=new Date},changeMode:function(e){f.calendar.mode=e},onViewTitleChanged:function(e){f.viewTitle=e},refreshOnPullDown:function(){d(!0)},showActionSheet:function(){a.show({buttons:[{text:"Work Week View"},{text:"Day View"},{text:"Month View"},{text:"Refresh Calender"}],titleText:"Calendar Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&f.events.changeMode("week"),1===e&&f.events.changeMode("day"),2===e&&f.events.changeMode("month"),3===e&&d(!0),!0}})}},e.$on("$ionicView.afterEnter",function(e,t){m()})}e.$inject=["$scope","$state","$timeout","$ionicActionSheet","localStorageService","fpm-utilities-factory","fieldPromaxConfig","work-orders-factory"],angular.module("fpm").controller("calendar-controller",e)}()}(),function(){"use strict";!function(){function e(e){}e.$inject=["$scope"],angular.module("fpm").controller("create-customer-controller",e)}()}(),function(){"use strict";!function(){function e(e,t){function n(t){return e.get(a+"SearchCustomers?searchPattern="+t)}var a="api/CustomerFile/";return{searchCustomers:n}}e.$inject=["api-base-factory","fieldPromaxConfig"],angular.module("fpm").factory("customers-file-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{onCustomerSelected:"&"},controller:["$scope","$ionicModal","customers-file-factory",function(e,t,n){function a(){c.searchValue="",c.customers=[],c.customerModal.show()}function o(){n.searchCustomers(c.searchValue).then(function(e){c.customers=e})}function i(){c.searchValue="",c.customers=[],c.customerModal.hide()}function r(e){c.customerModal.hide(),angular.isFunction(c.onCustomerSelected)&&c.onCustomerSelected({customer:e}),console.log(e)}var c=this;c.searchValue="",c.events={onSearchBoxTapped:a,applySearch:o,closeSearchModal:i,onCustomerSelected:r},t.fromTemplateUrl("customerSearchModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){c.customerModal=e})}],controllerAs:"vm",templateUrl:"js/customer/customer-search-header-component-template.html",replace:!0};angular.module("fpm").component("customerSearchHeaderComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,a,o,i){function r(){s=[];var e=!0;e===!0&&angular.forEach(l.result,function(e,t){e.dataForAdministrator&&e.dataForAdministrator.length>0&&_.forEach(e.dataForAdministrator,function(e){e.ordersJson&&_.forEach(JSON.parse(e.ordersJson),function(e){s.push(e)})})})}function c(e,t){o.getMobileDashboard(e).then(function(e){l.result=e.result,r()}).finally(function(){angular.isFunction(t)&&t()})}function u(){c(!1)}var l=this,s=[];l.isSearchModalOpened=!1,l.events={onSearchItemClick:function(e){e&&(l.matchedOrders=[],l.isSearchModalOpened=!1,l.searchModal.hide(),l.searchValue="",n(function(){t.go("app.editOrder",{barCode:e.Barcode,technicianNum:e.TechnicianScheduleNum,src:"main"})},300))},applySearch:function(){var e=l.searchValue.toLowerCase();l.matchedOrders=_.filter(s,function(t){return t.BarcodeName.toLowerCase().indexOf(e)>-1})},closeSearchModal:function(){l.matchedOrders=[],l.isSearchModalOpened=!1,l.searchModal.hide(),l.searchValue=""},openSearchModal:function(){l.searchValue="",l.matchedOrders=[],l.isSearchModalOpened=!0,l.searchModal.show()},onOrderClicked:function(e){e&&t.go("app.editOrder",{barCode:e.Barcode,technicianNum:e.TechnicianScheduleNum,src:"main"})},refreshOnPullDown:function(){c(!0,function(){e.$broadcast("scroll.refreshComplete")})},onChildGroupClicked:function(e,t,n){e.isOpen=!e.isOpen;var a=i.get("orderState");return null===a&&(a={}),"DD"===t?(e.isOpen===!0?(a[n]=e,i.set("orderState",a)):i.set("orderState",null),!1):void(e.isOpen===!0&&0===e.clickCount?(a[n]=e,i.set("orderState",a),"SP"===t?e.dataForServiceProvider=JSON.parse(e.ordersJson):e.ordersN=JSON.parse(e.ordersJson),e.clickCount+=1):(a[n]=null,i.set("orderState",a)))}},e.$on("$ionicView.loaded",function(e,t){u()}),e.$on("modal.hidden",function(){console.log("Execute action")}),e.$on("modal.removed",function(){console.log("modal.removed")}),e.$on("$destroy",function(){l.searchModal.remove()}),a.fromTemplateUrl("dashboardSearchModal.html",{scope:e,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){l.searchModal=e})}e.$inject=["$scope","$state","$timeout","$ionicModal","work-orders-factory","localStorageService"],angular.module("fpm").controller("dashboard-controller",e)}()}(),function(){"use strict";!function(){function e(e){function t(){return e.get(n+"GetValues")}var n="api/workorders/",a={testCall:t};return a}e.$inject=["api-base-factory"],angular.module("fpm").factory("dashboard-factory",e)}()}(),function(){"use strict";!function(){function e(e){}e.$inject=["$scope"],angular.module("fpm").controller("create-estimate-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,a,o){function i(){o.getExpense("",!0).then(function(e){l.paid=_.filter(e,function(e){return 1==e.expenseStatus}),l.unpaid=_.filter(e,function(e){return 0==e.expenseStatus})})}function r(){i()}function c(e){var t=a.confirm({title:"Delete Expense",template:"Are you sure?"});t.then(function(e){e&&console.log("HELLO WORLD")})}function u(e){console.log(l.modal),l.editedExpense=e,l.modal.show()}var l=this;l.paid=[],l.unpaid=[],l.events={onDeleteClicked:c,onEditClicked:u},e.$on("$ionicView.loaded",function(e,t){r()}),n.fromTemplateUrl("expenseModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){l.modal=e})}e.$inject=["$scope","$ionicLoading","$ionicModal","$ionicPopup","expense-data-factory"],angular.module("fpm").controller("expanses-controller",e)}()}(),function(){"use strict";!function(){function e(e){function t(t,n){return e.get(c+"GetExpense?barcode="+t+"&isFromMain="+n)}function n(t){return e.post(c+"AddExpense",t)}function a(t){return e.deleteApiCall(c+"DeleteExpense?id="+t)}function o(t){return e.get(c+"MarkAsPaidUnPaid?id="+t)}function i(t){return e.deleteApiCall(c+"DeleteImage?expenseId="+t)}var r={},c="api/expense/";return r.schema={expenseId:0,Title:"",Description:"",ExpenseType:0,ExpenseStatus:0,TotalCost:0,Barcode:"",ExpenseDate:new Date,Quantity:1,ImageChanged:!1,havingImage:!1},r.markAsPaidUnPaid=o,r.deleteExpense=a,r.addExpense=n,r.getExpense=t,r.deleteImage=i,r}e.$inject=["api-base-factory"],angular.module("fpm").factory("expense-data-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{expense:"="},template:"HHSKD",controller:["$scope",function(e){console.log("HELLO WORLD")}],controllerAs:"vm"};angular.module("fpm").component("expenseItemComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,a){var o=this;o.sideMenuItems=[{title:"Home",state:"app.dashboard",icon:"home"},{title:"Calendar",state:"app.calendar",icon:"calendar"},{title:"Map",state:"app.map",icon:"location"},{title:"Create Work Order",state:"app.createWorkOrder",icon:"plus-round"},{title:"Create Customer",state:"app.createCustomer",icon:"plus-round"},{title:"Create Estimate",state:"app.createEstimate",icon:"plus-round"},{title:"My Expense",state:"app.expense",icon:"cash"},{title:"Time Card",state:"app.timecard",icon:"clock"},{title:"Settings",state:"app.settings",icon:"settings"},{title:"Change Password",state:"app.changePassword",icon:""},{title:"Logout",state:"app.logout",icon:"power"}],e.$on("$ionicView.beforeEnter",function(e,t){n.showBackButton(!1)}),o.events={onMenuItemClicked:function(e){a.go(e.state)},toggleLeft:function(){}}}e.$inject=["$scope","$ionicSideMenuDelegate","$ionicNavBarDelegate","$state"],angular.module("fpm").controller("app-main-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,a,o,i){var r=this;r.user={userName:"",password:""},r.showError=!1,r.events={loginClick:function(e){return r.showError=!1,r.errors=[],e?void n.show({template:"authenticating you..."}).then(function(){a.login(r.user).then(function(e){n.hide().then(function(){e&&a.authentication.isAuth&&o.go("app.dashboard")})},function(e){n.hide(),r.showError=!0,e.error?r.errors=[e.error]:r.errors=["Invalid Email or Password"]})}):(t.alert({title:"Oops",template:"Please enter login information..."}),!1)}}}e.$inject=["$ionicScrollDelegate","$ionicPopup","$ionicLoading","authenticationFactory","$state","dashboard-factory"],angular.module("fpm").controller("login-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function a(){n.logout(),t.go("login")}a(),console.log("HELLO WORLD")}e.$inject=["$scope","$state","authenticationFactory"],angular.module("fpm").controller("logout-controller",e)}()}(),function(){"use strict";!function(){function e(e){var t=this;t.heading="HELLLO WORLD FROM IONIC"}e.$inject=["$scope"],angular.module("fpm").controller("main-controller",e)}()}(),function(){"use strict";!function(){function e(e,n,a,o,i,r){function c(){console.log("HELLO WORLD"),f.filtersModal&&f.filtersModal.show()}function u(){f.filtersModal&&f.filtersModal.hide()}function l(){}function s(){i.getMapData().then(function(e){e&&(f.mapData.users=e.users)})}function d(){h.center=new window.google.maps.LatLng(t.y,t.x),r.getIniitialData().then(function(e){if(f.iniitialData=e,e){var n=e.customerNumberEntity;h.center=new window.google.maps.LatLng(n.coordinateY||t.y,n.coordinateX||t.x),h.zoom=n.zoomDepth||8,f.map=new google.maps.Map(document.getElementById("map"),h)}else h.center=new window.google.maps.LatLng(t.y,t.x),f.map=new google.maps.Map(document.getElementById("map"),h)}).finally(s)}function m(){d()}var f=this;console.log(n);var h={center:null,panControl:!1,zoomControl:!0,scaleControl:!0,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP};o.fromTemplateUrl("mapFilters.html",{scope:e,animation:"slide-in-up"}).then(function(e){f.filtersModal=e}),f.filtersApplied=!1,f.events={onFiltersClicked:c,clearFilters:u,applyFilters:l},f.mapData={users:[]},m()}var t={x:44.31127,y:-92.67851,xcom:-92.67851,ycom:44.3112679};e.$inject=["$scope","$cordovaGeolocation","$timeout","$ionicModal","map-factory","shared-data-factory"],angular.module("fpm").controller("map-controller",e)}()}(),function(){"use strict";!function(){function e(e){function t(){return e.get(n+"GetMapData")}var n="api/Dashboard/";return{getMapData:t}}e.$inject=["api-base-factory"],angular.module("fpm").factory("map-factory",e)}()}(),function(){"use strict";!function(){function e(e){function t(){console.log("HELLO WORLD")}var n=this;n.events={onChangePasswordClicked:t}}e.$inject=["$scope"],angular.module("fpm").controller("change-password-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,a){function o(){var e=n.get(a.localStorageKeys.settingsKeyName);console.log(e),e&&(i.userSettings.defaultCalenderViewForMobile=e.DefaultCalenderViewForMobile||"workWeek",i.userSettings.startupPageForMobile=e.StartupPageForMobile||states.todaysWorkOrders,i.userSettings.pushNotifications=e.PushNotifications||!1,i.userSettings.locationServices=e.LocationServices||!1)}var i=this;i.userSettings={defaultCalenderViewForMobile:"workWeek",pushNotifications:!1,locationServices:!1},o()}e.$inject=["$scope","$state","localStorageService","fieldPromaxConfig"],angular.module("fpm").controller("settings-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function a(a,o,i){function r(e,t,n,a){return u.resolve(e)}function c(e){u.reject(e)}var u=t.defer();return e({method:a,url:n.fieldPromaxApi+o,data:i}).success(r).error(c),u.promise}function o(e,t){return a("POST",e,JSON.stringify(t))}function i(e,t){return a("GET",e,t)}function r(e,t){return a("DELETE",e,t)}var c={get:i,post:o,deleteReq:r};return c}e.$inject=["$http","$q","fieldPromaxConfig"],angular.module("fpm").factory("api-base-factory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,a,o,i,r,c,u){function l(n){function a(e){if(e){C.isAuth=!0,C.userName=e.userName;var t={token:e.access_token,userName:e.userName,customerNumber:e.customerNumber,secLevel:e.secLevel,isAdminstrator:"True"===e.isAdminstrator,isIntuitUser:"True"===e.isIntuitUser,userEmail:e.userEmail,etOn:"True"===e.etOn,timeCard:"True"===e.timeCard,allowPushTime:"True"===e.allowPushTime,showPrice:"True"===e.showPrice,havingGroupsAssigned:"True"===e.havingGroups};c.set(g.storageKeyName,t),e.hasOwnProperty(g.configKeyName)&&c.set(g.configKeyName,JSON.parse(e.configurations)),e.userSettings&&c.set(g.settingsKeyName,JSON.parse(e.userSettings)),u.resolve(e)}else e.data?u.reject(e.data.error):u.reject("Invalid Login Details")}function o(e){r.hide(),u.reject(e)}var i="grant_type=password&username="+n.userName+"&password="+n.password+"&client_id=fieldPromaxMob",u=t.defer();return e.post(p+"token",i,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(a).error(o),u.promise}function s(){var e=t.defer(),n=c.get(g.storageKeyName);return n?e.resolve(!0):e.resolve(!1),e.promise}function d(){return c.get(g.storageKeyName)}function m(){c.remove(g.initialData),c.remove(g.storageKeyName),c.remove(g.configKeyName),c.remove(g.settingsKeyName),c.remove("orderState")}function f(e){return apiContext.get("/api/public/SendPassword?email="+e)}function h(e){return apiContext.post("/api/changepassword/changepassword",e)}var p=u.fieldPromaxApi,g=u.localStorageKeys,C={isAuth:!1,userName:""},y={login:l,isAuthenticated:s,getLoggedInUserInfo:d,logout:m,sendPassword:f,authentication:C,changePassword:h};return y}e.$inject=["$http","$q","$rootScope","$state","$window","$timeout","$ionicLoading","localStorageService","fieldPromaxConfig"],angular.module("fpm").factory("authenticationFactory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,a,o){return{toStringDate:function(e){return moment(e).format("lll")},showLoading:function(e){var t=e||"please wait...";return o.show({template:t})},hideLoading:function(){return o.hide()},alerts:{alert:function(e,t,a){var o=n.alert({title:e,template:t});angular.isFunction(a)&&o.then(function(e){a()})},confirm:function(e,t,a,o){var i=n.confirm({title:e,template:t});i.then(function(e){e?angular.isFunction(a)&&a():angular.isFunction(o)&&o()})},confirmDelete:function(e){var t=n.confirm({title:"Confirmation",template:"Are you sure?"});t.then(function(t){t&&angular.isFunction(e)&&e()})}}}}function t(){return function(e){var t=e.substr(e.lastIndexOf("/")+1),n=t.substr(0,t.lastIndexOf("."))||"";return n}}e.$inject=["$cordovaDialogs","$q","$ionicPopup","$ionicModal","$ionicLoading"],angular.module("fpm").factory("fpm-utilities-factory",e),angular.module("fpm").filter("removeExt",[t])}()}(),function(){"use strict";!function(){function e(e,t,n){var a={BadRequest:400,PageNotFound:401},o={},i=function(e){e.headers=e.headers||{};var t=n.get("authorizationData");return t&&(e.headers.Authorization="Bearer "+t.token),e},r=function(n){if(n.status===a.PageNotFound&&t.path("/"),n.status===a.BadRequest&&n.data)throw n;return e.reject(n)};return o.request=i,o.responseError=r,o}e.$inject=["$q","$location","localStorageService"],angular.module("fpm").factory("requestIntercepter",e)}()}(),function(){"use strict";!function(){function e(e,t,n,a){function o(o){var r=a.localStorageKeys.initialData,c=o||!1;c===!0&&n.remove(r);var u=n.get(r);return u?e.when(u):t.get(i+"GetIniitialData").then(function(e){return n.set(r,e),e})}var i="api/Shared/";return{getIniitialData:o}}e.$inject=["$q","api-base-factory","localStorageService","fieldPromaxConfig"],angular.module("fpm").factory("shared-data-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{isEstimate:"<",onAddProductCompleted:"&",modalType:"<",product:"="},templateUrl:"js/shared-components/edit-product-component-template.html",controller:["$scope","$stateParams","$rootScope","work-orders-factory","authenticationFactory",function(e,t,n,a,o){var i=this;i.user=o.getLoggedInUserInfo(),i.events={closeProductEditModal:function(){n.$broadcast("$fpm:closeEditProductModal")},updateProductClick:function(){if(0===i.modalType){var o=i.isEstimate?null:a.updateProduct;o(i.product).then(function(t){e.$emit("$fpm:operation:updateProduct",t)})}else i.product.BarCode=t.barCode,i.product.Quantity=i.product.qty,i.product.FromListWindow=!0,a.addProduct(i.product).then(function(e){angular.isFunction(i.onAddProductCompleted)?i.onAddProductCompleted({product:e}):n.$broadcast("$fpm:operation:addProduct",e)})}}}],controllerAs:"vm"};angular.module("fpm").component("editProductComponent",e)}()}(),function(){"use strict";!function(){var e={templateUrl:"js/shared-components/product-search-component-template.html",controller:["$scope","$timeout","$ionicModal","work-orders-factory",function(e,t,n,a){var o=this;o.searchValue="",o.products=[],o.events={closeProductEditModal:function(){o.productModal.hide()},applySearch:function(){a.searchProduct(o.searchValue,"").then(function(e){o.products=e})},onProductItemClicked:function(e){o.currentProduct=angular.copy(e),o.currentProduct.qty=1,o.productModal&&o.productModal.show()},closeSearchModal:function(){e.$emit("$fpm:closeProductSearchModal",{fromProductAdd:!1})},onAddProductCompleted:function(n){o.productModal.hide(),t(function(){e.$emit("$fpm:closeProductSearchModal",{fromProductAdd:!0})},100)}},e.$on("$fpm:closeEditProductModal",function(){o.productModal.hide()}),n.fromTemplateUrl("addProductModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){o.productModal=e})}],controllerAs:"vm"};angular.module("fpm").component("productSearchComponent",e)}()}(),function(){"use strict";!function(){angular.module("fpm").filter("timeSpan",function(){return function(e,t){if(Date.parse(e)&&Date.parse(t)){var n=moment(t).diff(kendo.parseDate(e),"minutes"),a=Math.floor(n/60),o=n%60;return a>0?a+" hrs "+o+" min":o+" min"}return""}})}()}(),function(){"use strict";!function(){var e={bindings:{onCancelClicked:"&",onAddCompleted:"&",details:"<",isFromPto:"<",editMode:"<"},controller:["$scope","$timeout","$ionicActionSheet","timecard-factory","fpm-utilities-factory","authenticationFactory",function(e,t,n,a,o,i){function r(){if(h.ui.errors=[],null!==h.entity.finishTime){var e=kendo.parseDate(h.entity.finishTime),t=kendo.parseDate(h.entity.timeCardDate),n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),(new Date).getHours(),(new Date).getMinutes(),0,0),i=moment(new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),0,0)),r=moment(i).diff(kendo.parseDate(h.entity.startTime),"minutes");if(r<0)return h.ui.errors.push("Invalid Time"),!1;if(!h.isFromPto&&!h.editMode&&i.isAfter(n))return h.ui.errors.push("Cannot be a future time"),!1}return null===h.entity.jobCode||0===h.entity.jobCode?(h.ui.errors.push("Please select Job code before save"),!1):void o.showLoading().then(function(){var e=h.isFromPto?a.addPtoDetails:a.addNewDetails;e(h.entity).then(function(e){g=!1,angular.isArray(e.errors)&&e.errors.length>0?h.ui.errors=e.errors:p.alert("Time Added","Time has been "+(h.editMode?"updated":"added"),function(){angular.isFunction(h.onAddCompleted)&&h.onAddCompleted({o:e})})}).finally(o.hideLoading)})}function c(){var e=a.summary,t=h.dateTimeMode.startTime,n=kendo.parseDate(e.timeCardDate);h.entity.startTime=new Date(n.getFullYear(),n.getMonth(),n.getDate(),t.getHours(),t.getMinutes(),0,0),d()}function u(){var e=a.summary;null===h.entity.startTime&&c();var t=h.dateTimeMode.finishTime,n=kendo.parseDate(e.timeCardDate);h.entity.finishTime=new Date(n.getFullYear(),n.getMonth(),n.getDate(),t.getHours(),t.getMinutes(),0,0),d()}function l(){var e=a.summary;if(e&&e.timeCardDate){var t=kendo.parseDate(e.timeCardDate),n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),(new Date).getHours(),(new Date).getMinutes(),0);h.entity.startTime=n,h.dateTimeMode.startTime=n}}function s(){h.editMode&&h.details?(h.entity=angular.copy(h.details),h.entity.startTime=kendo.parseDate(h.details.startTime),h.entity.finishTime=kendo.parseDate(h.details.finishTime),h.isFromPto=h.details.isPtoType,h.entity.startTime&&(h.dateTimeMode.startTime=h.entity.startTime,h.dateTimeMode.isCheckedIn=!0),h.entity.finishTime&&(h.dateTimeMode.finishTime=h.entity.finishTime,h.dateTimeMode.isCheckedOut=!0),h.dateTimeMode.isCheckedOut=null!==h.entity.finishTime,d()):(h.entity=angular.copy(C),h.entity.startTime=new Date,h.entity.finishTime=new Date,h.isFromPto===!0&&l()),a.summary&&(h.entity.numFromSummary=a.summary.num,h.entity.timeCardDate=new Date(moment(a.summary.timeCardDate))),h.timecardPermissions.isFromAddingPto=h.isFromPto}function d(){if(h.ui.errors=[],h.ui.isInvalidSave=!1,console.log("Date.parse(vm.entity.finishTime)",Date.parse(h.entity.finishTime)),Date.parse(h.entity.startTime)&&Date.parse(h.entity.finishTime)){var e=new Date(h.entity.finishTime),n=new Date(h.entity.startTime);console.log("new Date(vm.entity.finishTime",new Date(h.entity.finishTime));var a=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),0,0),o=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),0,0),i=moment(a).diff(moment(o),"minutes"),r=Math.floor(i/60),c=i%60,u=t(function(){i>0?r>0?h.dateTimeMode.timeSpan=r+(r>1?" Hours ":" Hour ")+c+(c>1?" Minutes":" Minute"):h.dateTimeMode.timeSpan=c+" Minutes":h.isInEditMode||(h.entity.finishTime=new Date,h.ui.isInvalidSave=!0,h.ui.errors.push("Invalid Time")),t.cancel(u)},10)}return""}function m(){o.showLoading().then(function(){a.getWorkOrdersList().then(function(e){h.ui.workOrders=e}).finally(f)})}function f(){o.showLoading().then(function(){a.getJobCodes().then(function(e){h.ui.jobCodes=_.where(e,{isPtoType:!1}),h.ui.ptoJobCodes=_.where(e,{isPtoType:!0})}).finally(o.hideLoading)}).finally(o.hideLoading)}var h=this,p=o.alerts,g=!1;h.ui={summary:angular.copy(a.summary),jobCodes:[],workOrders:[],errors:[],isInvalidSave:!1,ptoJobCodes:[]},h.dateTimeMode={timeSpan:"",startTime:new Date,finishTime:null,isCheckedIn:!1,isCheckedOut:!1};var C={num:0,numFromSummary:0,timeCardDate:new Date,startTime:null,finishTime:null,jobCode:0,notes:"",barcode:0,isUserDefined:!0};h.timecardPermissions={allowPushTime:!1,timePickerVisibility:!0,isFromAddingPto:!1},h.entity=null,h.events={onCardActionClicked:function(){n.show({buttons:[{text:"Check In"},{text:"Check Out"}],titleText:"Time card",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&(h.dateTimeMode.startTime=new Date,h.entity.startTime=new Date,h.entity.finishTime=null,h.dateTimeMode.finishTime=null,h.dateTimeMode.isCheckedIn=!0,d()),1===e&&(h.dateTimeMode.finishTime=new Date,h.entity.finishTime=new Date,h.dateTimeMode.isCheckedOut=!0,d()),!0}})},updateButtonClicked:function(){if(h.ui.errors=[],h.ui.isInvalidSave=!1,null===h.entity.startTime&&(h.entity.startTime=new Date),h.entity.startTime=kendo.toString(h.entity.startTime,"g"),h.entity.finishTime=kendo.toString(h.entity.finishTime,"g"),!h.editMode){var e=angular.copy(a.details),t=_.where(e,{finishTime:null});return t.length>0&&!g?p.confirm("Confirmation!","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(e){g=!0,r()}):r(),!1}return r(),!1},closeProductEditModal:function(){angular.isFunction(h.onCancelClicked)&&h.onCancelClicked()},onDateTimeChaged:c,onFinishDateTimeChaged:u},h.$onChanges=function(){s()},s(),h.$onInit=function(){h.userInfo=i.getLoggedInUserInfo(),h.userInfo&&(h.timecardPermissions.allowPushTime=h.userInfo.allowPushTime,h.timecardPermissions.timePickerVisibility=!1),h.timecardPermissions.isFromAddingPto=h.isFromPto,h.timecardPermissions.isFromAddingPto===!0&&(h.timecardPermissions.timePickerVisibility=!0),m()},e.$on("timecard:addEditDetailsModal:open",function(){h.entity=angular.copy(C),h.dateTimeMode.startTime=null,h.dateTimeMode.finishTime=null,h.dateTimeMode.timeSpan=""})}],controllerAs:"vm",templateUrl:"js/timecard/timecard-add-edit-detail-component.template.html"};angular.module("fpm").component("addEditDetailsComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,a,o,i,r,c,u,l){function s(e){var t=_.where(e.timeCardDetails,{finishTime:null});return t.length>0?(T.ui.data.allowSendForApproval=!1,!1):T.ui.data.approvalStatus!==M.NONE?(T.ui.data.allowSendForApproval=!1,!1):(T.ui.data.allowSendForApproval=!0,!0)}function d(){var e=new Date(T.ui.data.currentDate.getFullYear(),T.ui.data.currentDate.getMonth(),T.ui.data.currentDate.getDate(),0,0,0,0),t=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),0,0,0,0),n=moment(e).isBefore(t),a=moment(e).isAfter(t);moment(e).isSame(t)&&(T.ui.data.addTimeVisibility=T.ui.data.isClockedIn,T.ui.data.ptoButtonVisibility=!T.ui.data.isClockedIn),T.ui.data.disableClockInButton=n,T.ui.data.isClockedOut===!0&&(T.ui.data.disableClockOutButton=n),a===!0&&(T.ui.data.disableClockInButton=!0,T.ui.data.addTimeVisibility=!1,T.ui.data.ptoButtonVisibility=!0),n===!0&&(T.ui.data.addTimeVisibility=!1,T.ui.data.ptoButtonVisibility=!0)}function m(e){var t=1,n=1;T.ui.data.timeCards=[],e.length>0&&angular.forEach(e,function(a,o){console.log(a),a.jobCode!==b.CLOCK_IN?a.isPtoType?(a.pto=n,n++):(a.section=t,t++):a.section=0,o===e.length-1&&(T.ui.data.timeCards=_.reject(e,{jobCode:b.CLOCK_IN,finishTime:null}))})}function f(e){if(console.log("details",e),T.ui.data.timeCards=[],T.ui.data.summary=e.timeCardSummary,T.factory.summary=e.timeCardSummary,T.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0,P=e.pendingClockIns,T.ui.data.currentClockedIn=_.findWhere(e.timeCardDetails,{jobCode:b.CLOCK_IN,finishTime:null}),s(e),angular.isDefined(T.ui.data.currentClockedIn)){var t=T.ui.data.currentClockedIn;T.ui.data.clockInDateTime=moment(t.startTime),T.ui.data.isClockedIn=!0,T.ui.data.isClockedOut=null!==t.finishTime,T.ui.data.addTimeVisibility=!T.ui.data.isClockedOut,T.ui.data.clockOutDateTime=moment(t.finishTime),T.ui.data.clockedInDate=angular.copy(t)}d(),m(e.timeCardDetails)}function h(){T.ui.data.totalTime="0";var e=_.filter(T.ui.data.timeCards,function(e){return e.jobCode===b.CLOCK_IN&&null!==e.finishTime}),t=_.filter(T.ui.data.timeCards,function(e){return e.jobCode!==b.CLOCK_IN&&e.isPayable===!1&&null!==e.finishTime}),n=0;if(e.length>0&&angular.forEach(e,function(e,t){n+=moment(e.FinishTime).diff(kendo.parseDate(e.startTime),"minutes")}),t.length>0){var a=0;angular.forEach(t,function(e,o){if(a+=moment(e.finishTime).diff(moment(e.startTime),"minutes"),o===t.length-1){n-=a;var i=Math.floor(n/60),r=n%60;T.ui.data.totalTime=i+" hrs "+r+" min"}})}else{var o=Math.floor(n/60),i=n%60;T.ui.data.totalTime=o+" hrs "+i+" min"}}function p(){u.showLoading().then(function(){c.getTimeCardByDate(k(T.currentDate)).then(function(e){console.log("getTimeCardByDate",e),e?f(e):d()}).finally(u.hideLoading)})}function g(){a.openDatePicker(E)}function C(e){T.popover.show(e)}function y(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),0,0);console.log(kendo.toString(t,"g"));var n={startTime:kendo.toString(t,"g"),jobCode:b.CLOCK_OUT,numFromSummary:T.ui.data.summary.Num,timeCardDate:moment(T.ui.data.summary.timeCardDate),uniqueIdentifier:T.ui.data.currentClockedIn.uniqueIdentifier};c.clockInOutUser(n).then(function(e){if(null===e.errors){T.ui.data.clockOutDateTime=t,T.ui.data.isClockedOut=!0,T.ui.data.isClockedIn=!1,T.ui.data.disableClockOutButton=!0,T.ui.data.addTimeVisibility=!1,T.ui.data.ptoButtonVisibility=!0,T.ui.data.summary=e.timeCardSummary,T.factory.summary=n.timeCardSummary;var a=new Date,o=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),i=new Date(moment(T.ui.data.summary.timeCardDate)),r=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0);moment(r).isSameOrAfter(o)&&(T.ui.data.disableClockInButton=!1),T.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0,m(e.timeCardDetails),s(e)}})}function D(){null===T.ui.data.addEditDetailsModal?i.fromTemplateUrl("timecardDetailsModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){T.ui.data.addEditDetailsModal=t,e.$broadcast("timecard:addEditDetailsModal:open"),T.ui.data.addEditDetailsModal.show()}):(e.$broadcast("timecard:addEditDetailsModal:open"),T.ui.data.addEditDetailsModal.show())}function v(){null===T.ui.data.timeCardSummaryModal?i.fromTemplateUrl("timecardSummaryModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){T.ui.data.timeCardSummaryModal=t,e.$broadcast("timecard:timeCardSummaryModal:open"),T.ui.data.timeCardSummaryModal.show()}):(e.$broadcast("timecard:timeCardSummaryModal:open"),T.ui.data.timeCardSummaryModal.show())}function w(){null===T.ui.data.timecardTutorialModal?i.fromTemplateUrl("timecardTutorialModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){T.ui.data.timecardTutorialModal=e,T.ui.data.timecardTutorialModal.show()}):T.ui.data.timecardTutorialModal.show()}function S(){p();var e=l.getLoggedInUserInfo(),t=_.findWhere(O,{c:e.customerNumber});T.ui.data.enableForCustomer=angular.isDefined(t)}var T=this,b={CLOCK_IN:5001,CLOCK_OUT:5002},k=u.toStringDate,M={NONE:0,SEND_FOR_APPROVAL:1,CANCELLED:2,APPROVED:3},P=[],I=!1;T.errors=[],T.factory=c;var $=u.alerts;T.currentDate=new Date,o.fromTemplateUrl("my-popover.html",{scope:e}).then(function(e){T.popover=e});var E={callback:function(e){T.currentDate=new Date(e),p()},inputDate:T.currentDate};T.events={onDatePickerClicked:g,showPopoverClicked:C},T.ui={errors:[],calendar:{settings:{theme:"mobiscroll",display:"bottom",swipeDirection:"vertical"}},data:{componentEvents:null,summary:null,currentDate:new Date,isClockedIn:!1,isClockedOut:!1,clockInDateTime:new Date,clockOutDateTime:new Date,addTimeVisibility:!1,clockedInDate:null,timeCards:[],approvalStatus:0,disableClockInButton:!1,disableClockOutButton:!1,currentClockedIn:null,allowSendForApproval:!1,totalTime:"",enableForCustomer:!1,ptoButtonVisibility:!1,isFromPto:!1,isInEditMode:!1,addEditDetailsModal:null,timeCardSummaryModal:null,currentDetails:null,timecardTutorialModal:null},events:{onTutorialModalCancel:function(){T.ui.data.timecardTutorialModal&&T.ui.data.timecardTutorialModal.hide()},onSummaryModalCancel:function(){T.ui.data.timeCardSummaryModal.hide()},checkSummaryClick:function(){return v(),T.popover.hide(),!0},showTimeCardTutorialWindow:function(){return T.popover.hide(),w(),!0},onAddScheduleCompleted:function(e){T.ui.data.timeCards.length!==e.timeCardDetails.length&&(T.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0),m(e.timeCardDetails),
T.ui.data.addEditDetailsModal.hide()},onModalCancelClicked:function(){T.ui.data.isInEditMode=!1,T.ui.data.isFromPto=!1,T.ui.data.currentDetails=null,T.ui.data.addEditDetailsModal.hide()},addTimeClick:function(e){return T.ui.data.isFromPto=e,T.ui.data.isInEditMode=!1,D(),T.popover.hide(),!0},onCardActionClicked:function(e){r.show({buttons:[{text:"Edit"}],destructiveText:"Delete",titleText:"Time Card Options",cancelText:"Cancel",cancel:function(){},destructiveButtonClicked:function(){return e.isUserDefined?$.confirmDelete(function(){u.showLoading().then(function(){c.deleteTimeCardDetails(e.num,e.numFromSummary).then(function(e){e&&$.alert("Success","Time Details cleared successfully",function(){m(e.timeCardDetails)})}).finally(u.hideLoading)})}):$.alert("Invalid Action","You are not allowed to perform delete"),!0},buttonClicked:function(t){return 0===t&&(T.ui.data.currentDetails=e,T.ui.data.isInEditMode=!0,T.ui.data.isFromPto=!1,D()),!0}})},sendForApproval:function(e){return angular.isArray(T.ui.data.timeCards)&&0===T.ui.data.timeCards.length?($.alert("No Timecard!","No Timecard information found to process this request."),!1):void $.confirm("Confirmation!","Are you sure?",function(){u.showLoading().then(function(){timeCardFactory.sendForApproval(T.ui.data.summary.Num,e).then(function(e){e&&(T.ui.data.summary=e.timeCardSummary,$timeout(function(){$.alert("Success","Time card sent for approval successfully",function(){T.ui.data.addTimeVisibility=!1,T.ui.data.ptoButtonVisibility=!1,T.ui.data.approvalStatus=T.ui.data.summary.ApproveStatus||0})},100))}).finally(u.hideLoading)})})},clockOutClick:function(){var e=_.where(T.ui.data.timeCards,{finishTime:null});e.length>0?$.confirm("Confirmation!","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(){y()}):$.confirm("Confirmation!","Are you sure?",function(){y()})},clockInClick:function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),(new Date).getHours(),(new Date).getMinutes(),0,0),a={startTime:u.toStringDate(t),jobCode:b.CLOCK_IN,numFromSummary:null===T.ui.data.summary?0:T.ui.data.summary.Num,timeCardDate:t};T.errors=[],c.clockInOutUser(a).then(function(e){null===e.errors?(T.ui.data.clockInDateTime=t,T.ui.data.isClockedIn=!0,T.ui.data.addTimeVisibility=!0,T.ui.data.ptoButtonVisibility=!1,$.alert("Clocked In","Clocked in successfully",function(){I===!0?n.go($stateParams.proute):f(e)})):T.errors=e.errors})}}};var O=[{c:"407805491"},{c:"1238967820"}];e.$watch("vm.ui.data.timeCards",function(e){T.factory.details=e,angular.isDefined(e)&&h()},!0),S()}e.$inject=["$scope","$rootScope","$state","ionicDatePicker","$ionicPopover","$ionicModal","$ionicActionSheet","timecard-factory","fpm-utilities-factory","authenticationFactory"],angular.module("fpm").controller("timecard-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function a(t){return e.get(D+"GetTimeCardByDate?date="+t)}function o(t){return e.get(D+"GetClockInByDate?date="+t)}function i(t){return e.post(D+"ClockInOutUser",t)}function r(n){n=n||!1,n===!0&&v.remove("jobCodes");var a=v.get("jobCodes");return angular.isDefined(a)&&a?t.when(a):e.get(D+"GetJobCodes").then(function(e){return v.put("jobCodes",e),e})}function c(n){n=n||!1,n===!0&&v.remove("workorders");var a=v.get("workorders");return angular.isDefined(a)&&a?t.when(a):e.get(D+"GetWorkOrdersList").then(function(e){return v.put("workorders",e),e})}function u(t){return e.post(D+"AddNewDetails",t)}function l(t,n){return e.get(D+"ClearCheckedOutTime?detailId="+t+"&summaryId="+n)}function s(t,n){return e.get(D+"SendForApproval?summaryId="+t+"&status="+n)}function d(t,n){return e.get(D+"DeleteTimeCardDetails?detailId="+t+"&summaryId="+n)}function m(t){return e.get(D+"ClearTimeCard?summaryId="+t)}function f(){return e.get(D+"GetPendingClockIns")}function h(t){return e.post(D+"PushCheckInOutTimes",t)}function p(){return e.get(D+"CertifieldUser")}function g(){return e.get(D+"GetCertifieldUser")}function C(t){return e.post(D+"AddPtoDetails",t)}function y(t){return e.post(D+"GetPayableHoursSummaryView",t)}var D="api/timecard/",v=n("timeCardCache"),w={details:[],jobCodes:{CLOCK_IN:5001,CLOCK_OUT:5002},summary:null},S={};return S.addPtoDetails=C,S.getSummaryPayableHours=y,S.certifyUser=p,S.getCertifieldUser=g,S.pushCheckInOutTimes=h,S.data=w,S.getPendingClockIns=f,S.getJobCodes=r,S.clockInOutUser=i,S.getClockInByDate=o,S.getTimeCardByDate=a,S.getWorkOrdersList=c,S.addNewDetails=u,S.clearCheckedOutTime=l,S.sendForApproval=s,S.deleteTimeCardDetails=d,S.clearTimeCard=m,S}e.$inject=["api-base-factory","$q","$cacheFactory"],angular.module("fpm").factory("timecard-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{onCancelClicked:"&"},controller:["$scope","$ionicActionSheet","timecard-factory","fpm-utilities-factory",function(e,t,n,a){function o(){angular.isFunction(u.onCancelClicked)&&u.onCancelClicked()}function i(){u.payableReport=[];var e=[];a.showLoading().then(function(){n.getSummaryPayableHours({startDate:u.modal.startDate,finishDate:u.modal.endDate}).then(function(t){t&&t.length>0&&angular.forEach(t,function(n,a){var o=_.findWhere(e,{timeCardDate:n.timeCardDate}),i=parseFloat(parseInt(n.totalMinutes,10)/60).toFixed(2);angular.isDefined(o)?(n.IsPayable?o.payableHours=parseFloat(i):o.nonPayable=parseFloat(i),o.total=parseFloat(o.payableHours)+parseFloat(o.nonPayable)):e.push({timeCardDate:n.timeCardDate,payableHours:n.isPayable===!0?parseFloat(i):0,nonPayable:n.isPayable===!1?parseFloat(i):0,total:parseFloat(i).toFixed(2)}),a===t.length-1&&(u.payableReport=e,_.forEach(e,function(e){u.totalPayables.p+=parseFloat(e.payableHours),u.totalPayables.np+=parseFloat(e.nonPayable),u.totalPayables.t+=parseFloat(e.total)}))})}).finally(a.hideLoading)})}function r(){t.show({buttons:[{text:"Show Current"},{text:"As Selected Dates"}],titleText:"Time card Report",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&c(),1===e&&(u.showCurrentSummary=!1),!0}})}function c(){u.lists={clockInOuts:[],payables:[],nonPayables:[]},a.showLoading().then(function(){if(angular.isArray(n.details)&&n.details.length>0){u.lists.clockInOuts=_.where(n.details,{jobCode:l.CLOCK_IN});var e=_.reject(n.details,{jobCode:l.CLOCK_IN});u.lists.payables=_.where(e,{isPayable:!0}),u.lists.nonPayables=_.where(e,{isPayable:!1})}a.hideLoading()}),u.showCurrentSummary=!0}var u=this,l=n.data.jobCodes;u.lists={clockInOuts:[],payables:[],nonPayables:[]},u.modal={startDate:new Date,endDate:null},u.payableReport=[],u.totalPayables={p:0,np:0,t:0},u.events={closeProductEditModal:o,showReport:i,onCardActionClicked:r},u.$onInit=function(){c()},e.$on("timecard:timeCardSummaryModal:open",function(){c()})}],controllerAs:"vm",templateUrl:"js/timecard/timecard-summary-component.template.html"};angular.module("fpm").component("timecardSummaryComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{onCancelClicked:"&"},controller:["$scope","timecard-factory",function(e,t){function n(){angular.isFunction(o.onCancelClicked)&&o.onCancelClicked()}function a(){t.certifyUser().then(function(e){e&&(o.isCertifield=!0,o.info=e)})}var o=this;o.isCertifield=!1,o.info=null,o.events={closeProductEditModal:n,onCertifyClicked:a},o.$onInit=function(){t.getCertifieldUser().then(function(e){e&&(o.isCertifield=e.isCertified||!1,o.info=e)})}}],controllerAs:"vm",templateUrl:"js/timecard/timecard-tutorial-component.template.html"};angular.module("fpm").component("timecardTutorialViewComponent",e)}()}(),function(){"use strict";!function(){angular.module("fpm").filter("totalTimeDiff",function(){return function(e){var t="0";if(e.length>0){var n=0;angular.forEach(e,function(a,o){if(a.finishTime&&(n+=moment(kendo.parseDate(a.finishTime)).diff(kendo.parseDate(a.startTime),"minutes")),o===e.length-1&&n>0){var i=Math.floor(n/60),r=n%60;return t=i+" hrs "+r+" min"}})}return t}})}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",onCancelClicked:"&",onAddCompleted:"&",serviceProviders:"<"},controller:["$scope","fpm-utilities-factory","work-orders-factory",function(e,t,n){var a=this;a.errors=[];var o={serviceProvider:"",startDate:new Date,endTime:new Date,fromMobile:!0,barCode:a.barcode,intuitQboItemId:""};a.newSchedule=angular.copy(o),a.events={closeProductEditModal:function(){angular.isFunction(a.onCancelClicked)&&a.onCancelClicked()},addScheduleClicked:function(){a.errors=[],a.showError=!1;var e=angular.copy(a.newSchedule);e.startDate=t.toStringDate(a.newSchedule.startDate),e.endTime=t.toStringDate(a.newSchedule.endTime),t.showLoading().then(function(){n.addWorkOrderSchedule(e).then(function(e){angular.isDefined(e.model)&&angular.isArray(e.model.errors)&&e.model.errors.length>0?(a.errors=e.model.errors,a.showError=!0):a.onAddCompleted({o:{invoice:e.invoice,schedules:e.schedule}})}).finally(t.hideLoading)})},onServiceProviderSelectionChanged:function(){}},a.$onInit=function(){}}],controllerAs:"vm",templateUrl:"js/work-orders/add-schedule-modal-component.template.html"};angular.module("fpm").component("addScheduleModalComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,a,o,i,r){function c(){o.getBarCodeNumber().then(function(e){h.woEntity.barCode=e.barcode,h.woEntity.barCodeName=e.barcodeName})}function u(){o.createEntity().then(function(e){h.woEntity=angular.copy(e),h.woEntity.fromMobile=!0,d()}).finally(c)}function l(e){return h.errors=[],h.showError=!1,h.isCustomerSelected===!1?(h.errors.push("Please select a customer first"),h.showError=!0,!1):void a.show({template:"creating work order..."}).then(function(){h.woEntity.scheduleStart=r.toStringDate(h.dates.startDate),h.woEntity.scheduleEnd=r.toStringDate(h.dates.endDate),o.createWorkOrder(h.woEntity).then(function(e){e&&(e.errors.length>0?(h.errors=e.errors,h.showError=!0):p.alert("Success","Work Order created successfully",function(){t.go("app.dashboard")}))}).finally(a.hide)})}function s(){n.show({buttons:[{text:"Same as Business Address"},{text:"Clear Address"}],titleText:"Service Address Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&(h.woEntity.sStreet=h.woEntity.bStreet,h.woEntity.sState=h.woEntity.bState,h.woEntity.sCity=h.woEntity.bCity,h.woEntity.sZip=h.woEntity.bZip),1===e&&(h.woEntity.sStreet="",h.woEntity.sState="",h.woEntity.sCity="",h.woEntity.sZip=""),!0}})}function d(){h.dates={startDate:new Date,endDate:new Date(moment().add(1,"hours"))}}function m(){t.go("app.dashboard")}function f(){i.getIniitialData().then(function(e){e&&(h.jobTypes=e.jobTypes,h.serviceProviders=e.serviceProviders)}).finally(u)}var h=this,p=r.alerts;h.errors=[],d(),h.isCustomerSelected=!1,h.events={onCustomerSelected:function(e){h.isCustomerSelected=!0,h.woEntity.firstName=e.firstName,h.woEntity.lastName=e.lastName,h.woEntity.companyName=e.company,h.woEntity.displayName=e.name,h.woEntity.bCity=e.addressCity,h.woEntity.bState=e.addressCountrySubDivCode,h.woEntity.bStreet=null==e.street?null:e.street.replace("::","\n"),h.woEntity.bZip=e.addressPostalCode,h.woEntity.phone=e.phone,h.woEntity.fax=e.fax,h.woEntity.uin=e.uin,h.woEntity.email=e.email_Group,h.woEntity.mobile=e.mobile,h.woEntity.sStreet=null==e.shipStreet?"":e.shipStreet.replace("::","\n"),h.woEntity.sState=e.shipState,h.woEntity.sCity=e.shipCity,h.woEntity.sZip=e.shipZIP},onSubmitButtonClicked:l,onServiceAddressActionClicked:s,onBackToDashboardClicked:m},f()}e.$inject=["$scope","$state","$ionicActionSheet","$ionicLoading","work-orders-factory","shared-data-factory","fpm-utilities-factory"],angular.module("fpm").controller("create-order-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,a,o,i,r,c,u,l,s,d,m){function f(){i.show({template:"loading work order..."}).then(function(){u.getBarcodeDetails(M.barcode).then(function(e){M.barCodeData=e,M.uiSettings.woData=angular.copy(e),M.taxCheckboxVisibility=(M.barCodeData.taxRate||0)>0,angular.isArray(e.schedules)&&(M.schedule=angular.copy(angular.copy(_.findWhere(e.schedules,{num:parseInt(a.technicianNum,10)}))),M.schedule.actualStartDateTime&&(M.schedule.actualStartDateTime=new Date(moment(M.schedule.actualStartDateTime))),M.schedule.actualFinishDateTime&&(M.schedule.actualFinishDateTime=new Date(moment(M.schedule.actualFinishDateTime))),h(M.schedule.actualStartDateTime,M.schedule.actualFinishDateTime),M.uiSettings.orderBelongToCurrentUser=M.schedule.technicianNum===M.userId,i.hide(),v())},function(e){P.alert("Oops","ERROR WHILE GETTING WORK ORDER INFORMATION..",i.hide)})})}function h(e,t){if(!Date.parse(e)||!Date.parse(t))return 0;var a=Math.abs(new Date(e)-new Date(t)),o=Math.floor(a/1e3),i=Math.floor(o/60),r=Math.floor(i/60);return i%=60,n(function(){0===r?M.scheduleTimeSpan.timeSpan=i+" Minutes":M.scheduleTimeSpan.timeSpan=r+" Hours "+i+" Minutes"},50),0}function p(e,t){return new Date(e.getTime()+6e4*t)}function g(e,t,n){M.user.havingGroupsAssigned;if(M.isServiceProvider===!1)return!0;var a=M.schedule.technicianNum===M.user.userEmail;if(havingGroupsAssinged===!0&&n&&n===!0){var o=_.findWhere(M.serviceProviders,{UserId:M.schedule.TechnicianNum});if(angular.isDefined(o))return!0}return M.isServiceProvider!==!0||a!==!1||(P.alert("Oops!","you are not authorized to perform this action",function(){angular.isFunction(t)&&t(e)}),!1)}function C(e){g(null,null,!1)&&(e===!0&&(M.schedule.actualStartDateTime=null),M.schedule.actualFinishDateTime=null,M.scheduleTimeSpan.timeSpan="")}function y(){var e={num:0,numFromSummary:0,timeCardDate:l.toStringDate(M.schedule.actualStartDateTime),startTime:l.toStringDate(M.schedule.actualStartDateTime),finishTime:l.toStringDate(M.schedule.actualFinishDateTime),jobCode:0,notes:"",barcode:M.barcode,isUserDefined:!0,scheduleId:M.schedule.num};M.schedule.actualStartDateTime?m.pushCheckInOutTimes(e).then(function(e){angular.isArray(e)&&e.length>0?P.alert("Warning",e[0]):P.alert("Success","Details successfully pushed to timecard")}):P.alert("Warning","Please select Check In date and time")}function D(){M.user=d.getLoggedInUserInfo(),M.uiSettings.isTimeCardModuleEnabled=M.user.timeCard&&M.user.allowPushTime,M.isServiceProvider=!M.user.isAdminstrator,s.getIniitialData(!0).then(function(e){e&&(M.uiSettings.milageTrackingEnabled=e.customerNumberEntity.milageTrackingEnabled||!1,M.uiSettings.timerEnabled=e.customerNumberEntity.workOrderTimerEnabled||!1,M.scheduleStatus=e.secondaryOrderStatus,M.serviceProviders=e.serviceProviders,M.vehicles=e.vehicles)}).finally(k)}function v(){if(M.totals={subtotal:0,totalqty:0,totalcost:0,totaltax:0},M.barCodeData.invoice&&M.barCodeData.invoice.length>0){var e=M.barCodeData.taxRate||0;angular.forEach(M.barCodeData.invoice,function(t){if(t.price&&t.qty&&angular.isNumber(parseFloat(t.price))&&angular.isNumber(parseInt(t.qty,10))){var n=t.price*t.qty,a=parseFloat(parseFloat(e)>0?parseFloat(e/100*n):0);M.totals.subtotal+=parseFloat(n),M.totals.totalqty+=parseInt(t.qty,10),(t.taxable||!1)===!0&&(M.totals.totaltax+=parseFloat(a))}})}}function w(){g(null,null,!1)&&u.updateWorkOrderMobile({barcodeAssay:M.barCodeData.barcodeDetails,fromMobile:!0}).then(function(e){e&&angular.isArray(e)&&e.length>0&&(M.errors=e)})}function S(e,t){t===!0?l.showLoading().then(function(){u.updateSchedule(M.schedule).then(function(){e&&P.alert("Success","Schedule information updated successfully")}).then(l.hideLoading)}):u.updateSchedule(M.schedule).then(function(){e&&P.alert("Success","Schedule information updated successfully")})}function T(e){if(M.uiSettings.woData){var t=_.findWhere(M.uiSettings.woData.invoice,{num:e.num});if(angular.isDefined(t))for(var n in t)e.hasOwnProperty(n)&&(e[n]=t[n])}}function b(){l.showLoading().then(function(){M.schedule.actualStartDateTime=new Date,M.schedule.actualFinishDateTime=null,M.scheduleTimeSpan.onStartDateTimeChaged(),u.updateJobStatus({scheduleButton:I.CheckIn,scheduleNum:M.schedule.num,actualStartTime:l.toStringDate(M.schedule.actualStartDateTime),barcode:M.barcode,timerStartAt:l.toStringDate(new Date)}).then(function(){M.schedule.checkInStatus=!0}).finally(l.hideLoading)})}function k(){if(M.user.timeCard===!0){var e=new Date,t=l.toStringDate(new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0));timeCardFactory.getTimeCardByDate(t).then(function(e){e&&(O.currentDetails=e.timeCardDetails)})}}var M=this;M.barcode=a.barCode,M.taxCheckboxVisibility=!0;var P=l.alerts,I={AcceptJob:0,InRoute:1,CheckIn:2,CheckOut:3},$={CLOCK_IN:5001,CLOCK_OUT:5002};M.invoiceOpen=!1,M.uiSettings={isTimeCardModuleEnabled:!1,milageTrackingEnabled:!1,orderBelongToCurrentUser:!1,timerEnabled:!1,woData:null},M.errors=[],f(),M.scheduleTimeSpan={timeSpan:"",onTimespanSeletionChanged:function(e,t){var a=t.getVal(),o=Math.floor(a/1e3),i=Math.floor(o/60);n(function(){var e,t=angular.copy(M.schedule.actualStartDateTime);null==t?(e=new Date,M.schedule.actualStartDateTime=new Date):e=new Date(t);var n=p(e,i);M.schedule.actualFinishDateTime=kendo.parseDate(n)},50)},onStartDateTimeChaged:function(){M.schedule.actualStartDateTime&&M.schedule.actualFinishDateTime&&(new Date(M.schedule.actualStartDateTime)>new Date(M.schedule.actualFinishDateTime)?P.alert("Warning","Start time cannot be greater than finish time."):h(M.schedule.actualStartDateTime,M.schedule.actualFinishDateTime))},onEndDateTimeChanged:function(){M.schedule.actualStartDateTime&&M.schedule.actualFinishDateTime&&(new Date(M.schedule.actualStartDateTime)>new Date(M.schedule.actualFinishDateTime)?P.alert("Warning","Start time cannot be greater than finish time."):h(M.schedule.actualStartDateTime,M.schedule.actualFinishDateTime))},clearAllDateTimeSelection:function(){}},D();var E=[{text:"Check In"},{text:"Check Out"},{text:'<span class="text-assertive">Clear All</span>'},{text:'<span class="text-assertive">Clear Checkout Time</span>'},{text:"Update Schedule"}];M.scheduleAddModal=null,M.tabs={desc:{events:{onDescriptionOrResolutionChanged:function(){w()}}},sch:{events:{onAddScheduleCompleted:function(e){e&&(M.barCodeData.schedules=e.schedules,M.barCodeData.invoice=e.invoice,M.scheduleAddModal.hide(),P.alert("Success","Schedule added successfully"))},onModalCancelClicked:function(){M.scheduleAddModal.hide()},onMilageInformationActionButtonClicked:function(){o.show({buttons:[{text:"Save Milage Information"}],titleText:"Milage Information",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&S(!0,!0),!0}})},onTripnoteChanged:function(){S(!1,!1)},updateSchedule:function(){S(!0,!0)},onListScheduleItemTap:function(e){e.num!==M.schedule.num&&P.confirm("Confirmation","Are you sure to load this schedule",function(){t.go("app.editOrder",{barCode:M.barcode,technicianNum:e.num,src:"main"})})},onSchedulesListButtonClicked:function(){o.show({buttons:[{text:"Add New Schedule"}],titleText:"New Schedule",cancelText:"Cancel",cancel:function(){},buttonClicked:function(t){return 0===t&&(null===M.scheduleAddModal?c.fromTemplateUrl("addScheduleModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){M.scheduleAddModal=e,M.scheduleAddModal.show()}):M.scheduleAddModal.show()),!0}})},checkIn:function(){if(M.schedule.approve!==!0&&M.schedule.checkInStatus!==!0){if(g(null,null,!0))if(M.user.timeCard===!0){var e=_.where(O.currentDetails,{jobCode:$.CLOCK_IN,finishTime:null}),t=_.reject(O.currentDetails,{jobCode:$.CLOCK_IN});if(0===e.length)P.confirm("Confirmation!","You have not clocked in yet. You will be clocked in automattically \n\n Are you sure?",function(){b()},function(){});else if(t.length>0){var n=_.where(t,{finishTime:null,jobCodeName:"On Job"});n.length>0?P.alert("Warning!","You have not checked out for previous task.",function(){}):b()}else b()}else b();return!1}P.alert("Alert","Not allowed to checkin")},checkOut:function(){if(M.schedule.approve===!0||M.schedule.checkOutStatus===!0)P.alert("Alert","Not allowed to checkout");else if(g(null,null,!1)){if(null===M.schedule.actualStartDateTime)return P.alert("Warning","Please check in first"),!1;M.schedule.actualFinishDateTime=new Date,M.scheduleTimeSpan.onEndDateTimeChanged(),u.updateJobStatus({scheduleButton:I.CheckOut,scheduleNum:M.schedule.num,actualEndTime:l.toStringDate(M.schedule.actualFinishDateTime),Barcode:M.barcode}).then(function(){M.schedule.checkOutStatus=!0})}},onScheduleActionButtonClicked:function(){var e=angular.copy(E);M.user.allowPushTime&&e.push({text:"<b>Push to Timecard</b>"}),o.show({buttons:e,titleText:"Current Schedule",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&M.tabs.sch.events.checkIn(),1===e&&M.tabs.sch.events.checkOut(),2===e&&C(!0),3===e&&C(!1),4===e&&S(!0,!0),5===e&&y(),!0}})}}},smry:{events:{onTaxCheckboaxChanged:function(e){g(e,T)&&(v(),u.updateOrderProduct(e))}}},prod:{events:{onProdcutActionButtonClicked:function(){o.show({buttons:[{text:"Add New Product"}],titleText:"New Product",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&M.productSearchModal.show(),!0}})},closeProductEditModal:function(){M.productModal.hide()},openProductSearchModal:function(){},onEditProductClicked:function(e){M.currentProduct=angular.copy(e),M.productModal.show()},onDeleteProductClicked:function(e){P.confirmDelete(function(){u.deleteProduct(M.barcode,e.num).then(function(e){e&&(M.barCodeData.products=e.products,M.barCodeData.invoice=e.invoice,v())})})}}}};var O={currentDetails:[]};c.fromTemplateUrl("productSearchModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){M.productSearchModal=e}),c.fromTemplateUrl("editProductModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){M.productModal=e}),e.$on("$fpm:closeEditProductModal",function(){M.productModal.hide()}),e.$on("$fpm:closeProductSearchModal",function(e,t){M.productSearchModal&&(t&&t.fromProductAdd===!0&&u.getBarcodeInvoiceAndProductDetails(M.barcode).then(function(e){M.barCodeData.products=e.products,M.barCodeData.invoice=e.invoice,v()}),M.productSearchModal.hide())}),e.$on("$fpm:operation:updateProduct",function(e,t){if(t&&M.currentProduct){var a=_.filter(M.barCodeData.products,function(e){return e.num===t.num}),o=_.filter(M.barCodeData.invoice,function(e){return"Labor"!==e.productName&&e.numFromSchedule===t.num});n(function(){a.length>0&&(a[0].qty=t.qty,a[0].productDescription=t.productDescription,a[0].price=t.price),o.length>0&&(o[0].qty=t.qty,o[0].productDescription=t.productDescription,o[0].price=t.price,o[0].totalPrice=parseFloat(t.qty)*parseFloat(t.price)),v(),M.productModal.hide()},100)}})}e.$inject=["$scope","$state","$timeout","$stateParams","$ionicActionSheet","$ionicLoading","$ionicPopup","$ionicModal","work-orders-factory","fpm-utilities-factory","shared-data-factory","authenticationFactory","timecard-factory"],angular.module("fpm").controller("edit-order-controller",e)}()}(),function(){"use strict";!function(){var e={templateUrl:"js/work-orders/order-documents-list-component.template.html",bindings:{barcode:"<"},controller:["$scope","work-orders-factory","fpm-utilities-factory","fieldPromaxConfig",function(e,t,n,a){var o=this,i=a.fieldPromaxApi,r=n.alerts;o.docUrl="",o.events={onDocumentClicked:function(e){window.open(i+"Handlers/GetImageFromBlob.ashx?imageId="+e.num+"&dateStamp="+new Date+"&flag=viewTarget","_system","location=yes")},onDeleteDocumentClicked:function(e){r.confirmDelete(function(){})}},o.$onInit=function(){o.barcode&&t.getUploadedDocuments(o.barcode).then(function(e){o.barcodeDocuments=e,console.log(o.barcodeDocuments)})}}],controllerAs:"vm"};angular.module("fpm").component("orderDocumentsListComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<"},templateUrl:"js/work-orders/order-images-list-component.template.html",controller:["$scope","$ionicModal","$ionicLoading","work-orders-factory","fpm-utilities-factory","fieldPromaxConfig",function(e,t,n,a,o,i){var r=this;r.isExpanded=!1;var c=i.fieldPromaxApi,u=o.alerts;r.upload={control:null,uploadImage:function(e,t){n.show({template:"Please wait..."}).then(function(){a.uploadFile({Barcode:r.barcode,Image:e,Name:t}).then(function(e){r.barcodeImages.push({barcode:r.barcode,fileName:t,imageURL:"/"+t,num:e}),u.alert("Uploaded","File Uploaded successfully")}).finally(n.hide)})},options:{multiple:!0,showFileList:!1,localization:{select:"Upload files"},select:function(e){e.isDefaultPrevented=!0;var t=["tif","tiff","gif","jpeg","jpg","jif","jfif","jp2","jpx","j2k","j2c","pcd","png","bmp"];angular.forEach(e.files,function(e){var n=e.name.split("."),a=n.reverse();if(e.size<20971520){var o=_.filter(t,function(e){return a[0].toLowerCase()===e});if(o.length>0){var i=new FileReader;i.onload=function(t){r.upload.uploadImage(t.target.result,e.name)},i.readAsDataURL(e.rawFile)}}})}}},r.currentImage=null,r.events={onDeleteImageClicked:function(e){u.confirmDelete(function(){console.log("HELLO WORLDF")})},onImageTap:function(e){r.currentImage=e,r.imageUrl=c+"Handlers/GetImageFromBlob.ashx?imageId="+e.num+"&dateStamp="+new Date,r.imageViewerModel.show()},closeImageViewModal:function(){r.imageViewerModel.hide()}},r.$onInit=function(){r.barcode&&a.getImagesList(r.barcode).then(function(e){r.barcodeImages=e})},t.fromTemplateUrl("imageViewerModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){r.imageViewerModel=e})}],controllerAs:"vm"};angular.module("fpm").component("orderImagesListComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<"},templateUrl:"js/work-orders/order-signature-card-component.template.html",controller:["$scope","$ionicActionSheet","authenticationFactory","fieldPromaxConfig",function(e,t,n,a){var o=this;o.showingSignaturePad=!1;var i=a.fieldPromaxApi,r=n.getLoggedInUserInfo();o.signPadEvents=null,o.events={onSignaturePadActionButtonClicked:function(){t.show({buttons:[{text:"Hide Signature Pad"},{text:"Save New Signature"}],titleText:"Work Order Signature",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&(o.showingSignaturePad=!1),1===e&&(console.log("EVNT",o.signPadEvents),o.signPadEvents&&o.signPadEvents.trySaveSignature().then(function(e){e===!0&&(o.showingSignaturePad=!1,o.imageUrl=i+"Handlers/GetBarcodeSignature.ashx?barcode="+o.barcode+"&dateStamp="+new Date+"&customernumber="+r.customerNumber)})),!0}})},onSignatureActionButtonClicked:function(){t.show({buttons:[{text:"Show Signature Pad"}],titleText:"Work Order Signature",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&(o.showingSignaturePad=!0),!0}})}},o.imageUrl=i+"Handlers/GetBarcodeSignature.ashx?barcode",o.$onInit=function(){o.imageUrl=i+"Handlers/GetBarcodeSignature.ashx?barcode="+o.barcode+"&dateStamp="+new Date+"&customernumber="+r.customerNumber},o.$onChanges=function(){}}],controllerAs:"vm"};angular.module("fpm").component("orderSignatureComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{padEventsRef:"="},templateUrl:"js/work-orders/order-signature-pad-template.html",controller:["$scope","$stateParams","$q","work-orders-factory",function(e,t,n,a){var o=this;o.customerName="";var i=t.barCode;o.events={trySaveSignature:function(){var e=n.defer(),t=!1,r=$(angular.element("#signature")).jSignature("getData","image");return""!==$.trim(o.customerName)&&angular.isArray(r)&&a.saveJsonSignForBarcode({BaseString:r[1],Barcode:t?"":i,CustomerName:o.customerName,EstimateId:0}).then(function(){e.resolve(!0)}),e.promise}},o.$onInit=function(){var e=angular.element("#signature");$(e).jSignature({lineWidth:1,width:$(document).width()-80,height:200,"decor-color":"transparent"}).bind("change",function(t){var n=$(e).jSignature("getData","image");angular.isArray(n)}),o.padEventsRef=o.events}}],controllerAs:"vm"};angular.module("fpm").component("orderSignaturePad",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",taxrate:"<",defaultEmails:"<"},templateUrl:"js/work-orders/work-order-email-card-template.html",controller:["$scope","$ionicActionSheet","$q","work-orders-factory","fpm-utilities-factory",function(e,t,n,a,o){function i(e){c.mailConfig.mailAddresses&&c.mailConfig.mailAddresses.length>0&&a.sendInvoiceMail({BarCode:c.barcode,SendAsInvoice:e,emailAddresses:c.mailConfig.mailAddresses,TaxRate:c.taxrate}).then(function(){o.alerts.alert("Email Sent","Email Sent Successfully")})}function r(){t.show({buttons:[{text:"Send As Invoice"},{text:"Send As Work Order"}],titleText:"Work Order Email Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0!==e&&1!==e||i(0===e),!0}})}var c=this;c.mailConfig={mailAddresses:[]},c.events={onOrderEmailActionClicked:r},c.$onInit=function(){console.log("DF",c.defaultEmails)}}],controllerAs:"vm"};angular.module("fpm").component("orderEmailCardComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{isCheckedIn:"<",isCheckedOut:"<",isApproved:"<",schedule:"<"},controller:["$interval","$state","$element","$timeout","shared-data-factory",function(e,t,n,a,o){function i(){var e=Math.floor(l.currentTime.totalMinutes/60),t=Math.floor(l.currentTime.totalMinutes%60);l.currentTime.mins=t<=9?"0"+t:t,l.currentTime.hrs=e<=9?"0"+e:e,0===e&&t>=55?l.currentTime.isOnInterval=!0:e>0&&(t>55||t<=5)?l.currentTime.isOnInterval=!0:l.currentTime.isOnInterval=!1}function r(){l.currentTime.showControl===!1&&(l.currentTime.showControl=!0),l.currentTime.isRunning=!0,s=e(function(){l.currentTime.totalMinutes+=1,console.log(l.currentTime.totalMinutes),i()},6e4)}function c(){null!==s&&(l.currentTime.isRunning=!1,e.cancel(s));var t=a(function(){l.currentTime.showControl=!1,a.cancel(t)},100)}function u(){i()}var l=this;l.currentTime={hrs:"00",mins:"00",totalMinutes:0,showControl:!1,isRunning:!1,isOnInterval:!1,intervalMinutes:0,intervalCounter:0};var s=null;this.$onDestroy=function(){c()};var d=!1;this.$onChanges=function(){d===!0&&(l.isCheckedIn===!0&&l.currentTime.isRunning===!1&&r(),l.isCheckedOut===!0&&c())},l.events={refreshTimer:u},this.$onInit=function(){l.currentTime.showControl=!1,o.getIniitialData().then(function(e){d=e.customerNumberEntity.workOrderTimerEnabled||!1,d===!0&&a(function(){if(l.schedule&&(l.currentTime.showControl=l.schedule.checkInStatus===!0&&l.schedule.checkOutStatus===!1,l.schedule.checkInStatus===!0&&l.schedule.timerStartAt&&(l.schedule.checkOutStatus||!1)===!1)){var e=moment(new Date).diff(moment(l.schedule.timerStartAt),"minutes");e>0&&(l.currentTime.totalMinutes=e,i())}},1e3)})}}],templateUrl:"js/work-orders/work-order-timer-component.template.html",controllerAs:"model"};angular.module("fpm").component("workOrderTimerComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,a){function o(t,a){t=null!==t&&t,t===!0&&M.remove(P);var o=M.get(P);return angular.isDefined(o)&&o?e.when(o):n.get(k+"GetMobileDashboard").then(function(e){return M.put(P,e),e})}function i(e){return n.get(k+"GetBarcodeDetails?barcode="+e)}function r(e,t){return n.get(k+"DeleteProduct?barcode="+e+"&productNum="+t)}function c(e){return n.post(k+"UpdateProduct?fromMobile=true",e)}function u(e,t){return n.get(k+"GetProductsLists?searchPattern="+e+"&alphabet="+t)}function l(e){return n.post(k+"AddProductsToOrder?fromMobile=true",e)}function s(e){return n.get(k+"GetBarcodeInvoiceAndProductDetails?barcode="+e)}function d(e){return n.post(k+"SaveJsonSignForBarcode",e)}function m(e){return n.post(k+"SendInvoiceMail",e)}function f(e){return n.get(k+"GetImagesList?barcode="+e)}function h(e){return n.get(k+"GetUploadedDocuments?barcode="+e)}function p(e){return n.post(k+"UploadFile",e)}function g(){var t=M.get("workOrderEntity");return angular.isDefined(t)&&t?e.when(t):n.get(k+"CreateEntity").then(function(e){return M.put("workOrderEntity",e),e})}function C(e){return n.post(k+"CreateWorkOrder",e)}function y(){return n.get(k+"GetBarCodeNumber")}function D(e){return n.post(k+"UpdateWorkOrderMobile",e)}function v(e){return e.clientTime=new Date,n.post(k+"UpdateJobStatus",e)}function w(e){return n.post(k+"UpdateSchedule?fromMobile=true",e)}function S(e){return n.post(k+"AddWorkOrderSchedule",e);
}function T(e){return n.post(k+"UpdateOrderProduct",e)}function b(t){t=null!==t&&t,t===!0&&M.remove(I);var a=M.get(I);return angular.isDefined(a)&&a?e.when(a):n.get("api/Scheduler/GetMyCalender?fromMobile=true").then(function(e){return M.put(I,e),e})}var k="api/workorders/",M=t("orderCache"),P="dashboardData",I="workorder:calendar";return{getMobileDashboard:o,getBarcodeDetails:i,deleteProduct:r,updateProduct:c,searchProduct:u,addProduct:l,getBarcodeInvoiceAndProductDetails:s,saveJsonSignForBarcode:d,sendInvoiceMail:m,getImagesList:f,getUploadedDocuments:h,uploadFile:p,createEntity:g,createWorkOrder:C,getBarCodeNumber:y,updateWorkOrderMobile:D,updateJobStatus:v,updateSchedule:w,addWorkOrderSchedule:S,updateOrderProduct:T,getDatewiseEvents:b}}e.$inject=["$q","$cacheFactory","api-base-factory","shared-data-factory"],angular.module("fpm").factory("work-orders-factory",e)}()}();