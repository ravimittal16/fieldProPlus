!function(){"use strict";!function(){function e(e,t,n,o,i,a,r){function u(e){angular.forEach(e,function(e){var t=kendo.parseDate(e.scheduledStartDateTime),n=kendo.parseDate(e.scheduledFinishDateTime);t&&n&&m.calendar.events.push({startTime:t,endTime:n,allDay:!1,title:e.barcodeName+" (Estimate)",originalObject:angular.copy(e),eventType:2})})}function c(e){angular.forEach(e,function(e){var t=kendo.parseDate(e.scheduledStartDateTime),n=kendo.parseDate(e.scheduledFinishDateTime);t&&n&&m.calendar.events.push({startTime:t,endTime:n,allDay:!1,title:e.barcodeName+" (Schedule)",originalObject:angular.copy(e),eventType:1})})}function s(e){angular.forEach(e,function(e){var t=kendo.parseDate(e.cacationDate),n=kendo.parseDate(e.vacationDate);e.endDateTime&&(n=kendo.parseDate(e.endDateTime)),t&&n&&m.calendar.events.push({startTime:t,endTime:n,allDay:e.isAllDay,title:e.vacationString,originalObject:angular.copy(e),eventType:3})})}function l(e){m.calendar.events=[],m.loadingCalender=!0,r.getDatewiseEvents(e).then(function(e){e&&(e.estimates&&e.estimates.length>0&&u(e.estimates),e.schedules&&e.schedules.length>0&&c(e.schedules),e.vacations&&e.vacations.length>0&&s(e.vacations)),m.loadingCalender=!1})}function d(){var e=o.get(f.settingsKeyName);e&&e.DefaultCalenderViewForMobile&&("workWeek"===e.DefaultCalenderViewForMobile?m.events.changeMode("week"):m.events.changeMode(e.DefaultCalenderViewForMobile)),l(!1)}var m=this,f=a.localStorageKeys;m.calendar={mode:"day",events:[],noEventLabel:"No Schedules Found",currentDate:new Date};var p=[{text:"Work Week View",mode:"week",otext:"Work Week View"},{text:"Day View",mode:"day",otext:"Day View"},{text:"Month View",mode:"month",otext:"Month View"},{text:"Refresh Calender",mode:"null",otext:"Refresh Calender"}];m.viewTitle="Calendar";i.alerts;m.events={refreshCalender:function(){l(!0)},onTimeSelected:function(e,t){},onEventSelected:function(e){if(1===e.eventType){var n=e.originalObject;i.alerts.confirm("Confirmation","Are you sure to edit this work order?",function(){t.go("app.editOrder",{barCode:n.barcode,technicianNum:n.num,src:"calender"})})}},today:function(){m.calendar.currentDate=new Date},changeMode:function(e){m.calendar.mode=e,angular.forEach(p,function(e){e.text=e.otext});var t=_.findWhere(p,{mode:e});t&&(t.text=t.otext+"<i class='icon ion-checkmark'></i>")},onViewTitleChanged:function(e){m.viewTitle=e},refreshOnPullDown:function(){l(!0)},showActionSheet:function(){n.show({buttons:p,titleText:"Calendar Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&m.events.changeMode("week"),1===e&&m.events.changeMode("day"),2===e&&m.events.changeMode("month"),3===e&&l(!0),!0}})}},m.loadingCalender=!1,e.$on("$ionicView.beforeEnter",function(t,n){console.log("HELLO WORLD"),e.$root.showNavButton=!0}),e.$on("$ionicView.afterEnter",function(e,t){d()})}e.$inject=["$scope","$state","$ionicActionSheet","localStorageService","fpm-utilities-factory","fieldPromaxConfig","work-orders-factory"],angular.module("fpm").controller("calendar-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(){n.getComponents().then(function(e){if(a.showEmptyMessage=null===e,angular.isArray(e)){var t=[];angular.forEach(e,function(n,o){n.isOpen=!1,t.push(n),o===e.length-1&&(a.components=t)})}})}function i(){o()}var a=this;a.showingLoading=!1,a.reportModel={startDate:null,endDate:null};var r={BarcodeName:"Wo#",ActualStartDateTime:"Start Date"};a.events={onChildGroupClicked:function(e){e.isOpen=!e.isOpen},refreshOnPullDown:function(){o(),e.$broadcast("scroll.refreshComplete")},runReport:function(){a.columns=[];var e=[];n.generateReport(a.reportModel).then(function(t){var n=angular.element("#tableReport");if(n.find("tbody").html(""),t&&(a.result=JSON.parse(t),a.result&&a.result.length>0)){var o=a.result[0];for(var i in o)e.push(i),"BarcodeName"===i||"ActualStartDateTime"===i?a.columns.push({colName:r[i]}):a.columns.push({colName:i});angular.forEach(a.result,function(t,o){var i="<tr>";if(a.result.length-1===o)var i="<tr class='success'>";angular.forEach(e,function(o,a){var r="";"ActualStartDateTime"===o?t[o]&&(r=moment(t[o]).format("MM/DD/YYYY")):r=t[o]||"",i+="<td>"+r+"</td>",a===e.length-1&&(i+="</tr>",n.find("tbody").append(i))})})}})}},e.$on("$ionicView.afterEnter",function(e,t){i()})}e.$inject=["$scope","$state","custom-components-factory"],angular.module("fpm").controller("custom-components-controller",e)}()}(),function(){"use strict";!function(){function e(e,t){function n(){return e.get(i+"GetCustomComponents")}function o(t){return t&&(t.startDate&&(t.startDate=kendo.toString(t.startDate,"g")),t.endDate&&(t.endDate=kendo.toString(t.endDate,"g"))),e.get(i+"GetTimeWorkedReport?startDate="+t.startDate+"&endDate="+t.endDate)}var i="api/CustomComponents/";return{generateReport:o,getComponents:n}}e.$inject=["api-base-factory","fieldPromaxConfig"],angular.module("fpm").factory("custom-components-factory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,i,a){function r(){t.go("app.dashboard",{refresh:!1})}function u(e){e?a.alerts.confirm("Confirmation","Are you sure?",function(){r()}):r()}function c(e){l.errors=[],e?a.showLoading().then(function(){o.createCustomer(l.customerModel).then(function(e){angular.isArray(e.errors)&&e.errors.length>0?l.errors=e.errors:a.alerts.alert("Success","Customer created successfully",function(){r()})}).finally(a.hideLoading)}):l.errors.push("Please check all values before save")}function s(){l.customerModel=angular.copy(d)}var l=this,d={displayName:"",firstName:"",lastName:"",companyName:"",email:"",phone:"",mobile:"",fax:"",bStreet:"",bCity:"",bState:"",bZip:"",sStreet:"",sCity:"",sState:"",sZip:"",uinNum:""};l.errors=[],l.events={sameAsBilling:function(){l.customerModel&&(l.customerModel.sStreet=l.customerModel.bStreet,l.customerModel.sState=l.customerModel.bState,l.customerModel.sCity=l.customerModel.bCity,l.customerModel.sZip=l.customerModel.bZip)},clearAddress:function(){l.customerModel.sStreet="",l.customerModel.sState="",l.customerModel.sCity="",l.customerModel.sZip=""},onBackToDashboardClicked:u,onSubmitButtonClicked:c},e.$on("$ionicView.afterEnter",function(e,t){s()})}e.$inject=["$scope","$state","$ionicActionSheet","customers-file-factory","localStorageService","fpm-utilities-factory"],angular.module("fpm").controller("create-customer-controller",e)}()}(),function(){"use strict";!function(){function e(e,t){function n(t){return e.get(i+"SearchCustomers?searchPattern="+t)}function o(t){return e.post(i+"CreateCustomer?fromMobile=true",t)}var i="api/CustomerFile/";return{createCustomer:o,searchCustomers:n}}e.$inject=["api-base-factory","fieldPromaxConfig"],angular.module("fpm").factory("customers-file-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{onCustomerSelected:"&",placeholder:"@"},controller:["$scope","$ionicModal","customers-file-factory",function(e,t,n){function o(){u.searchValue="",u.customers=[],u.customerModal.show().then(function(){})}function i(){u.customers=[],u.searchApplied=!1,u.runningSearch=!0,n.searchCustomers(u.searchValue).then(function(e){u.searchApplied=!0,u.runningSearch=!1,angular.isArray(e)&&(u.customers=e)})}function a(){u.searchValue="",u.customers=[],u.customerModal.hide()}function r(e){u.customerModal.hide(),angular.isFunction(u.onCustomerSelected)&&u.onCustomerSelected({customer:e})}var u=this;u.searchValue="",u.searchApplied=!1,u.runningSearch=!1,u.events={onSearchBoxTapped:o,applySearch:i,closeSearchModal:a,onCustomerSelected:r},t.fromTemplateUrl("customerSearchModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){u.customerModal=e})}],controllerAs:"vm",templateUrl:"js/customer/customer-search-header-component-template.html",replace:!0};angular.module("fpm").component("customerSearchHeaderComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,i,a,r,u,c,s,l){function d(){v=[],!y.isServiceProvider||y.havingGroupsAssigned?angular.forEach(y.result,function(e,t){e.dataForAdministrator&&e.dataForAdministrator.length>0&&_.forEach(e.dataForAdministrator,function(e){e.ordersJson&&_.forEach(JSON.parse(e.ordersJson),function(e){v.push(e)})})}):angular.forEach(y.result,function(e,t){e.dataForServiceProvider&&e.dataForServiceProvider.length>0&&_.forEach(e.dataForServiceProvider,function(e){v.push(e)})})}function m(e,t){y.showingLoading=!0,a.getMobileDashboard(e).then(function(e){y.result=e.result,y.havingGroupsAssinged=e.havingGroupsAssinged,y.isServiceProvider&&!y.havingGroupsAssigned&&(S="barcodeName"),d()}).finally(function(){y.showingLoading=!1,angular.isFunction(t)&&t()})}function f(e){w.confirmWithOkayCancel("Confirmation!","Your status has been updated to In Route",function(){s.showLoading().then(function(){a.updateJobStatus({scheduleButton:D.InRoute,scheduleNum:e.TechnicianScheduleNum,barcode:e.Barcode,ClientTime:kendo.toString(new Date,"g")}).then(function(){e.InRoute=!0}).finally(function(){s.hideLoading(),!0===C.enabled&&h()})})})}function p(e){_.where(C.currentDetails,{finishTime:null}).length>0?w.confirmWithOkayCancel("Confirmation","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(){f(e)}):f(e)}function h(){var e={CLOCK_IN:5001,CLOCK_OUT:5002},t=new Date,n=kendo.toString(new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),"g");c.getTimeCardByDate(n).then(function(t){t&&(C.todaysClockIns=_.where(t.timeCardDetails,{jobCode:e.CLOCK_IN}),C.currentDetails=_.reject(t.timeCardDetails,{jobCode:e.CLOCK_IN}))})}function g(){C.enabled=y.userInfo.timeCard||!1,y.havingGroupsAssigned=y.userInfo.havingGroupsAssigned,y.isServiceProvider=!y.userInfo.isAdminstrator,!0===C.enabled&&h(),r.getIniitialData().then(function(e){y.trackJobStatus=e.customerNumberEntity.trackJobStatus||!1}).finally(function(){m(!!angular.isDefined(n.refresh)&&n.refresh,null)})}var y=this;y.userInfo=u.getLoggedInUserInfo();var v=[],C={enabled:!1,clockedInInfo:null,currentDetails:[],todaysClockIns:[]},w=s.alerts;y.showingLoading=!0;var D={AcceptJob:0,InRoute:1,CheckIn:3,CheckOut:4};y.isSearchModalOpened=!1;var b=null;y.events={inRouteClicked:function(e){if(!1===C.enabled)f(e);else{var n=_.findWhere(C.todaysClockIns,{finishTime:null});angular.isDefined(n)?p(e):w.confirm("Warning!","You have not Clocked-In yet. Would you like to Clock-In now?",function(){t.go("app.timecard",{proute:t.current.name})})}},onSearchItemClick:function(e){e&&(y.matchedOrders=[],y.isSearchModalOpened=!1,y.searchModal.hide(),y.searchValue="",b=y.isServiceProvider&&!y.havingGroupsAssigned?o(function(){t.go("app.editOrder",{barCode:e.barcode,technicianNum:e.technicianScheduleNum,src:"main"})},300):o(function(){t.go("app.editOrder",{barCode:e.Barcode,technicianNum:e.TechnicianScheduleNum,src:"main"})},300))},applySearch:function(){if(v&&v.length>0){var e=y.searchValue.toLowerCase(),t=_.filter(v,function(t){return t[S].indexOf(e)>-1});y.matchedOrders=_.uniq(t,function(e,t,n){return e[S]})}},closeSearchModal:function(){y.matchedOrders=[],y.isSearchModalOpened=!1,y.searchModal.hide(),y.searchValue=""},openSearchModal:function(){y.searchValue="",y.matchedOrders=[],y.isSearchModalOpened=!0,y.searchModal.show()},refreshOnPullDown:function(){m(!0,function(){e.$broadcast("scroll.refreshComplete")})},onChildGroupClicked:function(e,t,n){e.isOpen=!e.isOpen;var o=l.get("orderState");if(null===o&&(o={}),"DD"===t)return!0===e.isOpen?(o[n]=e,l.set("orderState",o)):l.set("orderState",null),!1;!0===e.isOpen&&0===e.clickCount?(o[n]=e,l.set("orderState",o),"SP"===t?e.dataForServiceProvider=JSON.parse(e.ordersJson):e.ordersN=JSON.parse(e.ordersJson),e.clickCount+=1):(o[n]=null,l.set("orderState",o))}},y.havingGroupsAssigned=!1;var S="BarcodeName";e.$on("$ionicView.beforeEnter",function(e,t){g()}),e.$on("$destroy",function(){y.searchModal.remove(),b&&o.cancel(b)}),i.fromTemplateUrl("dashboardSearchModal.html",{scope:e,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){y.searchModal=e})}e.$inject=["$scope","$state","$stateParams","$timeout","$ionicModal","work-orders-factory","shared-data-factory","authenticationFactory","timecard-factory","fpm-utilities-factory","localStorageService"],angular.module("fpm").controller("dashboard-controller",e)}()}(),function(){"use strict";!function(){function e(e){return{}}e.$inject=["api-base-factory"],angular.module("fpm").factory("dashboard-factory",e)}()}(),function(){"use strict";!function(){angular.module("fpm").component("workorderViewComponent",{bindings:{odr:"<",trackJobStatus:"<",userInfo:"<",inRouteClicked:"&"},controller:["$state","fpm-utilities-factory","work-orders-factory",function(e,t,n){var o={AcceptJob:0,InRoute:1,CheckIn:3,CheckOut:4},i=this;i.events={acceptJob:function(){t.alerts.confirm("Confirmation!","Are you sure you want to accept this job?",function(){t.showLoading().then(function(){n.updateJobStatus({scheduleButton:o.AcceptJob,scheduleNum:i.odr.TechnicianScheduleNum}).then(function(){i.odr.JobAcceptanceStatus=!0}).finally(t.hideLoading)})})},inRouteClicked:function(){angular.isFunction(i.inRouteClicked)&&i.inRouteClicked({odr:i.odr})},onOrderClicked:function(){i.odr&&e.go("app.editOrder",{barCode:i.odr.Barcode,technicianNum:i.odr.TechnicianScheduleNum,src:"main"})}},i.$onInit=function(){}}],controllerAs:"vm",templateUrl:"js/dashboard/workorder-view-component-template.html"})}()}(),function(){"use strict";!function(){angular.module("fpm").component("equipmentCustomTypeListComponent",{bindings:{barcode:"<",entityId:"<"},controller:["equipment-factory","custom-types-factory",function(e,t){function n(){i.customTypes.data=[],i.factory.viewDataForEquipment=[],angular.isDefined(i.entityId)&&angular.isDefined(i.barcode)&&e.getEquipmentFields(i.entityId,i.barcode).then(function(e){if(e&&e.length>0){var t=_.where(e,{type:3});angular.forEach(t,function(e){e.value="true"===e.value||"True"===e.value||"1"===e.value}),i.customTypes.data=e,i.factory.viewDataForEquipment=i.customTypes.data}})}function o(t){3===t.type&&t.value,4===t.type&&(t.value=kendo.toString(kendo.parseDate(t.value),"g")),e.saveDataCustomTypes({num:i.entityId,barcode:i.barcode,customTypesJson:JSON.stringify(i.customTypes.data)})}var i=this;i.factory=t,i.customTypes={data:[]};var a=0;i.events={onValueChanged:function(e){4===e.type?0===a?(o(e),a++):a=0:o(e)}},i.$onChanges=function(){i.entityId&&n()},i.$onInit=function(){i.entityId&&n()}}],controllerAs:"vm",templateUrl:"js/equipments/equipment-custom-type-list-component-template.html"})}()}(),function(){"use strict";!function(){function e(e){function t(t,n,o,i){return e.post(h+"CreateEquipment?uin="+t+"&barcode="+o+"&attach="+i,n)}function n(){return e.get(h+"GetEquipmentList")}function o(t){return e.post(h+"AddMaintenanceNote",t)}function i(t){return e.deleteApiCall(h+"DeleteEquipment?id="+t)}function a(t){return e.get(h+"GetEquipmentNotes?id="+t)}function r(t){return e.deleteApiCall(h+"DeleteNote?num="+t)}function u(t){return e.get(h+"GetEquipmentsByUin?uin="+t)}function c(t,n){return e.get(h+"AttachEquipToBarcode?barcode="+t+"&equipNum="+n)}function s(t,n){return e.get(h+"UnattachEquipToBarcode?barcode="+t+"&equipNum="+n)}function l(t){return e.get(h+"GetBarcodeEquipments?barcode="+t)}function d(t,n){return e.get(h+"GetEquipmentFields?barcode="+n+"&num="+t)}function m(t){return e.post(h+"SaveDataCustomTypes",t)}function f(t){return e.get(h+"GetEquipmentHistory?id="+t)}var p={},h="api/equipment/";return p.createNewEquipment=t,p.getEquipments=n,p.addMaintenanceNote=o,p.deleteEquipment=i,p.getEquipmentNotes=a,p.deleteNote=r,p.getEquipmentsByUin=u,p.attachEquipToBarcode=c,p.unattachEquipToBarcode=s,p.getBarcodeEquipments=l,p.getEquipmentFields=d,p.saveDataCustomTypes=m,p.getEquipmentHistory=f,p}e.$inject=["api-base-factory"],angular.module("fpm").factory("equipment-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",uin:"<",displayName:"<"},controller:["$scope","$ionicActionSheet","equipment-factory","shared-data-factory","custom-types-factory","authenticationFactory","fpm-utilities-factory",function(e,t,n,o,i,a,r){function u(e,t){if(!0===t){var o=f.customTypesFactory.viewDataForEquipment;if(angular.isArray(o)&&o.length>0){r.showLoading();var i=_.where(o,{type:4});angular.isArray(i)&&angular.forEach(i,function(e){e.value&&(e.value=kendo.toString(kendo.parseDate(e.value),"d"))});var a=JSON.stringify(o);f.view.currentEquip?n.saveDataCustomTypes({num:f.view.currentEquip.num,barcode:f.barcode,customTypesJson:a}).then(function(){f.view.currentActiveIndex=e,f.view.currentEquip=f.view.barcodeEquipments[e]}).finally(r.hideLoading):(f.view.currentActiveIndex=e,f.view.currentEquip=f.view.barcodeEquipments[e])}else f.view.currentActiveIndex=e,f.view.currentEquip=f.view.barcodeEquipments[e]}else f.view.currentActiveIndex=e,f.view.currentEquip=f.view.barcodeEquipments[e]}function c(e,t){!0===e&&(f.view.currentActiveIndex=-1,f.view.currentEquip=null,f.view.notes=[]),f.view.gettingEquipements=!0,f.view.barcodeEquipments=[],r.showLoading().then(function(){n.getBarcodeEquipments(f.barcode).then(function(e){f.view.gettingEquipements=!1,angular.isArray(e)?(f.view.barcodeEquipments=e,1===f.view.barcodeEquipments.length?u(0,t):-1===f.view.currentActiveIndex?u(0,t):u(f.view.currentActiveIndex,t)):(f.view.currentActiveIndex=-1,f.view.currentEquip=null)}).finally(r.hideLoading)})}function s(){f.view.errors=[],r.showLoading().then(function(){n.getEquipmentsByUin(f.uin).then(function(t){if(t&&angular.isArray(t)&&0===t.length)return void r.hideLoading();f.view.equipments=t,r.getModal("attachEquipmentModal.html",e).then(function(e){f.view.attachEquipmentsModal=e,f.view.attachEquipmentsModal.show()})}).finally(r.hideLoading)})}function l(){if(f.view.currentEquip){var e=angular.copy(f.view.currentEquip);p.confirm("Confirmation!","Are you sure?",function(){r.showLoading().then(function(){n.unattachEquipToBarcode(f.barcode,e.num).then(function(e){!0===e&&p.alert("Success","Equipment unattached successfully",function(){c(!0,!1)})}).finally(r.hideLoading)})})}}function d(){f.uiResult=[],f.view.currentEquip?(null===f.view.equipmentHistoryModal&&r.getModal("equipmentHistoryModal.html",e).then(function(e){f.view.equipmentHistoryModal=e}),r.showLoading().then(function(){n.getEquipmentHistory(f.view.currentEquip.num).then(function(e){e&&(f.result=e,f.result.barcodes.length>0&&angular.forEach(f.result.barcodes,function(e){var t=_.filter(f.result.fields,function(t){return e.num===parseInt(t.entityKey,10)});t.length>0&&f.uiResult.push({barcodeView:e,fields:t})}))}).finally(function(){f.view.equipmentHistoryModal.show(),r.hideLoading()})})):p.alert("No Equipment Found","No Equipment Found")}function m(){f.view.errors=[],f.view.newEquipmentEntity=angular.copy(h),null===f.view.newEquipmentModal?r.getModal("newEquipmentModal.html",e).then(function(e){f.view.newEquipmentModal=e,f.view.newEquipmentModal.show()}):f.view.newEquipmentModal.show()}var f=this;f.customTypesFactory=i,f.userInfo=null;var p=r.alerts;f.view={currentActiveIndex:-1,currentEquip:null,barcodeEquipments:[],notes:[],gettingEquipements:!0,attachEquipmentsModal:null,equipments:[],newEquipmentModal:null,newEquipmentEntity:null,equipmentHistoryModal:null};var h={num:0,displayName:f.displayName,numFromCustomerFile:0,equipmentNumber:"",description:"",uin:f.uin,customTypesJson:""},g=[{EntityId:0,EntityType:101,UIOrder:1,Title:"Maintenance Note",Type:6},{EntityId:0,EntityType:101,UIOrder:2,Title:"Performed Date",Type:4}];f.events={tryAttachEquipment:function(){s()},closeHistoryModal:function(){f.view.equipmentHistoryModal&&f.view.equipmentHistoryModal.hide()},createEquipmentSubmit:function(e,t){f.view.errors=[];var o=0!==f.view.newEquipmentEntity.num;0===f.view.newEquipmentEntity.num&&(f.view.newEquipmentEntity.customTypesJson=JSON.stringify(g)),r.showLoading("creating equipment..").then(function(){n.createNewEquipment(f.uin,f.view.newEquipmentEntity,f.barcode,t).then(function(e){if(null!=e&&angular.isArray(e))f.data.errors=e;else{var n=t?"Equipment saved and attached successfully":"Equipment "+(o?"updated":"created")+" successfully";p.alert("Success!",n,function(){f.view.newEquipmentModal.hide(),c(!1)})}}).finally(r.hideLoading)})},closeNewEquipmentModal:function(){f.view.newEquipmentModal&&f.view.newEquipmentModal.hide()},closeEquipmentAttachModal:function(){f.view.attachEquipmentsModal.hide()},onAttachEquipmentItemClicked:function(e){f.view.errors=[],r.showLoading().then(function(){n.attachEquipToBarcode(f.barcode,e.num).then(function(e){null!==e&&angular.isArray(e)?f.view.errors=e:p.alert("Success","Equipment attached to work order successfully.",function(){c(!1,!0)})}).finally(r.hideLoading)})},onActionDotsClicked:function(){t.show({buttons:[{text:"Attach Equipment"},{text:"Unattach Equipment"},{text:"Show Maintenance History"},{text:"Create New Equipment"}],titleText:"Equipment Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&s(),1===e&&l(),2===e&&d(),3===e&&m(),!0}})},onEquimentNextPreButtonClicked:function(e){var t=f.view.currentActiveIndex;t=!0===e?t+1:t-1,t>f.view.barcodeEquipments.length-1&&(t=0),t<0&&(t=f.view.barcodeEquipments.length-1),u(t,!0)}},f.$onInit=function(){f.userInfo=a.getLoggedInUserInfo(),c()},f.$onDestroy=function(){f.view.attachEquipmentsModal=null}}],controllerAs:"vm",templateUrl:"js/equipments/equipments-list-component-template.html"};angular.module("fpm").component("equipmentsListComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,i,a,r){var u=this;u.errors=[],u.isCustomerSelected=!1;var c=a.alerts;u.issameaddress,u.userInfo=r.getLoggedInUserInfo(),u.priorities=[{name:"Normal"},{name:"High"}],u.events={backToEstimates:function(){},onSubmitButtonClicked:function(e){if(u.errors=[],u.isCustomerSelected||u.errors.push("Please select a customer before save"),e){var n=u.entity;i.getAddressCoorinates(n.wosState,n.wosZip,n.wosCity,n.wosStreet).then(function(e){u.entity.longitude=e.lat,u.entity.latitude=e.log,u.entity.estimateName="ESTIMATE",o.createWorkOrderEstimate(u.entity).then(function(e){e.errors?u.errors=e.errors:c.alert("Success","Estimate created successfully",function(){t.go("app.estimates",{refresh:!0})})})})}},sameAsBilling:function(){u.issameaddress,u.entity.wosCity=u.entity.wobbCity,u.entity.wosState=u.entity.wobState,u.entity.wosStreet=u.entity.wobStreet,u.entity.wosZip=u.entity.wobZip},clearServiceAddress:function(){u.entity.wosCity="",u.entity.wosState="",u.entity.wosStreet="",u.entity.wosZip="",u.issameaddress},onCustomerSelected:function(e){u.entity.woDisplayName=e.name,u.entity.woFirstName=e.firstName,u.entity.woLastName=e.lastName,u.entity.woCompanyName=e.company,u.entity.wobbCity=e.addressCity,u.entity.wobState=e.addressCountrySubDivCode,u.entity.wobZip=e.addressPostalCode,u.entity.uin=e.uin,u.entity.woEmail=e.email_Group,u.entity.woPhone=e.phone,u.entity.woFax=e.fax,u.entity.wobStreet=null==e.street?"":e.street.replace("::","\n"),!0===u.issameaddress?(u.entity.wosStreet=e.wobStreet,u.entity.wosState=u.entity.wobState,u.entity.wosCity=u.entity.wobCity,u.entity.wosZip=u.entity.wobZip):(u.entity.wosStreet=null==e.shipStreet?"":e.shipStreet.replace("::","\n"),u.entity.wosState=e.shipState,u.entity.wosCity=e.shipCity,u.entity.wosZip=e.shipZIP),u.isCustomerSelected=!0}},function(){i.getIniitialData().then(function(e){e&&(u.jobTypes=e.jobTypes,u.isServiceProvider=!u.userInfo.isAdminstrator)}),o.createEntity().then(function(e){u.entity=angular.copy(e),u.entity.estimateName="@"})}()}e.$inject=["$scope","$state","$timeout","estimates-factory","shared-data-factory","fpm-utilities-factory","authenticationFactory"],angular.module("fpm").controller("create-estimate-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,i,a,r,u){function c(){l.productSearchModal?l.productSearchModal.show():r.getModal("productSearchModal.html",e).then(function(e){l.productSearchModal=e,l.productSearchModal.show()}),o(function(){e.$broadcast("$fpm:changeAddModalOpenPriority",!1)},1e3)}function s(){i.getEstimateDetails(n.id).then(function(e){console.log(e),l.est=e})}var l=this;l.estimateId=n.id,l.enableMarkup=!1,l.user=u.getLoggedInUserInfo(),l.events={onProdcutActionButtonClicked:function(){c()},onAddProductCompleted:function(e){console.log(e)},onEditProductClicked:function(e){l.currentProduct=e},onDeleteProductClicked:function(e){},onTaxCheckboaxChanged:function(e){},onDescriptionOrNotesChanged:function(){},onAddressTapped:function(){}},e.$on("$fpm:onProductSelected",function(e,t){}),e.$on("$fpm:closeProductSearchModal",function(){l.productSearchModal.hide()}),function(){s()}()}e.$inject=["$scope","$state","$stateParams","$timeout","estimates-factory","shared-data-factory","fpm-utilities-factory","authenticationFactory"],angular.module("fpm").controller("edit-estimate-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(){var o=n.get("estimateEntitySchema");return o?e.when(o):t.get(u+"CreateEntity").then(function(e){return n.set("estimateEntitySchema",e),e})}function i(e){return t.post(u+"CreateWorkOrderEstimate",e)}function a(){return t.get(u+"GetEstimates?status=0")}function r(e){return t.get(u+"GetEstimateDetails?estimateId="+e+"&fromMobile=true")}var u="api/Estimates/";return{getEstimateDetails:r,getAllEstimates:a,createWorkOrderEstimate:i,createEntity:o}}e.$inject=["$q","api-base-factory","localStorageService"],angular.module("fpm").factory("estimates-factory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function i(e){s.processing=!0,o.showLoading("Loading estimates..."),n.getAllEstimates().then(function(t){s.estimates=t,s.processing=!1,angular.isFunction(e)&&e()}).finally(o.hideLoading)}function a(e){}function r(e){t.go("app.editEstimate",{id:e.estimateId})}function u(){t.go("app.createEstimate")}function c(){i(null)}var s=this;s.processing=!0,s.events={refreshOnPullDown:function(){i(function(){e.$broadcast("scroll.refreshComplete")})},onCreateEstimateClicked:u,onDeleteClicked:a,onEditClicked:r},e.$on("$ionicView.afterEnter",function(e,t){c()})}e.$inject=["$scope","$state","estimates-factory","fpm-utilities-factory"],angular.module("fpm").controller("estimates-view-controller",e)}()}(),function(){"use strict";!function(){angular.module("fpm").component("expanseExpanderComponent",{bindings:{barcode:"<"},controller:["$scope",function(e){}],controllerAs:"vm",templateUrl:"js/expanses/expanse-expander-component-template.html"})}()}(),function(){"use strict";!function(){angular.module("fpm").component("expanseItem",{bindings:{item:"<",itemIndex:"<",ondeleteClicked:"&",oneditClicked:"&",isPaidList:"<"},controller:["$scope",function(){var e=this;e.events={onEditClicked:function(){angular.isDefined(e.oneditClicked)&&e.oneditClicked({value:e.item})},onDeleteClicked:function(){angular.isDefined(e.ondeleteClicked)&&e.ondeleteClicked({value:e.item,index:e.itemIndex,isfrompaid:e.isPaidList})}}}],controllerAs:"vm",templateUrl:"js/expanses/expanse-item-template.html"})}()}(),function(){"use strict";!function(){angular.module("fpm").component("expanseListComponent",{bindings:{barcode:"<",refresher:"<"},controller:["$scope","$timeout","$ionicActionSheet","expense-data-factory","fpm-utilities-factory",function(e,t,n,o,i){function a(e){g.paid=[],g.unpaid=[],g.requestCompleted=!1,i.showLoading().then(function(){o.getExpense(g.barcode||"",!0).then(function(e){e&&(g.expanses=e,g.paid=_.filter(e,function(e){return 1==e.expenseStatus}),g.unpaid=_.filter(e,function(e){return 0==e.expenseStatus})),g.requestCompleted=!0}).finally(function(){angular.isFunction(e)&&e(),i.hideLoading()})})}function r(){a()}function u(e,n,a){y.confirmDelete(function(){i.showLoading().then(function(){o.deleteExpense(e.expenseId).then(function(e){!0===e&&(C=t(function(){y.alert("Deleted","Expense deleted successfully",function(){g.expanses.splice(n,1)})},200))}).finally(i.hideLoading)})})}function c(t){null===g.modal?i.getModal("expenseModal.html",e).then(function(e){g.modal=e,g.entity=angular.copy(t),0!==t.expenseId?(g.entity.isReimbursable=0===t.expenseType,g.entity.havingImage=null!==t.imageName):g.entity.havingImage=!1,g.modal.show()}):(g.entity=angular.copy(t),0!==t.expenseId?(g.entity.isReimbursable=0===t.expenseType,g.entity.havingImage=null!==t.imageName,g.entity.imageModel={name:t.imageName,image:null}):g.entity.havingImage=!1,g.modal.show())}function s(e){var t=angular.copy(e);t.isReimbursable=!1,c(t)}function l(){c(angular.copy(v))}function d(){l()}function m(e,t){g.entity.imageChanged=!0,g.entity.imageModel={image:e,name:t}}function f(){g.modal.hide(),g.entity.imageModel=null,g.entity=angular.copy(v),g.image={name:"",visible:!1}}function p(e){g.errors=[],!0===e?(g.entity.expenseType=!0===g.entity.isReimbursable?0:1,g.entity.expenseDate=kendo.toString(kendo.parseDate(g.entity.expenseDate),"g"),i.showLoading().then(function(){o.addExpense(g.entity).then(function(e){e&&(f(),a(i.hideLoading))})})):g.errors.push("Invalid Save: Please check all values before save")}function h(){a(function(){e.$broadcast("scroll.refreshComplete")})}var g=this;g.paid=[],g.unpaid=[],g.expanses=[],g.modal=null;var y=i.alerts,v={expenseId:0,title:"",description:"",expenseType:0,expenseStatus:0,totalCost:0,barcode:g.barcode,expenseDate:new Date,quantity:1,imageChanged:!1,havingImage:!1,isReimbursable:!1};g.image={name:"",visible:!1},g.requestCompleted=!1;var C=null;g.upload={control:null,config:{multiple:!1,showFileList:!1,localization:{select:"upload the receipt"},select:function(t){t.isDefaultPrevented=!0;var n=["tif","tiff","gif","jpeg","jpg","jif","jfif","jp2","jpx","j2k","j2c","pcd","png","bmp"],o=t.files[0].name.split("."),i=o.reverse();if(t.files[0].size>20971520)return void y.alert("Warning","This file is too big.Max size is 20 MB");if(e.$apply(function(){g.image.name=t.files[0].name,g.image.visible=!0}),$.inArray(i[0].toLowerCase(),n)<0)return void y.alert("Warning","Invalid image file extension ( ."+i[0]+" ). Please upload only image file.");var a=new FileReader;a.onload=function(e){m(e.target.result,t.files[0].name)},a.readAsDataURL(t.files[0].rawFile)}}},g.errors=[],g.$onDestroy=function(){t.cancel(C)},g.events={refreshOnPullDown:h,onSubmitClicked:p,closeModal:f,onActionDotsClicked:d,onDeleteClicked:u,onEditClicked:s},g.$onInit=function(){r()}}],controllerAs:"vm",templateUrl:"js/expanses/expanse-list-component-template.html"})}()}(),function(){"use strict";!function(){function e(e){}e.$inject=["$scope"],angular.module("fpm").controller("expanses-controller",e)}()}(),function(){"use strict";!function(){function e(e){function t(t,n){return e.get(r+"GetExpense?barcode="+t+"&isFromMain="+n)}function n(t){return e.post(r+"AddExpense",t)}function o(t){return e.deleteReq(r+"DeleteExpense?id="+t)}function i(t){return e.get(r+"MarkAsPaidUnPaid?id="+t)}function a(t){return e.deleteReq(r+"DeleteImage?expenseId="+t)}var r="api/expense/",u={};return u.markAsPaidUnPaid=i,u.deleteExpense=o,u.addExpense=n,u.getExpense=t,u.deleteImage=a,u}e.$inject=["api-base-factory"],angular.module("fpm").factory("expense-data-factory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,i,a,r,u,c,s){var l=this,d=(r.secLevels,c.getLoggedInUserInfo()),m=u.get("configurations");l.sideMenuItems=[{title:"Home",state:"app.dashboard",icon:"home"},{title:"Calendar",state:"app.calendar",icon:"calendar"},{title:"Map",state:"app.map",icon:"location"},{title:"Create Work Order",state:"app.createWorkOrder",icon:"plus-round",isConfigurationBased:!0,configProperty:"allowCreateWorkOrders"},{title:"Create Customer",state:"app.createCustomer",icon:"plus-round"},{title:"My Expense",state:"app.expense",icon:"cash",basedOn:"etOn",specialFeature:!0},{title:"Time Card",state:"app.timecard",icon:"clock",basedOn:"timeCard",specialFeature:!0},{title:"Custom Components",state:"app.customComponents",icon:"fork-repo"},{title:"Settings",state:"app.settings",icon:"settings"},{title:"Change Password",state:"app.changePassword",icon:""
},{title:"Logout",state:"app.logout",icon:"power"}],e.$on("$ionicView.beforeEnter",function(e,t){n.showBackButton(!1)});i.$on("$stateChangeSuccess",function(e,t,n,o,a){"app.logout"!==t.name&&"login"!==t.name&&"app.editOrder"!==t&&"app.editEstimate"!==t&&u.set("appState",{stateName:t.name,params:n}),"login"===t.name&&"app.changePassword"===o.name&&i.$broadcast("$fpm:onLoginViewLoaded",{clearPassword:!0})}),l.events={checkMenuItemVisibility:function(e){if(angular.isDefined(e.basedOn)){return d[e.basedOn]}if(d.isAdministrator)return!0;if(angular.isDefined(e.isConfigurationBased)&&!0===e.isConfigurationBased&&m&&angular.isDefined(e.configProperty)){return m[e.configProperty]}return!0},onMenuItemClicked:function(e){o.go(e.state)},toggleLeft:function(){}}}e.$inject=["$scope","$ionicSideMenuDelegate","$ionicNavBarDelegate","$state","$rootScope","$stateParams","fieldPromaxConfig","localStorageService","authenticationFactory","fpm-utilities-factory"],angular.module("fpm").controller("app-main-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,i,a,r,u,c,s,l,d){function m(){var e=a.getStoredCredentials();e&&angular.isDefined(e)&&(f.user=angular.copy(e),f.events.loginClick(!0))}var f=this;f.user={userName:"",password:""},f.showError=!1,f.data={model:""};var p=s.alerts;f.events={onForgotPasswordClicked:function(){f.forgotPasswordModalErrors=[],f.data.model="",o.show({templateUrl:"forgotPasswordModal.html",title:"Forgot Password",subTitle:"Please enter your registered email address",scope:e,buttons:[{text:"Cancel",onTap:function(){return f.data.model="",null}},{text:"Send password",type:"button-positive",onTap:function(e){if(f.data.model)return f.data.model;f.forgotPasswordModalErrors.push("please check the entered email"),e.preventDefault()}}]}).then(function(e){""!==$.trim(f.data.model)&&(f.forgotPasswordModalErrors=[],f.showError=!1,s.showLoading("sending password...").then(function(){a.sendPassword(e).then(function(e){angular.isArray(e)&&e.length>0?f.forgotPasswordModalErrors=e:p.alert("Password Sent","Password has been sent successfully.")}).finally(s.hideLoading)}))})},loginClick:function(e){if(f.showError=!1,f.errors=[],!e)return p.alert("Oops","Please enter login information..."),!1;i.show({template:"authenticating you..."}).then(function(){a.login(f.user).then(function(e){i.hide().then(function(){if(e&&a.authentication.isAuth){s.isOnDevMode||(s.locationService.start(l.saveLocationCordinates),l.registerUserTemplateForPushNotifications());var t=d.get("appState");t&&angular.isDefined(t)?"app.editOrder"===t.stateName?r.go("app.dashboard",{refresh:!0}):t.params&&angular.isDefined(t.params)?r.go(t.stateName,t.params):r.go(t.stateName):r.go("app.dashboard",{refresh:!0})}})},function(e){i.hide(),f.showError=!0,e.error?f.errors=[e.error]:f.errors=["Invalid Email or Password"]})})}},e.$on("$ionicView.loaded",function(){n(function(){u.clearHistory(),u.clearCache(),m()},200)}),e.$on("$fpm:onLoginViewLoaded",function(e,t){console.log("EVENT FIRED"),n(function(){t.clearPassword&&(f.user.password="")},200)})}e.$inject=["$scope","$stateParams","$timeout","$ionicPopup","$ionicLoading","authenticationFactory","$state","$ionicHistory","dashboard-factory","fpm-utilities-factory","shared-data-factory","localStorageService"],angular.module("fpm").controller("login-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,i,a){function r(){i.logout(!0),n(function(){t.$broadcast("$fpm:onLoginViewLoaded",{fromLogout:!0}),o.go("login")},200)}e.$on("$ionicView.beforeEnter",function(e,t){r()})}e.$inject=["$scope","$rootScope","$timeout","$state","authenticationFactory","fpm-utilities-factory"],angular.module("fpm").controller("logout-controller",e)}()}(),function(){"use strict";!function(){function e(e){this.heading="HELLLO WORLD FROM IONIC"}e.$inject=["$scope"],angular.module("fpm").controller("main-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){return{link:function(o,i,a){var r=n.secLevels,u=e.getLoggedInUserInfo();if(angular.isDefined(o.basedOn)){i.hide();!0===u[o.basedOn]&&i.show()}else if(!1===o.isConfigurationBased&&o.hideFor===u.secLevel&&i.hide(),!0===o.isConfigurationBased&&u.secLevel===r.ServiceProvider){var c=t.get("configurations");if(c){var s=c[o.configProperty];!0===s?i.show():i.hide()}}},restrict:"A",scope:{isConfigurationBased:"=",configProperty:"=",hideFor:"=",basedOn:"="}}}e.$inject=["authenticationFactory","localStorageService","fieldPromaxConfig"],angular.module("fpm").directive("setElementVisibilityForRole",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",jobtype:"<"},controller:["$scope","$timeout","custom-types-factory",function(e,t,n){function o(e,t){var o=angular.copy(e),a=!1;t&&o.value&&(o.value=kendo.toString(kendo.parseDate(e.value),"g")),3===e.type&&(a=e.value),o.dataEntityType=1,o.entityKey=i.barcode,n.updateData(o,a).then(function(t){t&&(e.id=t.id)})}var i=this;i.factory=n;var a=n.controlTypes;i.isExpanded=!1;var r=0;i.customTypes={data:[]},i.gettingCustomTypes=!1,i.events={onValueChanged:function(e){4===e.type?0===r?(o(e,!0),r++):r=0:o(e)}},i.$onInit=function(){if(i.customTypes.data=[],i.factory.viewData=[],i.factory.requestDataCompleted=!1,null===i.jobtype)return void(i.factory.requestDataCompleted=!0);i.gettingCustomTypes=!0,n.getCustomTypesDataByBarcode(i.barcode,i.jobtype).then(function(e){if(i.gettingCustomTypes=!1,e&&e.length>0){var t=_.where(e,{type:a.CHECKBOX});angular.forEach(t,function(e){e.value="true"===e.value||"True"===e.value||"1"===e.value}),i.customTypes.data=e,i.factory.viewData=i.customTypes.data}i.factory.requestDataCompleted=!0})}}],controllerAs:"vm",templateUrl:"js/jobtype-list/jobtype-list-component-template.html"};angular.module("fpm").component("jobtypeListComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{ctEntity:"="},controller:["$scope","$stateParams","$timeout","custom-types-factory","fpm-utilities-factory",function(e,t,n,o,i){function a(e,a){r.entity.imageModel={Image:e,Name:a},r.entity.view=r.ctEntity,r.entity.view.entityKey=t.barCode,r.ctEntity.value=a,o.uploadFile(r.entity).then(function(e){n(function(){r.ctEntity=e,r.showImageUpload=!1},100),u.alert("Uploaded","File uploaded successfully")}).finally(i.hideLoading)}var r=this;r.entity={},r.showImageUpload=null===r.ctEntity.value;var u=i.alerts;r.events={showImageClick:function(){}},r.imageUploader={control:null,config:{select:function(e){e.isDefaultPrevented=!0,i.showLoading();var t=["tif","tiff","gif","jpeg","jpg","jif","jfif","jp2","jpx","j2k","j2c","pcd","png","bmp"],n=e.files[0].name.split("."),o=n.reverse();if(e.files[0].size>10485760)return i.hideLoading(),void u.alert("Warning","This file is too big. Max size is 10 MB");if($.inArray(o[0].toLowerCase(),t)<0)return i.hideLoading(),void u.alert("Warning","Invalid image file extension ( ."+o[0]+" ). Please upload only image file.");var r=new FileReader;r.onload=function(t){a(t.target.result,e.files[0].name)},r.readAsDataURL(e.files[0].rawFile)},showFileList:!1,localization:{select:"upload image"},multiple:!1}}}],controllerAs:"vm",templateUrl:"js/jobtype-list/jobtype-upload-component-template.html"};angular.module("fpm").component("jobtypeUploadComponent",e)}()}(),function(){"use strict";!function(){function e(e,a,r,u,c,s,l,d,m,f,p,h,g){function y(){C()}function v(){j.filtersModal&&(j.filterDate=null,j.filterEndDate=null,_.forEach(i,function(e){D(e,j.map,!1)}),j.filtersModal&&j.filtersModal.hide())}function C(){j.filtersModal?j.filtersModal.show():h.getModal("mapFilters.html",e).then(function(e){j.filtersModal=e,j.filtersModal.show()})}function w(){T(!1,!0),j.filtersModal&&j.filtersModal.hide()}function D(e,t){e.havingMap=null!==t,e.marker.setMap(t)}function b(){angular.forEach(i,function(e){D(e,null)})}function S(){if(i){U=!0;b();var e=_.filter(i,function(e){return null!==e.start});angular.forEach(e,function(e){D(e,null)});var t=null,n=null;j.filterEndDate&&(t=new Date(j.filterEndDate.getFullYear(),j.filterEndDate.getMonth(),j.filterEndDate.getDate(),0,0,0,0)),j.filterDate&&(n=new Date(j.filterDate.getFullYear(),j.filterDate.getMonth(),j.filterDate.getDate(),0,0,0,0));var o=_.filter(e,function(e){var o=kendo.parseDate(e.start),i=new Date(o.getFullYear(),o.getMonth(),o.getDate(),0,0,0,0);return null!==n&&null===t?moment(i).isSameOrAfter(n):null!==n&&null!==t?moment(i).isSameOrAfter(n)&&moment(i).isSameOrBefore(t):moment(i).isSameOrBefore(t)});o.length>0&&_.forEach(o,function(e){D(e,j.map)})}}function T(e,t){j.filterDate&&S(!0)}function k(){N(!0)}function M(){angular.forEach(j.mapData.users,function(e){e.isChecked=!e.isChecked})}function E(){angular.forEach(j.mapData.users,function(e){e.isChecked=!0})}function I(){c.show({buttons:[{text:"Select All"},{text:"Invert Selection"}],titleText:"Service Provider Filter Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&E(),1===e&&M(),!0}})}function P(){c.show({buttons:[{text:"Set As Today's Date"}],titleText:"Date Filter Options",destructiveText:"Clear Date Filter",cancelText:"Cancel",destructiveButtonClicked:function(){return j.filterDate=null,j.filterEndDate=null,T(!0,!1),!0},cancel:function(){},buttonClicked:function(e){return 0===e&&(j.filterDate=new Date),!0}})}function A(t,n){window.google.maps.event.addListener(t,"click",function(){if(j.currentMarker=n.o,console.log("vm.currentMarker",j.currentMarker),!n.isHome){l.show({templateUrl:"mapInfoWindow.html",title:j.currentMarker.barcodeName,scope:e,buttons:[{text:"Close"},{text:"Edit Order",type:"button-positive",onTap:function(e){n.numFromTechnician&&a.go("app.editOrder",{barCode:n.barCode,technicianNum:n.numFromTechnician,src:"map"})}}]})}})}function O(){j.mapData;o&&o.length>0&&$.each(o,function(e,n){var a=null,r=new window.google.maps.LatLng(n.y,n.x);!0===n.isHome?(a=new window.google.maps.Marker({position:r,map:j.map,icon:{url:n.imageurl,size:new window.google.maps.Size(24,24),origin:new window.google.maps.Point(0,0),anchor:new window.google.maps.Point(0,24)},shape:{coord:[1,1,1,20,18,20,18,1],type:"poly"}}),A(a,n)):(!0===n.isAssigned?(a=new window.google.maps.Marker({position:r,map:j.map,labelContent:R,labelAnchor:new window.google.maps.Point(0,7),labelClass:"labels",labelStyle:{opacity:.75},icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:n.scale||6,fillColor:n.color||t,strokeColor:n.color||t}}),R+=1,i.push({detail:n,marker:a,technician:n.technician,havingMap:!0,isassigned:n.isAssigned,start:null!=n.start?new Date(n.start):null,isSpecialMarker:!0,numFromTechnician:n.numFromTechnician})):(a=new window.google.maps.Marker({position:r,map:j.map,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:n.scale||6,fillColor:n.color||t,strokeColor:n.color||t}}),i.push({detail:n,marker:a,technician:n.technician,havingMap:!0,isassigned:n.isAssigned,start:null!=n.start?new Date(n.start):null,isSpecialMarker:!1,numFromTechnician:n.numFromTechnician})),A(a,n)),o.length-1===e&&(j.filterDate=new Date,j.filterEndDate=new Date,w())})}function F(e){o=[],$.each(j.mapData.orders,function(e,n){var i=n.userColor||t,a=null!==n.scheduledStartDateTime&&null!==n.scheduledFinishDateTime;n.coordinateY&&n.coordinateX&&o.push({x:n.coordinateX,y:n.coordinateY,barCode:n.barcode,isHome:!1,color:i,scale:i===t?4:6,isAssigned:a,technician:n.technicianNum,start:n.scheduledStartDateTime,numFromTechnician:n.numFromTechnicianSchedule,o:n}),e===j.mapData.orders.length-1&&O()})}function N(e){h.showLoading().then(function(){f.getMapData(e).then(function(e){e&&(j.mapData.users=e.users,j.mapData.orders=e.orders,angular.isDefined(j.mapData)&&j.mapData.orders.length>0&&F(!0))}).finally(h.hideLoading)})}function L(){angular.isDefined(google)&&google.maps.event.addListenerOnce(j.map,"idle",function(){N(!1)})}function x(){i=[],B.center=new window.google.maps.LatLng(n.y,n.x),p.getIniitialData().then(function(e){if(j.iniitialData=e,e){var i=e.customerNumberEntity;B.center=new window.google.maps.LatLng(i.coordinateY||n.y,i.coordinateX||n.x),B.zoom=i.zoomDepth||8,j.map=new google.maps.Map(document.getElementById("map"),B),L(),o.push({x:i.coordinateX||n.x,y:i.coordinateY||n.y,imageurl:"../images/markers/home.png",barCode:"[HOME]",isHome:!0,color:t,technician:"",isAssigned:!0,start:null,numFromTechnician:0})}else B.center=new window.google.maps.LatLng(n.y,n.x),j.map=new google.maps.Map(document.getElementById("map"),B),L()})}function q(){x()}var j=this;j.user=g.getLoggedInUserInfo();var B={center:null,panControl:!1,zoomControl:!0,scaleControl:!0,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP};j.filtersApplied=!1,j.filterDate=null;var U=!1;j.events={onFiltersClicked:y,clearFilters:v,applyFilters:w,refreshMapClicked:k,onServiceProviderDotsClicked:I,onDateFilterDotsClicked:P},j.mapData={users:[],orders:[]};var R=1;e.$on("$ionicView.afterEnter",function(e,t){q()}),e.$on("$destroy",function(e){j.map=null,o=[],i=[]})}var t="#000000",n={x:44.31127,y:-92.67851,xcom:-92.67851,ycom:44.3112679},o=[],i=[];e.$inject=["$scope","$state","$q","$cordovaGeolocation","$ionicActionSheet","$timeout","$ionicPopup","$cordovaNetwork","$rootScope","map-factory","shared-data-factory","fpm-utilities-factory","authenticationFactory"],angular.module("fpm").controller("map-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(n){!0===(n=null!==n&&n)&&a.remove(r);var o=a.get(r);return angular.isDefined(o)&&o?t.when(o):e.get(i+"GetMapData?fromMobile=true").then(function(e){return a.put(r,e),e})}var i="api/Dashboard/",a=n("mapCache"),r="workorder:mapdata";return{getMapData:o}}e.$inject=["api-base-factory","$q","$cacheFactory"],angular.module("fpm").factory("map-factory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function i(e){a.errors=[],o.showLoading().then(function(){n.changePassword(a.model).then(function(e){!0===e.ok?o.alerts.alert("Success",e.msg,function(){n.logout(),t.go("login")}):a.errors.push(e.msg)}).finally(o.hideLoading)})}var a=this;a.errors=[],a.model={oldPassword:"",newPassword:"",confirmPassword:""},a.events={onChangePasswordClicked:i}}e.$inject=["$scope","$state","authenticationFactory","fpm-utilities-factory"],angular.module("fpm").controller("change-password-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,i,a){function r(){var e=n.get(o.localStorageKeys.settingsKeyName);e&&(u.userSettings.defaultCalenderViewForMobile=e.DefaultCalenderViewForMobile||"workWeek",u.userSettings.startupPageForMobile=e.StartupPageForMobile,u.userSettings.pushNotifications=e.PushNotifications||!1,u.userSettings.locationServices=e.LocationServices||!1)}var u=this;u.userSettings={defaultCalenderViewForMobile:"workWeek",pushNotifications:!1,locationServices:!1},u.events={updateSettings:function(){a.showLoading().then(function(){i.updateSettings(u.userSettings).then(function(e){a.alerts.alert("Saved","Settings updated successfully",function(){n.set(o.localStorageKeys.settingsKeyName,JSON.parse(e))})}).finally(a.hideLoading)})}},e.$on("$ionicView.beforeEnter",function(e,t){r()})}e.$inject=["$scope","$state","localStorageService","fieldPromaxConfig","shared-data-factory","fpm-utilities-factory"],angular.module("fpm").controller("settings-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function i(o,i,a){function r(e,t,n,o){return c.resolve(e)}function u(e){c.reject(e)}var c=t.defer();return e({method:o,url:n.fieldPromaxApi+i,data:a}).success(r).error(u),c.promise}function a(e,t){return i("POST",e,JSON.stringify(t))}function r(e,t){return i("GET",e,t)}function u(e,t){return i("DELETE",e,t)}return{get:r,post:a,deleteReq:u}}e.$inject=["$http","$q","fieldPromaxConfig","fpm-utilities-factory"],angular.module("fpm").factory("api-base-factory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,i,a,r,u,c,s,l,d,m){function f(n){function o(e){if(e){b.isAuth=!0,b.userName=e.userName;var t={token:e.access_token,userName:e.userName,customerNumber:e.customerNumber,secLevel:e.secLevel,isAdminstrator:"True"===e.isAdminstrator,isIntuitUser:"True"===e.isIntuitUser,userEmail:e.userEmail,etOn:"True"===e.etOn,timeCard:"True"===e.timeCard,allowPushTime:"True"===e.allowPushTime,showPrice:"True"===e.showPrice,havingGroupsAssigned:"True"===e.havingGroups};c.set(D.storageKeyName,t),e.hasOwnProperty(D.configKeyName)&&c.set(D.configKeyName,JSON.parse(e.configurations)),e.userSettings&&c.set(D.settingsKeyName,JSON.parse(e.userSettings)),c.set(D.userCredentials,n),r.resolve(e)}else e.data?r.reject(e.data.error):r.reject("Invalid Login Details")}function i(e){u.hideLoading(),r.reject(e)}var a="grant_type=password&username="+n.userName+"&password="+n.password+"&clientId=fieldPromaxMob",r=t.defer();return e.post(w+"token",a,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(o).error(i),r.promise}function p(){var e=t.defer();return c.get(D.storageKeyName)?e.resolve(!0):e.resolve(!1),e.promise}function h(){return c.get(D.storageKeyName)}function g(e){n.$evalAsync(function(){m.clearTimecardFactoryData(),r.clearHistory(),r.clearCache(),d.clearAllCache(),c.remove(D.initialData),c.remove(D.storageKeyName),c.remove(D.configKeyName),c.remove(D.settingsKeyName),c.clearAll(),e&&c.remove(D.userCredentials),c.remove("orderState"),u.clearHistory()},200)}function y(e){return l.get("api/public/SendPassword?email="+e)}function v(e){return l.post("api/user/changepassword",e)}function C(){return c.get(D.userCredentials)}var w=s.fieldPromaxApi,D=s.localStorageKeys,b={isAuth:!1,userName:""};return{getStoredCredentials:C,login:f,isAuthenticated:p,getLoggedInUserInfo:h,logout:g,sendPassword:y,authentication:b,changePassword:v}}e.$inject=["$http","$q","$rootScope","$state","$window","$timeout","$ionicHistory","fpm-utilities-factory","localStorageService","fieldPromaxConfig","api-base-factory","work-orders-factory","timecard-factory"],angular.module("fpm").factory("authenticationFactory",e)}()}(),function(){"use strict";!function(){function e(){return{link:function(e,t,n){setTimeout(function(){$(t).autogrow({vertical:!0,horizontal:!1})},1e3)},restrict:"A"}}var t=angular.module("fpm");t.directive("focusMe",["$timeout",function(e){return{link:function(t,n,o){t.$on("modal.shown",function(){e(function(){n[0].focus(),ionic.Platform.isAndroid()&&cordova.plugins.Keyboard.show()},750)})}}}]),t.directive("autoGrow",e)}()}(),function(){"use strict";!function(){function e(){return function(e){var t=e.substr(e.lastIndexOf("/")+1);return t.substr(0,t.lastIndexOf("."))||""}}var t=angular.module("fpm");t.provider("fpm-utilities-factory",function(){function e(e,n,o,i,a,r,u,c,s,l,d,m,f){var p={ANDROID:1,IOS:2,OTHER:3},h=!1,g=null,y=null,v={maximumAge:3e3,timeout:6e4,enableHighAccuracy:!1},C={maximumAge:3e3,timeout:6e4,enableHighAccuracy:!1},w=(m.localStorageKeys,{alert:function(e,t,n){var o=a.alert({title:e,template:t});angular.isFunction(n)&&o.then(function(e){n()})},confirmWithOkayCancel:function(e,t,n,o){a.confirm({title:e,template:t,cancelText:"Cancel",okText:"Okay"}).then(function(e){e?angular.isFunction(n)&&n():angular.isFunction(o)&&o()})},confirm:function(e,t,n,o){a.confirm({title:e,template:t,cancelText:"No",okText:"Yes"}).then(function(e){e?angular.isFunction(n)&&n():angular.isFunction(o)&&o()})},confirmDelete:function(e){a.confirm({title:"Confirmation",template:"Are you sure?",cancelText:"No",okText:"Yes"}).then(function(t){t&&angular.isFunction(e)&&e()})}}),D={isAndroid:function(){return!!t||ionic.Platform.isAndroid()},isIOS:function(){return!t&&ionic.Platform.isIOS()}},b={GCM_SENDER_ID:"504804224593",registrationId:null};return{push:{getRegistrationId:function(){return f.get("PUSH:registrationId")},register:function(){if(!t){PushNotification.init({android:{senderID:b.GCM_SENDER_ID,forceShow:"false"},ios:{alert:"true",badge:"true",sound:"true"}}).on("registration",function(e){e&&(b.registrationId=e.registrationId,f.set("PUSH:registrationId",e.registrationId))})}}},locationService:{start:function(e){function t(e){}function n(t){t&&t.coords&&angular.isFunction(e)&&e(t.coords)}var o=f.get(m.localStorageKeys.settingsKeyName);o&&o.LocationServices&&(navigator.geolocation.getCurrentPosition(n,t,C),y=d.watchPosition(v),y.then(null,t,n))},stop:function(){y&&angular.isFunction(y.clearWatch)&&y.clearWatch(),d.clearWatch(y)}},isOnDevMode:t,showNetworkDialog:function(){h||(g=a.alert({title:"No Network",template:"You're not connected to internet"}),h=!0,g.then(function(){h=!1}))},hideNetworkDialog:function(){g&&h&&(g.close(),h=!1)},clearHistory:function(){l.clearHistory()},device:{isAndroid:D.isAndroid,isIOS:D.isIOS,isConnected:function(){return t||o.isOnline()},getPicture:function(){var e={quality:50,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,saveToPhotoAlbum:!1},t=i.defer();return s.getPicture(e).then(function(e){t.resolve(e)},function(){a.alert({title:"Failed",template:"Failed to get Image Data"}),t.reject()}),t.promise},platforms:p,getPlatformInfo:function(){var e=t?"Android":c.getPlatform();return"Android"===e?p.ANDROID:"iOS"===e?p.IOS:p.OTHER}},toStringDate:function(e){return kendo.toString(kendo.parseDate(e),"g")},showLoading:function(e){var t=e||"please wait...";return u.show({template:t})},getModal:function(e,t){var n=i.defer();return r.fromTemplateUrl(e,{scope:t,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){n.resolve(e)}),n.promise},hideLoading:function(){return u.hide()},alerts:{alert:w.alert,confirm:w.confirm,confirmDelete:w.confirmDelete,confirmWithOkayCancel:w.confirmWithOkayCancel}}}var t=!1;this.setApplicationModel=function(e){t=e},this.$get=["$cordovaDialogs","$window","$cordovaNetwork","$q","$ionicPopup","$ionicModal","$ionicLoading","$cordovaDevice","$cordovaCamera","$ionicHistory","$cordovaGeolocation","fieldPromaxConfig","localStorageService",e]}),t.filter("removeExt",[e])}()}(),function(){"use strict";!function(){function e(e,t,n){var o={BadRequest:400,PageNotFound:401},i={},a=function(e){e.headers=e.headers||{};var t=n.get("authorizationData");return t&&(e.headers.Authorization="Bearer "+t.token),e},r=function(n){if(n.status===o.PageNotFound&&t.path("/"),n.status===o.BadRequest&&n.data)throw n;return e.reject(n)};return i.request=a,i.responseError=r,i}e.$inject=["$q","$location","localStorageService"],angular.module("fpm").factory("requestIntercepter",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,i){function a(e){return t.post("api/User/UpdateUserSettings",e)}function r(i){var a=o.localStorageKeys.initialData;!0===(i||!1)&&n.remove(a);var r=n.get(a);return r?e.when(r):t.get(d+"GetIniitialData").then(function(e){return n.set(a,e),e})}function u(e){return t.get(d+"SaveLocationCoordinates?lat="+e.latitude+"&lng="+e.longitude)}function c(){var e=n.get("PUSH:registrationId");if(!i.isOnDevMode&&angular.isDefined(e)){var o=i.device.isAndroid(),a=o?"0":"1",r=m+"RegisterUserToHub?handle="+e+"&platform="+a;return t.get(r)}var r=m+"RegisterUserToHub?handle="+e+"&platform=0";return t.get(r)}function s(e){return t.post(f+"PostLocation",e)}function l(t,n,o,i){var a=e.defer();if(window.google){var r=new google.maps.Geocoder,u=i+" "+o+" "+t+" "+n;r.geocode({address:u},function(e,t){t===google.maps.GeocoderStatus.OK?a.resolve({log:e[0].geometry.location.lng(),lat:e[0].geometry.location.lat()}):a.resolve({log:0,lat:0})})}else a.resolve({log:0,lat:0});return a.promise}var d="api/Shared/",m="api/NotificationsHub/",f="api/Location/";return{getAddressCoorinates:l,postLocation:s,registerUserTemplateForPushNotifications:c,updateSettings:a,getIniitialData:r,saveLocationCordinates:u}}e.$inject=["$q","api-base-factory","localStorageService","fieldPromaxConfig","fpm-utilities-factory"],angular.module("fpm").factory("shared-data-factory",e)}()}(),function(){"use strict";!function(){function e(e){function t(t,n){return e.get(i+"GetCustomTypesDataByBarcode?jobTypeName="+n+"&barcode="+t)}function n(t){return e.post(i+"UploadFile",t)}function o(t,n){return e.post(i+"UpdateData?checkBoxValue="+n,t)}var i="api/CustomTypes/",a={None:0,WorkOrder:1,Estimate:2,Expense:3,JobType:4,Equipment:101,EquipmentsToBarcode:102},r={TEXT_BOX:1,RADIO:2,CHECKBOX:3,DATE:4,UPLOAD:5},u={requestDataCompleted:!1,barcode:"",jobTypeName:"",entityId:0,isNewType:!1,fireGetTypesEvent:!1,fetchViewData:!1,data:[],viewData:[],viewDataForEquipment:[]},c={};return c.uploadFile=n,c.controlTypes=r,c.getCustomTypesDataByBarcode=t,c.entityTypes=a,c.typesData=u,c.updateData=o,c}e.$inject=["api-base-factory"],angular.module("fpm").factory("custom-types-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{isEstimate:"<",onAddProductCompleted:"&",modalType:"<",product:"="},templateUrl:"js/shared-components/edit-product-component-template.html",controller:["$scope","$stateParams","$rootScope","work-orders-factory","authenticationFactory","fpm-utilities-factory","shared-data-factory",function(e,t,n,o,i,a,r){var u=this;u.user=i.getLoggedInUserInfo(),u.events={closeProductEditModal:function(){n.$broadcast("$fpm:closeEditProductModal")},updateProductClick:function(){if(0===u.modalType){var i=u.isEstimate?null:o.updateProduct;a.showLoading("updating product...").then(function(){i(u.product).then(function(t){e.$emit("$fpm:operation:updateProduct",t)}).finally(a.hideLoading)})}else u.product.barCode=t.barCode,u.product.quantity=u.product.qty,u.product.markup=u.product.markup,u.product.FromListWindow=!0,a.showLoading().then(function(){o.addProduct(u.product).then(function(e){angular.isFunction(u.onAddProductCompleted)?u.onAddProductCompleted({product:e}):n.$broadcast("$fpm:operation:addProduct",e)}).finally(a.hideLoading)})}},u.$onInit=function(){r.getIniitialData().then(function(e){u.enableMarkupOrders=e.customerNumberEntity.enableMarkupForWorkOrders||!1})}}],controllerAs:"vm"};angular.module("fpm").component("editProductComponent",e)}()}(),function(){"use strict";!function(){angular.module("fpm").component("errorsView",{bindings:{errors:"<"},templateUrl:"js/shared-components/errors-view-component-template.html",controllerAs:[function(){}],controllerAs:"vm"})}()}(),function(){"use strict";!function(){function e(){return{link:function(e,t,n){$("#noImageMessageContainer").hide(),$(t).on("error",function(){$(t).hide(),$("#noImageMessageContainer").show()})}}}angular.module("fpm").directive("imageSrcCheck",e)}()}(),function(){"use strict";!function(){var e={templateUrl:"js/shared-components/product-search-component-template.html",controller:["$scope","$timeout","$ionicModal","fpm-utilities-factory","work-orders-factory","authenticationFactory",function(e,t,n,o,i,a){var r=this;r.searchValue="",r.products=[];var u=null;r.user=a.getLoggedInUserInfo(),r.events={closeProductEditModal:function(){r.productModal&&r.productModal.hide()},applySearch:function(){r.products=[],r.searchApplied=!1,r.runningSearch=!0,i.searchProduct(r.searchValue,"").then(function(e){r.searchApplied=!0,r.runningSearch=!1,angular.isArray(e)&&(r.products=e)})},onProductItemClicked:function(t){r.currentProduct=angular.copy(t),r.currentProduct.qty=1,r.openEditProductModalOnProductSelectedFromSearch?(r.currentProduct.markup=0,r.productModal&&r.productModal.show().then(function(){})):e.$emit("$fpm:onProductSelected",t)},closeSearchModal:function(){e.$emit("$fpm:closeProductSearchModal",{fromProductAdd:!1})},onAddProductCompleted:function(n){r.productModal.hide(),u=t(function(){e.$emit("$fpm:closeProductSearchModal",{fromProductAdd:!0})},100)}},e.$on("$fpm:closeEditProductModal",function(){r.productModal&&r.productModal.hide(),u&&t.cancel(u)}),o.getModal("addProductModal.html",e).then(function(e){r.productModal=e}),r.openEditProductModalOnProductSelectedFromSearch=!0,e.$on("$fpm:changeAddModalOpenPriority",function(e,t){r.openEditProductModalOnProductSelectedFromSearch=t})}],controllerAs:"vm"};angular.module("fpm").component("productSearchComponent",e)}()}(),function(){"use strict";!function(){angular.module("fpm").filter("timeSpan",function(){return function(e,t){if(Date.parse(e)&&Date.parse(t)){var n=moment(t).diff(kendo.parseDate(e),"minutes"),o=Math.floor(n/60),i=n%60;return o>0?o+" hrs "+i+" min":i+" min"}return""}})}()}(),function(){"use strict";!function(){var e={bindings:{onCancelClicked:"&",onAddCompleted:"&"},controller:["$scope","$timeout","$q","$ionicActionSheet","timecard-factory","fpm-utilities-factory","authenticationFactory",function(e,t,n,o,i,a,r){function u(){if(h.ui.errors=[],null!==h.entity.finishTime){var e=kendo.parseDate(h.entity.finishTime),t=kendo.parseDate(h.entity.timeCardDate),n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),(new Date).getHours(),(new Date).getMinutes(),0,0),o=moment(new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),0,0));if(moment(o).diff(kendo.parseDate(h.entity.startTime),"minutes")<0)return h.ui.errors.push("Invalid Time"),!1;if(!h.isFromPto&&!h.editMode&&o.isAfter(n))return h.ui.errors.push("Cannot be a future time"),!1}if(null===h.entity.jobCode||0===h.entity.jobCode)return h.ui.errors.push("Please select Job code before save"),!1;a.showLoading().then(function(){(h.isFromPto?i.addPtoDetails:i.addNewDetails)(h.entity).then(function(e){y=!1,angular.isArray(e.errors)&&e.errors.length>0?h.ui.errors=e.errors:g.alert("Time Added","Time has been "+(h.editMode?"updated":"added"),function(){angular.isFunction(h.onAddCompleted)&&h.onAddCompleted({o:e})})}).finally(a.hideLoading)})}function c(){var e=i.summary,t=h.dateTimeMode.startTime,n=kendo.parseDate(e.timeCardDate);h.entity.startTime=new Date(n.getFullYear(),n.getMonth(),n.getDate(),t.getHours(),t.getMinutes(),0,0),m()}function s(){var e=i.summary;null===h.entity.startTime&&c();var t=kendo.parseDate(h.dateTimeMode.finishTime),n=kendo.parseDate(e.timeCardDate);h.entity.finishTime=new Date(n.getFullYear(),n.getMonth(),n.getDate(),t.getHours(),t.getMinutes(),0,0),m()}function l(){if(i.summary&&i.summary.timeCardDate){var e=i.summary,t=kendo.parseDate(e.timeCardDate),n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),(new Date).getHours(),(new Date).getMinutes(),0);h.entity.startTime=n,h.dateTimeMode.startTime=n}}function d(e){h.ui.errors=[],h.details=e.details,h.editMode=e.editMode,h.isInEditMode=h.editMode;var t=e.isFromPto;h.isFromPto=t,h.editMode&&h.details?(h.entity=angular.copy(h.details),h.entity.startTime=kendo.parseDate(h.details.startTime),h.entity.finishTime=kendo.parseDate(h.details.finishTime),h.isFromPto=h.details.isPtoType,h.dateTimeMode.startTime=null,h.entity.startTime&&(h.dateTimeMode.startTime=h.entity.startTime,h.dateTimeMode.isCheckedIn=!0),h.dateTimeMode.finishTime=null,h.entity.finishTime&&(h.dateTimeMode.finishTime=h.entity.finishTime,h.dateTimeMode.isCheckedOut=!0),h.dateTimeMode.isCheckedOut=null!==h.entity.finishTime,m()):(h.entity=angular.copy(v),h.entity.startTime=new Date,h.entity.finishTime=null,h.dateTimeMode.startTime=new Date,h.dateTimeMode.finishTime=null,h.dateTimeMode.isCheckedIn=!1,h.dateTimeMode.isCheckedOut=!1,h.dateTimeMode.timeSpan="",!0===t&&l()),i.summary&&(h.entity.numFromSummary=i.summary.num,h.entity.timeCardDate=kendo.parseDate(i.summary.timeCardDate)),h.timecardPermissions.isFromAddingPto=t,t&&(h.timecardPermissions.timePickerVisibility=t)}function m(){var e=n.defer();if(h.ui.errors=[],h.ui.isInvalidSave=!1,Date.parse(h.entity.startTime)&&Date.parse(h.entity.finishTime))var o=new Date(h.entity.finishTime),i=new Date(h.entity.startTime),a=new Date(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),0,0),r=new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),0,0),u=moment(a).diff(moment(r),"minutes"),c=Math.floor(u/60),s=u%60,l=t(function(){u>0?(h.dateTimeMode.timeSpan=c>0?c+(c>1?" Hours ":" Hour ")+s+(s>1?" Minutes":" Minute"):s+" Minutes",e.resolve(!0)):h.isInEditMode||(h.entity.finishTime=new Date,h.ui.isInvalidSave=!0,e.resolve(!1)),t.cancel(l)},10);return e.promise}function f(){a.showLoading().then(function(){i.getWorkOrdersList().then(function(e){
h.ui.workOrders=e}).finally(p)})}function p(){a.showLoading().then(function(){i.getJobCodes().then(function(e){h.ui.jobCodes=_.where(e,{isPtoType:!1}),h.ui.ptoJobCodes=_.where(e,{isPtoType:!0})}).finally(a.hideLoading)})}var h=this,g=a.alerts,y=!1;h.ui={summary:angular.copy(i.summary),jobCodes:[],workOrders:[],errors:[],isInvalidSave:!1,ptoJobCodes:[]},h.dateTimeMode={timeSpan:"",startTime:new Date,finishTime:null,isCheckedIn:!1,isCheckedOut:!1};var v={num:0,numFromSummary:0,timeCardDate:new Date,startTime:null,finishTime:null,jobCode:0,notes:"",barcode:0,isUserDefined:!0};h.timecardPermissions={allowPushTime:!1,timePickerVisibility:!0,isFromAddingPto:!1},h.entity=null,h.events={checkInClick:function(){null===h.entity.startTime&&(h.dateTimeMode.startTime=new Date,h.entity.startTime=new Date,h.entity.finishTime=null,h.dateTimeMode.finishTime=null,m().then(function(e){e?h.dateTimeMode.isCheckedIn=!0:h.ui.errors.push("Invalid Time")}))},checkOutClick:function(){null===h.entity.finishTime&&(h.dateTimeMode.finishTime=new Date,h.entity.finishTime=new Date),m().then(function(e){e?h.dateTimeMode.isCheckedOut=!0:h.ui.errors.push("Invalid Time")})},updateButtonClicked:function(){if(h.ui.errors=[],h.ui.isInvalidSave=!1,null===h.entity.startTime&&(h.entity.startTime=new Date),h.entity.startTime=kendo.toString(h.entity.startTime,"g"),h.entity.finishTime=kendo.toString(h.entity.finishTime,"g"),!h.editMode){var e=angular.copy(i.details);return _.where(e,{finishTime:null}).length>0&&!y?g.confirm("Confirmation!","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(e){y=!0,u()}):u(),!1}return u(),!1},closeProductEditModal:function(){angular.isFunction(h.onCancelClicked)&&h.onCancelClicked()},onDateTimeChaged:c,onFinishDateTimeChaged:s},h.$onChanges=function(){},h.$onInit=function(){h.userInfo=r.getLoggedInUserInfo(),h.userInfo&&(h.timecardPermissions.allowPushTime=h.userInfo.allowPushTime,h.timecardPermissions.timePickerVisibility=h.userInfo.allowPushTime),f()},e.$on("timecard:addEditDetailsModal:open",function(e,t){d(t)})}],controllerAs:"vm",templateUrl:"js/timecard/timecard-add-edit-detail-component.template.html"};angular.module("fpm").component("addEditDetailsComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,i,a,r,u,c,s){function l(e){return _.where(e.timeCardDetails,{finishTime:null}).length>0?(k.ui.data.allowSendForApproval=!1,!1):k.ui.data.approvalStatus!==I.NONE?(k.ui.data.allowSendForApproval=!1,!1):(k.ui.data.allowSendForApproval=!0,!0)}function d(){var e=new Date(k.ui.data.currentDate.getFullYear(),k.ui.data.currentDate.getMonth(),k.ui.data.currentDate.getDate(),0,0,0,0),t=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),0,0,0,0),n=moment(e).isBefore(t),o=moment(e).isAfter(t);moment(e).isSame(t)&&(k.ui.data.addTimeVisibility=k.ui.data.isClockedIn,k.ui.data.ptoButtonVisibility=!k.ui.data.isClockedIn),k.ui.data.disableClockInButton=n,!0===k.ui.data.isClockedOut&&(k.ui.data.disableClockOutButton=n),!0===o&&(k.ui.data.disableClockInButton=!0,k.ui.data.addTimeVisibility=!1,k.ui.data.ptoButtonVisibility=!0),!0===n&&(k.ui.data.addTimeVisibility=!1,k.ui.data.ptoButtonVisibility=!0)}function m(e){var t=1,n=1;k.ui.data.timeCards=[],e.length>0&&angular.forEach(e,function(o,i){o.jobCode!==M.CLOCK_IN?o.isPtoType?(o.pto=n,n++):(o.section=t,t++):o.section=0,i===e.length-1&&(k.ui.data.timeCards=_.reject(e,{jobCode:M.CLOCK_IN,finishTime:null}))})}function f(e){if(k.ui.data.timeCards=[],k.ui.data.summary=e.timeCardSummary,k.factory.summary=e.timeCardSummary,k.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0,P=e.pendingClockIns,k.ui.data.currentClockedIn=_.findWhere(e.timeCardDetails,{jobCode:M.CLOCK_IN,finishTime:null}),l(e),angular.isDefined(k.ui.data.currentClockedIn)){var t=k.ui.data.currentClockedIn;k.ui.data.clockInDateTime=kendo.parseDate(t.startTime),k.ui.data.isClockedIn=!0,k.ui.data.isClockedOut=null!==t.finishTime,k.ui.data.addTimeVisibility=!k.ui.data.isClockedOut,k.ui.data.clockOutDateTime=kendo.parseDate(t.finishTime),k.ui.data.clockedInDate=angular.copy(t)}d(),m(e.timeCardDetails)}function p(){k.ui.data.totalTime="0";var e=_.filter(k.ui.data.timeCards,function(e){return e.jobCode===M.CLOCK_IN&&null!==e.finishTime}),t=_.filter(k.ui.data.timeCards,function(e){return e.jobCode!==M.CLOCK_IN&&!1===e.isPayable&&null!==e.finishTime}),n=0;if(e.length>0&&angular.forEach(e,function(e,t){n+=moment(kendo.parseDate(e.finishTime)).diff(kendo.parseDate(e.startTime),"minutes")}),t.length>0){var o=0;angular.forEach(t,function(e,i){if(o+=moment(kendo.parseDate(e.finishTime)).diff(kendo.parseDate(e.startTime),"minutes"),i===t.length-1){n-=o;var a=Math.floor(n/60),r=n%60;k.ui.data.totalTime=a+" hrs "+r+" min"}})}else{var i=Math.floor(n/60),a=n%60;k.ui.data.totalTime=i+" hrs "+a+" min"}}function h(){k.ui.data.allowSendForApproval=!1,k.ui.data.summary=null,k.ui.data.approvalStatus=0,k.ui.data.isClockedOut=!1,k.ui.data.summary=null,k.ui.data.clockInDateTime=new Date,k.ui.data.isClockedIn=!1,k.ui.data.addTimeVisibility=!1,k.ui.data.clockedInDate=null,k.ui.data.timeCards=[],k.ui.data.disableClockInButton=!1,k.ui.data.disableClockOutButton=!1}function g(){h(),c.showLoading().then(function(){u.getTimeCardByDate(E(k.currentDate)).then(function(e){e?f(e):d()}).finally(c.hideLoading)})}function y(e){k.popover.show(e)}function v(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),0,0),n={startTime:kendo.toString(t,"g"),jobCode:M.CLOCK_OUT,numFromSummary:k.ui.data.summary.Num,timeCardDate:kendo.parseDate(k.ui.data.summary.timeCardDate),uniqueIdentifier:k.ui.data.currentClockedIn.uniqueIdentifier};c.showLoading().then(function(){u.clockInOutUser(n).then(function(e){if(null===e.errors){k.ui.data.clockOutDateTime=t,k.ui.data.isClockedOut=!0,k.ui.data.isClockedIn=!1,k.ui.data.disableClockOutButton=!0,k.ui.data.addTimeVisibility=!1,k.ui.data.ptoButtonVisibility=!0,k.ui.data.summary=e.timeCardSummary,k.factory.summary=e.timeCardSummary;var n=new Date,o=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),i=new Date(moment(k.ui.data.summary.timeCardDate)),a=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0);moment(a).isSameOrAfter(o)&&(k.ui.data.disableClockInButton=!1),k.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0,m(e.timeCardDetails),l(e)}}).finally(function(){c.hideLoading()})})}function C(){!0===k.ui.data.isFromPto&&null===k.ui.data.summary&&(k.ui.data.summary={num:0,timeCardDate:k.ui.data.currentDate},k.factory.summary=k.ui.data.summary),null===k.ui.data.addEditDetailsModal?a.fromTemplateUrl("timecardDetailsModal.html",{scope:e,animation:"slide-in-up"}).then(function(n){k.ui.data.addEditDetailsModal=n,t(function(){e.$broadcast("timecard:addEditDetailsModal:open",{isFromPto:k.ui.data.isFromPto,details:k.ui.data.currentDetails,editMode:k.ui.data.isInEditMode}),n.show()},300)}):(e.$broadcast("timecard:addEditDetailsModal:open",{isFromPto:k.ui.data.isFromPto,details:k.ui.data.currentDetails,editMode:k.ui.data.isInEditMode}),k.ui.data.addEditDetailsModal.show())}function w(){null===k.ui.data.timeCardSummaryModal?a.fromTemplateUrl("timecardSummaryModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){k.ui.data.timeCardSummaryModal=t,e.$broadcast("timecard:timeCardSummaryModal:open"),k.ui.data.timeCardSummaryModal.show()}):(e.$broadcast("timecard:timeCardSummaryModal:open"),k.ui.data.timeCardSummaryModal.show())}function D(){null===k.ui.data.timecardTutorialModal?a.fromTemplateUrl("timecardTutorialModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){k.ui.data.timecardTutorialModal=e,k.ui.data.timecardTutorialModal.show()}):k.ui.data.timecardTutorialModal.show()}function b(e){g()}function S(){angular.isDefined(k.ui.calendar.control)&&k.ui.calendar.control.show()}function T(){g();var e=s.getLoggedInUserInfo(),t=_.findWhere(A,{c:e.customerNumber});k.ui.data.enableForCustomer=angular.isDefined(t)}var k=this,M={CLOCK_IN:5001,CLOCK_OUT:5002},E=c.toStringDate,I={NONE:0,SEND_FOR_APPROVAL:1,CANCELLED:2,APPROVED:3},P=[];k.errors=[],k.factory=u;var $=c.alerts;k.currentDate=new Date,i.fromTemplateUrl("my-popover.html",{scope:e}).then(function(e){k.popover=e});k.currentDate;k.events={showPopoverClicked:y};k.ui={errors:[],calendar:{settings:{theme:"mobiscroll",display:"bottom",swipeDirection:"vertical"}},data:{componentEvents:null,summary:null,currentDate:new Date,isClockedIn:!1,isClockedOut:!1,clockInDateTime:new Date,clockOutDateTime:new Date,addTimeVisibility:!1,clockedInDate:null,timeCards:[],approvalStatus:0,disableClockInButton:!1,disableClockOutButton:!1,currentClockedIn:null,allowSendForApproval:!1,totalTime:"",enableForCustomer:!1,ptoButtonVisibility:!1,isFromPto:!1,isInEditMode:!1,addEditDetailsModal:null,timeCardSummaryModal:null,currentDetails:null,timecardTutorialModal:null},events:{onShowCalenderClick:S,onCurrentDateChanged:b,onTutorialModalCancel:function(){k.ui.data.timecardTutorialModal&&k.ui.data.timecardTutorialModal.hide()},onSummaryModalCancel:function(){k.ui.data.timeCardSummaryModal.hide()},checkSummaryClick:function(){return w(),k.popover.hide(),!0},showTimeCardTutorialWindow:function(){return k.popover.hide(),D(),!0},onAddScheduleCompleted:function(e){k.ui.data.timeCards.length!==e.timeCardDetails.length&&(k.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0),m(e.timeCardDetails),k.ui.data.addEditDetailsModal.hide()},onModalCancelClicked:function(){k.ui.data.isInEditMode=!1,k.ui.data.isFromPto=!1,k.ui.data.currentDetails=null,k.ui.data.addEditDetailsModal.hide()},addTimeClick:function(e){return t(function(){k.ui.data.isFromPto=e,k.ui.data.isInEditMode=!1,C()},100),k.popover.hide(),!0},onCardActionClicked:function(e){r.show({buttons:[{text:"Edit"}],destructiveText:"Delete",titleText:"Time Card Options",cancelText:"Cancel",cancel:function(){},destructiveButtonClicked:function(){return e.isUserDefined?$.confirmDelete(function(){c.showLoading().then(function(){u.deleteTimeCardDetails(e.num,e.numFromSummary).then(function(e){e&&$.alert("Success","Time Details cleared successfully",function(){m(e.timeCardDetails)})}).finally(c.hideLoading)})}):$.alert("Invalid Action","You are not allowed to perform delete"),!0},buttonClicked:function(n){return 0===n&&t(function(){k.ui.data.currentDetails=e,k.ui.data.isInEditMode=!0,k.ui.data.isFromPto=e.isPtoType,C()},100),!0}})},sendForApproval:function(e){if(angular.isArray(k.ui.data.timeCards)&&0===k.ui.data.timeCards.length)return $.alert("No Timecard!","No Timecard information found to process this request."),!1;$.confirm("Confirmation!","Are you sure?",function(){c.showLoading().then(function(){u.sendForApproval(k.ui.data.summary.num,e).then(function(e){e&&(k.ui.data.summary=e.timeCardSummary,$.alert("Success","Time card sent for approval successfully"),k.ui.data.addTimeVisibility=!1,k.ui.data.ptoButtonVisibility=!1,k.ui.data.approvalStatus=k.ui.data.summary.approveStatus)}).finally(c.hideLoading)})})},clockOutClick:function(){_.where(k.ui.data.timeCards,{finishTime:null}).length>0?$.confirm("Confirmation!","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(){v()}):$.confirm("Confirmation!","Are you sure?",function(){v()})},clockInClick:function(){var e=k.currentDate,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),(new Date).getHours(),(new Date).getMinutes(),0,0),n={startTime:c.toStringDate(t),jobCode:M.CLOCK_IN,numFromSummary:null===k.ui.data.summary?0:k.ui.data.summary.Num,timeCardDate:t};k.errors=[],c.showLoading().then(function(){u.clockInOutUser(n).then(function(e){null===e.errors?(k.ui.data.clockInDateTime=t,k.ui.data.isClockedIn=!0,k.ui.data.disableClockOutButton=!1,k.ui.data.addTimeVisibility=!0,k.ui.data.ptoButtonVisibility=!1,$.alert("Clocked In","Clocked in successfully",function(){f(e)})):k.errors=e.errors}).then(function(){c.hideLoading()})})}}};var A=[{c:"407805491"},{c:"1238967820"}];e.$watch("vm.ui.data.timeCards",function(e){k.factory.details=e,angular.isDefined(e)&&p()},!0),e.$on("$destroy",function(){}),e.$on("$ionicView.beforeEnter",function(e,t){T()})}e.$inject=["$scope","$timeout","$rootScope","$state","$ionicPopover","$ionicModal","$ionicActionSheet","timecard-factory","fpm-utilities-factory","authenticationFactory"],angular.module("fpm").controller("timecard-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(t){return e.get(w+"GetTimeCardByDate?date="+t)}function i(t){return e.get(w+"GetClockInByDate?date="+t)}function a(t){return e.post(w+"ClockInOutUser",t)}function r(n){!0===(n=n||!1)&&D.remove("jobCodes");var o=D.get("jobCodes");return angular.isDefined(o)&&o?t.when(o):e.get(w+"GetJobCodes").then(function(e){return D.put("jobCodes",e),e})}function u(n){!0===(n=n||!1)&&D.remove("workorders");var o=D.get("workorders");return angular.isDefined(o)&&o?t.when(o):e.get(w+"GetWorkOrdersList").then(function(e){return D.put("workorders",e),e})}function c(t){return e.post(w+"AddNewDetails",t)}function s(t,n){return e.get(w+"ClearCheckedOutTime?detailId="+t+"&summaryId="+n)}function l(t,n){return e.get(w+"SendForApproval?summaryId="+t+"&status="+n)}function d(t,n){return e.get(w+"DeleteTimeCardDetails?detailId="+t+"&summaryId="+n)}function m(t){return e.get(w+"ClearTimeCard?summaryId="+t)}function f(){return e.get(w+"GetPendingClockIns")}function p(t){return e.post(w+"PushCheckInOutTimes",t)}function h(){return e.get(w+"CertifieldUser")}function g(){return e.get(w+"GetCertifieldUser")}function y(t){return e.post(w+"AddPtoDetails",t)}function v(t){return e.post(w+"GetPayableHoursSummaryView",t)}function C(){S.data={details:[],jobCodes:{CLOCK_IN:5001,CLOCK_OUT:5002},summary:null}}var w="api/timecard/",D=n("timeCardCache"),b={details:[],jobCodes:{CLOCK_IN:5001,CLOCK_OUT:5002},summary:null},S={};return S.clearTimecardFactoryData=C,S.addPtoDetails=y,S.getSummaryPayableHours=v,S.certifyUser=h,S.getCertifieldUser=g,S.pushCheckInOutTimes=p,S.data=b,S.getPendingClockIns=f,S.getJobCodes=r,S.clockInOutUser=a,S.getClockInByDate=i,S.getTimeCardByDate=o,S.getWorkOrdersList=u,S.addNewDetails=c,S.clearCheckedOutTime=s,S.sendForApproval=l,S.deleteTimeCardDetails=d,S.clearTimeCard=m,S}e.$inject=["api-base-factory","$q","$cacheFactory"],angular.module("fpm").factory("timecard-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{onCancelClicked:"&"},controller:["$scope","$ionicActionSheet","timecard-factory","fpm-utilities-factory",function(e,t,n,o){function i(){angular.isFunction(c.onCancelClicked)&&c.onCancelClicked()}function a(){c.payableReport=[];var e=[];o.showLoading().then(function(){n.getSummaryPayableHours({startDate:c.modal.startDate,finishDate:c.modal.endDate}).then(function(t){t&&t.length>0&&angular.forEach(t,function(n,o){var i=_.findWhere(e,{timeCardDate:n.timeCardDate}),a=parseFloat(parseInt(n.totalMinutes,10)/60).toFixed(2);angular.isDefined(i)?(n.IsPayable?i.payableHours=parseFloat(a):i.nonPayable=parseFloat(a),i.total=parseFloat(i.payableHours)+parseFloat(i.nonPayable)):e.push({timeCardDate:n.timeCardDate,payableHours:!0===n.isPayable?parseFloat(a):0,nonPayable:!1===n.isPayable?parseFloat(a):0,total:parseFloat(a).toFixed(2)}),o===t.length-1&&(c.payableReport=e,_.forEach(e,function(e){c.totalPayables.p+=parseFloat(e.payableHours),c.totalPayables.np+=parseFloat(e.nonPayable),c.totalPayables.t+=parseFloat(e.total)}))})}).finally(o.hideLoading)})}function r(){t.show({buttons:[{text:"Show Current"},{text:"As Selected Dates"}],titleText:"Time card Report",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&u(),1===e&&(c.showCurrentSummary=!1),!0}})}function u(){c.lists={clockInOuts:[],payables:[],nonPayables:[]},o.showLoading().then(function(){if(angular.isArray(n.details)&&n.details.length>0){c.lists.clockInOuts=_.where(n.details,{jobCode:s.CLOCK_IN});var e=_.reject(n.details,{jobCode:s.CLOCK_IN});c.lists.payables=_.where(e,{isPayable:!0}),c.lists.nonPayables=_.where(e,{isPayable:!1})}o.hideLoading()}),c.showCurrentSummary=!0}var c=this,s=n.data.jobCodes;c.lists={clockInOuts:[],payables:[],nonPayables:[]},c.modal={startDate:new Date,endDate:null},c.payableReport=[],c.totalPayables={p:0,np:0,t:0},c.events={closeProductEditModal:i,showReport:a,onCardActionClicked:r},c.$onInit=function(){u()},e.$on("timecard:timeCardSummaryModal:open",function(){u()})}],controllerAs:"vm",templateUrl:"js/timecard/timecard-summary-component.template.html"};angular.module("fpm").component("timecardSummaryComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{onCancelClicked:"&"},controller:["$scope","timecard-factory",function(e,t){function n(){angular.isFunction(i.onCancelClicked)&&i.onCancelClicked()}function o(){t.certifyUser().then(function(e){e&&(i.isCertifield=!0,i.info=e)})}var i=this;i.isCertifield=!1,i.info=null,i.events={closeProductEditModal:n,onCertifyClicked:o},i.$onInit=function(){t.getCertifieldUser().then(function(e){e&&(i.isCertifield=e.isCertified||!1,i.info=e)})}}],controllerAs:"vm",templateUrl:"js/timecard/timecard-tutorial-component.template.html"};angular.module("fpm").component("timecardTutorialViewComponent",e)}()}(),function(){"use strict";!function(){angular.module("fpm").filter("totalTimeDiff",function(){return function(e){var t="0";if(e.length>0){var n=0;angular.forEach(e,function(o,i){if(o.finishTime&&(n+=moment(kendo.parseDate(o.finishTime)).diff(kendo.parseDate(o.startTime),"minutes")),i===e.length-1&&n>0){var a=Math.floor(n/60);return t=a+" hrs "+n%60+" min"}})}return t}})}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",onCancelClicked:"&",onAddCompleted:"&",serviceProviders:"<"},controller:["$scope","fpm-utilities-factory","work-orders-factory","authenticationFactory",function(e,t,n,o){var i=this;i.errors=[];var a={serviceProvider:"",startDate:new Date,endTime:new Date,fromMobile:!0,barCode:i.barcode,intuitQboItemId:""};i.newSchedule=angular.copy(a),i.events={closeProductEditModal:function(){angular.isFunction(i.onCancelClicked)&&i.onCancelClicked()},addScheduleClicked:function(){i.errors=[],i.showError=!1;var e=angular.copy(i.newSchedule);e.startDate=t.toStringDate(i.newSchedule.startDate),e.endTime=t.toStringDate(i.newSchedule.endTime),t.showLoading().then(function(){n.addWorkOrderSchedule(e).then(function(e){angular.isDefined(e.model)&&angular.isArray(e.model.errors)&&e.model.errors.length>0?(i.errors=e.model.errors,i.showError=!0):i.onAddCompleted({o:{invoice:e.invoice,schedules:e.schedule}})}).finally(t.hideLoading)})},onServiceProviderSelectionChanged:function(){}},i.$onInit=function(){i.user=o.getLoggedInUserInfo()}}],controllerAs:"vm",templateUrl:"js/work-orders/add-schedule-modal-component.template.html"};angular.module("fpm").component("addScheduleModalComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,i,a,r,u){function c(){i.getBarCodeNumber().then(function(e){f.woEntity.barCode=e.barcode,f.woEntity.barCodeName=e.barcodeName}).finally(r.hideLoading)}function s(){r.showLoading().then(function(){i.createEntity().then(function(e){if(f.woEntity=angular.copy(e),f.woEntity.fromMobile=!0,!0===f.isServiceProvider)var t=n(function(){f.woEntity.serviceProvider=f.userInfo.userEmail,n.cancel(t)},100);d()}).finally(c)})}function l(e){if(f.errors=[],!1===f.isCustomerSelected)return f.errors.push("Please select a customer first"),!1;r.showLoading("creating work order...").then(function(){f.woEntity.scheduleStart=r.toStringDate(f.dates.startDate),f.woEntity.scheduleEnd=r.toStringDate(f.dates.endDate),i.createWorkOrder(f.woEntity).then(function(e){e&&(e.errors.length>0?f.errors=e.errors:p.alert("Success","Work Order created successfully",function(){t.go("app.dashboard",{refresh:!0})}))},function(){f.errors=["Error while creating work order"]}).finally(r.hideLoading)})}function d(){f.dates={startDate:new Date,endDate:new Date(moment().add(1,"hours"))}}function m(){t.go("app.dashboard",{refresh:!1})}var f=this,p=r.alerts;f.userInfo=u.getLoggedInUserInfo(),f.errors=[],d(),f.isCustomerSelected=!1,f.events={sameAsBilling:function(){f.woEntity.sStreet=f.woEntity.bStreet,f.woEntity.sState=f.woEntity.bState,f.woEntity.sCity=f.woEntity.bCity,f.woEntity.sZip=f.woEntity.bZip},clearServiceAddress:function(){f.woEntity.sStreet="",f.woEntity.sState="",f.woEntity.sCity="",f.woEntity.sZip=""},onCustomerSelected:function(e){f.isCustomerSelected=!0,f.woEntity.firstName=e.firstName,f.woEntity.lastName=e.lastName,f.woEntity.companyName=e.company,f.woEntity.displayName=e.name,f.woEntity.bCity=e.addressCity,f.woEntity.bState=e.addressCountrySubDivCode,f.woEntity.bStreet=null==e.street?null:e.street.replace("::","\n"),f.woEntity.bZip=e.addressPostalCode,f.woEntity.phone=e.phone,f.woEntity.fax=e.fax,f.woEntity.uin=e.uin,f.woEntity.email=e.email_Group,f.woEntity.mobile=e.mobile,f.woEntity.sStreet=null==e.shipStreet?"":e.shipStreet.replace("::","\n"),f.woEntity.sState=e.shipState,f.woEntity.sCity=e.shipCity,f.woEntity.sZip=e.shipZIP},onSubmitButtonClicked:l,onBackToDashboardClicked:m},function(){a.getIniitialData().then(function(e){e&&(f.jobTypes=e.jobTypes,f.serviceProviders=e.serviceProviders,f.isServiceProvider=!f.userInfo.isAdminstrator)}).finally(s)}()}e.$inject=["$scope","$state","$timeout","$ionicActionSheet","work-orders-factory","shared-data-factory","fpm-utilities-factory","authenticationFactory"],angular.module("fpm").controller("create-order-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,i,a,r,u,c,s,l,d,m,f,p,h){function g(e,t,i){var a=n.defer();if(Date.parse(e)&&Date.parse(t)){var r=new Date(t),u=new Date(e),c=new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),0,0),s=new Date(u.getFullYear(),u.getMonth(),u.getDate(),u.getHours(),u.getMinutes(),0,0),l=moment(c).diff(moment(s),"minutes"),d=l%60,m=Math.floor(l/60);j=o(function(){i?N.scheduleTimeSpan.inRouteTimeSpan=0===m?d+" Minutes":m+" Hours "+d+" Minutes":N.scheduleTimeSpan.timeSpan=0===m?d+" Minutes":m+" Hours "+d+" Minutes"},50),a.resolve(l)}else a.resolve(0);return a.promise}function y(e,t){return new Date(e.getTime()+6e4*t)}function v(e,t){var n=t.getVal(),i=Math.floor(n/1e3),a=Math.floor(i/60);B=o(function(){var e,t=angular.copy(N.schedule.inRouteStartTime);null==t?(e=new Date,N.schedule.inRouteStartTime=new Date):e=new Date(t);var n=y(e,a);N.schedule.inRouteEndTime=kendo.parseDate(n),M(!1,!1)},50)}function C(){g(N.schedule.inRouteStartTime,N.schedule.inRouteEndTime,!0),M(!1,!1)}function w(e,t,n){if(N.schedule){var o=N.user.havingGroupsAssigned;if(!1===N.isServiceProvider)return!0;var i=N.schedule.technicianNum===N.user.userEmail;if(!0===o&&n&&!0===n){var a=_.findWhere(N.serviceProviders,{UserId:N.schedule.TechnicianNum});if(angular.isDefined(a))return!0}return!0!==N.isServiceProvider||!1!==i||(L.alert("Oops!","you are not authorized to perform this action",function(){angular.isFunction(t)&&e&&t(e)}),!1)}return!1}function D(e){w(null,null,!1)&&(!0===e&&(N.schedule.actualStartDateTime=null),N.schedule.actualFinishDateTime=null,N.scheduleTimeSpan.timeSpan="",N.schedule.approve||b())}function b(){var e=angular.copy(N.schedule);e.actualStartDateTime=kendo.toString(N.schedule.actualStartDateTime,"g"),e.actualFinishDateTime=kendo.toString(N.schedule.actualFinishDateTime,"g"),d.updateSchduleTotalTime(e).then(function(e){e&&(N.barCodeData.schedules=e.schedules,N.barCodeData.invoice=e.invoice,T())})}function S(){var e={num:0,numFromSummary:0,timeCardDate:m.toStringDate(N.schedule.actualStartDateTime),startTime:m.toStringDate(N.schedule.actualStartDateTime),finishTime:m.toStringDate(N.schedule.actualFinishDateTime),jobCode:0,notes:"",barcode:N.barcode,isUserDefined:!0,scheduleId:N.schedule.num};N.schedule.actualStartDateTime?h.pushCheckInOutTimes(e).then(function(e){angular.isArray(e)&&e.length>0?L.alert("Warning",e[0]):L.alert("Success","Details successfully pushed to timecard")}):L.alert("Warning","Please select Check In date and time")}function T(){if(N.totals={subtotal:0,totalqty:0,totalcost:0,totaltax:0},N.barCodeData.invoice&&N.barCodeData.invoice.length>0){var e=N.barCodeData.taxRate||0;angular.forEach(N.barCodeData.invoice,function(t){if(t.price&&t.qty){var n=0;if(angular.isDefined(t.newPriceCalculated)||(t.newPriceCalculated=!1),angular.isNumber(parseFloat(t.price))&&angular.isNumber(parseInt(t.qty,10))){if(t.markup>0){var o=t.newPriceCalculated?t.price:parseFloat(t.price)+parseFloat((t.markup||0)/100*t.price);t.price=o,t.newPriceCalculated=!0,n=o*t.qty}else n=t.price*t.qty;t.totalPrice=n;var i=parseFloat(parseFloat(e)>0?parseFloat(e/100*n):0);N.totals.subtotal+=parseFloat(n),N.totals.totalqty+=parseInt(t.qty,10),!0===(t.taxable||!1)&&(N.totals.totaltax+=parseFloat(i))}}})}}function k(){w(null,null,!1)&&d.updateWorkOrderMobile({barcodeAssay:N.barCodeData.barcodeDetails,fromMobile:!0}).then(function(e){e&&angular.isArray(e)&&e.length>0&&(N.errors=e)})}function M(e,t,n){var o=angular.copy(N.schedule);N.schedule.actualStartDateTime&&(o.actualStartDateTime=kendo.toString(N.schedule.actualStartDateTime,"g")),N.schedule.actualFinishDateTime&&(o.actualFinishDateTime=kendo.toString(N.schedule.actualFinishDateTime,"g")),N.schedule.inRouteStartTime&&(o.inRouteStartTime=kendo.toString(N.schedule.inRouteStartTime,"g")),N.schedule.inRouteEndTime&&(o.inRouteEndTime=kendo.toString(N.schedule.inRouteEndTime,"g")),!0===t?m.showLoading().then(function(){d.updateSchedule(o).then(function(){e?L.alert("Success","Schedule information updated successfully",function(){angular.isFunction(n)&&n()}):angular.isFunction(n)&&n()}).then(m.hideLoading)}):d.updateSchedule(o).then(function(){e?L.alert("Success","Schedule information updated successfully",function(){angular.isFunction(n)&&n()}):angular.isFunction(n)&&n()})}function E(e){if(N.uiSettings.woData){var t=_.findWhere(N.uiSettings.woData.schedules,{num:e.num});if(angular.isDefined(t))for(var n in t)e.hasOwnProperty(n)&&(e[n]=t[n])}}function I(e){if(N.uiSettings.woData){var t=_.findWhere(N.uiSettings.woData.invoice,{num:e.num});if(angular.isDefined(t))for(var n in t)e.hasOwnProperty(n)&&(e[n]=t[n])}}function P(){m.showLoading().then(function(){N.schedule.actualStartDateTime=new Date,N.schedule.actualFinishDateTime=null,N.scheduleTimeSpan.onStartDateTimeChaged(),d.updateJobStatus({scheduleButton:x.CheckIn,scheduleNum:N.schedule.num,actualStartTime:m.toStringDate(N.schedule.actualStartDateTime),barcode:N.barcode,timerStartAt:m.toStringDate(new Date),clientTime:kendo.toString(new Date,"g")}).then(function(){N.schedule.checkInStatus=!0}).finally(m.hideLoading)})}function $(){N.productSearchModal?N.productSearchModal.show():m.getModal("productSearchModal.html",e).then(function(e){N.productSearchModal=e,N.productSearchModal.show()}),o(function(){e.$broadcast("$fpm:changeAddModalOpenPriority",!0)},1e3)}function A(){N.productModal?N.productModal.show():m.getModal("editProductModal.html",e).then(function(e){N.productModal=e,N.productModal.show()})}function O(){var e="http://maps.google.com/maps?saddr=Current+Location&daddr=",t=N.barCodeData.barcodeDetails;t.shipStreet&&(e+=t.shipStreet.replace("::"," ")),e+=" "+t.shipCity+", "+t.shipState+" "+t.shipZIP,i.open(e,"_blank","location=yes")}function F(){if(!0===N.user.timeCard){var e=new Date,t=m.toStringDate(new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0));h.getTimeCardByDate(t).then(function(e){e&&(H.currentDetails=e.timeCardDetails)})}}var N=this;N.barcode=a.barCode;m.device.platforms,m.device.getPlatformInfo();N.taxCheckboxVisibility=!0;var L=m.alerts,x={AcceptJob:0,InRoute:1,CheckIn:2,CheckOut:3},q={CLOCK_IN:5001,CLOCK_OUT:5002};N.invoiceOpen=!0,N.uiSettings={isTimeCardModuleEnabled:!1,milageTrackingEnabled:!1,orderBelongToCurrentUser:!1,timerEnabled:!1,woData:null,showEquipmentTabControl:!1,billingOption:0,isRouteTimeOptionChecked:!1,enableMarkup:!1,hideEmailButton:!1},N.errors=[],N.gettingBarcodeDetails=!0;var j=null,B=null,U=null;N.scheduleTimeSpan={timeSpan:"",inRouteTimeSpan:"",onInRouteTimespanChanged:v,onInRouteTImeChanged:C,onTimespanSeletionChanged:function(e,t){var n=t.getVal(),i=Math.floor(n/1e3),a=Math.floor(i/60);U=o(function(){var e,t=angular.copy(N.schedule.actualStartDateTime);null==t?(e=new Date,N.schedule.actualStartDateTime=new Date):e=new Date(t);var n=y(e,a);N.schedule.actualFinishDateTime=kendo.parseDate(n),N.schedule.approve||b()},50)},onStartDateTimeChaged:function(){0===N.uiSettings.billingOption&&N.schedule?N.schedule.actualStartDateTime&&N.schedule.actualFinishDateTime&&(new Date(N.schedule.actualStartDateTime)>new Date(N.schedule.actualFinishDateTime)?L.alert("Warning","Start time cannot be greater than finish time."):g(N.schedule.actualStartDateTime,N.schedule.actualFinishDateTime).then(function(e){N.schedule.approve||b()})):M(!1,!1)},onEndDateTimeChanged:function(){0===N.uiSettings.billingOption&&N.schedule?N.schedule&&N.schedule.actualStartDateTime&&N.schedule.actualFinishDateTime&&(new Date(N.schedule.actualStartDateTime)>new Date(N.schedule.actualFinishDateTime)?L.alert("Warning","Finish time cannot be less than start time"):g(N.schedule.actualStartDateTime,N.schedule.actualFinishDateTime).then(function(e){N.schedule.approve||b()})):M(!1,!1)},clearAllDateTimeSelection:function(){}},N.user=p.getLoggedInUserInfo();var R=[{text:'<span class="text-assertive">Clear All</span>'},{text:'<span class="text-assertive">Clear Checkout Time</span>'},{text:"Update Schedule"}],V=null;N.scheduleAddModal=null;N.map=null;var W=!1;N.popModal={type:"DESCRIPTION",modal:null,placeholder:"enter here...",content:""},N.tabs={events:{updateClicked:function(){"DESCRIPTION"===N.popModal.type&&(N.barCodeData.barcodeDetails.comment_1=angular.copy(N.popModal.content)),"RESOLUTION"===N.popModal.type&&(N.barCodeData.barcodeDetails.comment_2=angular.copy(N.popModal.content)),"COMMENTS"===N.popModal.type&&(N.barCodeData.barcodeDetails.comment_4=angular.copy(N.popModal.content)),k(),N.popModal.modal.hide()},closePopoutModal:function(){N.popModal.modal.hide()},popoutTextBox:function(t){"DESCRIPTION"===t&&(N.popModal.content=angular.copy(N.barCodeData.barcodeDetails.comment_1)),"RESOLUTION"===t&&(N.popModal.content=angular.copy(N.barCodeData.barcodeDetails.comment_2)),"COMMENTS"===t&&(N.popModal.content=angular.copy(N.barCodeData.barcodeDetails.comment_4)),N.popModal.type=t,N.popModal.modal?N.popModal.modal.show():m.getModal("fulltextModal.html",e).then(function(e){N.popModal.modal=e,N.popModal.modal.show()})}},desc:{events:{reloadWorkResolution:function(){w()&&m.showLoading().then(function(){var e=N.barCodeData.barcodeDetails.id;d.getWorkOrderResolution(e).then(function(e){e&&(N.barCodeData.barcodeDetails.comment_2=e.comment_2,N.barCodeData.barcodeDetails.comment_4=e.comment_4)}).finally(m.hideLoading)})},refreshOnPullDown:function(){F(),e.$broadcast("scroll.refreshComplete")},closeWorkOrderMapModal:function(){W=!1,V&&V.hide()},onAddressTapped:function(){O()},onDescriptionOrResolutionChanged:function(){k()}}},sch:{events:{workCompleteChanged:function(){w(N.schedule,E,!1)&&M(!0,!0,function(){o(function(){t.go("app.dashboard",{refresh:!0})},200)})},onCustomScheduleChanged:function(e){N.schedule.approve||d.updateCustomScheduleData(e)},pushToTimecard:function(){S()},onAddScheduleCompleted:function(e){e&&(N.scheduleAddModal.hide(),L.alert("Success","Schedule added successfully",function(){o(function(){N.barCodeData.schedules=e.schedules,N.barCodeData.invoice=e.invoice,T()},50)}))},onModalCancelClicked:function(){N.scheduleAddModal.hide()},updateMilage:function(){o(function(){N.schedule.startMiles&&N.schedule.endMiles&&(N.schedule.totalMiles=parseFloat(parseFloat(N.schedule.endMiles)-parseFloat(N.schedule.startMiles)).toFixed(2),M(!1,!1))},100)},onTripnoteChanged:function(){M(!1,!1)},updateSchedule:function(){M(!0,!0)},onListScheduleItemTap:function(e){
e.num!==N.schedule.num&&L.confirm("Confirmation","Are you sure to load this schedule",function(){t.go("app.editOrder",{barCode:N.barcode,technicianNum:e.num,src:"main"})})},onSchedulesListButtonClicked:function(){null===N.scheduleAddModal?m.getModal("addScheduleModal.html",e).then(function(e){N.scheduleAddModal=e,N.scheduleAddModal.show()}):N.scheduleAddModal.show()},checkIn:function(){if(!0!==N.schedule.approve&&!0!==N.schedule.checkInStatus){if(w(null,null,!0))if(!0===N.user.timeCard){var e=_.where(H.currentDetails,{jobCode:q.CLOCK_IN,finishTime:null}),t=_.reject(H.currentDetails,{jobCode:q.CLOCK_IN});if(0===e.length)L.confirm("Confirmation!","You have not clocked in yet. You will be clocked in automattically \n\n Are you sure?",function(){P()},function(){});else if(t.length>0){var n=_.where(t,{finishTime:null,jobCodeName:"On Job"});n.length>0?L.alert("Warning!","You have not checked out for previous task.",function(){}):P()}else P()}else P();return!1}L.alert("Alert","Not allowed to checkin")},checkOut:function(){if(!0===N.schedule.approve||!0===N.schedule.checkOutStatus)L.alert("Alert","Not allowed to checkout");else if(w(null,null,!1)){if(null===N.schedule.actualStartDateTime)return L.alert("Warning","Please check in first"),!1;N.schedule.actualFinishDateTime=new Date,N.scheduleTimeSpan.onEndDateTimeChanged(),d.updateJobStatus({scheduleButton:x.CheckOut,scheduleNum:N.schedule.num,actualEndTime:m.toStringDate(N.schedule.actualFinishDateTime),Barcode:N.barcode,clientTime:kendo.toString(new Date,"g")}).then(function(){N.schedule.checkOutStatus=!0})}},clearAllDateTimeSelection:function(e){D(e)},onScheduleActionButtonClicked:function(){var e=angular.copy(R);r.show({buttons:e,titleText:"Current Schedule",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&D(!0),1===e&&D(!1),2===e&&M(!0,!0),3===e&&S(),!0}})}}},smry:{events:{onTaxCheckboaxChanged:function(e){w(e,I)&&(T(),d.updateOrderProduct(e))}}},prod:{events:{onProdcutActionButtonClicked:function(){$()},closeProductEditModal:function(){N.productModal.hide()},openProductSearchModal:function(){},onEditProductClicked:function(e){N.currentProduct=angular.copy(e),A()},onDeleteProductClicked:function(e){L.confirmDelete(function(){d.deleteProduct(N.barcode,e.num).then(function(e){e&&(N.barCodeData.products=e.products,N.barCodeData.invoice=e.invoice,T())})})}}}};var H={currentDetails:[]};e.$on("$fpm:closeEditProductModal",function(){N.productModal&&N.productModal.hide()}),e.$on("$fpm:closeProductSearchModal",function(e,t){N.productSearchModal&&(t&&!0===t.fromProductAdd&&d.getBarcodeInvoiceAndProductDetails(N.barcode).then(function(e){N.barCodeData.products=e.products,N.barCodeData.invoice=e.invoice,T()}),N.productSearchModal.hide())});var G=null;e.$on("$fpm:operation:updateProduct",function(e,t){G=o(function(){m.showLoading().then(function(){d.getBarcodeInvoiceAndProductDetails(N.barcode).then(function(e){N.barCodeData.products=e.products,N.barCodeData.invoice=e.invoice,T()}).finally(function(){N.productModal.hide(),m.hideLoading()})})},300)}),e.$on("$destroy",function(){G&&o.cancel(G),j&&o.cancel(j),U&&o.cancel(U),B&&o.cancel(B),W=!1}),function(){N.gettingBarcodeDetails=!0,c.show({template:"loading work order..."}).then(function(){d.getBarcodeDetails(N.barcode).then(function(e){N.gettingBarcodeDetails=!1,N.barCodeData=e,N.uiSettings.woData=angular.copy(e),N.taxCheckboxVisibility=(N.barCodeData.taxRate||0)>0,angular.isArray(e.schedules)&&e.schedules.length>0?(N.schedule=angular.copy(_.findWhere(e.schedules,{num:parseInt(a.technicianNum,10)})),angular.isDefined(N.schedule)?(N.schedule.actualStartDateTime&&(N.schedule.actualStartDateTime=kendo.parseDate(N.schedule.actualStartDateTime),N.schedule.actualStartDateTimeString=kendo.toString(kendo.parseDate(N.schedule.actualStartDateTime),"g")),N.schedule.actualFinishDateTime&&(N.schedule.actualFinishDateTime=kendo.parseDate(N.schedule.actualFinishDateTime),N.schedule.actualFinishDateTimeString=kendo.toString(kendo.parseDate(N.schedule.actualFinishDateTime),"g")),g(N.schedule.actualStartDateTime,N.schedule.actualFinishDateTime),0===N.uiSettings.billingOption&&(N.schedule.inRouteStartTime=kendo.parseDate(N.schedule.inRouteStartTime),N.schedule.inRouteEndTime=kendo.parseDate(N.schedule.inRouteEndTime)),0===N.uiSettings.billingOption&&N.uiSettings.isRouteTimeOptionChecked&&g(N.schedule.inRouteStartTime,N.schedule.inRouteEndTime,!0),N.uiSettings.orderBelongToCurrentUser=N.schedule.technicianNum===N.userId,c.hide(),T()):(c.hide(),T())):(c.hide(),T())},function(e){L.alert("Oops","ERROR WHILE GETTING WORK ORDER INFORMATION..",c.hide)})})}(),function(){W=!1,N.uiSettings.isTimeCardModuleEnabled=N.user.timeCard&&N.user.allowPushTime,N.isServiceProvider=!N.user.isAdminstrator,N.showPrice=N.user.showPrice,f.getIniitialData(!0).then(function(e){if(e){if(N.uiSettings.milageTrackingEnabled=e.customerNumberEntity.milageTrackingEnabled||!1,N.uiSettings.timerEnabled=e.customerNumberEntity.workOrderTimerEnabled||!1,N.uiSettings.showEquipmentTabControl=e.customerNumberEntity.equipmentTrackingOn||!1,N.uiSettings.enableMarkup=e.customerNumberEntity.enableMarkupForWorkOrders||!1,N.enableMarkup=N.uiSettings.enableMarkup,e.customerNumberEntity.billingOption&&(N.uiSettings.billingOption=e.customerNumberEntity.billingOption),0===N.uiSettings.billingOption&&(N.uiSettings.isRouteTimeOptionChecked=e.customerNumberEntity.isRouteTimeOptionChecked),e.customerNumberEntity.configurationJson){var t=JSON.parse(e.customerNumberEntity.configurationJson);N.uiSettings.hideEmailButton=t.HideEmailButtonOnMobile||!1}N.scheduleStatus=e.secondaryOrderStatus,N.serviceProviders=e.serviceProviders,N.vehicles=e.vehicles}}).finally(F)}(),e.$on("$ionicView.beforeEnter",function(e,t){})}e.$inject=["$scope","$state","$q","$timeout","$window","$stateParams","$ionicActionSheet","$ionicNavBarDelegate","$ionicLoading","$ionicPopup","$ionicModal","work-orders-factory","fpm-utilities-factory","shared-data-factory","authenticationFactory","timecard-factory"],angular.module("fpm").controller("edit-order-controller",e)}()}(),function(){"use strict";!function(){var e={templateUrl:"js/work-orders/order-documents-list-component.template.html",bindings:{barcode:"<"},controller:["$scope","work-orders-factory","fpm-utilities-factory","fieldPromaxConfig",function(e,t,n,o){var i=this,a=o.fieldPromaxApi;n.alerts;i.docUrl="",i.gettinDocuments=!1,i.events={onDocumentClicked:function(e){window.open(a+"Handlers/GetImageFromBlob.ashx?imageId="+e.num+"&dateStamp="+new Date+"&flag=viewTarget&cust="+e.customerNumber,"_system","location=yes")}},i.$onInit=function(){i.barcode?(i.barcodeDocuments=[],i.gettinDocuments=!0,t.getUploadedDocuments(i.barcode).then(function(e){if(angular.isArray(e)&&e.length>0){var t=_.where(e,{extension:".pdf"});i.barcodeDocuments=t}i.gettinDocuments=!1})):i.gettinDocuments=!1}}],controllerAs:"vm"};angular.module("fpm").component("orderDocumentsListComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<"},templateUrl:"js/work-orders/order-images-list-component.template.html",controller:["$scope","$q","$timeout","$ionicModal","$ionicLoading","work-orders-factory","fpm-utilities-factory","fieldPromaxConfig",function(e,t,n,o,i,a,r,u){function c(e){if(h&&e+1<=h.length){f=e;var t=h[e];if(0===_.filter(p,function(e){return e===t.extension.toLowerCase()}).length)return m.alert("Invalid File","This is not a valid image file",function(){c(e+1)}),!1;if(y){var n=new FileReader;n.onload=function(n){var o=new Image;o.onload=function(){var n=s(o);l.upload.uploadImage(n,t.name,!1,e===h.length-1).then(function(){if(e===h.length-1)h=null;else{c(e+1)}})},o.src=n.target.result},n.readAsDataURL(t.rawFile)}else{var n=new FileReader;n.onload=function(n){l.upload.uploadImage(n.target.result,t.name,!1,e===h.length-1).then(function(){if(e===h.length-1)h=null;else{c(e+1)}})},n.readAsDataURL(t.rawFile)}}}function s(e){var t=500/e.width,n=$("<canvas>")[0];return n.width=e.width*t,n.height=e.height*t,n.getContext("2d").drawImage(e,0,0,n.width,n.height),n.toDataURL()}var l=this;l.isExpanded=!1;var d=u.fieldPromaxApi,m=r.alerts,f=0,p=[".tif",".tiff",".gif",".jpeg",".jpg",".jif",".jfif",".jp2",".jpx",".j2k",".j2c",".pcd",".png",".bmp"],h=null;l.upload={control:null,uploadImage:function(e,n,o,i){var u=t.defer();return r.showLoading("Uploading "+(f+1)+" of "+(o?1:h.length)).then(function(){a.uploadFile({Barcode:l.barcode,Image:e,Name:n}).then(function(e){l.barcodeImages.push({barcode:l.barcode,fileName:n,imageURL:"/"+n+(o?".jpg":""),num:e}),u.resolve(),i&&m.alert("Uploaded","File(s) Uploaded successfully")},function(e){m.alert("ERROR WHILE UPLOADING","Please try again"),u.reject()}).finally(r.hideLoading)}),u.promise},options:{multiple:!0,showFileList:!1,localization:{select:"Upload images"},select:function(e){if(e.isDefaultPrevented=!0,_.filter(e.files,function(e){return e.size>1024*g*1024}).length>0)return m.alert("Invalid Selection","Image size is too large to upload"),e.preventDefault(),!1;h=e.files,c(0),e.preventDefault()}}},l.currentImage=null,l.events={takePictureClicked:function(){r.device.getPicture().then(function(e){n(function(){if(e){var t="Picture"+l.barcode+kendo.toString(new Date,"ddffMMss");l.upload.uploadImage("data:image/jpeg;base64,"+e,t,!0,!0)}},500)})},onDeleteImageClicked:function(e,t){m.confirmDelete(function(){r.showLoading().then(function(){a.deleteImageFromBlob(e.num,l.barcode).then(function(){m.alert("Success","Image has been removed",function(){l.barcodeImages.splice(t,1)})}).finally(r.hideLoading)})})},onImageTap:function(e){l.currentImage=e,l.imageUrl=d+"Handlers/GetImageFromBlob.ashx?imageId="+e.num+"&dateStamp="+new Date,l.imageViewerModel.show()},closeImageViewModal:function(){l.imageViewerModel.hide()}};var g=8,y=!1;l.$onInit=function(){y=r.device.isAndroid(),y&&(g=3.5),l.barcode&&a.getImagesList(l.barcode).then(function(e){l.barcodeImages=e})},o.fromTemplateUrl("imageViewerModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){l.imageViewerModel=e})}],controllerAs:"vm"};angular.module("fpm").component("orderImagesListComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<"},templateUrl:"js/work-orders/order-signature-card-component.template.html",controller:["$scope","$ionicActionSheet","authenticationFactory","fieldPromaxConfig",function(e,t,n,o){var i=this;i.showingSignaturePad=!1;var a=o.fieldPromaxApi,r=n.getLoggedInUserInfo();i.signPadEvents=null,i.events={closeSignaturePad:function(){i.showingSignaturePad=!1},saveSignature:function(){i.signPadEvents&&i.signPadEvents.trySaveSignature().then(function(e){!0===e&&(i.showingSignaturePad=!1,i.imageUrl=a+"Handlers/GetBarcodeSignature.ashx?barcode="+i.barcode+"&dateStamp="+new Date+"&customernumber="+r.customerNumber)})},onSignatureActionButtonClicked:function(){i.showingSignaturePad=!0,i.imageUrl=a+"Handlers/GetBarcodeSignature.ashx?barcode="+i.barcode+"&dateStamp="+new Date+"&customernumber="+r.customerNumber}},e.$on("$signature:completedEvent",function(){i.showingSignaturePad=!1}),i.imageUrl=a+"Handlers/GetBarcodeSignature.ashx?barcode",i.$onInit=function(){i.imageUrl=a+"Handlers/GetBarcodeSignature.ashx?barcode="+i.barcode+"&dateStamp="+new Date+"&customernumber="+r.customerNumber},i.$onChanges=function(){}}],controllerAs:"vm"};angular.module("fpm").component("orderSignatureComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{padEventsRef:"="},templateUrl:"js/work-orders/order-signature-pad-template.html",controller:["$scope","$stateParams","$q","work-orders-factory","fpm-utilities-factory",function(e,t,n,o,i){var a=this;a.customerName="";var r=t.barCode;a.errors=["Please add customer name before save"],a.showError=!1,a.events={onCustomerNameKeyup:function(e){13===e&&(a.showError=!1,a.events.trySaveSignature())},trySaveSignature:function(){var t=n.defer();a.showError=!1;if(""===$.trim(a.customerName))a.showError=!0,t.resolve(!1);else{var u=$(angular.element("#signature")).jSignature("getData","image");""!==$.trim(a.customerName)&&angular.isArray(u)&&i.showLoading().then(function(){o.saveJsonSignForBarcode({BaseString:u[1],Barcode:r,CustomerName:a.customerName,EstimateId:0}).then(function(){e.$emit("$signature:completedEvent"),t.resolve(!0)}).finally(i.hideLoading)})}return t.promise}},a.$onInit=function(){var e=angular.element("#signature");$(e).jSignature({lineWidth:1,width:$(document).width()-80,height:200,"decor-color":"transparent"}).bind("change",function(t){var n=$(e).jSignature("getData","image");angular.isArray(n)}),a.padEventsRef=a.events}}],controllerAs:"vm"};angular.module("fpm").component("orderSignaturePad",e)}()}(),function(){"use strict";!function(){var e={bindings:{showPrice:"<",hideEmailButton:"<",barcode:"<",taxrate:"<",defaultEmails:"<"},templateUrl:"js/work-orders/work-order-email-card-template.html",controller:["$scope","$ionicActionSheet","$q","work-orders-factory","fpm-utilities-factory",function(e,t,n,o,i){function a(e){return/(^[a-z-0-9]([a-z-0-9_\.]*)@([a-z_\.]*)([.][a-z]{3})$)|(^[a-z]([a-z_\.]*)@([a-z-0-9]*)(\.[a-z]{3})(\.[a-z]{2})*$)/i.test(e)}function r(){var e=n.defer(),t=!1,o=c.mailConfig.mailAddresses;if(o.length>0)for(var i=0;i<=o.length-1;i++){t=!1;var r=$.trim(o[i]);a(r)||(t=!0),i===o.length-1&&e.resolve(t)}else e.resolve(!0);return e.promise}function u(e){c.emailErrors=[],c.sendingEmails=!1,c.mailConfig.mailAddresses&&c.mailConfig.mailAddresses.length>0&&r().then(function(t){t?c.emailErrors=["Please enter valid emails"]:(c.sendingEmails=!0,o.sendInvoiceMail({BarCode:c.barcode,SendAsInvoice:e,emailAddresses:c.mailConfig.mailAddresses,TaxRate:c.taxrate}).then(function(){i.alerts.alert("Email Sent","Email has been sent successfully",function(){c.sendingEmails=!1})}))})}var c=this;c.emailErrors=[],c.sendingEmails=!1,c.mailConfig={mailAddresses:[]},c.events={sendEmail:u},c.$onInit=function(){if(null!=c.defaultEmails&&c.defaultEmails.includes(",")){var e=[],t=c.defaultEmails.split(",");angular.forEach(t,function(t){e.push(t)}),c.mailConfig.mailAddresses=e}null==c.defaultEmails||c.defaultEmails.includes(",")||(c.mailConfig.mailAddresses=[c.defaultEmails])}}],controllerAs:"vm"};angular.module("fpm").component("orderEmailCardComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{isCheckedIn:"<",isCheckedOut:"<",isApproved:"<",schedule:"<"},controller:["$interval","$state","$element","$timeout","shared-data-factory",function(e,t,n,o,i){function a(){var e=Math.floor(s.currentTime.totalMinutes/60),t=Math.floor(s.currentTime.totalMinutes%60);s.currentTime.mins=t<=9?"0"+t:t,s.currentTime.hrs=e<=9?"0"+e:e,s.currentTime.isOnInterval=0===e&&t>=55||e>0&&(t>55||t<=5)}function r(){!1===s.currentTime.showControl&&(s.currentTime.showControl=!0),s.currentTime.isRunning=!0,l=e(function(){s.currentTime.totalMinutes+=1,a()},6e4)}function u(){null!==l&&(s.currentTime.isRunning=!1,e.cancel(l));var t=o(function(){s.currentTime.showControl=!1,o.cancel(t)},100)}function c(){a()}var s=this;s.currentTime={hrs:"00",mins:"00",totalMinutes:0,showControl:!1,isRunning:!1,isOnInterval:!1,intervalMinutes:0,intervalCounter:0};var l=null;this.$onDestroy=function(){u()};var d=!1;this.$onChanges=function(){!0===d&&(!0===s.isCheckedIn&&!1===s.currentTime.isRunning&&r(),!0===s.isCheckedOut&&u())},s.events={refreshTimer:c},this.$onInit=function(){s.currentTime.showControl=!1,i.getIniitialData().then(function(e){!0===(d=e.customerNumberEntity.workOrderTimerEnabled||!1)&&o(function(){if(s.schedule&&(s.currentTime.showControl=!0===s.schedule.checkInStatus&&!1===s.schedule.checkOutStatus,!0===s.schedule.checkInStatus&&s.schedule.timerStartAt&&!1===(s.schedule.checkOutStatus||!1))){var e=moment(new Date).diff(moment(s.schedule.timerStartAt),"minutes");e>0&&(s.currentTime.totalMinutes=e,a())}},1e3)})}}],templateUrl:"js/work-orders/work-order-timer-component.template.html",controllerAs:"model"};angular.module("fpm").component("workOrderTimerComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function i(){O.remove(F),O.removeAll()}function a(t,o){angular.isDefined(t)&&t&&O.remove(F);var i=O.get(F);return angular.isDefined(i)&&i?e.when(i):n.get(A+"GetMobileDashboard").then(function(e){return O.put(F,e),e})}function r(e){return n.get(A+"GetBarcodeDetails?barcode="+e)}function u(e,t){return n.get(A+"DeleteProduct?barcode="+e+"&productNum="+t)}function c(e){return n.post(A+"UpdateProduct?fromMobile=true",e)}function s(e,t){return n.get(A+"GetProductsLists?searchPattern="+e+"&alphabet="+t)}function l(e){return n.post(A+"AddProductsToOrder?fromMobile=true",e)}function d(e){return n.get(A+"GetBarcodeInvoiceAndProductDetails?barcode="+e)}function m(e){return n.post(A+"SaveJsonSignForBarcode",e)}function f(e){return n.post(A+"SendInvoiceMail",e)}function p(e){return n.get(A+"GetImagesList?barcode="+e)}function h(e){return n.get(A+"GetUploadedDocuments?barcode="+e)}function g(e){return n.post(A+"UploadFile",e)}function y(){var t=O.get("workOrderEntity");return angular.isDefined(t)&&t?e.when(t):n.get(A+"CreateEntity").then(function(e){return O.put("workOrderEntity",e),e})}function v(e){return n.post(A+"CreateWorkOrder",e)}function C(){return n.get(A+"GetBarCodeNumber")}function w(e){return n.post(A+"UpdateWorkOrderMobile",e)}function D(e){return e.clientTime=kendo.toString(new Date,"g"),n.post(A+"UpdateJobStatus",e)}function b(e){return console.log("model",e),e.customSchedules&&(e.customSchedules=JSON.stringify(e.customSchedules)),n.post(A+"UpdateSchedule?fromMobile=true",e)}function S(e){return n.post(A+"AddWorkOrderSchedule",e)}function T(e){return n.post(A+"UpdateOrderProduct",e)}function k(t){!0===(t=null!==t&&t)&&O.remove(N);var o=O.get(N);return angular.isDefined(o)&&o?e.when(o):n.get("api/Scheduler/GetMyCalender?fromMobile=true").then(function(e){return O.put(N,e),e})}function M(e){return n.post(A+"UpdateCustomScheduleData",e)}function E(e){return n.get(A+"GetWorkOrderResolution?id="+e)}function I(e){return n.post(A+"UpdateSchduleTotalTime",e)}function P(e,t){return n.deleteReq(A+"DeleteImage?imageId="+e+"&barcode="+t)}function $(e){return n.post(A+"UploadFilesN",e)}var A="api/workorders/",O=t("orderCache"),F="dashboardData",N="workorder:calendar";return{uploadFilesN:$,deleteImageFromBlob:P,updateSchduleTotalTime:I,getWorkOrderResolution:E,updateCustomScheduleData:M,getMobileDashboard:a,getBarcodeDetails:r,deleteProduct:u,updateProduct:c,searchProduct:s,addProduct:l,getBarcodeInvoiceAndProductDetails:d,saveJsonSignForBarcode:m,sendInvoiceMail:f,getImagesList:p,getUploadedDocuments:h,uploadFile:g,createEntity:y,createWorkOrder:v,getBarCodeNumber:C,updateWorkOrderMobile:w,updateJobStatus:D,updateSchedule:b,addWorkOrderSchedule:S,updateOrderProduct:T,getDatewiseEvents:k,clearAllCache:i}}e.$inject=["$q","$cacheFactory","api-base-factory","shared-data-factory"],angular.module("fpm").factory("work-orders-factory",e)}()}();