!function(){"use strict";!function(){function e(e){}e.$inject=["$scope"],angular.module("fpm").controller("calendar-controller",e)}()}(),function(){"use strict";!function(){function e(e){}e.$inject=["$scope"],angular.module("fpm").controller("create-customer-controller",e)}()}(),function(){"use strict";!function(){function e(e,t){function n(t){return e.get(o+"SearchCustomers?searchPattern="+t)}var o="api/CustomerFile/";return{searchCustomers:n}}e.$inject=["api-base-factory","fieldPromaxConfig"],angular.module("fpm").factory("customers-file-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{onCustomerSelected:"&"},controller:["$scope","$ionicModal","customers-file-factory",function(e,t,n){function o(){c.searchValue="",c.customers=[],c.customerModal.show()}function a(){n.searchCustomers(c.searchValue).then(function(e){c.customers=e})}function r(){c.searchValue="",c.customers=[],c.customerModal.hide()}function i(e){c.customerModal.hide(),angular.isFunction(c.onCustomerSelected)&&c.onCustomerSelected({customer:e}),console.log(e)}var c=this;c.searchValue="",c.events={onSearchBoxTapped:o,applySearch:a,closeSearchModal:r,onCustomerSelected:i},t.fromTemplateUrl("customerSearchModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){c.customerModal=e})}],controllerAs:"vm",templateUrl:"js/customer/customer-search-header-component-template.html",replace:!0};angular.module("fpm").component("customerSearchHeaderComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,r){function i(){l=[];var e=!0;e===!0&&angular.forEach(s.result,function(e,t){e.dataForAdministrator&&e.dataForAdministrator.length>0&&_.forEach(e.dataForAdministrator,function(e){e.ordersJson&&_.forEach(JSON.parse(e.ordersJson),function(e){l.push(e)})})})}function c(e,t){a.getMobileDashboard(e).then(function(e){s.result=e.result,i()}).finally(function(){angular.isFunction(t)&&t()})}function u(){c(!1)}var s=this,l=[];s.isSearchModalOpened=!1,s.events={onSearchItemClick:function(e){e&&(s.matchedOrders=[],s.isSearchModalOpened=!1,s.searchModal.hide(),s.searchValue="",n(function(){t.go("app.editOrder",{barCode:e.Barcode,technicianNum:e.TechnicianScheduleNum,src:"main"})},300))},applySearch:function(){var e=s.searchValue.toLowerCase();s.matchedOrders=_.filter(l,function(t){return t.BarcodeName.toLowerCase().indexOf(e)>-1})},closeSearchModal:function(){s.matchedOrders=[],s.isSearchModalOpened=!1,s.searchModal.hide(),s.searchValue=""},openSearchModal:function(){s.searchValue="",s.matchedOrders=[],s.isSearchModalOpened=!0,s.searchModal.show()},onOrderClicked:function(e){e&&t.go("app.editOrder",{barCode:e.Barcode,technicianNum:e.TechnicianScheduleNum,src:"main"})},refreshOnPullDown:function(){c(!0,function(){e.$broadcast("scroll.refreshComplete")})},onChildGroupClicked:function(e,t,n){e.isOpen=!e.isOpen;var o=r.get("orderState");return null===o&&(o={}),"DD"===t?(e.isOpen===!0?(o[n]=e,r.set("orderState",o)):r.set("orderState",null),!1):void(e.isOpen===!0&&0===e.clickCount?(o[n]=e,r.set("orderState",o),"SP"===t?e.dataForServiceProvider=JSON.parse(e.ordersJson):e.ordersN=JSON.parse(e.ordersJson),e.clickCount+=1):(o[n]=null,r.set("orderState",o)))}},e.$on("$ionicView.loaded",function(e,t){u()}),e.$on("modal.hidden",function(){console.log("Execute action")}),e.$on("modal.removed",function(){console.log("modal.removed")}),e.$on("$destroy",function(){s.searchModal.remove()}),o.fromTemplateUrl("dashboardSearchModal.html",{scope:e,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){s.searchModal=e})}e.$inject=["$scope","$state","$timeout","$ionicModal","work-orders-factory","localStorageService"],angular.module("fpm").controller("dashboard-controller",e)}()}(),function(){"use strict";!function(){function e(e){function t(){return e.get(n+"GetValues")}var n="api/workorders/",o={testCall:t};return o}e.$inject=["api-base-factory"],angular.module("fpm").factory("dashboard-factory",e)}()}(),function(){"use strict";!function(){function e(e){}e.$inject=["$scope"],angular.module("fpm").controller("create-estimate-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a){function r(){a.getExpense("",!0).then(function(e){s.paid=_.filter(e,function(e){return 1==e.expenseStatus}),s.unpaid=_.filter(e,function(e){return 0==e.expenseStatus})})}function i(){r()}function c(e){var t=o.confirm({title:"Delete Expense",template:"Are you sure?"});t.then(function(e){e&&console.log("HELLO WORLD")})}function u(e){console.log(s.modal),s.editedExpense=e,s.modal.show()}var s=this;s.paid=[],s.unpaid=[],s.events={onDeleteClicked:c,onEditClicked:u},e.$on("$ionicView.loaded",function(e,t){i()}),n.fromTemplateUrl("expenseModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){s.modal=e})}e.$inject=["$scope","$ionicLoading","$ionicModal","$ionicPopup","expense-data-factory"],angular.module("fpm").controller("expanses-controller",e)}()}(),function(){"use strict";!function(){function e(e){function t(t,n){return e.get(c+"GetExpense?barcode="+t+"&isFromMain="+n)}function n(t){return e.post(c+"AddExpense",t)}function o(t){return e.deleteApiCall(c+"DeleteExpense?id="+t)}function a(t){return e.get(c+"MarkAsPaidUnPaid?id="+t)}function r(t){return e.deleteApiCall(c+"DeleteImage?expenseId="+t)}var i={},c="api/expense/";return i.schema={expenseId:0,Title:"",Description:"",ExpenseType:0,ExpenseStatus:0,TotalCost:0,Barcode:"",ExpenseDate:new Date,Quantity:1,ImageChanged:!1,havingImage:!1},i.markAsPaidUnPaid=a,i.deleteExpense=o,i.addExpense=n,i.getExpense=t,i.deleteImage=r,i}e.$inject=["api-base-factory"],angular.module("fpm").factory("expense-data-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{expense:"="},template:"HHSKD",controller:["$scope",function(e){console.log("HELLO WORLD")}],controllerAs:"vm"};angular.module("fpm").component("expenseItemComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){var a=this;a.sideMenuItems=[{title:"Home",state:"app.dashboard",icon:"home"},{title:"Calendar",state:"app.calendar",icon:"calendar"},{title:"Map",state:"app.map",icon:"location"},{title:"Create Work Order",state:"app.createWorkOrder",icon:"plus-round"},{title:"Create Customer",state:"app.createCustomer",icon:"plus-round"},{title:"Create Estimate",state:"app.createEstimate",icon:"plus-round"},{title:"My Expense",state:"app.expense",icon:"cash"},{title:"Time Card",state:"app.timecard",icon:"clock"},{title:"Settings",state:"app.settings",icon:"settings"},{title:"Change Password",state:"app.changePassword",icon:""},{title:"Logout",state:"app.logout",icon:"power"}],e.$on("$ionicView.beforeEnter",function(e,t){n.showBackButton(!1)}),a.events={onMenuItemClicked:function(e){o.go(e.state)},toggleLeft:function(){}}}e.$inject=["$scope","$ionicSideMenuDelegate","$ionicNavBarDelegate","$state"],angular.module("fpm").controller("app-main-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,r){var i=this;i.user={userName:"",password:""},i.showError=!1,i.events={loginClick:function(e){return i.showError=!1,i.errors=[],e?void n.show({template:"authenticating you..."}).then(function(){o.login(i.user).then(function(e){n.hide().then(function(){e&&o.authentication.isAuth&&a.go("app.dashboard")})},function(e){n.hide(),i.showError=!0,e.error?i.errors=[e.error]:i.errors=["Invalid Email or Password"]})}):(t.alert({title:"Oops",template:"Please enter login information..."}),!1)}}}e.$inject=["$ionicScrollDelegate","$ionicPopup","$ionicLoading","authenticationFactory","$state","dashboard-factory"],angular.module("fpm").controller("login-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(){n.logout(),t.go("login")}o(),console.log("HELLO WORLD")}e.$inject=["$scope","$state","authenticationFactory"],angular.module("fpm").controller("logout-controller",e)}()}(),function(){"use strict";!function(){function e(e){var t=this;t.heading="HELLLO WORLD FROM IONIC"}e.$inject=["$scope"],angular.module("fpm").controller("main-controller",e)}()}(),function(){"use strict";!function(){function e(e,n,o,a,r,i){function c(){console.log("HELLO WORLD"),f.filtersModal&&f.filtersModal.show()}function u(){f.filtersModal&&f.filtersModal.hide()}function s(){}function l(){r.getMapData().then(function(e){e&&(f.mapData.users=e.users)})}function d(){p.center=new window.google.maps.LatLng(t.y,t.x),i.getIniitialData().then(function(e){if(f.iniitialData=e,e){var n=e.customerNumberEntity;p.center=new window.google.maps.LatLng(n.coordinateY||t.y,n.coordinateX||t.x),p.zoom=n.zoomDepth||8,f.map=new google.maps.Map(document.getElementById("map"),p)}else p.center=new window.google.maps.LatLng(t.y,t.x),f.map=new google.maps.Map(document.getElementById("map"),p)}).finally(l)}function m(){d()}var f=this;console.log(n);var p={center:null,panControl:!1,zoomControl:!0,scaleControl:!0,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP};a.fromTemplateUrl("mapFilters.html",{scope:e,animation:"slide-in-up"}).then(function(e){f.filtersModal=e}),f.filtersApplied=!1,f.events={onFiltersClicked:c,clearFilters:u,applyFilters:s},f.mapData={users:[]},m()}var t={x:44.31127,y:-92.67851,xcom:-92.67851,ycom:44.3112679};e.$inject=["$scope","$cordovaGeolocation","$timeout","$ionicModal","map-factory","shared-data-factory"],angular.module("fpm").controller("map-controller",e)}()}(),function(){"use strict";!function(){function e(e){function t(){return e.get(n+"GetMapData")}var n="api/Dashboard/";return{getMapData:t}}e.$inject=["api-base-factory"],angular.module("fpm").factory("map-factory",e)}()}(),function(){"use strict";!function(){function e(e){function t(){console.log("HELLO WORLD")}var n=this;n.events={onChangePasswordClicked:t}}e.$inject=["$scope"],angular.module("fpm").controller("change-password-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function a(){var e=n.get(o.localStorageKeys.settingsKeyName);console.log(e),e&&(r.userSettings.defaultCalenderViewForMobile=e.DefaultCalenderViewForMobile||"workWeek",r.userSettings.startupPageForMobile=e.StartupPageForMobile||states.todaysWorkOrders,r.userSettings.pushNotifications=e.PushNotifications||!1,r.userSettings.locationServices=e.LocationServices||!1)}var r=this;r.userSettings={defaultCalenderViewForMobile:"workWeek",pushNotifications:!1,locationServices:!1},a()}e.$inject=["$scope","$state","localStorageService","fieldPromaxConfig"],angular.module("fpm").controller("settings-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(o,a,r){function i(e,t,n,o){return u.resolve(e)}function c(e){u.reject(e)}var u=t.defer();return e({method:o,url:n.fieldPromaxApi+a,data:r}).success(i).error(c),u.promise}function a(e,t){return o("POST",e,JSON.stringify(t))}function r(e,t){return o("GET",e,t)}function i(e,t){return o("DELETE",e,t)}var c={get:r,post:a,deleteReq:i};return c}e.$inject=["$http","$q","fieldPromaxConfig"],angular.module("fpm").factory("api-base-factory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,r,i,c,u){function s(n){function o(e){if(e){C.isAuth=!0,C.userName=e.userName;var t={token:e.access_token,userName:e.userName,customerNumber:e.customerNumber,secLevel:e.secLevel,isAdminstrator:"True"===e.isAdminstrator,isIntuitUser:"True"===e.isIntuitUser,userEmail:e.userEmail,etOn:"True"===e.etOn,timeCard:"True"===e.timeCard,allowPushTime:"True"===e.allowPushTime,showPrice:"True"===e.showPrice,havingGroupsAssigned:"True"===e.havingGroups};c.set(g.storageKeyName,t),e.hasOwnProperty(g.configKeyName)&&c.set(g.configKeyName,JSON.parse(e.configurations)),e.userSettings&&c.set(g.settingsKeyName,JSON.parse(e.userSettings)),u.resolve(e)}else e.data?u.reject(e.data.error):u.reject("Invalid Login Details")}function a(e){i.hide(),u.reject(e)}var r="grant_type=password&username="+n.userName+"&password="+n.password+"&client_id=fieldPromaxMob",u=t.defer();return e.post(h+"token",r,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(o).error(a),u.promise}function l(){var e=t.defer(),n=c.get(g.storageKeyName);return n?e.resolve(!0):e.resolve(!1),e.promise}function d(){return c.get(g.storageKeyName)}function m(){c.remove(g.initialData),c.remove(g.storageKeyName),c.remove(g.configKeyName),c.remove(g.settingsKeyName),c.remove("orderState")}function f(e){return apiContext.get("/api/public/SendPassword?email="+e)}function p(e){return apiContext.post("/api/changepassword/changepassword",e)}var h=u.fieldPromaxApi,g=u.localStorageKeys,C={isAuth:!1,userName:""},v={login:s,isAuthenticated:l,getLoggedInUserInfo:d,logout:m,sendPassword:f,authentication:C,changePassword:p};return v}e.$inject=["$http","$q","$rootScope","$state","$window","$timeout","$ionicLoading","localStorageService","fieldPromaxConfig"],angular.module("fpm").factory("authenticationFactory",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a){return{toStringDate:function(e){return moment(e).format("lll")},showLoading:function(e){var t=e||"please wait...";return a.show({template:t})},hideLoading:function(){return a.hide()},alerts:{alert:function(e,t,o){var a=n.alert({title:e,template:t});angular.isFunction(o)&&a.then(function(e){o()})},confirm:function(e,t,o,a){var r=n.confirm({title:e,template:t});r.then(function(e){e?angular.isFunction(o)&&o():angular.isFunction(a)&&a()})},confirmDelete:function(e){var t=n.confirm({title:"Confirmation",template:"Are you sure?"});t.then(function(t){t&&angular.isFunction(e)&&e()})}}}}function t(){return function(e){var t=e.substr(e.lastIndexOf("/")+1),n=t.substr(0,t.lastIndexOf("."))||"";return n}}e.$inject=["$cordovaDialogs","$q","$ionicPopup","$ionicModal","$ionicLoading"],angular.module("fpm").factory("fpm-utilities-factory",e),angular.module("fpm").filter("removeExt",[t])}()}(),function(){"use strict";!function(){function e(e,t,n){var o={BadRequest:400,PageNotFound:401},a={},r=function(e){e.headers=e.headers||{};var t=n.get("authorizationData");return t&&(e.headers.Authorization="Bearer "+t.token),e},i=function(n){if(n.status===o.PageNotFound&&t.path("/"),n.status===o.BadRequest&&n.data)throw n;return e.reject(n)};return a.request=r,a.responseError=i,a}e.$inject=["$q","$location","localStorageService"],angular.module("fpm").factory("requestIntercepter",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function a(a){var i=o.localStorageKeys.initialData,c=a||!1;c===!0&&n.remove(i);var u=n.get(i);return u?e.when(u):t.get(r+"GetIniitialData").then(function(e){return n.set(i,e),e})}var r="api/Shared/";return{getIniitialData:a}}e.$inject=["$q","api-base-factory","localStorageService","fieldPromaxConfig"],angular.module("fpm").factory("shared-data-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{isEstimate:"<",onAddProductCompleted:"&",modalType:"<",product:"="},templateUrl:"js/shared-components/edit-product-component-template.html",controller:["$scope","$stateParams","$rootScope","work-orders-factory","authenticationFactory",function(e,t,n,o,a){var r=this;r.user=a.getLoggedInUserInfo(),r.events={closeProductEditModal:function(){n.$broadcast("$fpm:closeEditProductModal")},updateProductClick:function(){if(0===r.modalType){var a=r.isEstimate?null:o.updateProduct;a(r.product).then(function(t){e.$emit("$fpm:operation:updateProduct",t)})}else r.product.BarCode=t.barCode,r.product.Quantity=r.product.qty,r.product.FromListWindow=!0,o.addProduct(r.product).then(function(e){angular.isFunction(r.onAddProductCompleted)?r.onAddProductCompleted({product:e}):n.$broadcast("$fpm:operation:addProduct",e)})}}}],controllerAs:"vm"};angular.module("fpm").component("editProductComponent",e)}()}(),function(){"use strict";!function(){var e={templateUrl:"js/shared-components/product-search-component-template.html",controller:["$scope","$timeout","$ionicModal","work-orders-factory",function(e,t,n,o){var a=this;a.searchValue="",a.products=[],a.events={closeProductEditModal:function(){a.productModal.hide()},applySearch:function(){o.searchProduct(a.searchValue,"").then(function(e){a.products=e})},onProductItemClicked:function(e){a.currentProduct=angular.copy(e),a.currentProduct.qty=1,a.productModal&&a.productModal.show()},closeSearchModal:function(){e.$emit("$fpm:closeProductSearchModal",{fromProductAdd:!1})},onAddProductCompleted:function(n){a.productModal.hide(),t(function(){e.$emit("$fpm:closeProductSearchModal",{fromProductAdd:!0})},100)}},e.$on("$fpm:closeEditProductModal",function(){a.productModal.hide()}),n.fromTemplateUrl("addProductModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){a.productModal=e})}],controllerAs:"vm"};angular.module("fpm").component("productSearchComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,r,i){function c(e){var t=_.where(e.timeCardDetails,{finishTime:null});return t.length>0?(C.ui.data.allowSendForApproval=!1,!1):C.ui.data.approvalStatus!==D.NONE?(C.ui.data.allowSendForApproval=!1,!1):(C.ui.data.allowSendForApproval=!0,!0)}function u(){var e=new Date(C.ui.data.currentDate.getFullYear(),C.ui.data.currentDate.getMonth(),C.ui.data.currentDate.getDate(),0,0,0,0),t=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),0,0,0,0),n=moment(e).isBefore(t),o=moment(e).isAfter(t);moment(e).isSame(t)&&(C.ui.data.addTimeVisibility=C.ui.data.isClockedIn,C.ui.data.ptoButtonVisibility=!C.ui.data.isClockedIn),C.ui.data.disableClockInButton=n,C.ui.data.isClockedOut===!0&&(C.ui.data.disableClockOutButton=n),o===!0&&(C.ui.data.disableClockInButton=!0,C.ui.data.addTimeVisibility=!1,C.ui.data.ptoButtonVisibility=!0),n===!0&&(C.ui.data.addTimeVisibility=!1,C.ui.data.ptoButtonVisibility=!0)}function s(e){var t=1,n=1;C.ui.data.timeCards=[],e.length>0&&angular.forEach(e,function(o,a){o.jobCode!==v.CLOCK_IN?o.isPtoType?(o.pto=n,n++):(o.section=t,t++):o.section=0,a===e.length-1&&(C.ui.data.timeCards=_.reject(e,{jobCode:v.CLOCK_IN,finishTime:null}))})}function l(e){if(console.log("details",e),C.ui.data.timeCards=[],C.ui.data.summary=e.timeCardSummary,C.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0,y=e.pendingClockIns,C.ui.data.currentClockedIn=_.findWhere(e.timeCardDetails,{jobCode:v.CLOCK_IN,finishTime:null}),c(e),angular.isDefined(C.ui.data.currentClockedIn)){var t=C.ui.data.currentClockedIn;C.ui.data.clockInDateTime=moment(t.startTime),C.ui.data.isClockedIn=!0,C.ui.data.isClockedOut=null!==t.finishTime,C.ui.data.addTimeVisibility=!C.ui.data.isClockedOut,C.ui.data.clockOutDateTime=moment(t.finishTime),C.ui.data.clockedInDate=angular.copy(t)}u(),s(e.timeCardDetails)}function d(){C.ui.data.totalTime="0";var e=_.filter(C.ui.data.timeCards,function(e){return e.jobCode===v.CLOCK_IN&&null!==e.finishTime}),t=_.filter(C.ui.data.timeCards,function(e){return e.jobCode!==v.CLOCK_IN&&e.isPayable===!1&&null!==e.finishTime}),n=0;if(e.length>0&&angular.forEach(e,function(e,t){n+=moment(e.FinishTime).diff(kendo.parseDate(e.startTime),"minutes")}),t.length>0){var o=0;angular.forEach(t,function(e,a){if(o+=moment(e.finishTime).diff(moment(e.startTime),"minutes"),a===t.length-1){n-=o;var r=Math.floor(n/60),i=n%60;C.ui.data.totalTime=r+" hrs "+i+" min"}})}else{var a=Math.floor(n/60),r=n%60;C.ui.data.totalTime=a+" hrs "+r+" min"}}function m(){r.showLoading().then(function(){a.getTimeCardByDate(S(C.currentDate)).then(function(e){console.log("getTimeCardByDate",e),e?l(e):u()}).finally(r.hideLoading)})}function f(){n.openDatePicker(k)}function p(e){C.popover.show(e)}function h(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),0,0);console.log(kendo.toString(t,"g"));var n={startTime:kendo.toString(t,"g"),jobCode:v.CLOCK_OUT,numFromSummary:C.ui.data.summary.Num,timeCardDate:moment(C.ui.data.summary.timeCardDate),uniqueIdentifier:C.ui.data.currentClockedIn.uniqueIdentifier};a.clockInOutUser(n).then(function(e){if(console.log("response",e),null===e.errors){C.ui.data.clockOutDateTime=t,C.ui.data.isClockedOut=!0,C.ui.data.isClockedIn=!1,C.ui.data.disableClockOutButton=!0,C.ui.data.addTimeVisibility=!1,C.ui.data.ptoButtonVisibility=!0,C.ui.data.summary=e.timeCardSummary;var n=new Date,o=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),a=new Date(moment(C.ui.data.summary.timeCardDate)),r=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0);moment(r).isSameOrAfter(o)&&(C.ui.data.disableClockInButton=!1),C.ui.data.approvalStatus=e.timeCardSummary.approveStatus||0,s(e.timeCardDetails),c(e)}})}function g(){m();var e=i.getLoggedInUserInfo(),t=_.findWhere(T,{c:e.customerNumber});C.ui.data.enableForCustomer=angular.isDefined(t)}var C=this,v={CLOCK_IN:5001,CLOCK_OUT:5002},S=r.toStringDate,D={NONE:0,SEND_FOR_APPROVAL:1,CANCELLED:2,APPROVED:3},y=[],w=!1;C.errors=[],C.factory=a;var b=r.alerts;C.currentDate=new Date,o.fromTemplateUrl("my-popover.html",{scope:e}).then(function(e){C.popover=e});var k={callback:function(e){C.currentDate=new Date(e),m()},inputDate:C.currentDate};C.events={onDatePickerClicked:f,showPopoverClicked:p},C.ui={errors:[],calendar:{settings:{theme:"mobiscroll",display:"bottom",swipeDirection:"vertical"}},data:{summary:null,currentDate:new Date,isClockedIn:!1,isClockedOut:!1,clockInDateTime:new Date,clockOutDateTime:new Date,addTimeVisibility:!1,clockedInDate:null,timeCards:[],approvalStatus:0,disableClockInButton:!1,disableClockOutButton:!1,currentClockedIn:null,allowSendForApproval:!1,totalTime:"",enableForCustomer:!1,ptoButtonVisibility:!1},events:{clockOutClick:function(){var e=_.where(C.ui.data.timeCards,{finishTime:null});e.length>0?b.confirm("Confirmation!","You have a task pending to check out. \n\n Previously pending tasks will be checked out automattically. \n\n Are you sure?",function(){h()}):b.confirm("Confirmation!","Are you sure?",function(){h()})},clockInClick:function(){var e=new Date,n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),(new Date).getHours(),(new Date).getMinutes(),0,0),o={startTime:r.toStringDate(n),jobCode:v.CLOCK_IN,numFromSummary:null===C.ui.data.summary?0:C.ui.data.summary.Num,timeCardDate:n};C.errors=[],a.clockInOutUser(o).then(function(e){null===e.errors?(C.ui.data.clockInDateTime=n,C.ui.data.isClockedIn=!0,C.ui.data.addTimeVisibility=!0,C.ui.data.ptoButtonVisibility=!1,b.alert("Clocked In","Clocked in successfully",function(){w===!0?t.go($stateParams.proute):l(e)})):C.errors=e.errors})}}};var T=[{c:"407805491"},{c:"1238967820"}];e.$watch("vm.ui.data.timeCards",function(e){C.factory.details=e,angular.isDefined(e)&&d()},!0),g()}e.$inject=["$scope","$state","ionicDatePicker","$ionicPopover","timecard-factory","fpm-utilities-factory","authenticationFactory"],angular.module("fpm").controller("timecard-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n){function o(t){return console.log(t),e.get(v+"GetTimeCardByDate?date="+t)}function a(t){return e.get(v+"GetClockInByDate?date="+t)}function r(t){return e.post(v+"ClockInOutUser",t)}function i(n){n=n||!1,n===!0&&S.remove("jobCodes");var o=S.get("jobCodes");return angular.isDefined(o)&&o?t.when(o):e.get(v+"GetJobCodes").then(function(e){return S.put("jobCodes",e),e})}function c(n){n=n||!1,n===!0&&S.remove("workorders");var o=S.get("workorders");return angular.isDefined(o)&&o?t.when(o):e.get(v+"GetWorkOrdersList").then(function(e){return S.put("workorders",e),e})}function u(t){return e.post(v+"AddNewDetails",t)}function s(t,n){return e.get(v+"ClearCheckedOutTime?detailId="+t+"&summaryId="+n)}function l(t,n){return e.get(v+"SendForApproval?summaryId="+t+"&status="+n)}function d(t,n){return e.get(v+"DeleteTimeCardDetails?detailId="+t+"&summaryId="+n)}function m(t){return e.get(v+"ClearTimeCard?summaryId="+t)}function f(){return e.get(v+"GetPendingClockIns")}function p(t){return e.post(v+"PushCheckInOutTimes",t)}function h(){return e.get(v+"CertifieldUser")}function g(){return e.get(v+"GetCertifieldUser")}function C(t){return e.post(v+"AddPtoDetails",t)}var v="api/timecard/",S=n("timeCardCache"),D={details:[],jobCodes:{CLOCK_IN:5001,CLOCK_OUT:5002}},y={};return y.addPtoDetails=C,y.certifyUser=h,y.getCertifieldUser=g,y.pushCheckInOutTimes=p,y.data=D,y.getPendingClockIns=f,y.getJobCodes=i,y.clockInOutUser=r,y.getClockInByDate=a,y.getTimeCardByDate=o,y.getWorkOrdersList=c,y.addNewDetails=u,y.clearCheckedOutTime=s,y.sendForApproval=l,y.deleteTimeCardDetails=d,y.clearTimeCard=m,y}e.$inject=["api-base-factory","$q","$cacheFactory"],angular.module("fpm").factory("timecard-factory",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",onCancelClicked:"&",onAddCompleted:"&",serviceProviders:"<"},controller:["$scope","fpm-utilities-factory","work-orders-factory",function(e,t,n){var o=this;o.errors=[];var a={serviceProvider:"",startDate:new Date,endTime:new Date,fromMobile:!0,barCode:o.barcode,intuitQboItemId:""};o.newSchedule=angular.copy(a),o.events={closeProductEditModal:function(){angular.isFunction(o.onCancelClicked)&&o.onCancelClicked()},addScheduleClicked:function(){o.errors=[],o.showError=!1;var e=angular.copy(o.newSchedule);e.startDate=t.toStringDate(o.newSchedule.startDate),e.endTime=t.toStringDate(o.newSchedule.endTime),t.showLoading().then(function(){n.addWorkOrderSchedule(e).then(function(e){angular.isDefined(e.model)&&angular.isArray(e.model.errors)&&e.model.errors.length>0?(o.errors=e.model.errors,o.showError=!0):o.onAddCompleted({o:{invoice:e.invoice,schedules:e.schedule}})}).finally(t.hideLoading)})},onServiceProviderSelectionChanged:function(){}},o.$onInit=function(){}}],controllerAs:"vm",templateUrl:"js/work-orders/add-schedule-modal-component.template.html"};angular.module("fpm").component("addScheduleModalComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,r,i){function c(){a.getBarCodeNumber().then(function(e){p.woEntity.barCode=e.barcode,p.woEntity.barCodeName=e.barcodeName})}function u(){a.createEntity().then(function(e){p.woEntity=angular.copy(e),p.woEntity.fromMobile=!0,d()}).finally(c)}function s(e){return p.errors=[],p.showError=!1,p.isCustomerSelected===!1?(p.errors.push("Please select a customer first"),p.showError=!0,!1):void o.show({template:"creating work order..."}).then(function(){p.woEntity.scheduleStart=i.toStringDate(p.dates.startDate),p.woEntity.scheduleEnd=i.toStringDate(p.dates.endDate),a.createWorkOrder(p.woEntity).then(function(e){e&&(e.errors.length>0?(p.errors=e.errors,p.showError=!0):h.alert("Success","Work Order created successfully",function(){t.go("app.dashboard")}))}).finally(o.hide)})}function l(){n.show({buttons:[{text:"Same as Business Address"},{text:"Clear Address"}],titleText:"Service Address Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&(p.woEntity.sStreet=p.woEntity.bStreet,p.woEntity.sState=p.woEntity.bState,p.woEntity.sCity=p.woEntity.bCity,p.woEntity.sZip=p.woEntity.bZip),1===e&&(p.woEntity.sStreet="",p.woEntity.sState="",p.woEntity.sCity="",p.woEntity.sZip=""),!0}})}function d(){p.dates={startDate:new Date,endDate:new Date(moment().add(1,"hours"))}}function m(){t.go("app.dashboard")}function f(){r.getIniitialData().then(function(e){e&&(p.jobTypes=e.jobTypes,p.serviceProviders=e.serviceProviders)}).finally(u)}var p=this,h=i.alerts;p.errors=[],d(),p.isCustomerSelected=!1,p.events={onCustomerSelected:function(e){p.isCustomerSelected=!0,p.woEntity.firstName=e.firstName,p.woEntity.lastName=e.lastName,p.woEntity.companyName=e.company,p.woEntity.displayName=e.name,p.woEntity.bCity=e.addressCity,p.woEntity.bState=e.addressCountrySubDivCode,p.woEntity.bStreet=null==e.street?null:e.street.replace("::","\n"),p.woEntity.bZip=e.addressPostalCode,p.woEntity.phone=e.phone,p.woEntity.fax=e.fax,p.woEntity.uin=e.uin,p.woEntity.email=e.email_Group,p.woEntity.mobile=e.mobile,p.woEntity.sStreet=null==e.shipStreet?"":e.shipStreet.replace("::","\n"),p.woEntity.sState=e.shipState,p.woEntity.sCity=e.shipCity,p.woEntity.sZip=e.shipZIP},onSubmitButtonClicked:s,onServiceAddressActionClicked:l,onBackToDashboardClicked:m},f()}e.$inject=["$scope","$state","$ionicActionSheet","$ionicLoading","work-orders-factory","shared-data-factory","fpm-utilities-factory"],angular.module("fpm").controller("create-order-controller",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o,a,r,i,c,u,s,l,d,m){function f(){r.show({template:"loading work order..."}).then(function(){u.getBarcodeDetails($.barcode).then(function(e){$.barCodeData=e,$.uiSettings.woData=angular.copy(e),$.taxCheckboxVisibility=($.barCodeData.taxRate||0)>0,angular.isArray(e.schedules)&&($.schedule=angular.copy(angular.copy(_.findWhere(e.schedules,{num:parseInt(o.technicianNum,10)}))),$.schedule.actualStartDateTime&&($.schedule.actualStartDateTime=new Date(moment($.schedule.actualStartDateTime))),$.schedule.actualFinishDateTime&&($.schedule.actualFinishDateTime=new Date(moment($.schedule.actualFinishDateTime))),p($.schedule.actualStartDateTime,$.schedule.actualFinishDateTime),$.uiSettings.orderBelongToCurrentUser=$.schedule.technicianNum===$.userId,r.hide(),D())},function(e){I.alert("Oops","ERROR WHILE GETTING WORK ORDER INFORMATION..",r.hide)})})}function p(e,t){if(!Date.parse(e)||!Date.parse(t))return 0;var o=Math.abs(new Date(e)-new Date(t)),a=Math.floor(o/1e3),r=Math.floor(a/60),i=Math.floor(r/60);return r%=60,n(function(){0===i?$.scheduleTimeSpan.timeSpan=r+" Minutes":$.scheduleTimeSpan.timeSpan=i+" Hours "+r+" Minutes"},50),0}function h(e,t){return new Date(e.getTime()+6e4*t)}function g(e,t,n){$.user.havingGroupsAssigned;if($.isServiceProvider===!1)return!0;var o=$.schedule.technicianNum===$.user.userEmail;if(havingGroupsAssinged===!0&&n&&n===!0){var a=_.findWhere($.serviceProviders,{UserId:$.schedule.TechnicianNum});if(angular.isDefined(a))return!0}return $.isServiceProvider!==!0||o!==!1||(I.alert("Oops!","you are not authorized to perform this action",function(){angular.isFunction(t)&&t(e)}),!1)}function C(e){g(null,null,!1)&&(e===!0&&($.schedule.actualStartDateTime=null),$.schedule.actualFinishDateTime=null,$.scheduleTimeSpan.timeSpan="")}function v(){var e={num:0,numFromSummary:0,timeCardDate:s.toStringDate($.schedule.actualStartDateTime),startTime:s.toStringDate($.schedule.actualStartDateTime),finishTime:s.toStringDate($.schedule.actualFinishDateTime),jobCode:0,notes:"",barcode:$.barcode,isUserDefined:!0,scheduleId:$.schedule.num};$.schedule.actualStartDateTime?m.pushCheckInOutTimes(e).then(function(e){angular.isArray(e)&&e.length>0?I.alert("Warning",e[0]):I.alert("Success","Details successfully pushed to timecard")}):I.alert("Warning","Please select Check In date and time")}function S(){$.user=d.getLoggedInUserInfo(),$.uiSettings.isTimeCardModuleEnabled=$.user.timeCard&&$.user.allowPushTime,$.isServiceProvider=!$.user.isAdminstrator,l.getIniitialData(!0).then(function(e){e&&($.uiSettings.milageTrackingEnabled=e.customerNumberEntity.milageTrackingEnabled||!1,$.uiSettings.timerEnabled=e.customerNumberEntity.workOrderTimerEnabled||!1,$.scheduleStatus=e.secondaryOrderStatus,$.serviceProviders=e.serviceProviders,$.vehicles=e.vehicles)}).finally(T)}function D(){if($.totals={subtotal:0,totalqty:0,totalcost:0,totaltax:0},$.barCodeData.invoice&&$.barCodeData.invoice.length>0){var e=$.barCodeData.taxRate||0;angular.forEach($.barCodeData.invoice,function(t){if(t.price&&t.qty&&angular.isNumber(parseFloat(t.price))&&angular.isNumber(parseInt(t.qty,10))){var n=t.price*t.qty,o=parseFloat(parseFloat(e)>0?parseFloat(e/100*n):0);$.totals.subtotal+=parseFloat(n),$.totals.totalqty+=parseInt(t.qty,10),(t.taxable||!1)===!0&&($.totals.totaltax+=parseFloat(o))}})}}function y(){g(null,null,!1)&&u.updateWorkOrderMobile({barcodeAssay:$.barCodeData.barcodeDetails,fromMobile:!0}).then(function(e){e&&angular.isArray(e)&&e.length>0&&($.errors=e)})}function w(e,t){t===!0?s.showLoading().then(function(){u.updateSchedule($.schedule).then(function(){e&&I.alert("Success","Schedule information updated successfully")}).then(s.hideLoading)}):u.updateSchedule($.schedule).then(function(){e&&I.alert("Success","Schedule information updated successfully")})}function b(e){if($.uiSettings.woData){var t=_.findWhere($.uiSettings.woData.invoice,{
num:e.num});if(angular.isDefined(t))for(var n in t)e.hasOwnProperty(n)&&(e[n]=t[n])}}function k(){s.showLoading().then(function(){$.schedule.actualStartDateTime=new Date,$.schedule.actualFinishDateTime=null,$.scheduleTimeSpan.onStartDateTimeChaged(),u.updateJobStatus({scheduleButton:P.CheckIn,scheduleNum:$.schedule.num,actualStartTime:s.toStringDate($.schedule.actualStartDateTime),barcode:$.barcode,timerStartAt:s.toStringDate(new Date)}).then(function(){$.schedule.checkInStatus=!0}).finally(s.hideLoading)})}function T(){if($.user.timeCard===!0){var e=new Date,t=s.toStringDate(new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0));timeCardFactory.getTimeCardByDate(t).then(function(e){e&&(M.currentDetails=e.timeCardDetails)})}}var $=this;$.barcode=o.barCode,$.taxCheckboxVisibility=!0;var I=s.alerts,P={AcceptJob:0,InRoute:1,CheckIn:2,CheckOut:3},O={CLOCK_IN:5001,CLOCK_OUT:5002};$.invoiceOpen=!1,$.uiSettings={isTimeCardModuleEnabled:!1,milageTrackingEnabled:!1,orderBelongToCurrentUser:!1,timerEnabled:!1,woData:null},$.errors=[],f(),$.scheduleTimeSpan={timeSpan:"",onTimespanSeletionChanged:function(e,t){var o=t.getVal(),a=Math.floor(o/1e3),r=Math.floor(a/60);n(function(){var e,t=angular.copy($.schedule.actualStartDateTime);null==t?(e=new Date,$.schedule.actualStartDateTime=new Date):e=new Date(t);var n=h(e,r);$.schedule.actualFinishDateTime=kendo.parseDate(n)},50)},onStartDateTimeChaged:function(){$.schedule.actualStartDateTime&&$.schedule.actualFinishDateTime&&(new Date($.schedule.actualStartDateTime)>new Date($.schedule.actualFinishDateTime)?I.alert("Warning","Start time cannot be greater than finish time."):p($.schedule.actualStartDateTime,$.schedule.actualFinishDateTime))},onEndDateTimeChanged:function(){$.schedule.actualStartDateTime&&$.schedule.actualFinishDateTime&&(new Date($.schedule.actualStartDateTime)>new Date($.schedule.actualFinishDateTime)?I.alert("Warning","Start time cannot be greater than finish time."):p($.schedule.actualStartDateTime,$.schedule.actualFinishDateTime))},clearAllDateTimeSelection:function(){}},S();var E=[{text:"Check In"},{text:"Check Out"},{text:'<span class="text-assertive">Clear All</span>'},{text:'<span class="text-assertive">Clear Checkout Time</span>'},{text:"Update Schedule"}];$.scheduleAddModal=null,$.tabs={desc:{events:{onDescriptionOrResolutionChanged:function(){y()}}},sch:{events:{onAddScheduleCompleted:function(e){e&&($.barCodeData.schedules=e.schedules,$.barCodeData.invoice=e.invoice,$.scheduleAddModal.hide(),I.alert("Success","Schedule added successfully"))},onModalCancelClicked:function(){$.scheduleAddModal.hide()},onMilageInformationActionButtonClicked:function(){a.show({buttons:[{text:"Save Milage Information"}],titleText:"Milage Information",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&w(!0,!0),!0}})},onTripnoteChanged:function(){w(!1,!1)},updateSchedule:function(){w(!0,!0)},onListScheduleItemTap:function(e){e.num!==$.schedule.num&&I.confirm("Confirmation","Are you sure to load this schedule",function(){t.go("app.editOrder",{barCode:$.barcode,technicianNum:e.num,src:"main"})})},onSchedulesListButtonClicked:function(){a.show({buttons:[{text:"Add New Schedule"}],titleText:"New Schedule",cancelText:"Cancel",cancel:function(){},buttonClicked:function(t){return 0===t&&(null===$.scheduleAddModal?c.fromTemplateUrl("addScheduleModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){$.scheduleAddModal=e,$.scheduleAddModal.show()}):$.scheduleAddModal.show()),!0}})},checkIn:function(){if($.schedule.approve!==!0&&$.schedule.checkInStatus!==!0){if(g(null,null,!0))if($.user.timeCard===!0){var e=_.where(M.currentDetails,{jobCode:O.CLOCK_IN,finishTime:null}),t=_.reject(M.currentDetails,{jobCode:O.CLOCK_IN});if(0===e.length)I.confirm("Confirmation!","You have not clocked in yet. You will be clocked in automattically \n\n Are you sure?",function(){k()},function(){});else if(t.length>0){var n=_.where(t,{finishTime:null,jobCodeName:"On Job"});n.length>0?I.alert("Warning!","You have not checked out for previous task.",function(){}):k()}else k()}else k();return!1}I.alert("Alert","Not allowed to checkin")},checkOut:function(){if($.schedule.approve===!0||$.schedule.checkOutStatus===!0)I.alert("Alert","Not allowed to checkout");else if(g(null,null,!1)){if(null===$.schedule.actualStartDateTime)return I.alert("Warning","Please check in first"),!1;$.schedule.actualFinishDateTime=new Date,$.scheduleTimeSpan.onEndDateTimeChanged(),u.updateJobStatus({scheduleButton:P.CheckOut,scheduleNum:$.schedule.num,actualEndTime:s.toStringDate($.schedule.actualFinishDateTime),Barcode:$.barcode}).then(function(){$.schedule.checkOutStatus=!0})}},onScheduleActionButtonClicked:function(){var e=angular.copy(E);$.user.allowPushTime&&e.push({text:"<b>Push to Timecard</b>"}),a.show({buttons:e,titleText:"Current Schedule",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&$.tabs.sch.events.checkIn(),1===e&&$.tabs.sch.events.checkOut(),2===e&&C(!0),3===e&&C(!1),4===e&&w(!0,!0),5===e&&v(),!0}})}}},smry:{events:{onTaxCheckboaxChanged:function(e){g(e,b)&&(D(),u.updateOrderProduct(e))}}},prod:{events:{onProdcutActionButtonClicked:function(){a.show({buttons:[{text:"Add New Product"}],titleText:"New Product",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&$.productSearchModal.show(),!0}})},closeProductEditModal:function(){$.productModal.hide()},openProductSearchModal:function(){},onEditProductClicked:function(e){$.currentProduct=angular.copy(e),$.productModal.show()},onDeleteProductClicked:function(e){I.confirmDelete(function(){u.deleteProduct($.barcode,e.num).then(function(e){e&&($.barCodeData.products=e.products,$.barCodeData.invoice=e.invoice,D())})})}}}};var M={currentDetails:[]};c.fromTemplateUrl("productSearchModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){$.productSearchModal=e}),c.fromTemplateUrl("editProductModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){$.productModal=e}),e.$on("$fpm:closeEditProductModal",function(){$.productModal.hide()}),e.$on("$fpm:closeProductSearchModal",function(e,t){$.productSearchModal&&(t&&t.fromProductAdd===!0&&u.getBarcodeInvoiceAndProductDetails($.barcode).then(function(e){$.barCodeData.products=e.products,$.barCodeData.invoice=e.invoice,D()}),$.productSearchModal.hide())}),e.$on("$fpm:operation:updateProduct",function(e,t){if(t&&$.currentProduct){var o=_.filter($.barCodeData.products,function(e){return e.num===t.num}),a=_.filter($.barCodeData.invoice,function(e){return"Labor"!==e.productName&&e.numFromSchedule===t.num});n(function(){o.length>0&&(o[0].qty=t.qty,o[0].productDescription=t.productDescription,o[0].price=t.price),a.length>0&&(a[0].qty=t.qty,a[0].productDescription=t.productDescription,a[0].price=t.price,a[0].totalPrice=parseFloat(t.qty)*parseFloat(t.price)),D(),$.productModal.hide()},100)}})}e.$inject=["$scope","$state","$timeout","$stateParams","$ionicActionSheet","$ionicLoading","$ionicPopup","$ionicModal","work-orders-factory","fpm-utilities-factory","shared-data-factory","authenticationFactory","timecard-factory"],angular.module("fpm").controller("edit-order-controller",e)}()}(),function(){"use strict";!function(){var e={templateUrl:"js/work-orders/order-documents-list-component.template.html",bindings:{barcode:"<"},controller:["$scope","work-orders-factory","fpm-utilities-factory","fieldPromaxConfig",function(e,t,n,o){var a=this,r=o.fieldPromaxApi,i=n.alerts;a.docUrl="",a.events={onDocumentClicked:function(e){window.open(r+"Handlers/GetImageFromBlob.ashx?imageId="+e.num+"&dateStamp="+new Date+"&flag=viewTarget","_system","location=yes")},onDeleteDocumentClicked:function(e){i.confirmDelete(function(){})}},a.$onInit=function(){a.barcode&&t.getUploadedDocuments(a.barcode).then(function(e){a.barcodeDocuments=e,console.log(a.barcodeDocuments)})}}],controllerAs:"vm"};angular.module("fpm").component("orderDocumentsListComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<"},templateUrl:"js/work-orders/order-images-list-component.template.html",controller:["$scope","$ionicModal","$ionicLoading","work-orders-factory","fpm-utilities-factory","fieldPromaxConfig",function(e,t,n,o,a,r){var i=this;i.isExpanded=!1;var c=r.fieldPromaxApi,u=a.alerts;i.upload={control:null,uploadImage:function(e,t){n.show({template:"Please wait..."}).then(function(){o.uploadFile({Barcode:i.barcode,Image:e,Name:t}).then(function(e){i.barcodeImages.push({barcode:i.barcode,fileName:t,imageURL:"/"+t,num:e}),u.alert("Uploaded","File Uploaded successfully")}).finally(n.hide)})},options:{multiple:!0,showFileList:!1,localization:{select:"Upload files"},select:function(e){e.isDefaultPrevented=!0;var t=["tif","tiff","gif","jpeg","jpg","jif","jfif","jp2","jpx","j2k","j2c","pcd","png","bmp"];angular.forEach(e.files,function(e){var n=e.name.split("."),o=n.reverse();if(e.size<20971520){var a=_.filter(t,function(e){return o[0].toLowerCase()===e});if(a.length>0){var r=new FileReader;r.onload=function(t){i.upload.uploadImage(t.target.result,e.name)},r.readAsDataURL(e.rawFile)}}})}}},i.currentImage=null,i.events={onDeleteImageClicked:function(e){u.confirmDelete(function(){console.log("HELLO WORLDF")})},onImageTap:function(e){i.currentImage=e,i.imageUrl=c+"Handlers/GetImageFromBlob.ashx?imageId="+e.num+"&dateStamp="+new Date,i.imageViewerModel.show()},closeImageViewModal:function(){i.imageViewerModel.hide()}},i.$onInit=function(){i.barcode&&o.getImagesList(i.barcode).then(function(e){i.barcodeImages=e})},t.fromTemplateUrl("imageViewerModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){i.imageViewerModel=e})}],controllerAs:"vm"};angular.module("fpm").component("orderImagesListComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<"},templateUrl:"js/work-orders/order-signature-card-component.template.html",controller:["$scope","$ionicActionSheet","authenticationFactory","fieldPromaxConfig",function(e,t,n,o){var a=this;a.showingSignaturePad=!1;var r=o.fieldPromaxApi,i=n.getLoggedInUserInfo();a.signPadEvents=null,a.events={onSignaturePadActionButtonClicked:function(){t.show({buttons:[{text:"Hide Signature Pad"},{text:"Save New Signature"}],titleText:"Work Order Signature",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&(a.showingSignaturePad=!1),1===e&&(console.log("EVNT",a.signPadEvents),a.signPadEvents&&a.signPadEvents.trySaveSignature().then(function(e){e===!0&&(a.showingSignaturePad=!1,a.imageUrl=r+"Handlers/GetBarcodeSignature.ashx?barcode="+a.barcode+"&dateStamp="+new Date+"&customernumber="+i.customerNumber)})),!0}})},onSignatureActionButtonClicked:function(){t.show({buttons:[{text:"Show Signature Pad"}],titleText:"Work Order Signature",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&(a.showingSignaturePad=!0),!0}})}},a.imageUrl=r+"Handlers/GetBarcodeSignature.ashx?barcode",a.$onInit=function(){a.imageUrl=r+"Handlers/GetBarcodeSignature.ashx?barcode="+a.barcode+"&dateStamp="+new Date+"&customernumber="+i.customerNumber},a.$onChanges=function(){}}],controllerAs:"vm"};angular.module("fpm").component("orderSignatureComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{padEventsRef:"="},templateUrl:"js/work-orders/order-signature-pad-template.html",controller:["$scope","$stateParams","$q","work-orders-factory",function(e,t,n,o){var a=this;a.customerName="";var r=t.barCode;a.events={trySaveSignature:function(){var e=n.defer(),t=!1,i=$(angular.element("#signature")).jSignature("getData","image");return""!==$.trim(a.customerName)&&angular.isArray(i)&&o.saveJsonSignForBarcode({BaseString:i[1],Barcode:t?"":r,CustomerName:a.customerName,EstimateId:0}).then(function(){e.resolve(!0)}),e.promise}},a.$onInit=function(){var e=angular.element("#signature");$(e).jSignature({lineWidth:1,width:$(document).width()-80,height:200,"decor-color":"transparent"}).bind("change",function(t){var n=$(e).jSignature("getData","image");angular.isArray(n)}),a.padEventsRef=a.events}}],controllerAs:"vm"};angular.module("fpm").component("orderSignaturePad",e)}()}(),function(){"use strict";!function(){var e={bindings:{barcode:"<",taxrate:"<",defaultEmails:"<"},templateUrl:"js/work-orders/work-order-email-card-template.html",controller:["$scope","$ionicActionSheet","$q","work-orders-factory","fpm-utilities-factory",function(e,t,n,o,a){function r(e){c.mailConfig.mailAddresses&&c.mailConfig.mailAddresses.length>0&&o.sendInvoiceMail({BarCode:c.barcode,SendAsInvoice:e,emailAddresses:c.mailConfig.mailAddresses,TaxRate:c.taxrate}).then(function(){a.alerts.alert("Email Sent","Email Sent Successfully")})}function i(){t.show({buttons:[{text:"Send As Invoice"},{text:"Send As Work Order"}],titleText:"Work Order Email Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0!==e&&1!==e||r(0===e),!0}})}var c=this;c.mailConfig={mailAddresses:[]},c.events={onOrderEmailActionClicked:i},c.$onInit=function(){console.log("DF",c.defaultEmails)}}],controllerAs:"vm"};angular.module("fpm").component("orderEmailCardComponent",e)}()}(),function(){"use strict";!function(){var e={bindings:{isCheckedIn:"<",isCheckedOut:"<",isApproved:"<",schedule:"<"},controller:["$interval","$state","$element","$timeout","shared-data-factory",function(e,t,n,o,a){function r(){var e=Math.floor(s.currentTime.totalMinutes/60),t=Math.floor(s.currentTime.totalMinutes%60);s.currentTime.mins=t<=9?"0"+t:t,s.currentTime.hrs=e<=9?"0"+e:e,0===e&&t>=55?s.currentTime.isOnInterval=!0:e>0&&(t>55||t<=5)?s.currentTime.isOnInterval=!0:s.currentTime.isOnInterval=!1}function i(){s.currentTime.showControl===!1&&(s.currentTime.showControl=!0),s.currentTime.isRunning=!0,l=e(function(){s.currentTime.totalMinutes+=1,console.log(s.currentTime.totalMinutes),r()},6e4)}function c(){null!==l&&(s.currentTime.isRunning=!1,e.cancel(l));var t=o(function(){s.currentTime.showControl=!1,o.cancel(t)},100)}function u(){r()}var s=this;s.currentTime={hrs:"00",mins:"00",totalMinutes:0,showControl:!1,isRunning:!1,isOnInterval:!1,intervalMinutes:0,intervalCounter:0};var l=null;this.$onDestroy=function(){c()};var d=!1;this.$onChanges=function(){d===!0&&(s.isCheckedIn===!0&&s.currentTime.isRunning===!1&&i(),s.isCheckedOut===!0&&c())},s.events={refreshTimer:u},this.$onInit=function(){s.currentTime.showControl=!1,a.getIniitialData().then(function(e){d=e.customerNumberEntity.workOrderTimerEnabled||!1,d===!0&&o(function(){if(s.schedule&&(s.currentTime.showControl=s.schedule.checkInStatus===!0&&s.schedule.checkOutStatus===!1,s.schedule.checkInStatus===!0&&s.schedule.timerStartAt&&(s.schedule.checkOutStatus||!1)===!1)){var e=moment(new Date).diff(moment(s.schedule.timerStartAt),"minutes");e>0&&(s.currentTime.totalMinutes=e,r())}},1e3)})}}],templateUrl:"js/work-orders/work-order-timer-component.template.html",controllerAs:"model"};angular.module("fpm").component("workOrderTimerComponent",e)}()}(),function(){"use strict";!function(){function e(e,t,n,o){function a(t,o){t=null!==t&&t,t===!0&&T.remove($);var a=T.get($);return angular.isDefined(a)&&a?e.when(a):n.get(k+"GetMobileDashboard").then(function(e){return T.put($,e),e})}function r(e){return n.get(k+"GetBarcodeDetails?barcode="+e)}function i(e,t){return n.get(k+"DeleteProduct?barcode="+e+"&productNum="+t)}function c(e){return n.post(k+"UpdateProduct?fromMobile=true",e)}function u(e,t){return n.get(k+"GetProductsLists?searchPattern="+e+"&alphabet="+t)}function s(e){return n.post(k+"AddProductsToOrder?fromMobile=true",e)}function l(e){return n.get(k+"GetBarcodeInvoiceAndProductDetails?barcode="+e)}function d(e){return n.post(k+"SaveJsonSignForBarcode",e)}function m(e){return n.post(k+"SendInvoiceMail",e)}function f(e){return n.get(k+"GetImagesList?barcode="+e)}function p(e){return n.get(k+"GetUploadedDocuments?barcode="+e)}function h(e){return n.post(k+"UploadFile",e)}function g(){var t=T.get("workOrderEntity");return angular.isDefined(t)&&t?e.when(t):n.get(k+"CreateEntity").then(function(e){return T.put("workOrderEntity",e),e})}function C(e){return n.post(k+"CreateWorkOrder",e)}function v(){return n.get(k+"GetBarCodeNumber")}function S(e){return n.post(k+"UpdateWorkOrderMobile",e)}function D(e){return e.clientTime=new Date,n.post(k+"UpdateJobStatus",e)}function y(e){return n.post(k+"UpdateSchedule?fromMobile=true",e)}function w(e){return n.post(k+"AddWorkOrderSchedule",e)}function b(e){return n.post(k+"UpdateOrderProduct",e)}var k="api/workorders/",T=t("orderCache"),$="dashboardData";return{getMobileDashboard:a,getBarcodeDetails:r,deleteProduct:i,updateProduct:c,searchProduct:u,addProduct:s,getBarcodeInvoiceAndProductDetails:l,saveJsonSignForBarcode:d,sendInvoiceMail:m,getImagesList:f,getUploadedDocuments:p,uploadFile:h,createEntity:g,createWorkOrder:C,getBarCodeNumber:v,updateWorkOrderMobile:S,updateJobStatus:D,updateSchedule:y,addWorkOrderSchedule:w,updateOrderProduct:b}}e.$inject=["$q","$cacheFactory","api-base-factory","shared-data-factory"],angular.module("fpm").factory("work-orders-factory",e)}()}();