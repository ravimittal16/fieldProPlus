var isInDevMode=!0,constants={fieldPromaxApi:isInDevMode?"http://localhost:51518/":"https://microsoft-apiapp01371f9b84264eab9d5e506c9c4f6d24.azurewebsites.net/",localStorageKeys:{authorizationDataKey:"authorizationData",initialData:"initialData",storageKeyName:"authorizationData",configKeyName:"configurations",settingsKeyName:"userSettings"}},fpm=angular.module("fpm",["ionic","ui.router","LocalStorageModule","ngCordova","ionic-datepicker","kendo.directives","mobiscroll-datetime","mobiscroll-timespan","mobiscroll-numpad"]).config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider","$ionicConfigProvider","ionicDatePickerProvider",function(e,t,o,n,r,a){var i=[{state:"login",config:{url:"/",controller:"login-controller",controllerAs:"vm",templateUrl:"views/login.html"}},{state:"app",config:{abstract:!0,controller:"app-main-controller",controllerAs:"vm",templateUrl:"views/app-main.html"}},{state:"app.dashboard",config:{url:"/home",controller:"dashboard-controller",controllerAs:"vm",templateUrl:"views/dashboard.html"}},{state:"app.calendar",config:{url:"/calendar",controller:"calendar-controller",controllerAs:"vm",templateUrl:"views/calendar.html"}},{state:"app.map",config:{url:"/map",controller:"map-controller",controllerAs:"vm",templateUrl:"views/map.html"}},{state:"app.createWorkOrder",config:{url:"/createorder",controller:"create-order-controller",controllerAs:"vm",templateUrl:"views/create-order.html"}},{state:"app.editOrder",config:{url:"/editOrder?barCode&technicianNum&src",controller:"edit-order-controller",controllerAs:"vm",templateUrl:"views/edit-order.html"}},{state:"app.createCustomer",config:{url:"/createcustomer",controller:"create-customer-controller",controllerAs:"vm",templateUrl:"views/create-customer.html"}},{state:"app.createEstimate",config:{url:"/createestimate",controller:"create-estimate-controller",controllerAs:"vm",templateUrl:"views/create-estimate.html"}},{state:"app.expense",config:{url:"/expanses",controller:"expanses-controller",controllerAs:"vm",templateUrl:"views/expanses.html"}},{state:"app.timecard",config:{url:"/timecard",controller:"timecard-controller",controllerAs:"vm",templateUrl:"views/timecard.html"}},{state:"app.settings",config:{url:"/settings",controller:"settings-controller",controllerAs:"vm",templateUrl:"views/settings.html"}},{state:"app.changePassword",config:{url:"/changePassword",controller:"change-password-controller",controllerAs:"vm",templateUrl:"views/change-password.html"}},{state:"app.logout",config:{controller:"logout-controller",controllerAs:"vm"}}];angular.forEach(i,function(t){e.state(t.state,t.config)}),t.otherwise("/"),o.debugInfoEnabled(!1),n.interceptors.push("requestIntercepter");var c={inputDate:new Date,setLabel:"Set",todayLabel:"Today",closeLabel:"Close",mondayFirst:!1,weeksList:["S","M","T","W","T","F","S"],monthsList:["Jan","Feb","March","April","May","June","July","Aug","Sept","Oct","Nov","Dec"],templateType:"popup",from:new Date(2012,8,1),to:new Date(2025,8,1),showTodayButton:!0,dateFormat:"dd MMMM yyyy",closeOnSelect:!1};a.configDatePicker(c),r.tabs.position(isInDevMode?"top":"bottom")}]).run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]);fpm.constant("fieldPromaxConfig",constants),function(){"use strict";function e(e){}e.$inject=["$scope"],angular.module("fpm").controller("calendar-controller",e)}(),function(){"use strict";function e(e){}e.$inject=["$scope"],angular.module("fpm").controller("create-customer-controller",e)}(),function(){"use strict";function e(e){}e.$inject=["$scope"],angular.module("fpm").controller("create-estimate-controller",e)}(),function(){"use strict";function e(e,t,o,n,r,a){function i(){u=[];var e=!0;e===!0&&angular.forEach(s.result,function(e,t){e.dataForAdministrator&&e.dataForAdministrator.length>0&&_.forEach(e.dataForAdministrator,function(e){e.ordersJson&&_.forEach(JSON.parse(e.ordersJson),function(e){u.push(e)})})})}function c(e,t){r.getMobileDashboard(e).then(function(e){s.result=e.result,i()}).finally(function(){angular.isFunction(t)&&t()})}function l(){c(!1)}var s=this,u=[];s.isSearchModalOpened=!1,s.events={onSearchItemClick:function(e){e&&(s.matchedOrders=[],s.isSearchModalOpened=!1,s.searchModal.hide(),s.searchValue="",o(function(){t.go("app.editOrder",{barCode:e.Barcode,technicianNum:e.TechnicianScheduleNum,src:"main"})},300))},applySearch:function(){var e=s.searchValue.toLowerCase();s.matchedOrders=_.filter(u,function(t){return t.BarcodeName.toLowerCase().indexOf(e)>-1})},closeSearchModal:function(){s.matchedOrders=[],s.isSearchModalOpened=!1,s.searchModal.hide(),s.searchValue=""},openSearchModal:function(){s.searchValue="",s.matchedOrders=[],s.isSearchModalOpened=!0,s.searchModal.show()},onOrderClicked:function(e){e&&t.go("app.editOrder",{barCode:e.Barcode,technicianNum:e.TechnicianScheduleNum,src:"main"})},refreshOnPullDown:function(){c(!0,function(){e.$broadcast("scroll.refreshComplete")})},onChildGroupClicked:function(e,t,o){e.isOpen=!e.isOpen;var n=a.get("orderState");return null===n&&(n={}),"DD"===t?(e.isOpen===!0?(n[o]=e,a.set("orderState",n)):a.set("orderState",null),!1):void(e.isOpen===!0&&0===e.clickCount?(n[o]=e,a.set("orderState",n),"SP"===t?e.dataForServiceProvider=JSON.parse(e.ordersJson):e.ordersN=JSON.parse(e.ordersJson),e.clickCount+=1):(n[o]=null,a.set("orderState",n)))}},e.$on("$ionicView.loaded",function(e,t){l()}),e.$on("modal.hidden",function(){console.log("Execute action")}),e.$on("modal.removed",function(){console.log("modal.removed")}),e.$on("$destroy",function(){s.searchModal.remove()}),n.fromTemplateUrl("dashboardSearchModal.html",{scope:e,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){s.searchModal=e})}e.$inject=["$scope","$state","$timeout","$ionicModal","work-orders-factory","localStorageService"],angular.module("fpm").controller("dashboard-controller",e)}(),function(){"use strict";function e(e){function t(){return e.get(o+"GetValues")}var o="api/workorders/",n={testCall:t};return n}e.$inject=["api-base-factory"],angular.module("fpm").factory("dashboard-factory",e)}()(function(){"use strict";function e(e,t,o,n,r){function a(){r.getExpense("",!0).then(function(e){s.paid=_.filter(e,function(e){return 1==e.expenseStatus}),s.unpaid=_.filter(e,function(e){return 0==e.expenseStatus})})}function i(){a()}function c(e){var t=n.confirm({title:"Delete Expense",template:"Are you sure?"});t.then(function(e){e&&console.log("HELLO WORLD")})}function l(e){console.log(s.modal),s.editedExpense=e,s.modal.show()}var s=this;s.paid=[],s.unpaid=[],s.events={onDeleteClicked:c,onEditClicked:l},e.$on("$ionicView.loaded",function(e,t){i()}),o.fromTemplateUrl("expenseModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){s.modal=e})}e.$inject=["$scope","$ionicLoading","$ionicModal","$ionicPopup","expense-data-factory"],angular.module("fpm").controller("expanses-controller",e)})(),function(){"use strict";function e(e){function t(t,o){return e.get(c+"GetExpense?barcode="+t+"&isFromMain="+o)}function o(t){return e.post(c+"AddExpense",t)}function n(t){return e.deleteApiCall(c+"DeleteExpense?id="+t)}function r(t){return e.get(c+"MarkAsPaidUnPaid?id="+t)}function a(t){return e.deleteApiCall(c+"DeleteImage?expenseId="+t)}var i={},c="api/expense/";return i.schema={expenseId:0,Title:"",Description:"",ExpenseType:0,ExpenseStatus:0,TotalCost:0,Barcode:"",ExpenseDate:new Date,Quantity:1,ImageChanged:!1,havingImage:!1},i.markAsPaidUnPaid=r,i.deleteExpense=n,i.addExpense=o,i.getExpense=t,i.deleteImage=a,i}e.$inject=["api-base-factory"],angular.module("fpm").factory("expense-data-factory",e)}(),function(){"use strict";var e={bindings:{expense:"="},template:"HHSKD",controller:["$scope",function(e){console.log("HELLO WORLD")}],controllerAs:"vm"};angular.module("fpm").component("expenseItemComponent",e)}(),function(){"use strict";function e(e,t,o,n){var r=this;r.sideMenuItems=[{title:"Home",state:"app.dashboard",icon:"home"},{title:"Calendar",state:"app.calendar",icon:"calendar"},{title:"Map",state:"app.map",icon:"location"},{title:"Create Work Order",state:"app.createWorkOrder",icon:"plus-round"},{title:"Create Customer",state:"app.createCustomer",icon:"plus-round"},{title:"Create Estimate",state:"app.createEstimate",icon:"plus-round"},{title:"My Expense",state:"app.expense",icon:"cash"},{title:"Time Card",state:"app.timecard",icon:"clock"},{title:"Settings",state:"app.settings",icon:"settings"},{title:"Change Password",state:"app.changePassword",icon:""},{title:"Logout",state:"app.logout",icon:"power"}],e.$on("$ionicView.beforeEnter",function(e,t){o.showBackButton(!1)}),r.events={onMenuItemClicked:function(e){n.go(e.state)},toggleLeft:function(){}}}e.$inject=["$scope","$ionicSideMenuDelegate","$ionicNavBarDelegate","$state"],angular.module("fpm").controller("app-main-controller",e)}(),function(){"use strict";function e(e,t,o,n,r,a){var i=this;i.user={userName:"",password:""},i.showError=!1,i.events={loginClick:function(e){return i.showError=!1,i.errors=[],e?void o.show({template:"authenticating you..."}).then(function(){n.login(i.user).then(function(e){o.hide().then(function(){e&&n.authentication.isAuth&&r.go("app.dashboard")})},function(e){o.hide(),i.showError=!0,e.error?i.errors=[e.error]:i.errors=["Invalid Email or Password"]})}):(t.alert({title:"Oops",template:"Please enter login information..."}),!1)}}}e.$inject=["$ionicScrollDelegate","$ionicPopup","$ionicLoading","authenticationFactory","$state","dashboard-factory"],angular.module("fpm").controller("login-controller",e)}(),function(){"use strict";function e(e,t,o){function n(){o.logout(),t.go("login")}n(),console.log("HELLO WORLD")}e.$inject=["$scope","$state","authenticationFactory"],angular.module("fpm").controller("logout-controller",e)}(),function(){"use strict";function e(e){var t=this;t.heading="HELLLO WORLD FROM IONIC"}e.$inject=["$scope"],angular.module("fpm").controller("main-controller",e)}(),function(){"use strict";function e(e,o,n,r,a,i){function c(){console.log("HELLO WORLD"),p.filtersModal&&p.filtersModal.show()}function l(){p.filtersModal&&p.filtersModal.hide()}function s(){}function u(){a.getMapData().then(function(e){e&&(p.mapData.users=e.users)})}function d(){f.center=new window.google.maps.LatLng(t.y,t.x),i.getIniitialData().then(function(e){if(p.iniitialData=e,e){var o=e.customerNumberEntity;f.center=new window.google.maps.LatLng(o.coordinateY||t.y,o.coordinateX||t.x),f.zoom=o.zoomDepth||8,p.map=new google.maps.Map(document.getElementById("map"),f)}else f.center=new window.google.maps.LatLng(t.y,t.x),p.map=new google.maps.Map(document.getElementById("map"),f)}).finally(u)}function m(){d()}var p=this;console.log(o);var f={center:null,panControl:!1,zoomControl:!0,scaleControl:!0,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP};r.fromTemplateUrl("mapFilters.html",{scope:e,animation:"slide-in-up"}).then(function(e){p.filtersModal=e}),p.filtersApplied=!1,p.events={onFiltersClicked:c,clearFilters:l,applyFilters:s},p.mapData={users:[]},m()}var t={x:44.31127,y:-92.67851,xcom:-92.67851,ycom:44.3112679};e.$inject=["$scope","$cordovaGeolocation","$timeout","$ionicModal","map-factory","shared-data-factory"],angular.module("fpm").controller("map-controller",e)}(),function(){function e(e){function t(){return e.get(o+"GetMapData")}var o="api/Dashboard/";return{getMapData:t}}e.$inject=["api-base-factory"],angular.module("fpm").factory("map-factory",e)}(),function(){"use strict";function e(e){function t(){console.log("HELLO WORLD")}var o=this;o.events={onChangePasswordClicked:t}}e.$inject=["$scope"],angular.module("fpm").controller("change-password-controller",e)}(),function(){"use strict";function e(e,t,o,n){function r(){var e=o.get(n.localStorageKeys.settingsKeyName);console.log(e),e&&(a.userSettings.defaultCalenderViewForMobile=e.DefaultCalenderViewForMobile||"workWeek",a.userSettings.startupPageForMobile=e.StartupPageForMobile||states.todaysWorkOrders,a.userSettings.pushNotifications=e.PushNotifications||!1,a.userSettings.locationServices=e.LocationServices||!1)}var a=this;a.userSettings={defaultCalenderViewForMobile:"workWeek",pushNotifications:!1,locationServices:!1},r()}e.$inject=["$scope","$state","localStorageService","fieldPromaxConfig"],angular.module("fpm").controller("settings-controller",e)}(),function(){"use strict";function e(e,t,o){function n(n,r,a){function i(e,t,o,n){return l.resolve(e)}function c(e){l.reject(e)}var l=t.defer();return e({method:n,url:o.fieldPromaxApi+r,data:a}).success(i).error(c),l.promise}function r(e,t){return n("POST",e,JSON.stringify(t))}function a(e,t){return n("GET",e,t)}function i(e,t){return n("DELETE",e,t)}var c={get:a,post:r,deleteReq:i};return c}e.$inject=["$http","$q","fieldPromaxConfig"],angular.module("fpm").factory("api-base-factory",e)}()(function(){"use strict";function e(e,t,o,n,r,a,i,c,l){function s(o){function n(e){if(e){v.isAuth=!0,v.userName=e.userName;var t={token:e.access_token,userName:e.userName,customerNumber:e.customerNumber,secLevel:e.secLevel,isAdminstrator:"True"===e.isAdminstrator,isIntuitUser:"True"===e.isIntuitUser,userEmail:e.userEmail,etOn:"True"===e.etOn,timeCard:"True"===e.timeCard,allowPushTime:"True"===e.allowPushTime,showPrice:"True"===e.showPrice};c.set(h.storageKeyName,t),e.hasOwnProperty(h.configKeyName)&&c.set(h.configKeyName,JSON.parse(e.configurations)),e.userSettings&&c.set(h.settingsKeyName,JSON.parse(e.userSettings)),l.resolve(e)}else e.data?l.reject(e.data.error):l.reject("Invalid Login Details")}function r(e){i.hide(),l.reject(e)}var a="grant_type=password&username="+o.userName+"&password="+o.password+"&client_id=fieldPromaxMob",l=t.defer();return e.post(g+"token",a,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(n).error(r),l.promise}function u(){var e=t.defer(),o=c.get(h.storageKeyName);return o?e.resolve(!0):e.resolve(!1),e.promise}function d(){return c.get(h.storageKeyName)}function m(){c.remove(h.initialData),c.remove(h.storageKeyName),c.remove(h.configKeyName),c.remove(h.settingsKeyName),c.remove("orderState")}function p(e){return apiContext.get("/api/public/SendPassword?email="+e)}function f(e){return apiContext.post("/api/changepassword/changepassword",e)}var g=l.fieldPromaxApi,h=l.localStorageKeys,v={isAuth:!1,userName:""},w={login:s,isAuthenticated:u,getLoggedInUserInfo:d,logout:m,sendPassword:p,authentication:v,changePassword:f};return w}e.$inject=["$http","$q","$rootScope","$state","$window","$timeout","$ionicLoading","localStorageService","fieldPromaxConfig"],angular.module("fpm").factory("authenticationFactory",e)})(),function(){"use strict";function e(e,t,o,n){return{toStringDate:function(e){return moment(e).format("lll")},alerts:{alert:function(e,t,n){var r=o.alert({title:e,template:t});angular.isFunction(n)&&r.then(function(e){n()})},confirm:function(){},confirmDelete:function(e){var t=o.confirm({title:"Confirmation",template:"Are you sure?"});t.then(function(t){t&&angular.isFunction(e)&&e()})}}}}function t(){return function(e){var t=e.substr(e.lastIndexOf("/")+1),o=t.substr(0,t.lastIndexOf("."))||"";return o}}e.$inject=["$cordovaDialogs","$q","$ionicPopup","$ionicModal"],angular.module("fpm").factory("fpm-utilities-factory",e),angular.module("fpm").filter("removeExt",[t])}(),function(){"use strict";function e(e,t,o){var n={BadRequest:400,PageNotFound:401},r={},a=function(e){e.headers=e.headers||{};var t=o.get("authorizationData");return t&&(e.headers.Authorization="Bearer "+t.token),e},i=function(o){if(o.status===n.PageNotFound&&t.path("/"),o.status===n.BadRequest&&o.data)throw o;return e.reject(o)};return r.request=a,r.responseError=i,r}e.$inject=["$q","$location","localStorageService"],angular.module("fpm").factory("requestIntercepter",e)}(),function(){"use strict";function e(e,t,o,n){function r(r){var i=n.localStorageKeys.initialData,c=r||!1;c===!0&&o.remove(i);var l=o.get(i);return l?e.when(l):t.get(a+"GetIniitialData").then(function(e){return o.set(i,e),e})}var a="api/Shared/";return{getIniitialData:r}}e.$inject=["$q","api-base-factory","localStorageService","fieldPromaxConfig"],angular.module("fpm").factory("shared-data-factory",e)}(),function(){"use strict";var e={bindings:{isEstimate:"<",onAddProductCompleted:"&",modalType:"<",product:"="},templateUrl:"js/shared-components/edit-product-component-template.html",controller:["$scope","$stateParams","$rootScope","work-orders-factory","authenticationFactory",function(e,t,o,n,r){var a=this;a.user=r.getLoggedInUserInfo(),a.events={closeProductEditModal:function(){o.$broadcast("$fpm:closeEditProductModal")},updateProductClick:function(){if(0===a.modalType){var r=a.isEstimate?null:n.updateProduct;r(a.product).then(function(t){e.$emit("$fpm:operation:updateProduct",t)})}else a.product.BarCode=t.barCode,a.product.Quantity=a.product.qty,a.product.FromListWindow=!0,n.addProduct(a.product).then(function(e){angular.isFunction(a.onAddProductCompleted)?a.onAddProductCompleted({product:e}):o.$broadcast("$fpm:operation:addProduct",e)})}}}],controllerAs:"vm"};angular.module("fpm").component("editProductComponent",e)}(),function(){"use strict";var e={templateUrl:"js/shared-components/product-search-component-template.html",controller:["$scope","$timeout","$ionicModal","work-orders-factory",function(e,t,o,n){var r=this;r.searchValue="",r.products=[],r.events={closeProductEditModal:function(){r.productModal.hide()},applySearch:function(){n.searchProduct(r.searchValue,"").then(function(e){r.products=e})},onProductItemClicked:function(e){r.currentProduct=angular.copy(e),r.currentProduct.qty=1,r.productModal&&r.productModal.show()},closeSearchModal:function(){e.$emit("$fpm:closeProductSearchModal",{fromProductAdd:!1})},onAddProductCompleted:function(o){r.productModal.hide(),t(function(){e.$emit("$fpm:closeProductSearchModal",{fromProductAdd:!0})},100)}},e.$on("$fpm:closeEditProductModal",function(){r.productModal.hide()}),o.fromTemplateUrl("addProductModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){r.productModal=e})}],controllerAs:"vm"};angular.module("fpm").component("productSearchComponent",e)}()(function(){"use strict";function e(e,t,o,n,r){function a(){n.getTimeCardByDate(s(l.currentDate)).then(function(e){console.log(e)})}function i(){t.openDatePicker(u)}function c(e){l.popover.show(e)}var l=this,s=r.toStringDate;l.errors=[],l.currentDate=new Date,o.fromTemplateUrl("my-popover.html",{scope:e}).then(function(e){l.popover=e});var u={callback:function(e){l.currentDate=new Date(e),a()},inputDate:l.currentDate};l.events={onDatePickerClicked:i,showPopoverClicked:c},console.log("HELLO WORLD")}e.$inject=["$scope","ionicDatePicker","$ionicPopover","timecard-factory","fpm-utilities-factory"],angular.module("fpm").controller("timecard-controller",e)})(),function(){"use strict";function e(e,t,o){function n(t){return console.log(t),e.get(w+"GetTimeCardByDate?date="+t)}function r(t){return e.get(w+"GetClockInByDate?date="+t)}function a(t){return e.post(w+"ClockInOutUser",t)}function i(o){o=o||!1,o===!0&&y.remove("jobCodes");var n=y.get("jobCodes");return angular.isDefined(n)&&n?t.when(n):e.get(w+"GetJobCodes").then(function(e){return y.put("jobCodes",e),e})}function c(o){o=o||!1,o===!0&&y.remove("workorders");var n=y.get("workorders");return angular.isDefined(n)&&n?t.when(n):e.get(w+"GetWorkOrdersList").then(function(e){return y.put("workorders",e),e})}function l(t){return e.post(w+"AddNewDetails",t)}function s(t,o){return e.get(w+"ClearCheckedOutTime?detailId="+t+"&summaryId="+o)}function u(t,o){return e.get(w+"SendForApproval?summaryId="+t+"&status="+o)}function d(t,o){return e.get(w+"DeleteTimeCardDetails?detailId="+t+"&summaryId="+o)}function m(t){return e.get(w+"ClearTimeCard?summaryId="+t)}function p(){return e.get(w+"GetPendingClockIns")}function f(t){return e.post(w+"PushCheckInOutTimes",t)}function g(){return e.get(w+"CertifieldUser")}function h(){return e.get(w+"GetCertifieldUser")}function v(t){return e.post(w+"AddPtoDetails",t)}var w="api/timecard/",y=o("timeCardCache"),C={details:[],jobCodes:{CLOCK_IN:5001,CLOCK_OUT:5002}},$={};return $.addPtoDetails=v,$.certifyUser=g,$.getCertifieldUser=h,$.pushCheckInOutTimes=f,$.pushCheckInOutTimes=f,$.data=C,$.getPendingClockIns=p,$.getJobCodes=i,$.clockInOutUser=a,$.getClockInByDate=r,$.getTimeCardByDate=n,$.getWorkOrdersList=c,$.addNewDetails=l,$.clearCheckedOutTime=s,$.sendForApproval=u,$.deleteTimeCardDetails=d,$.clearTimeCard=m,$}e.$inject=["api-base-factory","$q","$cacheFactory"],angular.module("fpm").factory("timecard-factory",e)}(),function(){"use strict";function e(e,t,o){}e.$inject=["$scope","$state","work-orders-factory"],angular.module("fpm").controller("create-order-controller",e)}(),function(){"use strict";function e(e,t,o,n,r,a,i,c,l,s){function u(){a.show({template:"getting data..."}).then(function(){l.getBarcodeDetails(m.barcode).then(function(e){if(m.barCodeData=e,console.log("DD",e),angular.isArray(e.schedules)){var t=_.filter(e.schedules,function(e){return e.num===parseInt(n.technicianNum,10)});m.schedule=angular.copy(t[0]),a.hide(),d()}},function(e){i.alert({title:"Oops",template:"ERROR WHILE GETTING BARCODE DATA.."}),a.hide()})})}function d(){if(m.totals={subtotal:0,totalqty:0,totalcost:0,totaltax:0},m.barCodeData.invoice&&m.barCodeData.invoice.length>0){var e=m.barCodeData.taxRate||0;angular.forEach(m.barCodeData.invoice,function(t){if(t.price&&t.qty&&angular.isNumber(parseFloat(t.price))&&angular.isNumber(parseInt(t.qty,10))){var o=t.price*t.qty,n=parseFloat(parseFloat(e)>0?parseFloat(e/100*o):0);m.totals.subtotal+=parseFloat(o),m.totals.totalqty+=parseInt(t.qty,10),(t.taxable||!1)===!0&&(m.totals.totaltax+=parseFloat(n))}})}}var m=this;m.barcode=n.barCode;var p=s.alerts;m.invoiceOpen=!1,u(),m.tabs={sch:{events:{onListScheduleItemTap:function(e){console.log(e)},onScheduleActionButtonClicked:function(){r.show({buttons:[{text:"Add New Schedule"}],titleText:"Schedule",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return!0}})}}},smry:{events:{}},prod:{events:{onProdcutActionButtonClicked:function(){r.show({buttons:[{text:"Add New Product"}],titleText:"New Product",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&m.productSearchModal.show(),!0}})},closeProductEditModal:function(){m.productModal.hide()},openProductSearchModal:function(){},onEditProductClicked:function(e){m.currentProduct=angular.copy(e),m.productModal.show()},onDeleteProductClicked:function(e){p.confirmDelete(function(){l.deleteProduct(m.barcode,e.num).then(function(e){e&&(m.barCodeData.products=e.products,m.barCodeData.invoice=e.invoice,d())})})}}}},c.fromTemplateUrl("productSearchModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){m.productSearchModal=e}),c.fromTemplateUrl("editProductModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){m.productModal=e}),e.$on("$fpm:closeEditProductModal",function(){m.productModal.hide()}),e.$on("$fpm:closeProductSearchModal",function(e,t){m.productSearchModal&&(t&&t.fromProductAdd===!0&&l.getBarcodeInvoiceAndProductDetails(m.barcode).then(function(e){m.barCodeData.products=e.products,m.barCodeData.invoice=e.invoice,d()}),m.productSearchModal.hide())}),e.$on("$fpm:operation:updateProduct",function(e,t){if(t&&m.currentProduct){var n=_.filter(m.barCodeData.products,function(e){return e.num===t.num}),r=_.filter(m.barCodeData.invoice,function(e){return"Labor"!==e.productName&&e.numFromSchedule===t.num});o(function(){n.length>0&&(n[0].qty=t.qty,n[0].productDescription=t.productDescription,n[0].price=t.price),r.length>0&&(r[0].qty=t.qty,r[0].productDescription=t.productDescription,r[0].price=t.price,r[0].totalPrice=parseFloat(t.qty)*parseFloat(t.price)),d(),m.productModal.hide()},100)}})}e.$inject=["$scope","$state","$timeout","$stateParams","$ionicActionSheet","$ionicLoading","$ionicPopup","$ionicModal","work-orders-factory","fpm-utilities-factory"],angular.module("fpm").controller("edit-order-controller",e)}(),function(){"use strict";var e={templateUrl:"js/work-orders/order-documents-list-component.template.html",bindings:{barcode:"<"},controller:["$scope","work-orders-factory","fpm-utilities-factory",function(e,t,o){var n=this,r=o.alerts;n.events={onDocumentClicked:function(e){r.confirmDelete(function(){})},onDeleteDocumentClicked:function(e){}},n.$onInit=function(){n.barcode&&t.getUploadedDocuments(n.barcode).then(function(e){n.barcodeDocuments=e,console.log(n.barcodeDocuments)})}}],controllerAs:"vm"};angular.module("fpm").component("orderDocumentsListComponent",e)}(),function(){"use strict";var e={bindings:{barcode:"<"},templateUrl:"js/work-orders/order-images-list-component.template.html",controller:["$scope","$ionicModal","work-orders-factory","fpm-utilities-factory","fieldPromaxConfig",function(e,t,o,n,r){var a=this;a.isExpanded=!1;var i=r.fieldPromaxApi,c=n.alerts;a.upload={control:null,uploadImage:function(e,t){o.uploadFile({Barcode:a.barcode,Image:e,Name:t}).then(function(e){a.barcodeImages.push({barcode:a.barcode,fileName:t,imageURL:"/"+t,num:e}),c.alert("Uploaded","File Uploaded successfully")})},options:{multiple:!0,showFileList:!1,localization:{select:"Upload files"},select:function(e){e.isDefaultPrevented=!0;var t=["tif","tiff","gif","jpeg","jpg","jif","jfif","jp2","jpx","j2k","j2c","pcd","png","bmp"];angular.forEach(e.files,function(e){var o=e.name.split("."),n=o.reverse();if(e.size<20971520){var r=_.filter(t,function(e){return n[0].toLowerCase()===e});if(r.length>0){var i=new FileReader;i.onload=function(t){a.upload.uploadImage(t.target.result,e.name)},i.readAsDataURL(e.rawFile)}console.log(r)}}),console.log(e)}}},a.currentImage=null,a.events={onDeleteImageClicked:function(e){c.confirmDelete(function(){console.log("HELLO WORLDF")})},onImageTap:function(e){a.currentImage=e,a.imageUrl=i+"Handlers/GetImageFromBlob.ashx?imageId="+e.num+"&dateStamp="+new Date,a.imageViewerModel.show()},closeImageViewModal:function(){a.imageViewerModel.hide()}},a.$onInit=function(){a.barcode&&o.getImagesList(a.barcode).then(function(e){a.barcodeImages=e})},t.fromTemplateUrl("imageViewerModal.html",{scope:e,animation:"slide-in-up"}).then(function(e){a.imageViewerModel=e})}],controllerAs:"vm"};angular.module("fpm").component("orderImagesListComponent",e)}()(function(){"use strict";var e={bindings:{barcode:"<"},templateUrl:"js/work-orders/order-signature-card-component.template.html",controller:["$scope","$ionicActionSheet","authenticationFactory","fieldPromaxConfig",function(e,t,o,n){var r=this;r.showingSignaturePad=!1;var a=n.fieldPromaxApi,i=o.getLoggedInUserInfo();r.signPadEvents=null,r.events={onSignaturePadActionButtonClicked:function(){t.show({buttons:[{text:"Hide Signature Pad"},{text:"Save New Signature"}],titleText:"Work Order Signature",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&(r.showingSignaturePad=!1),1===e&&(console.log("EVNT",r.signPadEvents),r.signPadEvents&&r.signPadEvents.trySaveSignature().then(function(e){e===!0&&(r.showingSignaturePad=!1,r.imageUrl=a+"Handlers/GetBarcodeSignature.ashx?barcode="+r.barcode+"&dateStamp="+new Date+"&customernumber="+i.customerNumber)})),!0}})},onSignatureActionButtonClicked:function(){t.show({buttons:[{text:"Show Signature Pad"}],titleText:"Work Order Signature",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0===e&&(r.showingSignaturePad=!0),!0}})}},r.imageUrl=a+"Handlers/GetBarcodeSignature.ashx?barcode",r.$onInit=function(){r.imageUrl=a+"Handlers/GetBarcodeSignature.ashx?barcode="+r.barcode+"&dateStamp="+new Date+"&customernumber="+i.customerNumber},r.$onChanges=function(){}}],controllerAs:"vm"};angular.module("fpm").component("orderSignatureComponent",e)})(),function(){"use strict";var e={bindings:{padEventsRef:"="},templateUrl:"js/work-orders/order-signature-pad-template.html",controller:["$scope","$stateParams","$q","work-orders-factory",function(e,t,o,n){var r=this;r.customerName="";var a=t.barCode;r.events={trySaveSignature:function(){var e=o.defer(),t=!1,i=$(angular.element("#signature")).jSignature("getData","image");return""!==$.trim(r.customerName)&&angular.isArray(i)&&n.saveJsonSignForBarcode({BaseString:i[1],Barcode:t?"":a,CustomerName:r.customerName,EstimateId:0}).then(function(){e.resolve(!0)}),e.promise}},r.$onInit=function(){var e=angular.element("#signature");$(e).jSignature({lineWidth:1,width:$(document).width()-80,height:200,"decor-color":"transparent"}).bind("change",function(t){var o=$(e).jSignature("getData","image");angular.isArray(o)}),r.padEventsRef=r.events}}],controllerAs:"vm"};angular.module("fpm").component("orderSignaturePad",e)}(),function(){"use strict";var e={bindings:{barcode:"<",taxrate:"<",defaultEmails:"<"},templateUrl:"js/work-orders/work-order-email-card-template.html",controller:["$scope","$ionicActionSheet","$q","work-orders-factory","fpm-utilities-factory",function(e,t,o,n,r){function a(e){c.mailConfig.mailAddresses&&c.mailConfig.mailAddresses.length>0&&n.sendInvoiceMail({BarCode:c.barcode,SendAsInvoice:e,emailAddresses:c.mailConfig.mailAddresses,TaxRate:c.taxrate}).then(function(){r.alerts.alert("Email Sent","Email Sent Successfully")})}function i(){t.show({buttons:[{text:"Send As Invoice"},{text:"Send As Work Order"}],titleText:"Work Order Email Options",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return 0!==e&&1!==e||a(0===e),!0}})}var c=this;c.mailConfig={mailAddresses:[]},c.events={onOrderEmailActionClicked:i},c.$onInit=function(){console.log("DF",c.defaultEmails)}}],controllerAs:"vm"};angular.module("fpm").component("orderEmailCardComponent",e)}(),function(){"use strict";function e(e,t,o,n){function r(t,n){t=null!==t&&t,t===!0&&v.remove(w);var r=v.get(w);return angular.isDefined(r)&&r?e.when(r):o.get(h+"GetMobileDashboard").then(function(e){return v.put(w,e),e})}function a(e){return o.get(h+"GetBarcodeDetails?barcode="+e)}function i(e,t){return o.get(h+"DeleteProduct?barcode="+e+"&productNum="+t)}function c(e){return o.post(h+"UpdateProduct?fromMobile=true",e)}function l(e,t){return o.get(h+"GetProductsLists?searchPattern="+e+"&alphabet="+t)}function s(e){return o.post(h+"AddProductsToOrder?fromMobile=true",e)}function u(e){return o.get(h+"GetBarcodeInvoiceAndProductDetails?barcode="+e)}function d(e){return o.post(h+"SaveJsonSignForBarcode",e)}function m(e){return o.post(h+"SendInvoiceMail",e)}function p(e){return o.get(h+"GetImagesList?barcode="+e)}function f(e){return o.get(h+"GetUploadedDocuments?barcode="+e)}function g(e){return o.post(h+"UploadFile",e)}var h="api/workorders/",v=t("orderCache"),w="dashboardData";return{getMobileDashboard:r,getBarcodeDetails:a,deleteProduct:i,updateProduct:c,searchProduct:l,addProduct:s,getBarcodeInvoiceAndProductDetails:u,saveJsonSignForBarcode:d,sendInvoiceMail:m,getImagesList:p,getUploadedDocuments:f,uploadFile:g}}e.$inject=["$q","$cacheFactory","api-base-factory","shared-data-factory"],angular.module("fpm").factory("work-orders-factory",e)}();